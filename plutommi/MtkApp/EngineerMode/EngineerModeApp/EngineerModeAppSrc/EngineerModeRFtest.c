/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE. 
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/
/*****************************************************************************
 *
 * Filename:
 * ---------
 *  EngineerModeRFtest.c
 *
 * Project:
 * -------- 
 *  MAUI
 *
 * Description:
 * ------------
 *  Coding Template header file
 *
 * Author:
 * -------
 * -------
 *
 *============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 *
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *============================================================================
 ****************************************************************************/
 
/***************************************************************************** 
 * Include 
 *****************************************************************************/
#include "MMI_features.h"

#ifdef __MMI_ENGINEER_MODE__ 
    
#include "MMIDataType.h"
#include "kal_general_types.h"
#include "mmi_frm_utility_gprot.h"
#include "mmi_msg_struct.h"
#include "GlobalConstants.h"
#include "wgui_categories_util.h"
#include "mmi_frm_history_gprot.h"
#include "stack_msgs.h"
#include "mmi_frm_events_gprot.h"
#include "EngineerModeResDef.h"
#include "GlobalMenuItems.h"
#include "CustMenuRes.h"
#include "wgui_categories_list.h"
#include "GlobalResDef.h"
#include "mmi_frm_input_gprot.h"
#include "GpioSrvGprot.h"
#include "wgui_inline_edit.h"
#include "stdio.h"
#include "Unicodexdcl.h"
#include "mmi_frm_queue_gprot.h"
#include "app_ltlcom.h"
#include "device.h"
#include "TimerEvents.h"
#include "mmi_frm_timer_gprot.h"
#include "ps_public_struct.h"
#include "kal_public_api.h"
#include "CustDataRes.h"
#include "ImeGprot.h"
#include "wgui_fixed_menus.h"
#include "stdlib.h"
#include "string.h"
#include "mmi_res_range_def.h"

#include "Dtcntsrvgprot.h"
#include "DataAccountGprot.h"

#include "CommonScreens.h"

#include "ShutdownSrvGprot.h"
#include "Modeswitchsrvgprot.h"
#include "ProfilesSrvGProt.h"
#include "fseditorcuigprot.h"
#include "inlinecuigprot.h"
#include "SimCtrlSrvGprot.h"


#ifdef __MMI_EM_RF_WIFI__
#include "wndrv_ft_types.h"
#include "wndrv_api.h"
#endif

#include "mmi_rp_app_engineermode1_def.h"
#include "EngineerModeUtil.h"
#include "EngineerModeDef.h"
#include "EngineerModeCommUI.h"
#include "EngineerModeRFtest.h"

/***************************************************************************** 
 * Define
 *****************************************************************************/
typedef enum
{
    MMI_EM_CAPTION_1 = CUI_INLINE_ITEM_ID_BASE + 0,
    MMI_EM_CAPTION_2,
    MMI_EM_CAPTION_3,
    MMI_EM_CAPTION_4,
    MMI_EM_CAPTION_5,
    MMI_EM_CAPTION_6,
    MMI_EM_CAPTION_7,
    MMI_EM_CAPTION_8,
    MMI_EM_CAPTION_9,
    MMI_EM_CAPTION_10,
    MMI_EM_CAPTION_11,
        
    MMI_EM_TEXT_EDIT_1,
    MMI_EM_TEXT_EDIT_2,
    MMI_EM_TEXT_EDIT_3,
    MMI_EM_TEXT_EDIT_4,
    MMI_EM_TEXT_EDIT_5,
    MMI_EM_TEXT_EDIT_6,
        
    MMI_EM_STR_SELECT_1,
    MMI_EM_STR_SELECT_2,
    MMI_EM_STR_SELECT_3,
    MMI_EM_STR_SELECT_4,
    MMI_EM_STR_SELECT_5,
    MMI_EM_STR_SELECT_6,
    MMI_EM_STR_SELECT_7,
    MMI_EM_STR_SELECT_8,
    MMI_EM_STR_SELECT_9,
    MMI_EM_STR_SELECT_10,
    
    MMI_EM_DISPLAY_ONLY_1,
    MMI_EM_DISPLAY_ONLY_2,
    MMI_EM_DISPLAY_ONLY_3,
    MMI_EM_DISPLAY_ONLY_4,
    MMI_EM_DISPLAY_ONLY_5,
    MMI_EM_DISPLAY_ONLY_6,
MMI_EM_DEV_DEV_RF_TEST_ITEM_ID_END_OF_ENUM
} mmi_em_dev_rf_test_item_id_enum;


#define MMI_EM_RF_TX_ARF_RESULT    (0X1)
#define MMI_EM_RF_TX_TSC_RESULT    (0X2)
#define MMI_EM_RF_TX_RCL_RESULT    (0X4)
#define MMI_EM_RF_TX_AFC_RESULT    (0X8)

#define MMI_EM_RF_TX_BAND_GSM850_ID  (0)
#define MMI_EM_RF_TX_BAND_GSM900_ID  (1)
#define MMI_EM_RF_TX_BAND_DCS1800_ID (2)
#define MMI_EM_RF_TX_BAND_PCS1900_ID (3)

#define  MMI_EM_RF_TX_BURST_NB_ID         (0)
#define  MMI_EM_RF_TX_BURST_NBALL_ID      (1)
#define  MMI_EM_RF_TX_BURST_AB            (2)
#define  MMI_EM_RF_TX_BURST_CONTTX00      (3)
#define  MMI_EM_RF_TX_BURST_CONTTX11      (4)
#define  MMI_EM_RF_TX_BURST_CONTTX01      (5)
#define  MMI_EM_RF_TX_BURST_CONTTX_RANDOM (6)

#if defined(__MMI_EM_RF_GSM__) || defined(__MMI_EM_RF_WIFI__)
typedef enum {

   EM_SLEEPMODE_STATE_ENABLE = 0 ,
   EM_SLEEPMODE_STATE_DISABLE
   
}  EM_SLEEPMODE_STATE_ENUM;

U8 g_rf_tool_sleep_mode_state = EM_SLEEPMODE_STATE_ENABLE;
#endif 


#ifdef __MMI_EM_RF_GSM__
/* RF Test Tool -- GSM */
typedef enum {

   EM_RF_GSM_BAND_GSM850 = 0 ,
   EM_RF_GSM_BAND_GSM900,
   EM_RF_GSM_BAND_DCS1800,
   EM_RF_GSM_BAND_PCS1900
   
}  EM_RF_GSM_BAND_ENUM;

#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif

static const U8 rf_gsm_band[4] = { 0x80, 0x02, 0x08, 0x10 };

static const U8 g_mmi_em_rf_test_tx_bursttype_values[] = {MMI_EM_RF_TX_BURST_NB_ID, 
                                                        MMI_EM_RF_TX_BURST_AB};


#define EM_RF_TOOL_GSM_POWERSCAN_DURATION         3000   /* 3 s*/
#define EM_RF_TOOL_GSM_RX_BURST_DURATION          9500   /* 9.5 s*/

typedef struct
{
    PS16    arfcn;
    PS16    power;
    U32     cur_index;    
}rf_test_gsm_power_scan_rsp_struct;


typedef struct {

    S32     currRFGsmBand;
    S32     currTxBurstType;     
    S32     currRxBurstType;         
    U16     int_arfcn;         /* atoi value */
    S16     int_afc;           /* atoi value */
    S16     int_gain;          /* atoi value */  
    U8      int_tsc;           /* atoi value */
    U8      int_pcl;           /* atoi value */
    U8      req_type;

    MMI_BOOL is_powerscan_requesting;
    
    WCHAR   arfcn[10];
    WCHAR   tsc[10];
    WCHAR   pcl[10];    
    WCHAR   afc[10];    
    WCHAR   gain[10];
    U8      *pEMRFGsmBand[4];
    U8      *pEMRFGsmBurstType[7];
    MMI_BOOL     request_processing;    
    rf_test_gsm_power_scan_rsp_struct power_scan_rsp;
    mmi_id  rf_test_gsm_menu_id;    
} em_rf_test_gsm_struct;

em_rf_test_gsm_struct g_rf_test_gsm_cntx={0};

#endif /* #ifdef __MMI_EM_RF_GSM__ */

/***************************************************************************** 
 * Static Declaration
 *****************************************************************************/


/***************************************************************************** 
 * Global Variable
 *****************************************************************************/


/***************************************************************************** 
 * Local Function
 *****************************************************************************/


/***************************************************************************** 
 * Global Function 
 *****************************************************************************/


#if defined(__MMI_EM_RF_GSM__) || defined(__MMI_EM_RF_WIFI__)
 /**************************************************************
  ***************** GSM  RF Test *******************************
  **************************************************************/
 
 /**************************************************************
 **  FUNCTION NAME       : EmRFTestDisableSleepMode
 **
 **  PURPOSE             : RF Test Disable Sleep Mode
 **
 **  INPUT PARAMETERS    : nil
 **
 **  OUTPUT PARAMETERS   : void
 **
 **  RETURNS             : void
 **
 **  REMARKS         : 
 **************************************************************/
 void EmRFTestDisableSleepMode(void)
 {
     /*----------------------------------------------------------------*/
     /* Local Variables                                                */
     /*----------------------------------------------------------------*/
 
     /*----------------------------------------------------------------*/
     /* Code Body                                                      */
     /*----------------------------------------------------------------*/
     /* re-register protocol event handler of MSG_ID_MMI_EQ_SET_SLEEP_MODE_RSP */
#ifdef __MTK_TARGET__     
	 cui_menu_pause(mmi_em_get_main_menu_id());
#endif
     SetProtocolEventHandler (EmRFTestToolSleepModeHdlr, MSG_ID_MMI_EQ_SET_SLEEP_MODE_RSP);    
 
     g_rf_tool_sleep_mode_state = EM_SLEEPMODE_STATE_DISABLE;    
     EngineerModeSetSleepModeReq(EM_SLEEPMODE_STATE_DISABLE);    
 }

 /**************************************************************
 **  FUNCTION NAME       : EmRFTestEnableSleepMode
 **
 **  PURPOSE             : RF Test Tool Enable Sleep Mode
 **
 **  INPUT PARAMETERS    : nil
 **
 **  OUTPUT PARAMETERS   : void
 **
 **  RETURNS             : void
 **
 **  REMARKS         : 
 **************************************************************/
 void EmRFTestEnableSleepMode(void)
 {
     /*----------------------------------------------------------------*/
     /* Local Variables                                                */
     /*----------------------------------------------------------------*/
 
     /*----------------------------------------------------------------*/
     /* Code Body                                                      */
     /*----------------------------------------------------------------*/
    /* re-register protocol event handler of MSG_ID_MMI_EQ_SET_SLEEP_MODE_RSP */
     SetProtocolEventHandler (EmRFTestToolSleepModeHdlr, MSG_ID_MMI_EQ_SET_SLEEP_MODE_RSP);    
 
     g_rf_tool_sleep_mode_state = EM_SLEEPMODE_STATE_ENABLE;    
     EngineerModeSetSleepModeReq(EM_SLEEPMODE_STATE_ENABLE); 
 
 }
     
 
 /**************************************************************
 **  FUNCTION NAME       : EmRFTestToolSleepModeHdlr
 **
 **  PURPOSE             : RF Test Tool Sleep Mode Handler
 **
 **  INPUT PARAMETERS    : nil
 **
 **  OUTPUT PARAMETERS   : void
 **
 **  RETURNS             : void
 **
 **  REMARKS         : 
 **************************************************************/
 void  EmRFTestToolSleepModeHdlr(void* inMsg)
 {
     /*----------------------------------------------------------------*/
     /* Local Variables                                                */
     /*----------------------------------------------------------------*/
 
     /*----------------------------------------------------------------*/
     /* Code Body                                                      */
     /*----------------------------------------------------------------*/
     switch (g_rf_tool_sleep_mode_state)
     {
         case EM_SLEEPMODE_STATE_ENABLE: /* enable measn that exit RF Test Screen */
         {
             /* recover the protocol event handler of MSG_ID_MMI_EQ_SET_SLEEP_MODE_RSP */
             SetProtocolEventHandler (EngineerModeSetSleepModeRes, MSG_ID_MMI_EQ_SET_SLEEP_MODE_RSP);           
             
             /* resume MMI sleep mode */
             srv_backlight_turn_on(SRV_BACKLIGHT_SHORT_TIME);

             break;
         }
         case EM_SLEEPMODE_STATE_DISABLE: /* disable means that enter RF Test Screen*/
         {
             /* stop MMI sleep mode */
             srv_backlight_turn_on(SRV_BACKLIGHT_PERMANENT);
             
             /* Enter RF Test Tool Screen */
             cui_menu_play(mmi_em_get_main_menu_id());
             break;
          }
     }
 }
 
 
 /**************************************************************
 
     FUNCTION NAME       : ExitEmRFTestInlineSelectScreen()
 
     PURPOSE             : Exit Em RF Test inline select screen
 
     INPUT PARAMETERS    : nil
 
     OUTPUT PARAMETERS   : nil
 
     RETURNS             : void
 
     REMARKS             : nil
 
 **************************************************************/
 void ExitEmRFTestInlineSelectScreen(void)
 {
     /*----------------------------------------------------------------*/
     /* Local Variables                                                */
     /*----------------------------------------------------------------*/
 
     /*----------------------------------------------------------------*/
     /* Code Body                                                      */
     /*----------------------------------------------------------------*/
     CloseCategory57Screen();
 }
#endif /* #ifdef __MMI_EM_RF_GSM__ || defined(#if defined(__MMI_EM_RF_WIFI__)) */



 #ifdef __MMI_EM_RF_GSM__

#define MMI_EM_GSM_RF_SHOW_TEXT_BUF_LEN       (150*sizeof(WCHAR))

 
static void mmi_em_fs_trace_pw_set_hdlr(void);
static void mmi_em_rf_test_gsm_enter_confirm_hdlr(void);
static void mmi_em_rf_test_gsm_band_highlight_hdlr(cui_event_inline_common_struct *event);
static MMI_BOOL mmi_em_rf_test_gsm_tx_set_value(U16 *value, U16 item_id, U16 check_num, cui_event_inline_common_struct* inline_evt);
static U16 mmi_em_rf_test_gsm_check_gsm_arfcn_valid(cui_event_inline_common_struct* inline_evt);
static MMI_ID mmi_em_rf_test_gsm_enter_list(void);
static MMI_RET mmi_em_rf_test_gsm_powerscan_rsp_scrn_proc(mmi_event_struct* param);
static void mmi_em_rf_test_gsm_power_scan_rsp_update(PS16 arfcn, PS16 power);


/**************************************************************
**    FUNCTION NAME        : EMRFTestGSMInitContext
**
**  PURPOSE                :  
**
**    INPUT PARAMETERS    : nil
**
**    OUTPUT PARAMETERS    : void
**
**    RETURNS                : void
**
**    REMARKS            : 
**************************************************************/
void EMRFTestGSMInitContext(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_rf_test_gsm_cntx.currRFGsmBand = 1;  /* default hilte GSM900 */

    mmi_wcs_itow(20, g_rf_test_gsm_cntx.arfcn, 10);
    g_rf_test_gsm_cntx.int_arfcn = 20;

    /* tsc default value */        
    mmi_wcs_itow(5, g_rf_test_gsm_cntx.tsc, 10);
    g_rf_test_gsm_cntx.int_tsc= 5;
            
    /* pcl default value */        
    mmi_wcs_itow(5, g_rf_test_gsm_cntx.pcl, 10);
    g_rf_test_gsm_cntx.int_pcl = 5;
    
    /* afc default value */        
    mmi_wcs_itow(4100, g_rf_test_gsm_cntx.afc, 10);
    g_rf_test_gsm_cntx.int_afc = 4100;
    
    /* burst type default value */        
    g_rf_test_gsm_cntx.currTxBurstType = 0;  /* NB */
    
    /* rx gain default value */        
    mmi_wcs_itow(40, g_rf_test_gsm_cntx.gain, 10);
    g_rf_test_gsm_cntx.int_gain = 40;
        
//    g_rf_test_gsm_cntx.power_scan_flag = EM_RF_GSM_POWERSCAN_NONE;
}


/**************************************************************
**    FUNCTION NAME        : EMRFTestGsmSendReq
**
**     PURPOSE                : RF Test GSM send request function. 
**
**    INPUT PARAMETERS    : nil
**
**    OUTPUT PARAMETERS    : void
**
**    RETURNS                : void
**
**    REMARKS            : 
**************************************************************/
void EMRFTestGsmSendReq(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_eq_rf_test_gsm_req_struct *msg_p;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    msg_p = OslConstructDataPtr(sizeof(mmi_eq_rf_test_gsm_req_struct));

    msg_p->request_type = g_rf_test_gsm_cntx.req_type;

    switch(g_rf_test_gsm_cntx.req_type)
    {
        case RF_TEST_GSM_STOP:
        {
            StopTimer(EM_RINGTONE_HIGHLIGHT_TIMER);    
            break;
        }
        case RF_TEST_GSM_TX_TEST:
        {
            msg_p->request.gsm_tx_test.band = rf_gsm_band[g_rf_test_gsm_cntx.currRFGsmBand];           
            msg_p->request.gsm_tx_test.arfcn = g_rf_test_gsm_cntx.int_arfcn;
            msg_p->request.gsm_tx_test.tsc = g_rf_test_gsm_cntx.int_tsc;
            msg_p->request.gsm_tx_test.pcl = g_rf_test_gsm_cntx.int_pcl;
            msg_p->request.gsm_tx_test.afc = g_rf_test_gsm_cntx.int_afc;
            msg_p->request.gsm_tx_test.pattern  = g_mmi_em_rf_test_tx_bursttype_values[g_rf_test_gsm_cntx.currTxBurstType];
            break;
        }
        case RF_TEST_GSM_RX_TEST:
        {
            msg_p->request.gsm_rx_test.band = rf_gsm_band[g_rf_test_gsm_cntx.currRFGsmBand];                       
            msg_p->request.gsm_rx_test.arfcn = g_rf_test_gsm_cntx.int_arfcn;
            msg_p->request.gsm_rx_test.gain = g_rf_test_gsm_cntx.int_gain;
            msg_p->request.gsm_rx_test.pattern = g_rf_test_gsm_cntx.currRxBurstType;
            break;           
        }
        case RF_TEST_GSM_POWER_SCAN:
        {
            msg_p->request.gsm_power_scan.band = rf_gsm_band[g_rf_test_gsm_cntx.currRFGsmBand];                       
            msg_p->request.gsm_power_scan.arfcn_in = g_rf_test_gsm_cntx.int_arfcn;
            break;           
        }
       default:
            break;
    }

    EngineerModeSendMsg(MSG_ID_MMI_EQ_RF_TEST_GSM_REQ, msg_p, NULL);

}


/**************************************************************
**    FUNCTION NAME        : EMRFTestGsmSendRes
**
**     PURPOSE                : RF Test GSM send request response function. 
**
**    INPUT PARAMETERS    : nil
**
**    OUTPUT PARAMETERS    : void
**
**    RETURNS                : void
**
**    REMARKS            : 
**************************************************************/
void EMRFTestGsmSendRes(void* inMsg)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_eq_rf_test_gsm_rsp_struct *rsp_p = inMsg;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(rsp_p->request_type)
    {
        case RF_TEST_GSM_POWER_SCAN:
        {
            EntryEMRFGSMPowerScanRsp(rsp_p->request.gsm_power_scan.arfcn_out, rsp_p->request.gsm_power_scan.power);
            break;
        }
        default:
            break;
    }

}


/**************************************************************

    FUNCTION NAME        : EmStopRFTestGsm()

      PURPOSE                : Stop Em RF Test GSM Request

    INPUT PARAMETERS    : nil

    OUTPUT PARAMETERS    : nil

    RETURNS                : void

    REMARKS                : nil

**************************************************************/
void EmStopRFTestGsm(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_rf_test_gsm_cntx.request_processing == MMI_TRUE)
    {
        g_rf_test_gsm_cntx.req_type = RF_TEST_GSM_STOP;
        g_rf_test_gsm_cntx.request_processing = MMI_FALSE;
        EMRFTestGsmSendReq();        
    }
}

/**********************************************************************
 *  ref test -> GSM
 **********************************************************************/
static MMI_RET mmi_em_rf_test_gsm_confirm_proc(mmi_event_struct *evt);
static mmi_ret mmi_em_rf_test_gsm_list_entry_event_hdlr(mmi_event_struct *evt);
static mmi_ret mmi_em_rf_test_gsm_list_sel_event_hdlr(mmi_event_struct *evt);
static mmi_ret mmi_em_rf_test_gsm_list_proc(mmi_event_struct *evt);
static void mmi_em_rf_test_gsm_enter_silient_confirm(void);
static MMI_RET mmi_em_rf_test_gsm_silient_confirm_proc(mmi_event_struct *evt);


/**********************************************************************
 *  ref test -> GSM -> tx set
 **********************************************************************/
MMI_RET mmi_em_rf_test_gsm_tx_set_scrn_proc(mmi_event_struct *evt);
static void mmi_em_rf_test_gsm_tx_set_hdlr(void);

/**********************************************************************
 *  ref test -> GSM -> rx set
 **********************************************************************/
static MMI_RET mmi_em_rf_test_gsm_rx_set_scrn_proc(mmi_event_struct *evt);
static void mmi_em_rf_test_gsm_rx_check_and_send_req(cui_event_inline_common_struct *inline_evt);
static void mmi_em_rf_test_gsm_rx_set_hdlr(void);



static void mmi_em_rf_test_gsm_enter_confirm_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 sim_idx = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    for (sim_idx = 0; sim_idx < MMI_SIM_TOTAL; sim_idx++)
    {
        if (srv_sim_ctrl_is_available((mmi_sim_enum)(0x01 << sim_idx)))
        {
            break;
        }
    }
    
    if (sim_idx >= MMI_SIM_TOTAL)
    {
        mmi_display_popup(get_string(STR_GLOBAL_UNAVAILABLE_SIM), MMI_EVENT_WARNING);
        return;
    }

    mmi_em_display_confirm(STR_ID_EM_RF_TEST_GSM_CONFIRM_NOTIFY_TEST,
        mmi_em_get_root_group(),
        MMI_EVENT_WARNING,
        mmi_em_rf_test_gsm_confirm_proc);
}

static MMI_RET mmi_em_rf_test_gsm_confirm_proc(mmi_event_struct *evt)
{
    mmi_alert_result_evt_struct *alert = (mmi_alert_result_evt_struct*) evt;
    
    switch (alert->result)
    {
    case MMI_ALERT_CNFM_YES:
        EmRFTestGSMEnterFlightMode();
        break;
    default:
        break;
    }

    return MMI_RET_OK;
}

/**************************************************************
**    FUNCTION NAME        : EmRFTestGSMEnterFlightMode
**
**  PURPOSE                : RF Test GSM menu Enter Flight Mode
**
**    INPUT PARAMETERS    : nil
**
**    OUTPUT PARAMETERS    : void
**
**    RETURNS                : void
**
**    REMARKS            : 
**************************************************************/
void mmi_em_gsm_rf_test_replay_hdlr(void)
{
    /* check if request is processing. If yes, then stop it. */
    EmStopRFTestGsm();
    mmi_em_rf_test_gsm_enter_list();
}


#if defined(__FLIGHT_MODE_SUPPORT__) && defined(__MMI_TELEPHONY_SUPPORT__)
void EmRFTestGSMEnterFlightMode(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    mmi_em_dualmode_enter_flight_mode((FuncPtr)mmi_em_gsm_rf_test_replay_hdlr);
}
#endif


static MMI_ID mmi_em_rf_test_gsm_enter_list(void)
{
    MMI_ID em_root_group_id;
    MMI_ID em_main_menu_id;
    
    SetProtocolEventHandler(EMRFTestGsmSendRes ,  MSG_ID_MMI_EQ_RF_TEST_GSM_RSP);
    em_root_group_id = mmi_frm_group_create_ex(mmi_em_get_root_group(),
                                    GRP_ID_AUTO_GEN,
                                    mmi_em_rf_test_gsm_list_proc,
                                    NULL, 
                                    MMI_FRM_NODE_SMART_CLOSE_FLAG);
   
    em_main_menu_id = cui_menu_create_and_run(em_root_group_id,
                                CUI_MENU_SRC_TYPE_RESOURCE,
                                CUI_MENU_TYPE_FROM_RESOURCE,
                                MENU_ID_EM_RF_TEST_TOOL_GSM_LIST,
                                MMI_TRUE,
                                NULL);
    g_rf_test_gsm_cntx.rf_test_gsm_menu_id = em_main_menu_id;
    return em_main_menu_id;
}

static mmi_ret mmi_em_rf_test_gsm_list_proc(mmi_event_struct *evt)
{
    cui_menu_event_struct *menu_evt = (cui_menu_event_struct *)evt;
    switch (evt->evt_id)   
    {
    case EVT_ID_CUI_MENU_LIST_ENTRY:
        mmi_em_rf_test_gsm_list_entry_event_hdlr(evt);
        break;
        
    case EVT_ID_CUI_MENU_ITEM_SELECT:
        mmi_em_rf_test_gsm_list_sel_event_hdlr(evt);
        break;
        
    case EVT_ID_CUI_MENU_CLOSE_REQUEST:
        {
            cui_menu_close(menu_evt->sender_id);
            break;
        }
        
    case EVT_ID_GROUP_DEINIT:
        SetProtocolEventHandler(NULL,  MSG_ID_MMI_EQ_RF_TEST_GSM_RSP);
        EmRFTestGSMExitFlightMode();
        break;

    default:
        break;
    }
    
    return MMI_RET_OK;
}

static mmi_ret mmi_em_rf_test_gsm_list_entry_event_hdlr(mmi_event_struct *evt)
{
    return MMI_RET_OK;
}

static mmi_ret mmi_em_rf_test_gsm_list_sel_event_hdlr(mmi_event_struct *evt)
{
    cui_menu_event_struct *menu_evt = (cui_menu_event_struct *)evt;
    
    
    switch(menu_evt->highlighted_menu_id)
    {
        case MENU_ID_EM_RF_GSM_TX_TEST:
            mmi_em_rf_test_gsm_tx_set_hdlr();
            break;

        case MENU_ID_EM_RF_GSM_RX_TEST:
            mmi_em_rf_test_gsm_rx_set_hdlr();
            break;

        case MENU_ID_EM_RF_GSM_POWER_SCAN:
            mmi_em_fs_trace_pw_set_hdlr();
            break;

        default:
            break;
    }

    return MMI_RET_OK;
}

static mmi_ret exit_flight_mode_rsp_hdlr(mmi_event_struct *evt)
{
    if (evt->evt_id == EVT_ID_SRV_MODE_SWITCH_FINISH)
    {        
        cui_menu_close(g_rf_test_gsm_cntx.rf_test_gsm_menu_id);
        srv_shutdown_normal_start(APP_ENGINEERMODE1);
    }

    return MMI_RET_OK;
}
/**************************************************************
**    FUNCTION NAME        : EmRFTestGSMExitFlightMode
**
**  PURPOSE                : RF Test GSM menu Exit Flight Mode
**
**    INPUT PARAMETERS    : nil
**
**    OUTPUT PARAMETERS    : void
**
**    RETURNS                : void
**
**    REMARKS            : 
**************************************************************/
void EmRFTestGSMExitFlightMode(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    srv_mode_switch_switch_rf_mode(SRV_MODE_SWITCH_SIM_ALL, exit_flight_mode_rsp_hdlr, NULL);
}


void mmi_em_rf_test_gsm_tx_init_hdlr(MMI_ID inline_gid, U16 item_id, U16 set_value)
{
    WCHAR wcs_buf[20];

    mmi_wcs_itow((S32)set_value, wcs_buf, 10);
    cui_inline_set_value(inline_gid, item_id, (void*)wcs_buf);
}


static const cui_inline_item_caption_struct g_mmi_em_rf_test_tx_cap0 = 
{
    STR_ID_EM_RF_GSM_TX_BAND,
};


static const U16 g_mmi_em_rf_test_tx_select_str0[4] = {STR_ID_EM_RF_GSM_TX_BAND_GSM850, 
                                                    STR_ID_EM_RF_GSM_TX_BAND_GSM900,
                                                    STR_ID_EM_RF_GSM_TX_BAND_DCS1800,
                                                    STR_ID_EM_RF_GSM_TX_BAND_PCS1900};

static const cui_inline_item_select_struct g_mmi_em_rf_test_tx_select0 = 
{
    4,
    0,
    (U16*)g_mmi_em_rf_test_tx_select_str0,
};

static const cui_inline_item_caption_struct g_mmi_em_rf_test_tx_cap1 = 
{
    STR_ID_EM_RF_GSM_TX_ARFCN,
};

static const cui_inline_item_text_edit_struct g_mmi_em_rf_test_tx_text_edit0 =
{
    0,
    0,
    10,
    IMM_INPUT_TYPE_NUMERIC,
    0,
    NULL    
};

static const cui_inline_item_caption_struct g_mmi_em_rf_test_tx_cap2 = 
{
    STR_ID_EM_RF_GSM_TX_TSC,
};

static const cui_inline_item_text_edit_struct g_mmi_em_rf_test_tx_text_edit1 =
{
    0,
    0,
    10,
    IMM_INPUT_TYPE_NUMERIC,
    0,
    NULL    
};

static const cui_inline_item_caption_struct g_mmi_em_rf_test_tx_cap3 = 
{
    STR_ID_EM_RF_GSM_TX_PCL,
};

static const cui_inline_item_text_edit_struct g_mmi_em_rf_test_tx_text_edit2 =
{
    0,
    0,
    10,
    IMM_INPUT_TYPE_NUMERIC,
    0,
    NULL    
};

static const cui_inline_item_caption_struct g_mmi_em_rf_test_tx_cap4 = 
{
    STR_ID_EM_RF_GSM_TX_AFC,
};

static const cui_inline_item_text_edit_struct g_mmi_em_rf_test_tx_text_edit3 =
{
    0,
    0,
    10,
    IMM_INPUT_TYPE_NUMERIC,
    0,
    NULL    
};

static const cui_inline_item_caption_struct g_mmi_em_rf_test_tx_cap5 = 
{
    STR_ID_EM_RF_GSM_TX_BURST_TYPE,
};

static const U16 g_mmi_em_rf_test_tx_select_str1[] = {STR_ID_EM_RF_GSM_TX_BURST_NB, 
                                                    STR_ID_EM_RF_GSM_TX_BURST_AB};


static const cui_inline_item_select_struct g_mmi_em_rf_test_tx_select1 = 
{
    sizeof(g_mmi_em_rf_test_tx_select_str1)/sizeof(U16),
    0,
    (U16*)g_mmi_em_rf_test_tx_select_str1,
};

/* For 10A*/
static const cui_inline_set_item_struct g_mmi_em_rf_test_tx_inline[12] = 
{
    {MMI_EM_CAPTION_1, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_test_tx_cap0},
    {MMI_EM_STR_SELECT_1, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_test_tx_select0},
    {MMI_EM_CAPTION_2, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_test_tx_cap1},
    {MMI_EM_TEXT_EDIT_1, CUI_INLINE_ITEM_TYPE_TEXT_EDIT, 0, (void*)&g_mmi_em_rf_test_tx_text_edit0},
    {MMI_EM_CAPTION_3, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_test_tx_cap2},
    {MMI_EM_TEXT_EDIT_2, CUI_INLINE_ITEM_TYPE_TEXT_EDIT, 0, (void*)&g_mmi_em_rf_test_tx_text_edit1},
    {MMI_EM_CAPTION_4, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_test_tx_cap3},
    {MMI_EM_TEXT_EDIT_3, CUI_INLINE_ITEM_TYPE_TEXT_EDIT, 0, (void*)&g_mmi_em_rf_test_tx_text_edit2},
    {MMI_EM_CAPTION_5, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_test_tx_cap4},
    {MMI_EM_TEXT_EDIT_4, CUI_INLINE_ITEM_TYPE_TEXT_EDIT, 0, (void*)&g_mmi_em_rf_test_tx_text_edit3},
    {MMI_EM_CAPTION_6, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_test_tx_cap5},
    {MMI_EM_STR_SELECT_2, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_test_tx_select1},
};

static const cui_inline_struct g_mmi_em_rf_test_tx_inline_screen = 
{
    12,
    STR_ID_EM_RF_GSM_TX_TEST,
    0,
    CUI_INLINE_SCREEN_LOOP|CUI_INLINE_SCREEN_DISABLE_DONE,
    NULL,
    (const cui_inline_set_item_struct*)&g_mmi_em_rf_test_tx_inline,
};

void mmi_em_rf_test_gsm_init_tx_test_data(MMI_ID inline_id)
{
     cui_inline_set_value(inline_id, MMI_EM_STR_SELECT_1, (void*)g_rf_test_gsm_cntx.currRFGsmBand);
     mmi_em_rf_test_gsm_tx_init_hdlr(inline_id, MMI_EM_TEXT_EDIT_1, g_rf_test_gsm_cntx.int_arfcn);
     mmi_em_rf_test_gsm_tx_init_hdlr(inline_id, MMI_EM_TEXT_EDIT_2, g_rf_test_gsm_cntx.int_tsc);
     mmi_em_rf_test_gsm_tx_init_hdlr(inline_id, MMI_EM_TEXT_EDIT_3, g_rf_test_gsm_cntx.int_pcl);
     mmi_em_rf_test_gsm_tx_init_hdlr(inline_id, MMI_EM_TEXT_EDIT_4, g_rf_test_gsm_cntx.int_afc);
     cui_inline_set_value(inline_id, MMI_EM_STR_SELECT_2, (void*)g_rf_test_gsm_cntx.currTxBurstType);
}

MMI_RET mmi_em_rf_test_gsm_tx_set_scrn_proc(mmi_event_struct *evt);

static void mmi_em_rf_test_gsm_tx_set_hdlr(void)
{
    MMI_ID gid;
    MMI_ID inline_id;
    gid = mmi_frm_group_create_ex(mmi_em_get_root_group(),
                                GRP_ID_AUTO_GEN,
                                mmi_em_rf_test_gsm_tx_set_scrn_proc,
                                NULL,
                                MMI_FRM_NODE_SMART_CLOSE_FLAG);
    inline_id = cui_inline_create(gid, &g_mmi_em_rf_test_tx_inline_screen);    
    mmi_em_rf_test_gsm_init_tx_test_data(inline_id);    
    cui_inline_run(inline_id);
}


void mmi_em_rf_test_gsm_tx_check_and_send_req(cui_event_inline_common_struct* inline_evt);

MMI_RET mmi_em_rf_test_gsm_tx_set_scrn_proc(mmi_event_struct *evt)
{
    cui_event_inline_common_struct* inline_evt = (cui_event_inline_common_struct*) evt;
    cui_event_inline_notify_struct* notify_evt = (cui_event_inline_notify_struct*) evt;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(evt->evt_id)
    {
        case EVT_ID_CUI_INLINE_SUBMIT:
        case EVT_ID_CUI_INLINE_CSK_PRESS:
            mmi_em_rf_test_gsm_tx_check_and_send_req(inline_evt);
            break;

        case EVT_ID_CUI_INLINE_ABORT:
            cui_inline_close(inline_evt->sender_id);
            break;
        
        case EVT_ID_CUI_INLINE_MAIN_SCREEN_ACTIVE:
            EmStopRFTestGsm();
            g_rf_test_gsm_cntx.req_type = RF_TEST_GSM_TX_TEST;
            break;
        case EVT_ID_CUI_INLINE_NOTIFY:
            if (CUI_INLINE_NOTIFY_HIGHLIGHT_ITEM == notify_evt->event_type)
            {
                EmStopRFTestGsm();
            }      
            else if (MMI_EM_STR_SELECT_1 == notify_evt->item_id &&
                CUI_INLINE_NOTIFY_SELECT_FOCUS_CHANGED == notify_evt->event_type)
            {
             mmi_em_rf_test_gsm_band_highlight_hdlr(inline_evt);
            }
            break;

        default:
            break;
    }
    return MMI_RET_OK;
}

static void mmi_em_rf_test_gsm_band_highlight_hdlr(cui_event_inline_common_struct *event)
{
    U32 index = 0;
    U32 value = 0;
    WCHAR buffer[10];

    cui_inline_get_value(event->sender_id, MMI_EM_STR_SELECT_1, &index);
    g_rf_test_gsm_cntx.currRFGsmBand = index;
    switch (index)
    {
        case RF_TEST_GSM_TX_BAND_900:
        {   
            value = 20;
            break;
        }
        case RF_TEST_GSM_TX_BAND_850:
        {
            value = 128;
            break;
        }
        case RF_TEST_GSM_TX_BAND_1800:
        {
            value = 512;
            break;
        }
        case RF_TEST_GSM_TX_BAND_1900:
        {
            value = 512;
            break;
        }
        default:
            ASSERT(0);
    }
    mmi_wcs_itow(value, buffer, 10);
    cui_inline_set_value(event->sender_id, MMI_EM_TEXT_EDIT_1, (void*)buffer);
}


WCHAR* mmi_em_rf_test_gsm_tx_reset_band(U16 index);

void mmi_em_rf_test_gsm_tx_check_and_send_req(cui_event_inline_common_struct* inline_evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 result0 = MMI_TRUE, result1 = MMI_TRUE, result2 = MMI_TRUE, result3 = MMI_TRUE;
    U16 value;
    WCHAR *detail_buf;
    mmi_em_text_viewer_struct detail = {0};

    /* To check if ARFCN is valid */    
    result0 = mmi_em_rf_test_gsm_check_gsm_arfcn_valid(inline_evt);

    cui_inline_get_value(inline_evt->sender_id, MMI_EM_STR_SELECT_1, &g_rf_test_gsm_cntx.currRFGsmBand);
    cui_inline_get_value(inline_evt->sender_id, MMI_EM_STR_SELECT_2, &g_rf_test_gsm_cntx.currTxBurstType);
    result1 = mmi_em_rf_test_gsm_tx_set_value(&value, MMI_EM_TEXT_EDIT_2, 7, inline_evt);
    g_rf_test_gsm_cntx.int_tsc = (U8)value;
    result2 = mmi_em_rf_test_gsm_tx_set_value(&value, MMI_EM_TEXT_EDIT_3, 31, inline_evt);
    g_rf_test_gsm_cntx.int_pcl = (U8)value;
    result3 = mmi_em_rf_test_gsm_tx_set_value(&value, MMI_EM_TEXT_EDIT_4, 8191, inline_evt);
    g_rf_test_gsm_cntx.int_afc = value;

     /* If one of the parameters is invalid, then pop-up error and return */
    if (result0 == MMI_FALSE || result1 == MMI_FALSE || result2 == MMI_FALSE || result3 == MMI_FALSE)
    {
        mmi_em_popup_by_str(STR_GLOBAL_ERROR, MMI_EVENT_FAILURE);
        return;
    }
    /* Send request to RF , now req_type = RF_TEST_GSM_TX_TEST */
    g_rf_test_gsm_cntx.request_processing = MMI_TRUE;
    EMRFTestGsmSendReq();

    detail_buf = OslMalloc(MMI_EM_GSM_RF_SHOW_TEXT_BUF_LEN);

    kal_wsprintf(detail_buf, "%w: %w\n%w: %d\n%w: %d\n%w: %d\n%w: %d\n%w: %w\n",
              get_string(STR_ID_EM_RF_GSM_TX_BAND), 
              mmi_em_rf_test_gsm_tx_reset_band(g_rf_test_gsm_cntx.currRFGsmBand),
              get_string(STR_ID_EM_RF_GSM_TX_ARFCN),
              g_rf_test_gsm_cntx.int_arfcn,
              get_string(STR_ID_EM_RF_GSM_TX_TSC), 
              g_rf_test_gsm_cntx.int_tsc,
              get_string(STR_ID_EM_RF_GSM_TX_PCL), 
              g_rf_test_gsm_cntx.int_pcl,
              get_string(STR_ID_EM_RF_GSM_TX_AFC), 
              g_rf_test_gsm_cntx.int_afc,
              get_string(STR_ID_EM_RF_GSM_TX_BURST_TYPE),
              get_string(g_mmi_em_rf_test_tx_select_str1[g_rf_test_gsm_cntx.currTxBurstType])
              );
    /* show RF Test GSM TX Test Detail screen */
    detail.title_id = STR_ID_EM_RF_GSM_TX_TEST;
    detail.text = (const WCHAR *)detail_buf;
    mmi_em_show_text_viewer(&detail);
    OslMfree(detail_buf);
}

WCHAR* mmi_em_rf_test_gsm_tx_reset_band(U16 index)
{
    U16 str_id = 0;

    switch (index)
    {
    case MMI_EM_RF_TX_BAND_GSM850_ID:
        str_id = STR_ID_EM_RF_GSM_TX_BAND_GSM850;
        break;

    case MMI_EM_RF_TX_BAND_GSM900_ID:
        str_id = STR_ID_EM_RF_GSM_TX_BAND_GSM900;
        break;

    case MMI_EM_RF_TX_BAND_DCS1800_ID:
        str_id = STR_ID_EM_RF_GSM_TX_BAND_DCS1800;
        break;

    case MMI_EM_RF_TX_BAND_PCS1900_ID:
        str_id = STR_ID_EM_RF_GSM_TX_BAND_PCS1900;
        break;

    default:
        break;

    }
    return get_string(str_id);
}


static MMI_BOOL mmi_em_rf_test_gsm_tx_set_value(U16 *value, U16 item_id, U16 check_num, cui_event_inline_common_struct* inline_evt)
{
    WCHAR  textbuf[20];
    MMI_BOOL result = MMI_TRUE;


    cui_inline_get_value(inline_evt->sender_id, item_id, textbuf);
    if (textbuf[0] == 0)
        result = MMI_FALSE;
    *value = mmi_wcs_wtoi(textbuf);
    if (*value > check_num)
        result = MMI_FALSE;

    return result;
}

static const cui_inline_item_caption_struct g_mmi_em_rf_test_rx_cap2 = 
{
    STR_ID_EM_RF_GSM_TX_GAIN,
};

static const cui_inline_item_text_edit_struct g_mmi_em_rf_test_rx_text_edit1 =
{
    0,
    0,
    5,
    IMM_INPUT_TYPE_NUMERIC,
    0,
    NULL    
};

static const U16 g_mmi_em_rf_test_rx_select_str1[] = {STR_ID_EM_RF_GSM_RX_BURST_BURST_RX};

static const cui_inline_item_select_struct g_mmi_em_rf_test_rx_select1 = 
{
    sizeof(g_mmi_em_rf_test_rx_select_str1)/ sizeof(U16),
    0,
    (U16*)g_mmi_em_rf_test_rx_select_str1,
};

/* For 10A*/


static const cui_inline_set_item_struct g_mmi_em_rf_test_rx_inline[8] = 
{
    {MMI_EM_CAPTION_1, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_test_tx_cap0},
    {MMI_EM_STR_SELECT_1, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_test_tx_select0},
    {MMI_EM_CAPTION_2, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_test_tx_cap1},
    {MMI_EM_TEXT_EDIT_1, CUI_INLINE_ITEM_TYPE_TEXT_EDIT, 0, (void*)&g_mmi_em_rf_test_tx_text_edit0},
    {MMI_EM_CAPTION_3, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_test_rx_cap2},
    {MMI_EM_TEXT_EDIT_2, CUI_INLINE_ITEM_TYPE_TEXT_EDIT, 0, (void*)&g_mmi_em_rf_test_rx_text_edit1},
    {MMI_EM_CAPTION_6, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_test_tx_cap5},
    {MMI_EM_STR_SELECT_2, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_test_rx_select1},
};

static const cui_inline_struct g_mmi_em_rf_test_rx_inline_screen = 
{
    8,
    STR_ID_EM_RF_GSM_RX_TEST,
    0,
    CUI_INLINE_SCREEN_LOOP|CUI_INLINE_SCREEN_DISABLE_DONE,
    NULL,
    (const cui_inline_set_item_struct*)&g_mmi_em_rf_test_rx_inline,
};

static void mmi_em_rf_test_gsm_rx_set_hdlr(void)
{
    MMI_ID gid;
    MMI_ID inline_id;
    gid = mmi_frm_group_create_ex(mmi_em_get_root_group(),
                                GRP_ID_AUTO_GEN,
                                mmi_em_rf_test_gsm_rx_set_scrn_proc,
                                NULL,
                                MMI_FRM_NODE_SMART_CLOSE_FLAG);

    inline_id = cui_inline_create(gid, &g_mmi_em_rf_test_rx_inline_screen);

    cui_inline_set_value(inline_id, MMI_EM_STR_SELECT_1, (void*)&g_rf_test_gsm_cntx.currRFGsmBand);
    mmi_em_rf_test_gsm_tx_init_hdlr(inline_id, MMI_EM_TEXT_EDIT_1, g_rf_test_gsm_cntx.int_arfcn);
    mmi_em_rf_test_gsm_tx_init_hdlr(inline_id, MMI_EM_TEXT_EDIT_2, g_rf_test_gsm_cntx.int_gain);
//    cui_inline_set_value(inline_id, MMI_EM_STR_SELECT_2, (void*)&g_rf_test_gsm_cntx.currRxBurstType);
  
    cui_inline_run(inline_id);
}

static MMI_RET mmi_em_rf_test_gsm_rx_set_scrn_proc(mmi_event_struct *evt)
{
    cui_event_inline_common_struct* inline_evt = (cui_event_inline_common_struct*) evt;
    cui_event_inline_notify_struct* notify_evt = (cui_event_inline_notify_struct*) evt;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(evt->evt_id)
    {
    case EVT_ID_CUI_INLINE_SUBMIT:
    case EVT_ID_CUI_INLINE_CSK_PRESS:
            mmi_em_rf_test_gsm_rx_check_and_send_req(inline_evt);
            break;

    case EVT_ID_CUI_INLINE_ABORT:
            cui_inline_close(inline_evt->sender_id);
            break;
        
        case EVT_ID_CUI_INLINE_MAIN_SCREEN_ACTIVE:
            EmStopRFTestGsm();
            g_rf_test_gsm_cntx.req_type = RF_TEST_GSM_RX_TEST;
            break;

    case EVT_ID_CUI_INLINE_NOTIFY:
            if (MMI_EM_STR_SELECT_1 == notify_evt->item_id &&
                CUI_INLINE_NOTIFY_SELECT_FOCUS_CHANGED == notify_evt->event_type)
            {
                mmi_em_rf_test_gsm_band_highlight_hdlr(inline_evt);
            }                
            break;
    default:
        break;
    }

    return MMI_RET_OK;
}

static void mmi_em_rf_test_gsm_rx_check_and_send_req(cui_event_inline_common_struct *inline_evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    WCHAR  ucs_buf[20];
    CHAR asc_buf[20];
    S32 gain;
    MMI_BOOL result = MMI_TRUE;
    U8 i, len;
    WCHAR *detail_buf;
    mmi_em_text_viewer_struct detail = {0};
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    /* To check if ARFCN is valid */
    result = (MMI_BOOL)mmi_em_rf_test_gsm_check_gsm_arfcn_valid(inline_evt);

    cui_inline_get_value(inline_evt->sender_id, MMI_EM_STR_SELECT_1, &g_rf_test_gsm_cntx.currRFGsmBand);
    
    //only Burst RX, this type is fixed 1
    g_rf_test_gsm_cntx.currRxBurstType = 1;

    /* To check input data is not NULL */
    cui_inline_get_value(inline_evt->sender_id, MMI_EM_TEXT_EDIT_2, ucs_buf);
    if (ucs_buf[0] == 0)
        result = MMI_FALSE;
    mmi_wcs_to_asc(asc_buf, ucs_buf);
    len = strlen(asc_buf);
    for (i = 0; i< len ; i++)
        if (asc_buf[i] == '.')
            break;

    /* check if there is a dot and the dot is not located at the last 2 position.
         because only accept one digit after dot. */
    if ( (i != (len-2)) && (i != len))
        result = MMI_FALSE;
              
    /* If one of the parameters is invalid, then pop-up error and return */
    if (result == MMI_FALSE)
    {
        //mmi_display_popup_with_sg(inline_evt->sender_id,get_string(STR_GLOBAL_ERROR), MMI_EVENT_FAILURE, 0);
        mmi_em_fail_popup();
      return;
    }

    /* set the atoi result to global context */
    gain = atoi(asc_buf);    
    g_rf_test_gsm_cntx.int_gain = (S16)(gain * 8);        

    /* Send request to RF,  now req_type = RF_TEST_GSM_RX_TEST */
    g_rf_test_gsm_cntx.request_processing = MMI_TRUE;
    EMRFTestGsmSendReq();

    /* start a timer to send RX test request */
    StartTimer(EM_RINGTONE_HIGHLIGHT_TIMER, EM_RF_TOOL_GSM_RX_BURST_DURATION, EMRFTestGsmRXTestTimeoutHdlr);    

    detail_buf = OslMalloc(MMI_EM_GSM_RF_SHOW_TEXT_BUF_LEN);
    /* show RF Test GSM RX Test detail screen */
    kal_wsprintf(detail_buf, "%w: %w\n%w: %d\n%w: %d\n%w: %w",
          get_string(STR_ID_EM_RF_GSM_TX_BAND), 
          mmi_em_rf_test_gsm_tx_reset_band(g_rf_test_gsm_cntx.currRFGsmBand),
          get_string(STR_ID_EM_RF_GSM_TX_ARFCN),
          g_rf_test_gsm_cntx.int_arfcn,
          get_string(STR_ID_EM_RF_GSM_TX_GAIN), 
          gain,
          get_string(STR_ID_EM_RF_GSM_TX_BURST_TYPE),
          get_string(g_mmi_em_rf_test_rx_select_str1[0])
          );
    
    detail.title_id = STR_ID_EM_RF_GSM_RX_TEST;
    //detail.parent_gid = inline_evt->sender_id;
    detail.text = (const WCHAR*)detail_buf;

    mmi_em_show_text_viewer(&detail);
    OslMfree(detail_buf);
}
/**************************************************************
**    FUNCTION NAME        : EMRFTestGsmRXTestTimeoutHdlr
**
**  PURPOSE                : Enrty function for RF Test GSM Rx Test timeout hdlr
**
**    INPUT PARAMETERS    : nil
**
**    OUTPUT PARAMETERS    : void
**
**    RETURNS                : void
**
**    REMARKS            : 
**************************************************************/
void EMRFTestGsmRXTestTimeoutHdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* at first, to stop last request */
    g_rf_test_gsm_cntx.req_type = RF_TEST_GSM_STOP;    
    EMRFTestGsmSendReq();   
    
    /* then send the next request */
    g_rf_test_gsm_cntx.req_type = RF_TEST_GSM_RX_TEST;
    EMRFTestGsmSendReq();
    
    /* re-start the timer */
    StartTimer(EM_RINGTONE_HIGHLIGHT_TIMER, EM_RF_TOOL_GSM_RX_BURST_DURATION, EMRFTestGsmRXTestTimeoutHdlr);    
}


static const cui_inline_set_item_struct g_mmi_em_rf_test_pw_inline[4] = 
{
    {MMI_EM_CAPTION_1, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_test_tx_cap0},
    {MMI_EM_STR_SELECT_1, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_test_tx_select0},
    {MMI_EM_CAPTION_2, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_test_tx_cap1},
    {MMI_EM_TEXT_EDIT_1, CUI_INLINE_ITEM_TYPE_TEXT_EDIT, 0, (void*)&g_mmi_em_rf_test_tx_text_edit0},
};

static const cui_inline_struct g_mmi_em_rf_test_pw_inline_screen = 
{
    4,
    STR_ID_EM_RF_GSM_POWER_SCAN,
    0,
    CUI_INLINE_SCREEN_LOOP|CUI_INLINE_SCREEN_DISABLE_DONE,
    NULL,
    (const cui_inline_set_item_struct*)&g_mmi_em_rf_test_pw_inline,
};


static MMI_RET mmi_em_fs_trace_pw_set_scrn_proc(mmi_event_struct *evt);

static void mmi_em_fs_trace_pw_set_hdlr(void)
{
    MMI_ID gid;
    MMI_ID inline_id;
    
    gid = mmi_frm_group_create_ex(mmi_em_get_root_group(),
                                GRP_ID_AUTO_GEN,
                                mmi_em_fs_trace_pw_set_scrn_proc,
                                NULL,
                                MMI_FRM_NODE_SMART_CLOSE_FLAG);

    inline_id = cui_inline_create(gid, &g_mmi_em_rf_test_pw_inline_screen);
    cui_inline_set_value(inline_id, MMI_EM_STR_SELECT_1, (void*)g_rf_test_gsm_cntx.currRFGsmBand);
    mmi_wcs_itow(9999, g_rf_test_gsm_cntx.arfcn, 10);
    cui_inline_set_value(inline_id, MMI_EM_TEXT_EDIT_1, (void *)g_rf_test_gsm_cntx.arfcn);
    cui_inline_run(inline_id);
}

static MMI_RET mmi_em_fs_trace_pw_set_scrn_proc(mmi_event_struct *evt)
{
    cui_event_inline_common_struct* inline_evt = (cui_event_inline_common_struct*) evt;

   /*----------------------------------------------------------------*/
   /* Code Body                                                      */
   /*----------------------------------------------------------------*/
   switch(evt->evt_id)
   {
    case EVT_ID_CUI_INLINE_SUBMIT:
    case EVT_ID_CUI_INLINE_CSK_PRESS:
        cui_inline_get_value(inline_evt->sender_id, MMI_EM_STR_SELECT_1, (void *) &g_rf_test_gsm_cntx.currRFGsmBand);
        cui_inline_get_value(inline_evt->sender_id, MMI_EM_TEXT_EDIT_1, (void *) g_rf_test_gsm_cntx.arfcn);
        EMRFGSMPowerScanFunc(inline_evt->sender_id);
        break;

    case EVT_ID_CUI_INLINE_ABORT:
        cui_inline_close(inline_evt->sender_id);
        break;

    case EVT_ID_GROUP_DELETE_REQ_IN_END_KEY:
    case EVT_ID_GROUP_GOBACK_IN_END_KEY:
        if (g_rf_test_gsm_cntx.is_powerscan_requesting)
        {            
            return MMI_RET_KEY_HANDLED;
        }
        break;   
        
    case EVT_ID_CUI_INLINE_MAIN_SCREEN_ACTIVE:
        EmStopRFTestGsm();  
        g_rf_test_gsm_cntx.req_type = RF_TEST_GSM_POWER_SCAN;
        break;

    default:
        break;
    }

    return MMI_RET_OK;
}

/**************************************************************

    FUNCTION NAME           : EMRFGSMPowerScanFunc

    PURPOSE                 : Set RF GSM Power Scan

    INPUT PARAMETERS        : nil

    OUTPUT PARAMETERS       : nil

    RETURNS                 : void

    REMARKS                 : nil

**************************************************************/
void EMRFGSMPowerScanFunc(mmi_menu_id menu_id) 
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_BOOL result = MMI_TRUE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    //CloseCategory57Screen();
    
    /* To check input data is not NULL */
    if (g_rf_test_gsm_cntx.arfcn[0] == 0)
        result = MMI_FALSE;

    /* To check if ARFCN is valid */
    if (result == MMI_TRUE)
        result = check_gsm_arfcn_valid();

    /* If one of the parameters is invalid, then pop-up error and return */
    if (result == MMI_FALSE)
    {
        mmi_em_fail_popup();
        cui_inline_close(menu_id);
      return;
    }

    /* Send request to RF , now req_type = RF_TEST_GSM_POWER_SCAN */
    g_rf_test_gsm_cntx.request_processing = MMI_TRUE;
    g_rf_test_gsm_cntx.is_powerscan_requesting = MMI_TRUE;
    EMRFTestGsmSendReq();
    
    ClearInputEventHandler(MMI_DEVICE_ALL);
}


/*****************************************************************************
  * FUNCTION
  *  mmi_em_rf_test_gsm_power_scan_rsp_update
  * DESCRIPTION
  *  mmi_em_rf_test_gsm_power_scan_rsp_update
  * PARAMETERS
  *  arfcn      [IN]
  *  power      [IN]    
  * RETURNS
  *  void 
  *****************************************************************************/
static void mmi_em_rf_test_gsm_power_scan_rsp_update(PS16 arfcn, PS16 power)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 nItems = 0;                
    U32 val_arfnc;
    char *format_str= "CH%d: %.1f";
    char buffer[32];
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    val_arfnc = mmi_wcs_wtoi(g_rf_test_gsm_cntx.arfcn);
    if (val_arfnc == 9999)
    {
        for(nItems=0; nItems<20; nItems++)
        {
            sprintf(buffer,format_str, arfcn[nItems] , (DOUBLE)power[nItems]/4);
            mmi_asc_to_ucs2((CHAR*)subMenuData[nItems], buffer);
            subMenuDataPtrs[nItems] = subMenuData[nItems];
        }
    }
    else
    {
        sprintf(buffer, format_str, arfcn[nItems] , (DOUBLE)power[nItems]/4);
        mmi_asc_to_ucs2((CHAR*)subMenuData[nItems], buffer);
        subMenuDataPtrs[nItems] = subMenuData[nItems];
        nItems ++;
    }
    
    if (g_rf_test_gsm_cntx.power_scan_rsp.cur_index >= nItems)
    {
        g_rf_test_gsm_cntx.power_scan_rsp.cur_index = nItems - 1;
    }
    
    ShowCategory6Screen(STR_ID_EM_RF_GSM_POWER_SCAN,
                          0,
                          STR_GLOBAL_ABORT,
                          0,
                          STR_GLOBAL_BACK,
                          0,
                          nItems,
                          (PU8*)subMenuDataPtrs,
                          NULL,
                          g_rf_test_gsm_cntx.power_scan_rsp.cur_index,
                          mmi_frm_scrn_get_active_gui_buf());

    /* start the timer to send power scan request */
    StartTimer(EM_RINGTONE_HIGHLIGHT_TIMER, EM_RF_TOOL_GSM_POWERSCAN_DURATION, EMRFTestGsmSendReq);
    
}

/*****************************************************************************
  * FUNCTION
  *  mmi_em_rf_test_gsm_powerscan_rsp_scrn_proc
  * DESCRIPTION
  *  mmi_em_rf_test_gsm_powerscan_rsp_scrn_proc
  * PARAMETERS
  *  param      [IN]    
  * RETURNS
  *  void 
  *****************************************************************************/
static MMI_RET mmi_em_rf_test_gsm_powerscan_rsp_scrn_proc(mmi_event_struct* param)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (param->evt_id)
    {
        case EVT_ID_SCRN_ACTIVE:    
            {
                mmi_frm_scrn_active_evt_struct *evt = (mmi_frm_scrn_active_evt_struct *)param;
                if (evt->is_first_active)
                {
                    mmi_em_rf_test_gsm_power_scan_rsp_update(g_rf_test_gsm_cntx.power_scan_rsp.arfcn, 
                                                         g_rf_test_gsm_cntx.power_scan_rsp.power);
                }
                else
                {
                    mmi_frm_scrn_close_active_id();
                }
                break;
            }

        case EVT_ID_SCRN_HIGHLIGHT_CHANGE:
            {
                cat_evt_struct *evt = (cat_evt_struct *)param;
                g_rf_test_gsm_cntx.power_scan_rsp.cur_index = evt->item_index;
                break;
            }

        case EVT_ID_SCRN_DEINIT:
        case EVT_ID_SCRN_GOBACK_IN_END_KEY:
            g_rf_test_gsm_cntx.power_scan_rsp.cur_index = 0;
            EmStopRFTestGsm();
            break;
        
        case EVT_ID_WGUI_LSK_CLICK:   
            mmi_frm_scrn_close_active_id();
            return MMI_RET_KEY_HANDLED;
    }    
    return MMI_OK;
}


/**************************************************************

    FUNCTION NAME        : EntryEMRFGSMPowerScanRsp

      PURPOSE                : RF GSM Power Scan Response 

    INPUT PARAMETERS    : nil

    OUTPUT PARAMETERS    : nil

    RETURNS                : void

    REMARKS                : nil

**************************************************************/
void EntryEMRFGSMPowerScanRsp(PS16 arfcn, PS16 power) 
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID em_group;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_rf_test_gsm_cntx.power_scan_rsp.arfcn = arfcn;
    g_rf_test_gsm_cntx.power_scan_rsp.power = power;
    g_rf_test_gsm_cntx.is_powerscan_requesting = MMI_FALSE;
    
    em_group = mmi_em_get_root_group();
    if (em_group == 0)
    {
        return;
    }
    
    if (mmi_frm_scrn_is_present(em_group,SCR_ID_EM_RF_TEST_GSM_POWER_SCAN_RESULT,MMI_FRM_NODE_ALL_FLAG))
    {
        if (SCR_ID_EM_RF_TEST_GSM_POWER_SCAN_RESULT == mmi_frm_scrn_get_active_id())
        {
            mmi_em_rf_test_gsm_power_scan_rsp_update(arfcn, power);    
        }        
    }
    else
    {
        mmi_frm_scrn_create(em_group,
                        SCR_ID_EM_RF_TEST_GSM_POWER_SCAN_RESULT,
                        mmi_em_rf_test_gsm_powerscan_rsp_scrn_proc,
                        NULL);
    }   
}


static MMI_BOOL mmi_em_rf_test_check_arfcn_valid(S32 arfcn)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_BOOL result = MMI_TRUE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_rf_test_gsm_cntx.currRFGsmBand == EM_RF_GSM_BAND_GSM900)
    {
         if ( (arfcn>124 && arfcn < 975) || (arfcn >1024))
             result = MMI_FALSE;         
    }
    else if (g_rf_test_gsm_cntx.currRFGsmBand == EM_RF_GSM_BAND_GSM850)
    {
         if ( (arfcn < 128) ||  (arfcn > 251))
             result = MMI_FALSE;     
    }
    else if (g_rf_test_gsm_cntx.currRFGsmBand == EM_RF_GSM_BAND_DCS1800)
    {
         if ( (arfcn < 512) ||  (arfcn > 885))
             result = MMI_FALSE;     
    }
    else if (g_rf_test_gsm_cntx.currRFGsmBand == EM_RF_GSM_BAND_PCS1900)
    {
         if ( (arfcn < 512) ||  (arfcn > 810))
             result = MMI_FALSE;     
    }
    else
        ASSERT(0);

    if (g_rf_test_gsm_cntx.req_type == RF_TEST_GSM_POWER_SCAN)
        if (arfcn == 9999)
            result = MMI_TRUE;

    /* set the atoi result to global context */
    g_rf_test_gsm_cntx.int_arfcn = arfcn;
    return result;
}



/**************************************************************
**    FUNCTION NAME        : check_rf_test_gsm_parameter_valid
**
**  PURPOSE                : Check if ARFCN parameter is valid.
**
**    INPUT PARAMETERS    : nil
**
**    OUTPUT PARAMETERS    : void
**
**    RETURNS                : void
**
**    REMARKS            : 
**************************************************************/
MMI_BOOL check_gsm_arfcn_valid(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 arfcn;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* To check if ARFCN is valid */
    arfcn = mmi_wcs_wtoi(g_rf_test_gsm_cntx.arfcn);
    return mmi_em_rf_test_check_arfcn_valid(arfcn);  
}

static U16 mmi_em_rf_test_gsm_check_gsm_arfcn_valid(cui_event_inline_common_struct* inline_evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    WCHAR  textbuf[20];
    S32 arfcn;

    /*----------------------------------------------------------------*/
    /* Code Body                                                */
    /*----------------------------------------------------------------*/
    /* To check if ARFCN is valid */
    cui_inline_get_value(inline_evt->sender_id, MMI_EM_TEXT_EDIT_1, (void *) textbuf);
    if (textbuf[0] == 0)
    {
        return MMI_FALSE;
    }
    else
    {
        arfcn = mmi_wcs_wtoi(textbuf);
        return mmi_em_rf_test_check_arfcn_valid(arfcn);
    }
}

#endif /* #ifdef __MMI_EM_RF_GSM__ */


#if defined(__MMI_EM_RF_WIFI__)


#define MMI_EM_RF_WIFI_GAIN_LEN             (3)
#define MMI_EM_WIFI_REG_ACCESS_ADDR_LEN     (9)
#define MMI_EM_WIFI_CAP21_MRC_ADDR_LEN      (3)
#define MMI_EM_WIFI_REG_ACCESS_DATA_LEN     (9)

#define MMI_EM_WIFI_EFUSE_ADDR_LEN          (3)

#define MMI_EM_WIFI_PKT_COUNT_LEN           (11)
#define MMI_EM_WIFI_PKT_LENGTH_LEN           (5)
#define MMI_EM_WIFI_REG_POWER_UPDATE_LEN    (6)
#define MMI_EM_WIFI_SHOW_TEXT_BUF_LEN       (200 * sizeof(WCHAR))


/*var data range field*/


#define MMI_EM_WIFI_TX_GAIN_MAX             (0x3F)               
#define MMI_EM_WIFI_MCR_ADDR_MAX            (0x07FF)
#define MMI_EM_WIFI_EEPROM_ADDR_MAX         (0x1FF)
#define MMI_EM_WIFI_EFUSE_ADDR_MAX          (0x8F)


typedef enum
{
    MMI_EM_WIFI_CAPABILITY_21 = (WLAN_SUPPORT_11b_MODE | WLAN_SUPPORT_11g_MODE),
    MMI_EM_WIFI_CAPABILITY_31 = (WLAN_SUPPORT_11b_MODE | WLAN_SUPPORT_11g_MODE | WLAN_SUPPORT_11n_MODE),

    MMI_EM_WIFI_CAPABILITY_ENUM_MAX
}mmi_em_rf_wifi_capability_enum;

typedef struct {
    S32       rx_scrn_hilight;
    S32       currRFWifiChFreq;     
    S32       currRFWifiTxRate;         
    S32       currRFWifiTxPattern;
    S32       currRFWifiTxShortPeramble;
    S32       currRFWifiPowerSave;
    S32       currRFWifiRegisterType;
    S32       currRFWifiRegisterAccess;
    U32       currRFWifi11nBW;
    U32       currRFWifi11nGI;
    U32       currRFWifi11nPF;

    U32       int_power;
    U32         int_gain;              /* atoi value */

    U32         int_pktcount;       /* atoi value */
    U32         int_pktlength;      /* atoi value */    

    U32         int_mcr_address;
    U32         int_mcr_data;

    
    U32         int_eeprom_address;
    U32         int_eeprom_data;

    U32         int_efuse_address;
    
    U8          req_type;
    MMI_BOOL    request_processing;    
    MMI_BOOL    is_not_waiting; /*if user don't want to wait for response and exit*/    
    mmi_em_rf_wifi_capability_enum   wifi_capability;
} em_rf_test_wifi_struct;

em_rf_test_wifi_struct g_rf_test_wifi_cntx={0};

static const U32 rf_wifi_tx_ch_freq[14]=
{
    2412000, 2417000, 2422000, 2427000, 2432000, 2437000, 2442000, 
    2447000, 2452000, 2457000, 2462000, 2467000, 2472000, 2483500
};

typedef enum {

   EM_RF_WIFI_DOMAIN_US = 0,
   EM_RF_WIFI_DOMAIN_JP
   
}  EM_RF_WIFI_DOMAIN_ENUM;

typedef enum {

   EM_RF_WIFI_REGISTER_TYPE_32 = 0,
   EM_RF_WIFI_REGISTER_TYPE_16   
   
}  EM_RF_WIFI_REGISTER_TYPE_ENUM;

typedef enum {

   EM_RF_WIFI_REGISTER_ACCESS_READ = 0,
   EM_RF_WIFI_REGISTER_ACCESS_WRITE
   
}  EM_RF_WIFI_REGISTER_ACCESS_ENUM;



typedef enum
{
    MMI_EM_RF_WIFI_FREQ_2412 = 0,
    MMI_EM_RF_WIFI_FREQ_2417,
    MMI_EM_RF_WIFI_FREQ_2422,
    MMI_EM_RF_WIFI_FREQ_2427,
    MMI_EM_RF_WIFI_FREQ_2432,
    MMI_EM_RF_WIFI_FREQ_2437,
    MMI_EM_RF_WIFI_FREQ_2442,
    MMI_EM_RF_WIFI_FREQ_2447,
    MMI_EM_RF_WIFI_FREQ_2452,
    MMI_EM_RF_WIFI_FREQ_2457,
    MMI_EM_RF_WIFI_FREQ_2462,
    MMI_EM_RF_WIFI_FREQ_2467,
    MMI_EM_RF_WIFI_FREQ_2472,
//    MMI_EM_RF_WIFI_FREQ_2484,
    
    MMI_EM_RF_WIFI_FREQ_MAX
}mmi_em_rf_wifi_freq_enum;

typedef enum
{
    MMI_EM_WIFI_RATE_1M = 0,
    MMI_EM_WIFI_RATE_2M,
    MMI_EM_WIFI_RATE_5_5M,
    MMI_EM_WIFI_RATE_11M,
    MMI_EM_WIFI_RATE_6M,
    MMI_EM_WIFI_RATE_9M,
    MMI_EM_WIFI_RATE_12M,
    MMI_EM_WIFI_RATE_18M,
    MMI_EM_WIFI_RATE_24M,
    MMI_EM_WIFI_RATE_36M,
    MMI_EM_WIFI_RATE_48M,
    MMI_EM_WIFI_RATE_54M,
    MMI_EM_WIFI_RATE_21_END,

    MMI_EM_WIFI_RATE_MCS0 = MMI_EM_WIFI_RATE_21_END,
    MMI_EM_WIFI_RATE_MCS1,
    MMI_EM_WIFI_RATE_MCS2,
    MMI_EM_WIFI_RATE_MCS3,
    MMI_EM_WIFI_RATE_MCS4,
    MMI_EM_WIFI_RATE_MCS5,
    MMI_EM_WIFI_RATE_MCS6,
    MMI_EM_WIFI_RATE_MCS7,
    MMI_EM_WIFI_RATE_MCS32,
    
    MMI_EM_WIFI_RATE_MAX     
}mmi_em_rf_wifi_data_rate_enum;


typedef enum
{
    MMI_EM_WIFI_CAP_1 = CUI_INLINE_ITEM_ID_BASE + 0,
    MMI_EM_WIFI_CAP_2,
    MMI_EM_WIFI_CAP_3,
    MMI_EM_WIFI_CAP_4,
    MMI_EM_WIFI_CAP_5,
    MMI_EM_WIFI_CAP_6,
    MMI_EM_WIFI_CAP_7,
    MMI_EM_WIFI_CAP_8,
    MMI_EM_WIFI_CAP_9,
    MMI_EM_WIFI_CAP_10,
    
    MMI_EM_WIFI_FREQ_SEL,
    MMI_EM_WIFI_DATA_RATE_SEL,
    MMI_EM_WIFI_TX_PATTERN_SEL,
    MMI_EM_WIFI_SLEEP_MODE_SEL,
    MMI_EM_WIFI_BIT_TYPE_SEL,
    MMI_EM_WIFI_ACCESS_TYPE_SEL,
    
    
    MMI_EM_WIFI_GAIN_EDIT,
    MMI_EM_WIFI_PKT_COUNT_EDIT,
    MMI_EM_WIFI_PKT_LENGTH_EDIT,
    MMI_EM_WIFI_ADDRESS_EDIT,
    MMI_EM_WIFI_DATA_EDIT,

    MMI_EM_WIFI_11N_BW_SEL,
    MMI_EM_WIFI_11N_GI_SEL,
    MMI_EM_WIFI_11N_PF_SEL,

    MMI_EM_WIFI_POWER_EDIT,
    
    MMI_EM_WIFI_INLINE_ITEM_MAX
    
}mmi_em_wifi_inline_item_enum;



#define STATIC_FUNCTION
/***************************************************************************** 
 * Static function 
 *****************************************************************************/
static MMI_BOOL mmi_em_rf_hex_to_i(U16 *buf, U32 *int_value);
static void mmi_em_rf_test_wifi_handle_tx_output_power(void);
static MMI_RET mmi_em_rf_test_wifi_tx_output_power_proc(mmi_event_struct *evt);
static void mmi_em_wifi_rf_test_replay_hdlr(void);
static MMI_RET mmi_em_rf_test_wifi_confirm_proc(mmi_event_struct *evt);
static MMI_RET mmi_em_rf_test_wifi_entry_list(em_rf_test_wifi_struct *wifi_cntx);
static MMI_RET mmi_em_rf_test_wifi_list_proc(mmi_event_struct *evt);
static MMI_RET mmi_em_rf_test_menu_sel_event_hdlr(cui_menu_event_struct *evt);
static void mmi_em_rf_test_wifi_handle_tx_local_fraq(void);
static void mmi_em_rf_test_wifi_handle_tx_cont_pkt(void);
static void mmi_em_rf_test_wifi_handle_rx_cont_pkt(void);
static void mmi_em_rf_test_wifi_handle_power_save_mode(void);

static void EMRFTestWiFiFillTxCommonReqContext(mmi_eq_rf_test_wifi_req_struct* msg);


static MMI_BOOL mmi_em_rf_test_wifi_get_gain_from_inline(MMI_ID inline_id, U16 item_id, U32 *data);
static void mmi_em_rf_test_wifi_set_gain_to_inline(MMI_ID inline_id, U16 item_id, U32 set_value);

static MMI_BOOL mmi_em_rf_wifi_get_power_value_from_inline(MMI_ID inline_id, U16 item_id, U32 *data);
static void mmi_em_rf_test_wifi_set_power_value_to_inline(MMI_ID inline_gid, U16 item_id, U32 set_value);

static MMI_RET mmi_em_rf_test_wifi_tx_output_power_proc(mmi_event_struct *evt);
static void mmi_em_rf_test_wifi_init_tx_output_power(MMI_ID inline_id);
static void mmi_em_rf_test_wifi_output_power_submit_hdlr(MMI_ID inline_id);
static void mmi_em_rf_test_wifi_display_tx_out_power_data(void);

static MMI_RET mmi_em_rf_test_wifi_tx_local_fraq_proc(mmi_event_struct *evt);
static void mmi_em_rf_test_wifi_init_tx_local_freq(MMI_ID inline_id);
static void mmi_em_rf_test_wifi_tx_local_freq_submit_hdlr(MMI_ID inline_id);
static void mmi_em_rf_test_wifi_display_tx_local_freq_data(void);

static MMI_RET mmi_em_rf_test_wifi_tx_cont_pkt_proc(mmi_event_struct *evt);
static void mmi_em_rf_wifi_init_tx_cont_pkt(MMI_ID inline_id);
static void mmi_em_rf_wifi_tx_cont_pkt_submit_hdlr(MMI_ID inline_id);
static void mmi_em_rf_test_wifi_display_tx_cont_pkt_data(void);

static void mmi_em_rf_wifi_handle_register_mcr(void);
static void mmi_em_rf_test_wifi_register_mcr_handle_notify(mmi_event_struct *evt);
static MMI_RET mmi_em_rf_test_wifi_register_mcr_proc(mmi_event_struct *evt);

static void mmi_em_rf_wifi_handle_register_eeprom(void);
static void mmi_em_rf_wifi_init_register_eeprom(MMI_ID inline_id);
static MMI_RET mmi_em_rf_test_wifi_register_eeprom_proc(mmi_event_struct *evt); 


static MMI_RET mmi_em_rf_test_wifi_register_efuse_proc(mmi_event_struct *evt);
static void mmi_em_rf_wifi_init_register_efuse(MMI_ID inline_id);
static void mmi_em_rf_wifi_register_efuse_submit_hdlr(MMI_ID inline_id);
static void mmi_em_rf_wifi_register_efuse_rsp(U32 eeprom_data);
static void mmi_em_rf_wifi_handle_register_efuse(void);

extern S32 cui_inline_set_item_select_with_string_id(mmi_id gid, U16 item_id, S32 n_items, U16 *list_of_string_id, U8 highlighted_item);


#define WIFI_INLINE_SELECTOR_STR
static const U16 g_mmi_em_rf_wifi_freq_str[MMI_EM_RF_WIFI_FREQ_MAX] = 
                                                   {STR_ID_EM_RF_WIFI_TX_CH_FREQ_1, 
                                                    STR_ID_EM_RF_WIFI_TX_CH_FREQ_2,
                                                    STR_ID_EM_RF_WIFI_TX_CH_FREQ_3,
                                                    STR_ID_EM_RF_WIFI_TX_CH_FREQ_4,
                                                    STR_ID_EM_RF_WIFI_TX_CH_FREQ_5,
                                                    STR_ID_EM_RF_WIFI_TX_CH_FREQ_6,
                                                    STR_ID_EM_RF_WIFI_TX_CH_FREQ_7,
                                                    STR_ID_EM_RF_WIFI_TX_CH_FREQ_8,
                                                    STR_ID_EM_RF_WIFI_TX_CH_FREQ_9,
                                                    STR_ID_EM_RF_WIFI_TX_CH_FREQ_10,
                                                    STR_ID_EM_RF_WIFI_TX_CH_FREQ_11,
                                                    STR_ID_EM_RF_WIFI_TX_CH_FREQ_12,
                                                    STR_ID_EM_RF_WIFI_TX_CH_FREQ_13
                                                    };


static const U16 g_mmi_em_rf_wifi_rate_str[MMI_EM_WIFI_RATE_MAX] = {
                                                    STR_ID_EM_RF_WIFI_TX_RATE_1M, 
                                                    STR_ID_EM_RF_WIFI_TX_RATE_2M,
                                                    STR_ID_EM_RF_WIFI_TX_RATE_5_5M,
                                                    STR_ID_EM_RF_WIFI_TX_RATE_11M,
                                                    STR_ID_EM_RF_WIFI_TX_RATE_6M,
                                                    STR_ID_EM_RF_WIFI_TX_RATE_9M,
                                                    STR_ID_EM_RF_WIFI_TX_RATE_12M,
                                                    STR_ID_EM_RF_WIFI_TX_RATE_18M,
                                                    STR_ID_EM_RF_WIFI_TX_RATE_24M,
                                                    STR_ID_EM_RF_WIFI_TX_RATE_36M,
                                                    STR_ID_EM_RF_WIFI_TX_RATE_48M,
                                                    STR_ID_EM_RF_WIFI_TX_RATE_54M,
                                                    STR_ID_EM_RF_WIFI_TX_RATE_MCS0,
                                                    STR_ID_EM_RF_WIFI_TX_RATE_MCS1,
                                                    STR_ID_EM_RF_WIFI_TX_RATE_MCS2,
                                                    STR_ID_EM_RF_WIFI_TX_RATE_MCS3,
                                                    STR_ID_EM_RF_WIFI_TX_RATE_MCS4,
                                                    STR_ID_EM_RF_WIFI_TX_RATE_MCS5,
                                                    STR_ID_EM_RF_WIFI_TX_RATE_MCS6,
                                                    STR_ID_EM_RF_WIFI_TX_RATE_MCS7,
                                                    STR_ID_EM_RF_WIFI_TX_RATE_MCS32
                                                };


static const U16 g_mmi_em_rf_wifi_tx_pattern_str[] = {STR_ID_EM_RF_WIFI_TX_PATTERN_ALL_0, 
                                                    STR_ID_EM_RF_WIFI_TX_PATTERN_ALL_1,
                                                    STR_ID_EM_RF_WIFI_TX_PATTERN_ALTER_BITS,
                                                    STR_ID_EM_RF_WIFI_TX_PATTERN_RANDOM};

static const U16 g_mmi_em_rf_wifi_power_save_mode_str[3] = {STR_GLOBAL_NORMAL, 
                                                    STR_ID_EM_RF_WIFI_POWER_SAVE_IDLE,
                                                    STR_ID_EM_RF_WIFI_POWER_SAVE_SLEEP};

static const U16 g_mmi_em_rf_wifi_register_type_str[2] = {STR_ID_EM_RF_WIFI_REGISTER_32,
                                                        STR_ID_EM_RF_WIFI_REGISTER_16
                                                        }; 
static const U16 g_mmi_em_rf_wifi_register_access_str[2] = {STR_GLOBAL_READ, 
                                                    STR_ID_EM_RF_WIFI_REGISTER_WRITE};



static const U16 g_mmi_em_rf_wifi_11nBW_str[] = {
                                                    STR_ID_EM_RF_WIFI_11NBW_HT20,
                                                    STR_ID_EM_RF_WIFI_11NBW_HT40,
                                                    STR_ID_EM_RF_WIFI_11NBW_U20,
                                                    STR_ID_EM_RF_WIFI_11NBW_L20                                                        
                                                 };

static const U16 g_mmi_em_rf_wifi_11nGI_str[] = {
                                                    STR_ID_EM_RF_WIFI_11NGI_SG,
                                                    STR_ID_EM_RF_WIFI_11NGI_NG                                                    
                                                };
static const U16 g_mmi_em_rf_wifi_11nPF_str[] = {
                                                    STR_ID_EM_RF_WIFI_11NPF_GF,
                                                    STR_ID_EM_RF_WIFI_11NPF_MM
                                                };




#define WIFI_INLINE_CAPTION

static const cui_inline_item_caption_struct g_mmi_em_rf_wifi_freq_cap = 
{
    STR_ID_EM_RF_WIFI_TX_CH_FREQ
};
static const cui_inline_item_caption_struct g_mmi_em_rf_wifi_rate_cap = 
{
    STR_ID_EM_RF_WIFI_TX_RATE
};

static const cui_inline_item_caption_struct g_mmi_em_rf_wifi_tx_gain_cap = 
{
    STR_ID_EM_RF_WIFI_TX_GAIN
};

static const cui_inline_item_caption_struct g_mmi_em_rf_wifi_tx_rkt_count_cap = 
{
    STR_ID_EM_RF_WIFI_TX_PKT_COUNT
};

static const cui_inline_item_caption_struct g_mmi_em_rf_wifi_tx_rkt_length_cap = 
{
    STR_ID_EM_RF_WIFI_TX_PKT_LENGTH
};

static const cui_inline_item_caption_struct g_mmi_em_rf_wifi_tx_pattern_cap = 
{
    STR_ID_EM_RF_WIFI_TX_PATTERN
};

static const cui_inline_item_caption_struct g_mmi_em_rf_wifi_power_save_mode_cap = 
{
    STR_GLOBAL_MODE,
};

static const cui_inline_item_caption_struct g_mmi_em_rf_wifi_register_type_cap = 
{
    STR_ID_EM_RF_WIFI_REGISTER_TYPE
};

static const cui_inline_item_caption_struct g_mmi_em_rf_wifi_register_address_cap = 
{
    STR_ID_EM_RF_WIFI_REGISTER_ADDRESS
};

static const cui_inline_item_caption_struct g_mmi_em_rf_wifi_register_data_cap = 
{
    STR_ID_EM_RF_WIFI_REGISTER_DATA
};

static const cui_inline_item_caption_struct g_mmi_em_rf_wifi_register_access_cap = 
{
    STR_ID_EM_RF_WIFI_REGISTER_ACCESS
};


static const cui_inline_item_caption_struct g_mmi_em_rf_wifi_11nBW_cap = 
{
    STR_ID_EM_RF_WIFI_11NBW
};

static const cui_inline_item_caption_struct g_mmi_em_rf_wifi_11nGI_cap = 
{
    STR_ID_EM_RF_WIFI_11NGI
};

static const cui_inline_item_caption_struct g_mmi_em_rf_wifi_11nPF_cap = 
{
    STR_ID_EM_RF_WIFI_11NPF
};

static const cui_inline_item_caption_struct g_mmi_em_rf_wifi_power_update_cap = 
{
    STR_ID_EM_RF_WIFI_POWER_UPDATE
};



#define WIFI_INLINE_SELECTOR
static const cui_inline_item_select_struct g_mmi_em_rf_wifi_tx_select_freq = 
{
    sizeof(g_mmi_em_rf_wifi_freq_str)/sizeof(U16),
    0,
    (U16*)g_mmi_em_rf_wifi_freq_str,
};

static const cui_inline_item_select_struct g_mmi_em_rf_wifi_select_rate = 
{
    sizeof(g_mmi_em_rf_wifi_rate_str)/sizeof(U16),
    0,
    (U16*)g_mmi_em_rf_wifi_rate_str,
};

static const cui_inline_item_select_struct g_mmi_em_rf_wifi_tx_select_pattern = 
{
    sizeof(g_mmi_em_rf_wifi_tx_pattern_str)/sizeof(U16),
    0,
    (U16*)g_mmi_em_rf_wifi_tx_pattern_str,
};

static const cui_inline_item_select_struct g_mmi_em_rf_wifi_select_power_save_mode = 
{
    sizeof(g_mmi_em_rf_wifi_power_save_mode_str)/sizeof(U16),
    0,
    (U16*)g_mmi_em_rf_wifi_power_save_mode_str,
};

static const cui_inline_item_select_struct g_mmi_em_rf_wifi_select_register_type = 
{
    sizeof(g_mmi_em_rf_wifi_register_type_str)/sizeof(U16),
    0,
    (U16*)g_mmi_em_rf_wifi_register_type_str
};

static const cui_inline_item_select_struct g_mmi_em_rf_wifi_select_register_access = 
{
    sizeof(g_mmi_em_rf_wifi_register_access_str)/sizeof(U16),
    0,
    (U16*)g_mmi_em_rf_wifi_register_access_str
};

static const cui_inline_item_select_struct g_mmi_em_rf_wifi_select_11nBW = 
{
    sizeof(g_mmi_em_rf_wifi_11nBW_str)/sizeof(U16),
    0,
    (U16*)g_mmi_em_rf_wifi_11nBW_str,
};

static const cui_inline_item_select_struct g_mmi_em_rf_wifi_select_11nGI = 
{
    sizeof(g_mmi_em_rf_wifi_11nGI_str)/sizeof(U16),
    0,
    (U16*)g_mmi_em_rf_wifi_11nGI_str,
};

static const cui_inline_item_select_struct g_mmi_em_rf_wifi_select_11nPF = 
{
    sizeof(g_mmi_em_rf_wifi_11nPF_str)/sizeof(U16),
    0,
    (U16*)g_mmi_em_rf_wifi_11nPF_str,
};



#define WIFI_INLINE_EDITOR
static const cui_inline_item_text_edit_struct g_mmi_em_rf_wifi_tx_gain_edit =
{
	0,
	0,
	MMI_EM_RF_WIFI_GAIN_LEN,
	IMM_INPUT_TYPE_SENTENCE,
	0,
	NULL	
};

static const cui_inline_item_text_edit_struct g_mmi_em_rf_wifi_tx_pkt_count_edit =
{
	0,
	0,
	MMI_EM_WIFI_PKT_COUNT_LEN,
	IMM_INPUT_TYPE_NUMERIC,
	0,
	NULL	
};

static const cui_inline_item_text_edit_struct g_mmi_em_rf_wifi_tx_pkt_length_edit =
{
	0,
	0,
	MMI_EM_WIFI_PKT_LENGTH_LEN,
	IMM_INPUT_TYPE_NUMERIC,
	0,
	NULL	
};

static const cui_inline_item_text_edit_struct g_mmi_em_rf_wifi_register_address_edit =
{
	0,
	0,
	MMI_EM_WIFI_REG_ACCESS_ADDR_LEN,
	IMM_INPUT_TYPE_SENTENCE,
	0,
	NULL	
};

static const cui_inline_item_text_edit_struct g_mmi_em_rf_wifi_register_data_edit =
{
	0,
	0,
	MMI_EM_WIFI_REG_ACCESS_DATA_LEN,
	IMM_INPUT_TYPE_SENTENCE,
	0,
	NULL	
};


static const cui_inline_item_text_edit_struct g_mmi_em_rf_wifi_power_update_edit =
{
	0,
	0,
	MMI_EM_WIFI_REG_POWER_UPDATE_LEN,
	IMM_INPUT_TYPE_DECIMAL_NUMERIC,
	0,
	NULL	
};



#define WIFI_INLINE_ITEM_SCRN


const cui_inline_set_item_struct g_mmi_em_rf_test_wifi_tx_inline[] = 
{
    {MMI_EM_WIFI_CAP_1, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_freq_cap},
    {MMI_EM_WIFI_FREQ_SEL, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_wifi_tx_select_freq},
    {MMI_EM_WIFI_CAP_2, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_rate_cap},
    {MMI_EM_WIFI_DATA_RATE_SEL, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_wifi_select_rate},  
    {MMI_EM_WIFI_CAP_3, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_tx_gain_cap},
    {MMI_EM_WIFI_GAIN_EDIT, CUI_INLINE_ITEM_TYPE_TEXT_EDIT, 0, (void*)&g_mmi_em_rf_wifi_tx_gain_edit},   
    {MMI_EM_WIFI_CAP_4, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_11nBW_cap},
    {MMI_EM_WIFI_11N_BW_SEL, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_wifi_select_11nBW},
    {MMI_EM_WIFI_CAP_5, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_11nGI_cap},
    {MMI_EM_WIFI_11N_GI_SEL, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_wifi_select_11nGI},
    {MMI_EM_WIFI_CAP_6, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_11nPF_cap},
    {MMI_EM_WIFI_11N_PF_SEL, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_wifi_select_11nPF},
    {MMI_EM_WIFI_CAP_7, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_power_update_cap},
    {MMI_EM_WIFI_POWER_EDIT, CUI_INLINE_ITEM_TYPE_TEXT_EDIT, 0, (void*)&g_mmi_em_rf_wifi_power_update_edit},
};
static const cui_inline_struct g_mmi_em_rf_test_wifi_tx_output_power_inline_scrn = 
{
    sizeof(g_mmi_em_rf_test_wifi_tx_inline)/sizeof(cui_inline_set_item_struct),
    STR_ID_EM_RF_WIFI_TX_OUTPUT_POWER,
    0,
    CUI_INLINE_SCREEN_LOOP|CUI_INLINE_SCREEN_DISABLE_DONE,
    NULL,
    (const cui_inline_set_item_struct*)&g_mmi_em_rf_test_wifi_tx_inline
};

static const cui_inline_set_item_struct g_mmi_em_rf_test_wifi_tx_local_fraq_inline[] = 
{
    {MMI_EM_WIFI_CAP_1, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_freq_cap},
    {MMI_EM_WIFI_FREQ_SEL, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_wifi_tx_select_freq},  
    {MMI_EM_WIFI_CAP_2, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_tx_gain_cap},
    {MMI_EM_WIFI_GAIN_EDIT, CUI_INLINE_ITEM_TYPE_TEXT_EDIT, 0, (void*)&g_mmi_em_rf_wifi_tx_gain_edit}
};


static const cui_inline_struct g_mmi_em_rf_test_wifi_tx_local_fraq_inline_scrn = 
{
    sizeof(g_mmi_em_rf_test_wifi_tx_local_fraq_inline)/sizeof(cui_inline_set_item_struct),
    STR_ID_EM_RF_WIFI_TX_LOCAL_FREQUENCY,
    0,
    CUI_INLINE_SCREEN_LOOP|CUI_INLINE_SCREEN_DISABLE_DONE,
    NULL,
    (const cui_inline_set_item_struct*)&g_mmi_em_rf_test_wifi_tx_local_fraq_inline
};

static const cui_inline_set_item_struct g_mmi_em_rf_test_wifi_tx_cont_pkt_inline[] = 
{
    {MMI_EM_WIFI_CAP_1, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_freq_cap},
    {MMI_EM_WIFI_FREQ_SEL, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_wifi_tx_select_freq},
    {MMI_EM_WIFI_CAP_2, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_rate_cap},
    {MMI_EM_WIFI_DATA_RATE_SEL, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_wifi_select_rate},  
    {MMI_EM_WIFI_CAP_3, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_tx_gain_cap},
    {MMI_EM_WIFI_GAIN_EDIT, CUI_INLINE_ITEM_TYPE_TEXT_EDIT, 0, (void*)&g_mmi_em_rf_wifi_tx_gain_edit},
    {MMI_EM_WIFI_CAP_4, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_power_update_cap},
    {MMI_EM_WIFI_POWER_EDIT, CUI_INLINE_ITEM_TYPE_TEXT_EDIT, 0, (void*)&g_mmi_em_rf_wifi_power_update_edit},
    {MMI_EM_WIFI_CAP_5, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_tx_rkt_count_cap},
    {MMI_EM_WIFI_PKT_COUNT_EDIT, CUI_INLINE_ITEM_TYPE_TEXT_EDIT, 0, (void*)&g_mmi_em_rf_wifi_tx_pkt_count_edit},
    {MMI_EM_WIFI_CAP_6, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_tx_rkt_length_cap},
    {MMI_EM_WIFI_PKT_LENGTH_EDIT, CUI_INLINE_ITEM_TYPE_TEXT_EDIT, 0, (void*)&g_mmi_em_rf_wifi_tx_pkt_length_edit},
    {MMI_EM_WIFI_CAP_7, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_11nBW_cap},
    {MMI_EM_WIFI_11N_BW_SEL, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_wifi_select_11nBW},
    {MMI_EM_WIFI_CAP_8, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_11nGI_cap},
    {MMI_EM_WIFI_11N_GI_SEL, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_wifi_select_11nGI},
    {MMI_EM_WIFI_CAP_9, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_11nPF_cap},
    {MMI_EM_WIFI_11N_PF_SEL, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_wifi_select_11nPF},
    {MMI_EM_WIFI_CAP_10, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_tx_pattern_cap},
    {MMI_EM_WIFI_TX_PATTERN_SEL, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_wifi_tx_select_pattern}
};
static const cui_inline_struct g_mmi_em_rf_test_wifi_tx_cont_pkt_inline_scrn = 
{
    sizeof(g_mmi_em_rf_test_wifi_tx_cont_pkt_inline)/sizeof(cui_inline_set_item_struct),
    STR_ID_EM_RF_WIFI_TX_CONT_PKT_TX,
    0,
    CUI_INLINE_SCREEN_LOOP|CUI_INLINE_SCREEN_DISABLE_DONE,
    NULL,
    (const cui_inline_set_item_struct*)&g_mmi_em_rf_test_wifi_tx_cont_pkt_inline
};



static const cui_inline_set_item_struct g_mmi_em_rf_test_wifi_rx_cont_pkt_inline[] = 
{
    {MMI_EM_WIFI_CAP_1, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_freq_cap},
    {MMI_EM_WIFI_FREQ_SEL, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_wifi_tx_select_freq}
    ,{MMI_EM_WIFI_CAP_2, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_11nBW_cap},
    {MMI_EM_WIFI_11N_BW_SEL, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_wifi_select_11nBW}
};

static const cui_inline_struct g_mmi_em_rf_test_wifi_rx_cont_pkt_inline_scrn = 
{
    sizeof(g_mmi_em_rf_test_wifi_rx_cont_pkt_inline)/sizeof(cui_inline_set_item_struct),
    STR_ID_EM_RF_WIFI_CONT_PKT_RX,
    0,
    CUI_INLINE_SCREEN_LOOP|CUI_INLINE_SCREEN_DISABLE_DONE,
    NULL,
    (const cui_inline_set_item_struct*)&g_mmi_em_rf_test_wifi_rx_cont_pkt_inline
};


static const cui_inline_set_item_struct g_mmi_em_rf_test_wifi_power_save_mode_inline[] = 
{
    {MMI_EM_WIFI_CAP_1, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_power_save_mode_cap},
    {MMI_EM_WIFI_SLEEP_MODE_SEL, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_wifi_select_power_save_mode}
};

static const cui_inline_struct g_mmi_em_rf_test_wifi_power_save_mode_inline_scrn = 
{
    sizeof(g_mmi_em_rf_test_wifi_power_save_mode_inline)/sizeof(cui_inline_set_item_struct),
    STR_ID_EM_RF_WIFI_POWER_SAVE,
    0,
    CUI_INLINE_SCREEN_LOOP|CUI_INLINE_SCREEN_DISABLE_DONE,
    NULL,
    (const cui_inline_set_item_struct*)&g_mmi_em_rf_test_wifi_power_save_mode_inline
};

static const cui_inline_set_item_struct g_mmi_em_rf_wifi_register_inline[] = 
{
    {MMI_EM_WIFI_CAP_1, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_register_type_cap},
    {MMI_EM_WIFI_BIT_TYPE_SEL, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_wifi_select_register_type}, 
    {MMI_EM_WIFI_CAP_2, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_register_access_cap},
    {MMI_EM_WIFI_ACCESS_TYPE_SEL, CUI_INLINE_ITEM_TYPE_SELECT, 0, (void*)&g_mmi_em_rf_wifi_select_register_access},
    {MMI_EM_WIFI_CAP_3, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_register_address_cap},
    {MMI_EM_WIFI_ADDRESS_EDIT, CUI_INLINE_ITEM_TYPE_TEXT_EDIT, 0, (void*)&g_mmi_em_rf_wifi_register_address_edit},
    {MMI_EM_WIFI_CAP_4, CUI_INLINE_ITEM_TYPE_CAPTION, 0, (void*)&g_mmi_em_rf_wifi_register_data_cap},
    {MMI_EM_WIFI_DATA_EDIT, CUI_INLINE_ITEM_TYPE_TEXT_EDIT, 0, (void*)&g_mmi_em_rf_wifi_register_data_edit},        
};

static const cui_inline_struct g_mmi_em_rf_wifi_register_mcr_inline_scrn = 
{
    sizeof(g_mmi_em_rf_wifi_register_inline)/sizeof(cui_inline_set_item_struct),
    STR_ID_EM_RF_WIFI_REGISTER_MCR,
    0,
    CUI_INLINE_SCREEN_LOOP|CUI_INLINE_SCREEN_DISABLE_DONE,
    NULL,
    (const cui_inline_set_item_struct*)&g_mmi_em_rf_wifi_register_inline
};

static const cui_inline_struct g_mmi_em_rf_wifi_register_eeprom_inline_scrn = 
{
    sizeof(g_mmi_em_rf_wifi_register_inline)/sizeof(cui_inline_set_item_struct),
    STR_ID_EM_RF_WIFI_REGISTER_EEPROM,
    0,
    CUI_INLINE_SCREEN_LOOP|CUI_INLINE_SCREEN_DISABLE_DONE,
    NULL,
    (const cui_inline_set_item_struct*)&g_mmi_em_rf_wifi_register_inline
};


static const cui_inline_struct g_mmi_em_rf_wifi_register_efuse_inline_scrn = 
{
    sizeof(g_mmi_em_rf_wifi_register_inline)/sizeof(cui_inline_set_item_struct),
    STR_ID_EM_RF_WIFI_REGISTER_EFUSE,
    0,
    CUI_INLINE_SCREEN_LOOP|CUI_INLINE_SCREEN_DISABLE_DONE,
    NULL,    
    (const cui_inline_set_item_struct*)&g_mmi_em_rf_wifi_register_inline
};



#define WIFI_MAIN
/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_hex_to_i
 * DESCRIPTION
 *  transfer a hex string to int value, don't process negative number
 * PARAMETERS
 *  buf         [IN]  hex string
 *  int_value   [IN]  pointer to return the transfer int value
 * RETURNS
 *  MMI_BOOL    if success  
 *****************************************************************************/
static MMI_BOOL mmi_em_rf_hex_to_i(U16 *buf, U32 *int_value)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 temp;
    U32 value = 0;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    while(*buf)
    {
        if( *buf >='0' && *buf <='9' )           /* 0 ~ 9 */
            temp = *buf - '0';
        else if (*buf >= 'A' && *buf <= 'F')     /* A ~ F */
            temp = *buf - 'A' + 10; 
        else if (*buf >= 'a' && *buf <= 'f')     /* a ~ f */
            temp = *buf - 'a' + 10;        
        else 
            return MMI_FALSE;
        value = value * 16 + temp;
        buf ++;
    }
    *int_value = value;
    return MMI_TRUE;    
}


#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif


/*****************************************************************************
 * FUNCTION
 *  EMRFTestWiFiInitContext
 * DESCRIPTION
 *  EMRFTestWiFiInitContext
 * PARAMETERS
 *  void
 * RETURNS
 *  void 
 *****************************************************************************/
void EMRFTestWiFiInitContext(void)
{    
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    wifi_cntx->wifi_capability = (mmi_em_rf_wifi_capability_enum)wndrv_query_chip_capability();    
    wifi_cntx->int_pktcount = 1000;    
    wifi_cntx->int_eeprom_address = 0;
    wifi_cntx->int_eeprom_data = 0;
    wifi_cntx->int_mcr_address = 0;
    wifi_cntx->int_mcr_data = 0;
    wifi_cntx->int_efuse_address = 0;
    wifi_cntx->int_pktlength = 1024;
    wifi_cntx->currRFWifiTxPattern = 3;
}

/*****************************************************************************
 * FUNCTION
 *  EMRFTestWiFiFillTxCommonReqContext
 * DESCRIPTION
 *  Tx request
 * PARAMETERS
 *  msg         [IN]
 * RETURNS
 *  void
 *****************************************************************************/
static void EMRFTestWiFiFillTxCommonReqContext(mmi_eq_rf_test_wifi_req_struct* msg)
{    
	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    msg->request.wifi_tx_common.contry_code[0]='U';
    msg->request.wifi_tx_common.contry_code[1]='S';   
    
    msg->request.wifi_tx_common.ch_freq = rf_wifi_tx_ch_freq[wifi_cntx->currRFWifiChFreq];
    msg->request.wifi_tx_common.tx_rate = (kal_uint8)wifi_cntx->currRFWifiTxRate;
    msg->request.wifi_tx_common.tx_ant = 0;
    
    msg->request.wifi_tx_common.txBw = (wndrv_test_bandwidth_enum)wifi_cntx->currRFWifi11nBW;
    msg->request.wifi_tx_common.txGI = (wndrv_test_guard_intval_enum)wifi_cntx->currRFWifi11nGI;
    msg->request.wifi_tx_common.txMode = (wndrv_test_mode_sel_enum)wifi_cntx->currRFWifi11nPF;
    if (MMI_EM_WIFI_CAPABILITY_31 == wifi_cntx->wifi_capability)
    {
        msg->request.wifi_tx_common.gain = wifi_cntx->int_power;       
    }
    else
    {
        msg->request.wifi_tx_common.gain = wifi_cntx->int_gain;    
    }
}


/*****************************************************************************
 * FUNCTION
 *  EMRFTestWiFiSendReq
 * DESCRIPTION
 *  Test request function
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMRFTestWiFiSendReq(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_eq_rf_test_wifi_req_struct *msg_p;
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    msg_p = OslConstructDataPtr(sizeof(mmi_eq_rf_test_wifi_req_struct));

    msg_p->request_type = wifi_cntx->req_type;
       
    switch(wifi_cntx->req_type)
    {
        case RF_TEST_WIFI_TX_OUTPUT_POWER:
        {
            EMRFTestWiFiFillTxCommonReqContext(msg_p);
            break;           
        }

        case RF_TEST_WIFI_TX_LOCAL_FREQ:
        {
            EMRFTestWiFiFillTxCommonReqContext(msg_p);        
            break;           
        }

        case RF_TEST_WIFI_TX_CONT_PKT:
        {
            msg_p->request.wifi_tx_cont_pkt.contry_code[0]='U';
            msg_p->request.wifi_tx_cont_pkt.contry_code[1]='S';
            
            msg_p->request.wifi_tx_cont_pkt.ch_freq = rf_wifi_tx_ch_freq[wifi_cntx->currRFWifiChFreq];
            msg_p->request.wifi_tx_cont_pkt.tx_rate = (kal_uint8)wifi_cntx->currRFWifiTxRate;
            msg_p->request.wifi_tx_cont_pkt.tx_ant = 0;
            
            msg_p->request.wifi_tx_cont_pkt.gain = wifi_cntx->int_gain;        
            msg_p->request.wifi_tx_cont_pkt.pkt_count = wifi_cntx->int_pktcount;
            msg_p->request.wifi_tx_cont_pkt.pkt_interval = 0;
            msg_p->request.wifi_tx_cont_pkt.pkt_length = wifi_cntx->int_pktlength;

            msg_p->request.wifi_tx_cont_pkt.tx_pattern = wifi_cntx->currRFWifiTxPattern;
            msg_p->request.wifi_tx_cont_pkt.short_peramble= KAL_FALSE;
            if (MMI_EM_WIFI_CAPABILITY_31 == wifi_cntx->wifi_capability)
            {
                msg_p->request.wifi_tx_cont_pkt.txBw = (wndrv_test_bandwidth_enum)wifi_cntx->currRFWifi11nBW;
                msg_p->request.wifi_tx_cont_pkt.txGI = (wndrv_test_guard_intval_enum)wifi_cntx->currRFWifi11nGI;
                msg_p->request.wifi_tx_cont_pkt.txMode = (wndrv_test_mode_sel_enum)wifi_cntx->currRFWifi11nPF;
                msg_p->request.wifi_tx_cont_pkt.gain = wifi_cntx->int_power;
            }
            else
            {
                msg_p->request.wifi_tx_cont_pkt.gain = wifi_cntx->int_gain;
            }
            
            
            break;           
        }
        case RF_TEST_WIFI_RX_CONT_PKT:
        {
            msg_p->request.wifi_rx_cont_pkt.ch_freq = rf_wifi_tx_ch_freq[wifi_cntx->currRFWifiChFreq];
            if (MMI_EM_WIFI_CAPABILITY_31 == wifi_cntx->wifi_capability)
            {
                msg_p->request.wifi_rx_cont_pkt.rxBw = (wndrv_test_bandwidth_enum)wifi_cntx->currRFWifi11nBW;    
            }            
            break;           
        }
        case RF_TEST_WIFI_POWER_SAVE:
        {
            msg_p->request.wifi_power_save.pwr_mgt = (U8)wifi_cntx->currRFWifiPowerSave;
            break;           
        }
        case RF_TEST_WIFI_REG_MCR32_WRITE:
        {
            msg_p->request.wifi_mcr32_write.mcr_index = wifi_cntx->int_mcr_address;
            msg_p->request.wifi_mcr32_write.mcr32 = wifi_cntx->int_mcr_data;
            break;           
        }
        case RF_TEST_WIFI_REG_MCR32_READ:
        {
            msg_p->request.wifi_mcr32_read.mcr_index = wifi_cntx->int_mcr_address;
            break;           
        }
        case RF_TEST_WIFI_REG_MCR16_WRITE:
        {
            msg_p->request.wifi_mcr16_write.mcr_index = wifi_cntx->int_mcr_address;
            msg_p->request.wifi_mcr16_write.mcr16 = (U16)wifi_cntx->int_mcr_data;
            break;           
        }
        case RF_TEST_WIFI_REG_MCR16_READ:
        {
            msg_p->request.wifi_mcr16_read.mcr_index = wifi_cntx->int_mcr_address;
            break;           
        }
        case RF_TEST_WIFI_REG_EEPROM_WRITE:
        {
            msg_p->request.wifi_eeprom_write.eeprom_index = wifi_cntx->int_eeprom_address;
            msg_p->request.wifi_eeprom_write.eeprom = (U16)wifi_cntx->int_eeprom_data;
            break;           
        }
        case RF_TEST_WIFI_REG_EEPROM_READ:
        {
            msg_p->request.wifi_eeprom_read.eeprom_index = wifi_cntx->int_eeprom_address;        
            break;           
        }

        case RF_TEST_WIFI_REG_EFUSE_WRITE:
//            msg_p->request.wifi_efuse_write.efuse_index = wifi_cntx->int_efuse_address;
//            msg_p->request.wifi_efuse_write.efuse = wifi_cntx->int_efuse_data;
            break;

        case RF_TEST_WIFI_REG_EFUSE_READ:
            msg_p->request.wifi_efuse_read.efuse_index = wifi_cntx->int_efuse_address;
            break;

       default:
            break;
    }

    EngineerModeSendMsg(MSG_ID_MMI_EQ_RF_TEST_WIFI_REQ, msg_p, NULL);    
}


/*****************************************************************************
 * FUNCTION
 *  EMRFTestWifiSendRes
 * DESCRIPTION
 *  RF Test WiFi send request response function.
 * PARAMETERS
 *  inMsg       [IN]
 * RETURNS
 *  void
 *****************************************************************************/
void EMRFTestWifiSendRes(void* inMsg)
{
    mmi_eq_rf_test_wifi_rsp_struct *rsp_p = inMsg;

    /*if user don't wait the response and exit, will not process response*/
    if (g_rf_test_wifi_cntx.is_not_waiting== MMI_TRUE)
    {
        return;
    }
    
    switch(rsp_p->request_type)
    {
        case RF_TEST_WIFI_RX_CONT_PKT:
        {
            EntryEmRFTestWiFiRXContPKTRsp((U8 *)&(rsp_p->request.wifi_rx_cont_pkt));    
            break;           
        }

        case RF_TEST_WIFI_REG_MCR32_READ:
        {
            EntryEmRFTestWiFiRegMCRAccessRsp(rsp_p->request.wifi_mcr32_read.mcr32);
            break;           
        }

        case RF_TEST_WIFI_REG_MCR16_READ:
        {
            EntryEmRFTestWiFiRegMCRAccessRsp(rsp_p->request.wifi_mcr16_read.mcr16);
            break;           
        }
        
        case RF_TEST_WIFI_REG_EEPROM_READ:
        {
            EntryEmRFTestWiFiRegEEPROMAccessRsp(rsp_p->request.wifi_eeprom_read.eeprom);
            break;           
        }

        case RF_TEST_WIFI_REG_EFUSE_READ:
            mmi_em_rf_wifi_register_efuse_rsp(rsp_p->request.wifi_efuse_read.efuse);
            break;

        default:
            break;
    }

 }


/*****************************************************************************
 * FUNCTION
 *  EmStopRFTestWiFi
 * DESCRIPTION
 *  Stop Em RF Test WIFI request
 * PARAMETERS
 *  inMsg       [IN]
 * RETURNS
 *  void
 *****************************************************************************/
void EmStopRFTestWiFi(void)
{
	em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    if (wifi_cntx->request_processing == MMI_TRUE)
    {
        wifi_cntx->req_type = RF_TEST_WIFI_STOP;
        wifi_cntx->request_processing = MMI_FALSE;
        EMRFTestWiFiSendReq();        
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_enter_confirm_hdlr
 * DESCRIPTION
 *  when entry wifi rftest, let user to confirm if entry.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_em_rf_test_wifi_enter_confirm_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __RF_DESENSE_TEST__    
    EmRFTestWifiEnterFlightMode();
#else
    mmi_em_display_confirm(STR_ID_EM_RF_TEST_GSM_CONFIRM_NOTIFY_TEST,
                            mmi_em_get_root_group(),
                            MMI_EVENT_WARNING,
                            mmi_em_rf_test_wifi_confirm_proc);
#endif
}

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_confirm_proc
 * DESCRIPTION
 *  mmi_em_rf_test_wifi_confirm_proc
 * PARAMETERS
 *  evt     [IN]
 * RETURNS
 *  MMI_RET 
 *****************************************************************************/
static MMI_RET mmi_em_rf_test_wifi_confirm_proc(mmi_event_struct *evt)
{    
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_alert_result_evt_struct *alert = (mmi_alert_result_evt_struct*) evt;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
  
    switch (alert->result)
    {
    case MMI_ALERT_CNFM_YES:
        EmRFTestWifiEnterFlightMode();
        break;

    default:
        break;
    }
    return MMI_RET_OK;
}


/*****************************************************************************
 * FUNCTION
 *  EmRFTestWifiEnterFlightMode
 * DESCRIPTION
 *  enter flight mode: let user to shutdown wifi app
 * PARAMETERS
 *  void
 * RETURNS
 *  void 
 *****************************************************************************/
void EmRFTestWifiEnterFlightMode(void)
{
    srv_dtcnt_wlan_status_enum status;
    
    status = srv_dtcnt_wlan_status();
    if (status == SRV_DTCNT_WLAN_STATUS_CONNECTED)
    {
        mmi_em_popup_by_str(STR_ID_EM_RF_TEST_WIFI_CLOSE, MMI_EVENT_FAILURE);
    }
    else
    {
        mmi_em_wifi_rf_test_replay_hdlr();
    }
}

/*****************************************************************************
 * FUNCTION
 *  mmi_em_wifi_rf_test_replay_hdlr
 * DESCRIPTION
 *  send request to driver, let driver enter test mode
 * PARAMETERS
 *  void
 * RETURNS
 *  void 
 *****************************************************************************/
static void mmi_em_wifi_rf_test_replay_hdlr(void)
{        
	em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
   /* set request type = WiFi Test Mode*/    
    wifi_cntx->req_type = RF_TEST_WIFI_TEST_MODE;
    
    /* Send request to RF */
    wifi_cntx->request_processing = MMI_TRUE;
    EMRFTestWiFiSendReq();

    mmi_em_rf_test_wifi_entry_list(wifi_cntx);
}

/*****************************************************************************
 * FUNCTION
 *  EmRFTestWifiExitTestMode
 * DESCRIPTION
 *  exit wifi test, phone power off and restart
 * PARAMETERS
 *  void
 * RETURNS
 *  void 
 *****************************************************************************/
void EmRFTestWifiExitTestMode(void)
{
    srv_shutdown_normal_start(APP_ENGINEERMODE1);
}

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_entry_list
 * DESCRIPTION
 *  mmi_em_rf_test_wifi_entry_list
 * PARAMETERS
 *  wifi_cntx       [IN]
 * RETURNS
 *  void 
 *****************************************************************************/
static mmi_ret mmi_em_rf_test_wifi_entry_list(em_rf_test_wifi_struct *wifi_cntx)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_id group_id = 0;
    mmi_id menu_id = 0;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/ 
    SetProtocolEventHandler(EMRFTestWifiSendRes ,  MSG_ID_MMI_EQ_RF_TEST_WIFI_RSP);
    group_id = mmi_frm_group_create_ex(mmi_em_get_root_group(),
                                GRP_ID_AUTO_GEN,
                                mmi_em_rf_test_wifi_list_proc,
                                NULL,
                                MMI_FRM_NODE_SMART_CLOSE_FLAG);

    menu_id = cui_menu_create_and_run(group_id,
                        CUI_MENU_SRC_TYPE_RESOURCE,
                        CUI_MENU_TYPE_FROM_RESOURCE,
                        MENU_ID_EM_RF_TEST_TOOL_WIFI_LIST,
                        MMI_TRUE,
                        NULL);
    if (MMI_EM_WIFI_CAPABILITY_31 == wifi_cntx->wifi_capability)
    {
        cui_menu_set_item_hidden(menu_id, MENU_ID_EM_RF_WIFI_TX_LOCAL_FREQUENCY, MMI_TRUE);
        cui_menu_set_item_hidden(menu_id, MENU_ID_EM_RF_WIFI_REGISTER_EEPROM, MMI_TRUE);
    }
    else
    {
        cui_menu_set_item_hidden(menu_id, MENU_ID_EM_RF_WIFI_REGISTER_EFUSE, MMI_TRUE);
    }
    return MMI_RET_OK;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_list_proc
 * DESCRIPTION
 *  mmi_em_rf_test_wifi_list_proc
 * PARAMETERS
 *  evt     [IN]
 * RETURNS
 *  MMI_RET
 *****************************************************************************/
static MMI_RET mmi_em_rf_test_wifi_list_proc(mmi_event_struct *evt)
{
    cui_menu_event_struct *menu_evt = (cui_menu_event_struct *)evt;
    
    
    switch(menu_evt->evt_id)
    {
        case EVT_ID_CUI_MENU_LIST_ENTRY:
            if (MMI_EM_WIFI_CAPABILITY_31 == g_rf_test_wifi_cntx.wifi_capability)
            {
                if(menu_evt->parent_menu_id == MENU_ID_EM_RF_TEST_TOOL_WIFI_LIST)
                {
                    cui_menu_set_item_string_by_id(menu_evt->sender_id, 
                                                MENU_ID_EM_RF_WIFI_REGISTER_ACCESS, 
                                                STR_ID_EM_RF_WIFI_STORAGE);
                }
                if (menu_evt->parent_menu_id == MENU_ID_EM_RF_WIFI_REGISTER_ACCESS)
                {
                    cui_menu_set_currlist_title_by_id(menu_evt->sender_id,
                                                        STR_ID_EM_RF_WIFI_STORAGE,
                                                        0);
                }    
            }            
            break;
            
        case EVT_ID_CUI_MENU_ITEM_SELECT:
        {
            mmi_em_rf_test_menu_sel_event_hdlr(menu_evt);
            break;
        }

        case EVT_ID_CUI_MENU_CLOSE_REQUEST:
        {
            cui_menu_close(menu_evt->sender_id);
            break;
        }

        case EVT_ID_GROUP_DEINIT:
        #ifdef __RF_DESENSE_TEST__
            SetProtocolEventHandler(NULL,  MSG_ID_MMI_EQ_RF_TEST_WIFI_RSP);
        #else            
            EmStopRFTestWiFi();// stop wifi test
            EmRFTestWifiExitTestMode();  //turn off phone
        #endif
            break;
        
        default:
            break;
    }    
    return MMI_RET_OK;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_menu_sel_event_hdlr
 * DESCRIPTION
 *  mmi_em_rf_test_menu_sel_event_hdlr
 * PARAMETERS
 *  evt     [IN]
 * RETURNS
 *  MMI_RET
 *****************************************************************************/
static MMI_RET mmi_em_rf_test_menu_sel_event_hdlr(cui_menu_event_struct *evt)
{
    switch(evt->highlighted_menu_id)
    {      
    case MENU_ID_EM_RF_WIFI_TX_OUTPUT_POWER:
        mmi_em_rf_test_wifi_handle_tx_output_power();
        break;
           
    case MENU_ID_EM_RF_WIFI_TX_LOCAL_FREQUENCY:
        mmi_em_rf_test_wifi_handle_tx_local_fraq();
        break;

    case MENU_ID_EM_RF_WIFI_TX_CONT_PKT_TX:
        mmi_em_rf_test_wifi_handle_tx_cont_pkt();
        break;

    case MENU_ID_EM_RF_WIFI_CONT_PKT_RX:
        mmi_em_rf_test_wifi_handle_rx_cont_pkt();
        break;
        
    case MENU_ID_EM_RF_WIFI_POWER_SAVE:
        mmi_em_rf_test_wifi_handle_power_save_mode();
        break;

    case MENU_ID_EM_RF_WIFI_REGISTER_MCR:
        mmi_em_rf_wifi_handle_register_mcr();
        break;
              
    case MENU_ID_EM_RF_WIFI_REGISTER_EEPROM:
        mmi_em_rf_wifi_handle_register_eeprom();
        break;


    case MENU_ID_EM_RF_WIFI_REGISTER_EFUSE:
        mmi_em_rf_wifi_handle_register_efuse();
        break;
       
    default:
        break;
    }
    return MMI_RET_OK;
}


#define EM_WIFI_COMMON_FUNC


/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_get_gain_from_inline
 * DESCRIPTION
 *  mmi_em_rf_test_wifi_get_gain_from_inline
 * PARAMETERS
 *  inline_id       [IN]
 *  item_id         [IN]
 *  data            [IN/OUT]
 * RETURNS
 *  MMI_BOOL
 *****************************************************************************/
static MMI_BOOL mmi_em_rf_test_wifi_get_gain_from_inline(MMI_ID inline_id, U16 item_id, U32 *data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 gain;
    MMI_BOOL result;
    WCHAR gain_str[MMI_EM_RF_WIFI_GAIN_LEN + 1];
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    
    cui_inline_get_value(inline_id, item_id, (void*)gain_str);
    result = mmi_em_rf_hex_to_i(gain_str, &gain);
    if (result && gain <= MMI_EM_WIFI_TX_GAIN_MAX)
    {
        *data = gain;
        return MMI_TRUE;
    }
    else
    {
        return MMI_FALSE;
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_set_gain_to_inline
 * DESCRIPTION
 *  set gain value
 * PARAMETERS
 *  inline_id       [IN]
 *  item_id         [IN]
 *  set_value       [IN]
 * RETURNS
 *  MMI_BOOL
 *****************************************************************************/
static void mmi_em_rf_test_wifi_set_gain_to_inline(MMI_ID inline_id, U16 item_id, U32 set_value)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    WCHAR gain_str[MMI_EM_RF_WIFI_GAIN_LEN + 1];
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_wcs_itow((S32)set_value, gain_str, 16);
	cui_inline_set_value(inline_id, item_id, (void*)gain_str);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_set_gain_to_inline
 * DESCRIPTION
 *  get power value
 * PARAMETERS
 *  inline_id       [IN]
 *  item_id         [IN]
 *  data            [IN/OUT]
 * RETURNS
 *  MMI_BOOL
 *****************************************************************************/
static MMI_BOOL mmi_em_rf_wifi_get_power_value_from_inline(MMI_ID inline_id, U16 item_id, U32 *data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    WCHAR wstr[MMI_EM_WIFI_REG_POWER_UPDATE_LEN + 1];
    CHAR  str[MMI_EM_WIFI_REG_POWER_UPDATE_LEN + 1];  
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /*because power's mini unit is 0.5dbm, so user can input float value*/
    /*but the power type in struct is defined as kal_uint8.             */
    /*so, let user to input float value, than mmi make the float_value*2 and */
    /*trans to kal_uint*/
    cui_inline_get_value(inline_id, item_id, (void*)wstr);
    mmi_wcs_to_asc(str, wstr);
    *data = (U32)(atof(str) *2);
    return MMI_TRUE; 
}

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_set_power_value_to_inline
 * DESCRIPTION
 *  Set power value
 * PARAMETERS
 *  inline_id       [IN]
 *  item_id         [IN]
 *  set_value       [IN]
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_em_rf_test_wifi_set_power_value_to_inline(MMI_ID inline_gid, U16 item_id, U32 set_value)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
     WCHAR power_str[MMI_EM_WIFI_REG_POWER_UPDATE_LEN + 1];
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_wcs_itow((S32)set_value, power_str, 10);
	cui_inline_set_value(inline_gid, item_id, (void*)power_str);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_get_pkt_count_from_inline
 * DESCRIPTION
 *  Get pkt count value from inline
 * PARAMETERS
 *  inline_id       [IN]
 *  item_id         [IN]
 *  data            [IN/OUT]
 * RETURNS
 *  MMI_BOOL
 *****************************************************************************/
static MMI_BOOL mmi_em_rf_test_wifi_get_pkt_count_from_inline(MMI_ID inline_id, U16 item_id, U32 *data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    WCHAR data_buf[MMI_EM_WIFI_PKT_COUNT_LEN + 1];
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    cui_inline_get_value(inline_id, item_id, (void*)data_buf);
    *data = (U32)mmi_wcs_wtoi(data_buf);
    return MMI_TRUE;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_get_pkt_length_from_inline
 * DESCRIPTION
 *  Get pkt length value from inline
 * PARAMETERS
 *  inline_id       [IN]
 *  item_id         [IN]
 *  data            [IN/OUT]
 * RETURNS
 *  MMI_BOOL
 *****************************************************************************/
static MMI_BOOL mmi_em_rf_test_wifi_get_pkt_length_from_inline(MMI_ID inline_id, U16 item_id, U32 *data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 length = 0;
    WCHAR data_buf[MMI_EM_WIFI_PKT_LENGTH_LEN + 1];
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    cui_inline_get_value(inline_id, item_id, (void*)data_buf);
    length = mmi_wcs_wtoi(data_buf);
    if (length < 24 || length > 1500)
    {
        return MMI_FALSE; 
    }
    else
    {
        *data = length;
        return MMI_TRUE;
    }
}




#define WIFI_TX_OUTPUT_POWER

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_init_tx_output_power
 * DESCRIPTION
 *  mmi_em_rf_test_wifi_init_tx_output_power
 * PARAMETERS
 *  inline_id       [IN]
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_em_rf_test_wifi_init_tx_output_power(MMI_ID inline_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    cui_inline_set_value(inline_id, MMI_EM_WIFI_FREQ_SEL, (void *) wifi_cntx->currRFWifiChFreq);
    if (wifi_cntx->wifi_capability == MMI_EM_WIFI_CAPABILITY_31)
    {
        cui_inline_set_value(inline_id, MMI_EM_WIFI_DATA_RATE_SEL, (void *) wifi_cntx->currRFWifiTxRate);
        mmi_em_rf_test_wifi_set_power_value_to_inline(inline_id,
                                            MMI_EM_WIFI_POWER_EDIT,
                                            wifi_cntx->int_power / 2);
        cui_inline_set_value(inline_id, MMI_EM_WIFI_11N_BW_SEL, (void *) wifi_cntx->currRFWifi11nBW);
        cui_inline_set_value(inline_id, MMI_EM_WIFI_11N_GI_SEL, (void *) wifi_cntx->currRFWifi11nGI);
        cui_inline_set_value(inline_id, MMI_EM_WIFI_11N_PF_SEL, (void *) wifi_cntx->currRFWifi11nPF); 
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_CAP_3);
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_GAIN_EDIT);
    }
    else
    {
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_CAP_4);
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_CAP_5);
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_CAP_6);
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_CAP_7);
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_11N_BW_SEL);
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_11N_GI_SEL);
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_11N_PF_SEL);
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_POWER_EDIT);

        cui_inline_set_item_select_with_string_id(inline_id, 
                                    MMI_EM_WIFI_DATA_RATE_SEL, 
                                    MMI_EM_WIFI_RATE_21_END,
                                    (U16 *)g_mmi_em_rf_wifi_rate_str,
                                    (U8)wifi_cntx->currRFWifiTxRate);
        mmi_em_rf_test_wifi_set_gain_to_inline(inline_id, 
                                            MMI_EM_WIFI_GAIN_EDIT,
                                            (U32)wifi_cntx->int_gain);
    }
}

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_output_power_submit_hdlr
 * DESCRIPTION
 *  mmi_em_rf_test_wifi_output_power_submit_hdlr
 * PARAMETERS
 *  inline_id       [IN]
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_em_rf_test_wifi_output_power_submit_hdlr(MMI_ID inline_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_BOOL result;
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    cui_inline_get_value(inline_id, MMI_EM_WIFI_FREQ_SEL, (void *) &wifi_cntx->currRFWifiChFreq);
    cui_inline_get_value(inline_id, MMI_EM_WIFI_DATA_RATE_SEL, (void *) &wifi_cntx->currRFWifiTxRate);
    if(MMI_EM_WIFI_CAPABILITY_31 == wifi_cntx->wifi_capability)
    {
        cui_inline_get_value(inline_id, MMI_EM_WIFI_11N_BW_SEL, (void *)&wifi_cntx->currRFWifi11nBW);
        cui_inline_get_value(inline_id, MMI_EM_WIFI_11N_GI_SEL, (void *)&wifi_cntx->currRFWifi11nGI);
        cui_inline_get_value(inline_id, MMI_EM_WIFI_11N_PF_SEL, (void *)&wifi_cntx->currRFWifi11nPF);
        result = mmi_em_rf_wifi_get_power_value_from_inline(inline_id,
                                                        MMI_EM_WIFI_POWER_EDIT,
                                                        &wifi_cntx->int_power);
    }
    else
    {
        result = mmi_em_rf_test_wifi_get_gain_from_inline(inline_id, 
                                                        MMI_EM_WIFI_GAIN_EDIT,
                                                        &wifi_cntx->int_gain);
    }
    if (!result)
    {
        mmi_em_fail_popup();
        cui_inline_close(inline_id);
    }
    else
    {
        wifi_cntx->request_processing = MMI_TRUE;
        EMRFTestWiFiSendReq();
        mmi_em_rf_test_wifi_display_tx_out_power_data();
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_handle_tx_output_power
 * DESCRIPTION
 *  mmi_em_rf_test_wifi_handle_tx_output_power
 * PARAMETERS
 *  inline_id       [IN]
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_em_rf_test_wifi_handle_tx_output_power(void)
{
#if 1//def __MTK_TARGET__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID gid;
    MMI_ID inline_id;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gid = mmi_frm_group_create_ex(mmi_em_get_root_group(),
                                    GRP_ID_AUTO_GEN,
                                    mmi_em_rf_test_wifi_tx_output_power_proc,
                                    NULL, 
                                    MMI_FRM_NODE_SMART_CLOSE_FLAG);

    inline_id = cui_inline_create(gid, &g_mmi_em_rf_test_wifi_tx_output_power_inline_scrn);
    mmi_em_rf_test_wifi_init_tx_output_power(inline_id);
    cui_inline_run(inline_id);
#endif
}

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_tx_output_power_proc
 * DESCRIPTION
 *  mmi_em_rf_test_wifi_tx_output_power_proc
 * PARAMETERS
 *  inline_id       [IN]
 * RETURNS
 *  void
 *****************************************************************************/
static MMI_RET mmi_em_rf_test_wifi_tx_output_power_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cui_event_inline_common_struct* inline_evt = (cui_event_inline_common_struct*) evt;
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(evt->evt_id)
    {
    case EVT_ID_CUI_INLINE_MAIN_SCREEN_ACTIVE:
        /* check if request is processing. If yes, then stop it. */
        EmStopRFTestWiFi();  
        wifi_cntx->req_type = RF_TEST_WIFI_TX_OUTPUT_POWER;
        break;
        
    case EVT_ID_CUI_INLINE_SUBMIT:
	case EVT_ID_CUI_INLINE_CSK_PRESS:
        mmi_em_rf_test_wifi_output_power_submit_hdlr(inline_evt->sender_id);
        break;

    case EVT_ID_CUI_INLINE_ABORT:
		cui_inline_close(inline_evt->sender_id);
		break;

    default:
        break;
    }

    return MMI_RET_OK;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_display_tx_out_power_data
 * DESCRIPTION
 *  mmi_em_rf_test_wifi_display_tx_out_power_data
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_em_rf_test_wifi_display_tx_out_power_data()
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    WCHAR *text_buf;
    mmi_em_text_viewer_struct data = {0};
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    text_buf = (WCHAR *)OslMalloc(MMI_EM_WIFI_SHOW_TEXT_BUF_LEN);
    if(MMI_EM_WIFI_CAPABILITY_31 == wifi_cntx->wifi_capability)
    {
        CHAR power_buf[MMI_EM_WIFI_REG_POWER_UPDATE_LEN + 3];
        sprintf(power_buf, "%.1f", ((double)wifi_cntx->int_power)/ 2);
        kal_wsprintf(text_buf, "%w: %w\n%w: %w\n%w: %w\n%w: %w\n%w: %w\n%w: %s\n", 
                 get_string(STR_ID_EM_RF_WIFI_TX_CH_FREQ),
                 GetString(g_mmi_em_rf_wifi_freq_str[wifi_cntx->currRFWifiChFreq]),
                 GetString(STR_ID_EM_RF_WIFI_TX_RATE),
                 GetString(g_mmi_em_rf_wifi_rate_str[wifi_cntx->currRFWifiTxRate]),
                 GetString(STR_ID_EM_RF_WIFI_11NBW),
                 GetString(g_mmi_em_rf_wifi_11nBW_str[wifi_cntx->currRFWifi11nBW]),
                 GetString(STR_ID_EM_RF_WIFI_11NGI),
                 GetString(g_mmi_em_rf_wifi_11nGI_str[wifi_cntx->currRFWifi11nGI]),
                 GetString(STR_ID_EM_RF_WIFI_11NPF),
                 GetString(g_mmi_em_rf_wifi_11nPF_str[wifi_cntx->currRFWifi11nPF]),
                 GetString(STR_ID_EM_RF_WIFI_POWER_UPDATE),
                 power_buf);
    }        
    else
        kal_wsprintf(text_buf, "%w: %w\n%w: %w\n%w: %x\n", 
                 get_string(STR_ID_EM_RF_WIFI_TX_CH_FREQ),
                 GetString(g_mmi_em_rf_wifi_freq_str[wifi_cntx->currRFWifiChFreq]),
                 GetString(STR_ID_EM_RF_WIFI_TX_RATE),
                 GetString(g_mmi_em_rf_wifi_rate_str[wifi_cntx->currRFWifiTxRate]),
                 GetString(STR_ID_EM_RF_WIFI_TX_GAIN),
                 wifi_cntx->int_gain);

    data.text = text_buf;
    data.title_id = STR_ID_EM_RF_WIFI_TX_OUTPUT_POWER;    
    mmi_em_show_text_viewer(&data);
    OslMfree(text_buf);
}


#define WIFI_TX_LOCAL_FREQ

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_handle_tx_local_fraq
 * DESCRIPTION
 *  mmi_em_rf_test_wifi_handle_tx_local_fraq
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_em_rf_test_wifi_handle_tx_local_fraq(void)
{
#if 1 //def __MTK_TARGET__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID gid;
    MMI_ID inline_id;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gid = mmi_frm_group_create_ex(mmi_em_get_root_group(),
                                    GRP_ID_AUTO_GEN,
                                    mmi_em_rf_test_wifi_tx_local_fraq_proc,
                                    NULL, 
                                    MMI_FRM_NODE_SMART_CLOSE_FLAG);
    
    inline_id = cui_inline_create(gid, &g_mmi_em_rf_test_wifi_tx_local_fraq_inline_scrn);
	mmi_em_rf_test_wifi_init_tx_local_freq(inline_id);    
    cui_inline_run(inline_id);
#endif
}

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_tx_local_fraq_proc
 * DESCRIPTION
 *  mmi_em_rf_test_wifi_tx_local_fraq_proc
 * PARAMETERS
 *  evt         [IN]
 * RETURNS
 *  MMI_RET
 *****************************************************************************/
static MMI_RET mmi_em_rf_test_wifi_tx_local_fraq_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cui_event_inline_common_struct* inline_evt = (cui_event_inline_common_struct*) evt;
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(evt->evt_id)
    {
    case EVT_ID_CUI_INLINE_MAIN_SCREEN_ACTIVE:
        /* check if request is processing. If yes, then stop it. */
        EmStopRFTestWiFi();
        wifi_cntx->req_type = RF_TEST_WIFI_TX_LOCAL_FREQ;
        break;
        
    case EVT_ID_CUI_INLINE_SUBMIT:
	case EVT_ID_CUI_INLINE_CSK_PRESS:
        mmi_em_rf_test_wifi_tx_local_freq_submit_hdlr(inline_evt->sender_id);
        break;

    case EVT_ID_CUI_INLINE_ABORT:
		cui_inline_close(inline_evt->sender_id);
		break;

    default:
        break;
    }

    return MMI_RET_OK;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_init_tx_local_freq
 * DESCRIPTION
 *  mmi_em_rf_test_wifi_init_tx_local_freq
 * PARAMETERS
 *  inline_id         [IN]
 * RETURNS
 *  MMI_RET
 *****************************************************************************/
static void mmi_em_rf_test_wifi_init_tx_local_freq(MMI_ID inline_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    cui_inline_set_value(inline_id, MMI_EM_WIFI_FREQ_SEL, (void *) wifi_cntx->currRFWifiChFreq);
    mmi_em_rf_test_wifi_set_gain_to_inline(inline_id, 
                                            MMI_EM_WIFI_GAIN_EDIT,
                                            (U32)wifi_cntx->int_gain);
}

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_tx_local_freq_submit_hdlr
 * DESCRIPTION
 *  mmi_em_rf_test_wifi_tx_local_freq_submit_hdlr
 * PARAMETERS
 *  inline_id         [IN]
 * RETURNS
 *  MMI_RET
 *****************************************************************************/
static void mmi_em_rf_test_wifi_tx_local_freq_submit_hdlr(MMI_ID inline_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_BOOL result;
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    cui_inline_get_value(inline_id, MMI_EM_WIFI_FREQ_SEL, (void *) &wifi_cntx->currRFWifiChFreq);
    result = mmi_em_rf_test_wifi_get_gain_from_inline(inline_id, 
                                                        MMI_EM_WIFI_GAIN_EDIT,
                                                        &wifi_cntx->int_gain);
    if (!result)
    {
        mmi_em_fail_popup();
        cui_inline_close(inline_id);
    }
    else
    {
        wifi_cntx->request_processing = MMI_TRUE;
        EMRFTestWiFiSendReq();
        mmi_em_rf_test_wifi_display_tx_local_freq_data();
    }
}

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_display_tx_local_freq_data
 * DESCRIPTION
 *  mmi_em_rf_test_wifi_display_tx_local_freq_data
 * PARAMETERS
 *  inline_id         [IN]
 * RETURNS
 *  MMI_RET
 *****************************************************************************/
static void mmi_em_rf_test_wifi_display_tx_local_freq_data(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    WCHAR *text_buf;
    mmi_em_text_viewer_struct data = {0};
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    text_buf = (WCHAR*)OslMalloc(MMI_EM_WIFI_SHOW_TEXT_BUF_LEN);

    kal_wsprintf(text_buf, "%w: %w\n%w: %x\n", 
             GetString(STR_ID_EM_RF_WIFI_TX_CH_FREQ),
             GetString(g_mmi_em_rf_wifi_freq_str[wifi_cntx->currRFWifiChFreq]),
             GetString(STR_ID_EM_RF_WIFI_TX_GAIN),
             wifi_cntx->int_gain); 

    data.text = text_buf;
    data.title_id = STR_ID_EM_RF_WIFI_TX_LOCAL_FREQUENCY;
    mmi_em_show_text_viewer(&data);
    OslMfree(text_buf);
}


#define WIFI_TX_CONT_PKT

static void mmi_em_rf_test_wifi_handle_tx_cont_pkt(void)
{
#if 1 //def __MTK_TARGET__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID gid;
    MMI_ID inline_id;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gid = mmi_frm_group_create_ex(mmi_em_get_root_group(),
                                    GRP_ID_AUTO_GEN,
                                    mmi_em_rf_test_wifi_tx_cont_pkt_proc,
                                    NULL, 
                                    MMI_FRM_NODE_SMART_CLOSE_FLAG);
    
    inline_id = cui_inline_create(gid, &g_mmi_em_rf_test_wifi_tx_cont_pkt_inline_scrn);	
	mmi_em_rf_wifi_init_tx_cont_pkt(inline_id);        
    cui_inline_run(inline_id);
#endif
}

static MMI_RET mmi_em_rf_test_wifi_tx_cont_pkt_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cui_event_inline_common_struct* inline_evt = (cui_event_inline_common_struct*) evt;
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(evt->evt_id)
    {
    case EVT_ID_CUI_INLINE_MAIN_SCREEN_ACTIVE:
        /* check if request is processing. If yes, then stop it. */
        EmStopRFTestWiFi();   
        wifi_cntx->req_type = RF_TEST_WIFI_TX_CONT_PKT;
        break;
        
    case EVT_ID_CUI_INLINE_SUBMIT:
	case EVT_ID_CUI_INLINE_CSK_PRESS:
		mmi_em_rf_wifi_tx_cont_pkt_submit_hdlr(inline_evt->sender_id);
        break;

    case EVT_ID_CUI_INLINE_ABORT:
		cui_inline_close(inline_evt->sender_id);
		break;

    default:
        break;
    }

    return MMI_RET_OK;
}

static void mmi_em_rf_wifi_init_tx_cont_pkt(MMI_ID inline_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    WCHAR data_buf[50];
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    cui_inline_set_value(inline_id, MMI_EM_WIFI_FREQ_SEL, (void *) wifi_cntx->currRFWifiChFreq);
    cui_inline_set_value(inline_id, MMI_EM_WIFI_DATA_RATE_SEL, (void *) wifi_cntx->currRFWifiTxRate);
    if(MMI_EM_WIFI_CAPABILITY_31 == wifi_cntx->wifi_capability)
    {
        mmi_em_rf_test_wifi_set_power_value_to_inline(inline_id, 
                                                    MMI_EM_WIFI_POWER_EDIT,
                                                    wifi_cntx->int_power/2);
        cui_inline_set_value(inline_id, MMI_EM_WIFI_11N_BW_SEL, (void *) wifi_cntx->currRFWifi11nBW);
        cui_inline_set_value(inline_id, MMI_EM_WIFI_11N_GI_SEL, (void *) wifi_cntx->currRFWifi11nGI);
        cui_inline_set_value(inline_id, MMI_EM_WIFI_11N_PF_SEL, (void *) wifi_cntx->currRFWifi11nPF);
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_CAP_3);
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_GAIN_EDIT);
    }
    else
    {
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_CAP_4);
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_CAP_7);
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_CAP_8);
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_CAP_9);
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_POWER_EDIT);
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_11N_BW_SEL);
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_11N_GI_SEL);
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_11N_PF_SEL);
        cui_inline_set_item_select_with_string_id(inline_id, 
                                    MMI_EM_WIFI_DATA_RATE_SEL, 
                                    MMI_EM_WIFI_RATE_21_END,
                                    (U16 *)g_mmi_em_rf_wifi_rate_str,
                                    (U8)wifi_cntx->currRFWifiTxRate);
        mmi_em_rf_test_wifi_set_gain_to_inline(inline_id, 
                                            MMI_EM_WIFI_GAIN_EDIT,
                                            wifi_cntx->int_gain);

    }
    mmi_wcs_itow(wifi_cntx->int_pktcount, data_buf, 10);
    cui_inline_set_value(inline_id, MMI_EM_WIFI_PKT_COUNT_EDIT, (void *) data_buf);
    mmi_wcs_itow(wifi_cntx->int_pktlength, data_buf, 10);
    cui_inline_set_value(inline_id, MMI_EM_WIFI_PKT_LENGTH_EDIT, (void *) data_buf);
    cui_inline_set_value(inline_id, MMI_EM_WIFI_TX_PATTERN_SEL, (void *) wifi_cntx->currRFWifiTxPattern);   
}


static void mmi_em_rf_wifi_tx_cont_pkt_submit_hdlr(MMI_ID inline_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    MMI_BOOL result = MMI_TRUE;    
    U32  power = 0;
    U32  gain = 0;
    U32 count;
    U32 length = 0;
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(MMI_EM_WIFI_CAPABILITY_31 == wifi_cntx->wifi_capability)
    {
        result = mmi_em_rf_wifi_get_power_value_from_inline(inline_id, MMI_EM_WIFI_POWER_EDIT, &power);    
    }
    else
    {
        result = mmi_em_rf_test_wifi_get_gain_from_inline(inline_id, MMI_EM_WIFI_GAIN_EDIT, &gain);    
    }
    if (!result ||
        !mmi_em_rf_test_wifi_get_pkt_count_from_inline(inline_id, MMI_EM_WIFI_PKT_COUNT_EDIT, &count) ||
        !mmi_em_rf_test_wifi_get_pkt_length_from_inline(inline_id, MMI_EM_WIFI_PKT_LENGTH_EDIT, &length))
    {
        mmi_em_fail_popup();
        return;
    }
    
   
    wifi_cntx->int_power = power;
    wifi_cntx->int_gain = gain;
    wifi_cntx->int_pktcount = count;
    wifi_cntx->int_pktlength = length;    
    
    cui_inline_get_value(inline_id, MMI_EM_WIFI_FREQ_SEL, (void*)&wifi_cntx->currRFWifiChFreq);
    cui_inline_get_value(inline_id, MMI_EM_WIFI_DATA_RATE_SEL, (void*)&wifi_cntx->currRFWifiTxRate);
    if(MMI_EM_WIFI_CAPABILITY_31 == wifi_cntx->wifi_capability)
    {
        cui_inline_get_value(inline_id, MMI_EM_WIFI_11N_BW_SEL, (void*)&wifi_cntx->currRFWifi11nBW);
        cui_inline_get_value(inline_id, MMI_EM_WIFI_11N_GI_SEL, (void*)&wifi_cntx->currRFWifi11nGI);
        cui_inline_get_value(inline_id, MMI_EM_WIFI_11N_PF_SEL, (void*)&wifi_cntx->currRFWifi11nPF);    
    }    
    cui_inline_get_value(inline_id, MMI_EM_WIFI_TX_PATTERN_SEL, (void*)&wifi_cntx->currRFWifiTxPattern);
    
    /* Send request to RF */
    wifi_cntx->request_processing = MMI_TRUE;
    EMRFTestWiFiSendReq();

    /* show RF Test WiFi TX Cont. PKT Done screen */
    mmi_em_rf_test_wifi_display_tx_cont_pkt_data();    
}

void mmi_em_rf_test_wifi_display_tx_cont_pkt_data(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    WCHAR *text_buf;    
    mmi_em_text_viewer_struct data = {0};
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    text_buf = (WCHAR*)OslMalloc(MMI_EM_WIFI_SHOW_TEXT_BUF_LEN);
    
    if(MMI_EM_WIFI_CAPABILITY_31 == wifi_cntx->wifi_capability)
    {
        CHAR power_buf[MMI_EM_WIFI_REG_POWER_UPDATE_LEN + 3];
        sprintf(power_buf, "%.1f", ((double)wifi_cntx->int_power)/ 2);
        kal_wsprintf(text_buf, "%w: %w\n%w: %w\n%w: %s\n%w: %d\n%w: %d\n%w: %w\n%w: %w\n%w: %w\n%w: %w\n", 
             get_string(STR_ID_EM_RF_WIFI_TX_CH_FREQ),
             get_string(g_mmi_em_rf_wifi_freq_str[wifi_cntx->currRFWifiChFreq]),
             get_string(STR_ID_EM_RF_WIFI_TX_RATE),
             get_string(g_mmi_em_rf_wifi_rate_str[wifi_cntx->currRFWifiTxRate]),
             get_string(STR_ID_EM_RF_WIFI_POWER_UPDATE),
             power_buf,
             get_string(STR_ID_EM_RF_WIFI_TX_PKT_COUNT),
             wifi_cntx->int_pktcount,
             get_string(STR_ID_EM_RF_WIFI_TX_PKT_LENGTH),
             wifi_cntx->int_pktlength,
             get_string(STR_ID_EM_RF_WIFI_11NBW),
             get_string(g_mmi_em_rf_wifi_11nBW_str[wifi_cntx->currRFWifi11nBW]),
             get_string(STR_ID_EM_RF_WIFI_11NGI),
             get_string(g_mmi_em_rf_wifi_11nGI_str[wifi_cntx->currRFWifi11nGI]),
             get_string(STR_ID_EM_RF_WIFI_11NPF),
             get_string(g_mmi_em_rf_wifi_11nPF_str[wifi_cntx->currRFWifi11nPF]),
             get_string(STR_ID_EM_RF_WIFI_TX_PATTERN),
             get_string(g_mmi_em_rf_wifi_tx_pattern_str[wifi_cntx->currRFWifiTxPattern]));    
    }    
    else
    {
        kal_wsprintf(text_buf, "%w: %w\n%w: %w\n%w: %x\n%w: %d\n%w: %d\n%w: %w\n", 
             get_string(STR_ID_EM_RF_WIFI_TX_CH_FREQ),
             get_string(g_mmi_em_rf_wifi_freq_str[wifi_cntx->currRFWifiChFreq]),
             get_string(STR_ID_EM_RF_WIFI_TX_RATE),
             get_string(g_mmi_em_rf_wifi_rate_str[wifi_cntx->currRFWifiTxRate]),
             get_string(STR_ID_EM_RF_WIFI_TX_GAIN),
             wifi_cntx->int_gain,
             get_string(STR_ID_EM_RF_WIFI_TX_PKT_COUNT),
             wifi_cntx->int_pktcount,
             get_string(STR_ID_EM_RF_WIFI_TX_PKT_LENGTH),
             wifi_cntx->int_pktlength,
             get_string(STR_ID_EM_RF_WIFI_TX_PATTERN),
             get_string(g_mmi_em_rf_wifi_tx_pattern_str[wifi_cntx->currRFWifiTxPattern]));    
    }
    
    data.text = text_buf;
    data.title_id = STR_ID_EM_RF_WIFI_TX_CONT_PKT_TX;    
    
    mmi_em_show_text_viewer(&data);
    OslMfree(text_buf);
}




#define WIFI_RX

static MMI_RET mmi_em_rf_test_wifi_rx_cont_pkt_proc(mmi_event_struct *evt);

static void mmi_em_rf_test_wifi_handle_rx_cont_pkt(void)
{
#ifdef __MTK_TARGET__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID gid;
    MMI_ID inline_id;
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gid = mmi_frm_group_create_ex(mmi_em_get_root_group(),
                                GRP_ID_AUTO_GEN,
                                mmi_em_rf_test_wifi_rx_cont_pkt_proc,
                                NULL, 
                                MMI_FRM_NODE_SMART_CLOSE_FLAG);
    inline_id = cui_inline_create(gid, &g_mmi_em_rf_test_wifi_rx_cont_pkt_inline_scrn);
	
    cui_inline_set_value(inline_id, MMI_EM_WIFI_FREQ_SEL, (void*)&wifi_cntx->currRFWifiChFreq);
    if (MMI_EM_WIFI_CAPABILITY_31 == wifi_cntx->wifi_capability)
    {
        cui_inline_set_value(inline_id, MMI_EM_WIFI_11N_BW_SEL, (void*)&wifi_cntx->currRFWifi11nBW);    
    }
    else
    {
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_11N_BW_SEL);
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_CAP_2);
    }
    cui_inline_run(inline_id);
#endif
}

static MMI_RET mmi_em_rf_test_wifi_rx_cont_pkt_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cui_event_inline_common_struct* inline_evt = (cui_event_inline_common_struct*) evt;
	em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(evt->evt_id)
    {
    case EVT_ID_CUI_INLINE_MAIN_SCREEN_ACTIVE:
        EmStopRFTestWiFi();
        wifi_cntx->req_type = RF_TEST_WIFI_RX_CONT_PKT;
        wifi_cntx->is_not_waiting = MMI_FALSE;
        wifi_cntx->rx_scrn_hilight = 0;
        break;
        
    case EVT_ID_CUI_INLINE_SUBMIT:
    case EVT_ID_CUI_INLINE_CSK_PRESS:
        cui_inline_get_value(inline_evt->sender_id, MMI_EM_WIFI_FREQ_SEL, &wifi_cntx->currRFWifiChFreq);
        cui_inline_get_value(inline_evt->sender_id, MMI_EM_WIFI_11N_BW_SEL, &wifi_cntx->currRFWifi11nBW);
        EMRFTESTWifiRXContPKTSendReq();
        break;

    case EVT_ID_CUI_INLINE_ABORT:
       cui_inline_close(inline_evt->sender_id);
       break;

    case EVT_ID_CUI_INLINE_GROUP_DEINIT:
        wifi_cntx->is_not_waiting = MMI_TRUE;
        break;
    
    default:
        break;
    }

    return MMI_RET_OK;
}

/**************************************************************
**    FUNCTION NAME        : EMRFTESTWifiRXContPKTSendReq
**
**  PURPOSE                :  RF Test Wifi Rx Cont. PKT Send Req
**
**    INPUT PARAMETERS    : nil
**
**    OUTPUT PARAMETERS    : void
**
**    RETURNS                : void
**
**    REMARKS            : 
**************************************************************/
void EMRFTESTWifiRXContPKTSendReq(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/	
    if (wifi_cntx->request_processing == MMI_FALSE)
    {
        mmi_em_entry_dualmode_switch_progress();
        /* Send request to RF , now req_type = RF_TEST_WIFI_RX_CONT_PKT */
        wifi_cntx->req_type = RF_TEST_WIFI_RX_CONT_PKT;
        wifi_cntx->request_processing = MMI_TRUE;
        EMRFTestWiFiSendReq();
    }
}


/**************************************************************
**    FUNCTION NAME        : EntryEmRFTestWiFiRXContPKTRsp
**
**  PURPOSE                : Enrty function for RF Test WiFi Rx Cont PKT menu
**
**    INPUT PARAMETERS    : nil
**
**    OUTPUT PARAMETERS    : void
**
**    RETURNS                : void
**
**    REMARKS            : 
**************************************************************/
/* errors */
MMI_RET mmi_em_rf_wifi_rx_cont_pkt_scrn_leave_proc(mmi_event_struct* evt);
#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif

static void mmi_em_rf_wifi_rx_scrn_highlight(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    wifi_cntx->rx_scrn_hilight = index;
}

void EntryEmRFTestWiFiRXContPKTRsp(U8 *rsp)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    CHAR *buffer;
    U8 *guiBuffer;
    U32 nItems = 0;
    U32 i;
    U32 value;
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    rf_test_wifi_rx_cont_pkt_struct *p = (rf_test_wifi_rx_cont_pkt_struct *)rsp;
    
    if (mmi_frm_scrn_get_active_id() != SCR_ID_EM_RF_WIFI_RX_CONT_PKT)
    {
        if (!mmi_frm_scrn_enter(mmi_em_get_root_group(),
                                 SCR_ID_EM_RF_WIFI_RX_CONT_PKT, 
                                 NULL,
                                 NULL, 
                                 MMI_FRM_FULL_SCRN))
        {
            return;
        }
    }
    mmi_em_close_dualmode_switch_progress();
    
    guiBuffer  = mmi_frm_scrn_get_gui_buf(mmi_em_get_root_group(), SCR_ID_EM_RF_WIFI_RX_CONT_PKT);
    RegisterHighlightHandler(mmi_em_rf_wifi_rx_scrn_highlight);

    if (p->pau_total == 0)
      value = 0;
    else
      value = (p->pau_err*100)/p->pau_total;

    buffer = OslMalloc(50);
    sprintf(buffer, "PER:  %d%%", value);
    mmi_asc_to_ucs2((CHAR*)subMenuData[0], buffer);
    OslMfree(buffer);
    
    kal_wsprintf((WCHAR*)subMenuData[1], "FCS:  %d", p->pau_err);
    kal_wsprintf((WCHAR*)subMenuData[2], "RX ok:  %d", p->int_ok);
    kal_wsprintf((WCHAR*)subMenuData[3], "Total:  %d", p->pau_total);
    for (i = 0; i < 4; i++)
    {
        subMenuDataPtrs[i] = subMenuData[i];
        nItems ++;
    }

    ShowCategory6Screen (STR_ID_EM_RF_WIFI_TX_CONT_PKT_TX, 0,
                          0, 0, STR_GLOBAL_BACK, 0,
                          nItems, (PU8*)subMenuDataPtrs,NULL, 
                          wifi_cntx->rx_scrn_hilight,
                          guiBuffer); 
                          
    SetRightSoftkeyFunction (mmi_frm_scrn_close_active_id, KEY_EVENT_UP);

#if 0    
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif

}


#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif

#define WIFI_POWER_SAVE


static MMI_RET mmi_em_rf_test_wifi_power_save_mode_proc(mmi_event_struct *evt);
static void mmi_em_rf_test_wifi_display_power_save_data(void);
static void mmi_em_rf_test_wifi_power_save_submit_hdlr(MMI_ID inline_id); 

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_wifi_handle_register_efuse
 * DESCRIPTION
 *  mmi_em_rf_wifi_handle_register_efuse
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_em_rf_test_wifi_handle_power_save_mode(void)
{
#if 1 /*def __MTK_TARGET__*/
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID gid;
    MMI_ID inline_id;
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gid = mmi_frm_group_create_ex(mmi_em_get_root_group(),
                                GRP_ID_AUTO_GEN,
                                mmi_em_rf_test_wifi_power_save_mode_proc,
                                NULL, 
                                MMI_FRM_NODE_SMART_CLOSE_FLAG);
    inline_id = cui_inline_create(gid, &g_mmi_em_rf_test_wifi_power_save_mode_inline_scrn);    
    cui_inline_set_value(inline_id, MMI_EM_WIFI_SLEEP_MODE_SEL, (void*)&wifi_cntx->currRFWifiPowerSave);

    cui_inline_run(inline_id);
#endif
}

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_register_efuse_proc
 * DESCRIPTION
 *  mmi_em_rf_test_wifi_register_efuse_proc
 * PARAMETERS
 *  evt       [IN]
 * RETURNS
 *  MMI_RET
 *****************************************************************************/
static MMI_RET mmi_em_rf_test_wifi_power_save_mode_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cui_event_inline_common_struct* inline_evt = (cui_event_inline_common_struct*) evt;
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    switch(evt->evt_id)
    {
    case EVT_ID_CUI_INLINE_MAIN_SCREEN_ACTIVE:
         /* check if request is processing. If yes, then stop it. */
        EmStopRFTestWiFi();   
        wifi_cntx->req_type = RF_TEST_WIFI_POWER_SAVE;
        break;
        
    case EVT_ID_CUI_INLINE_SUBMIT:
	case EVT_ID_CUI_INLINE_CSK_PRESS:
        mmi_em_rf_test_wifi_power_save_submit_hdlr(inline_evt->sender_id);    
//       cui_inline_get_value(inline_evt->sender_id, MMI_EM_STR_SELECT_1, (void*)&wifi_cntx->currRFWifiPowerSave);
//		EMRFTESTWifiPowerSaveSendReq();
        break;

    case EVT_ID_CUI_INLINE_ABORT:
		cui_inline_close(inline_evt->sender_id);
        EmRFTestWifiExitTestMode();
		break;

    default:
        break;
    }

    return MMI_RET_OK;
}


static void mmi_em_rf_test_wifi_power_save_submit_hdlr(MMI_ID inline_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    cui_inline_get_value(inline_id, MMI_EM_WIFI_SLEEP_MODE_SEL, (void*)&wifi_cntx->currRFWifiPowerSave);
    /* Send request to RF , now req_type = RF_TEST_WIFI_POWER_SAVE */
    wifi_cntx->request_processing = MMI_TRUE;
    EMRFTestWiFiSendReq();
    
    /* Show Power Save Done Screen */
    mmi_em_rf_test_wifi_display_power_save_data();
}



void EMRFTESTWifiPowerSaveSendReq(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Send request to RF , now req_type = RF_TEST_WIFI_POWER_SAVE */
    wifi_cntx->request_processing = MMI_TRUE;
    EMRFTestWiFiSendReq();
    
    /* Show Power Save Done Screen */
    mmi_em_rf_test_wifi_display_power_save_data();    
}

static void mmi_em_rf_test_wifi_display_power_save_data(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    WCHAR *text_buf;
    mmi_em_text_viewer_struct data = {0};
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    text_buf = (WCHAR*)OslMalloc(MMI_EM_WIFI_SHOW_TEXT_BUF_LEN);
    kal_wsprintf(text_buf, "%w:%w\n", 
             get_string(STR_GLOBAL_MODE),
             get_string(g_mmi_em_rf_wifi_power_save_mode_str[wifi_cntx->currRFWifiPowerSave])
             );
    
    data.text = text_buf;
    data.title_id = STR_ID_EM_RF_WIFI_POWER_SAVE;    
    mmi_em_show_text_viewer(&data);
    OslMfree(text_buf);
}

#define WIFI_REGISTER_MCR


/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_wifi_init_register_mcr
 * DESCRIPTION
 *  mmi_em_rf_wifi_init_register_mcr
 * PARAMETERS
 *  inline_id       [IN]
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_em_rf_wifi_init_register_mcr(MMI_ID inline_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    WCHAR data_buf[MMI_EM_WIFI_REG_ACCESS_DATA_LEN] = {0};
    WCHAR addr_buf[MMI_EM_WIFI_REG_ACCESS_ADDR_LEN] = {0};
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_wcs_itow((S32)wifi_cntx->int_mcr_data, data_buf, 16);
    mmi_wcs_itow((S32)wifi_cntx->int_mcr_address, addr_buf, 16);
    if (MMI_EM_WIFI_CAPABILITY_31 == wifi_cntx->wifi_capability)
    {
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_BIT_TYPE_SEL);
        cui_inline_delete_item(inline_id, MMI_EM_WIFI_CAP_1);
        wifi_cntx->currRFWifiRegisterType = EM_RF_WIFI_REGISTER_TYPE_32;
    }
    else
    {
        cui_inline_set_value(inline_id, MMI_EM_WIFI_BIT_TYPE_SEL, (void *) wifi_cntx->currRFWifiRegisterType);
    }
    
    cui_inline_set_value(inline_id, MMI_EM_WIFI_ACCESS_TYPE_SEL, (void *) wifi_cntx->currRFWifiRegisterAccess);
    cui_inline_set_value(inline_id, MMI_EM_WIFI_ADDRESS_EDIT, (void *) addr_buf);
    cui_inline_set_value(inline_id, MMI_EM_WIFI_DATA_EDIT, (void *) data_buf); 

    if (EM_RF_WIFI_REGISTER_ACCESS_WRITE != wifi_cntx->currRFWifiRegisterAccess)    /* not Write */
    {
        cui_inline_set_item_attributes(inline_id, 
                                   MMI_EM_WIFI_DATA_EDIT, 
                                   CUI_INLINE_SET_ATTRIBUTE, 
                                   CUI_INLINE_ITEM_DISABLE);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_wifi_handle_register_mcr
 * DESCRIPTION
 *  mmi_em_rf_wifi_handle_register_mcr
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_em_rf_wifi_handle_register_mcr(void)
{
#if 1//def __MTK_TARGET__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID gid;
    MMI_ID inline_id;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gid = mmi_frm_group_create_ex(mmi_em_get_root_group(),
                                GRP_ID_AUTO_GEN,
                                mmi_em_rf_test_wifi_register_mcr_proc,
                                NULL, 
                                MMI_FRM_NODE_SMART_CLOSE_FLAG);
    inline_id = cui_inline_create(gid, &g_mmi_em_rf_wifi_register_mcr_inline_scrn);
    
    mmi_em_rf_wifi_init_register_mcr(inline_id);

    cui_inline_run(inline_id);
#endif
}


/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_register_mcr_proc
 * DESCRIPTION
 *  mmi_em_rf_test_wifi_register_mcr_proc
 * PARAMETERS
 *  evt       [IN]
 * RETURNS
 *  MMI_RET
 *****************************************************************************/
MMI_RET mmi_em_rf_test_wifi_register_mcr_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cui_event_inline_common_struct* inline_evt = (cui_event_inline_common_struct*) evt;
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(evt->evt_id)
    {
    case EVT_ID_CUI_INLINE_MAIN_SCREEN_ACTIVE:
        /* check if request is processing. If yes, then stop it. */
        EmStopRFTestWiFi();
        wifi_cntx->is_not_waiting = MMI_FALSE;
        break;
        
    case EVT_ID_CUI_INLINE_SUBMIT:
    case EVT_ID_CUI_INLINE_CSK_PRESS:
    {
        EMRFTESTWifiRegMCRSendReq(inline_evt);
        break;
    }

    case EVT_ID_CUI_INLINE_ABORT:
        cui_inline_close(inline_evt->sender_id);
        break;

    case EVT_ID_CUI_INLINE_NOTIFY:
        mmi_em_rf_test_wifi_register_mcr_handle_notify(evt);            
        break;

    case EVT_ID_CUI_INLINE_GROUP_DEINIT:
        wifi_cntx->is_not_waiting = MMI_TRUE;
        break;

    default:
        break;
    }
    return MMI_RET_OK;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_register_mcr_handle_notify
 * DESCRIPTION
 *  mmi_em_rf_test_wifi_register_mcr_handle_notify
 * PARAMETERS
 *  evt       [IN]
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_em_rf_test_wifi_register_mcr_handle_notify(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/    
    cui_event_inline_notify_struct* notify_evt = (cui_event_inline_notify_struct*) evt;
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (CUI_INLINE_NOTIFY_SELECT_FOCUS_CHANGED == notify_evt->event_type)
    {   
        if (MMI_EM_WIFI_ACCESS_TYPE_SEL== notify_evt->item_id)
        {
            cui_inline_get_value(notify_evt->sender_id, MMI_EM_WIFI_ACCESS_TYPE_SEL, &wifi_cntx->currRFWifiRegisterAccess);

            if(EM_RF_WIFI_REGISTER_ACCESS_WRITE == wifi_cntx->currRFWifiRegisterAccess) 
            {
                cui_inline_set_item_attributes(notify_evt->sender_id, 
                                       MMI_EM_WIFI_DATA_EDIT, 
                                       CUI_INLINE_RESET_ATTRIBUTE, 
                                       CUI_INLINE_ITEM_DISABLE); /* register data input */
  //              wifi_cntx->int_mcr_data = 0;
            }
            else if (EM_RF_WIFI_REGISTER_ACCESS_READ == wifi_cntx->currRFWifiRegisterAccess)
            {
                cui_inline_set_item_attributes(notify_evt->sender_id, 
                                       MMI_EM_WIFI_DATA_EDIT, 
                                       CUI_INLINE_SET_ATTRIBUTE, 
                                       CUI_INLINE_ITEM_DISABLE); /* register data input */
 //               wifi_cntx->int_mcr_data = 0;
            }
            else
                ASSERT(0);
        }
    }
}

/*****************************************************************************
 * FUNCTION
 *  EMRFTESTWifiRegMCRSendReq
 * DESCRIPTION
 *  RF Test Wifi Register MCR Send Req
 * PARAMETERS
 *  inline_evt       [IN]
 * RETURNS
 *  void
 *****************************************************************************/
void EMRFTESTWifiRegMCRSendReq(cui_event_inline_common_struct* inline_evt)
{    
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID inline_id;
    MMI_BOOL result = MMI_TRUE;
    U32  address=0;
    U32 data=0;
    U32 RegisterType = 0;
    U32 RegisterAccess = 0;
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    WCHAR data_buf[MMI_EM_WIFI_REG_ACCESS_DATA_LEN];
    WCHAR addr_buf[MMI_EM_WIFI_REG_ACCESS_ADDR_LEN];
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    inline_id = inline_evt->sender_id;
    if (MMI_EM_WIFI_CAPABILITY_21 == wifi_cntx->wifi_capability)
    {
        cui_inline_get_value(inline_id, MMI_EM_WIFI_BIT_TYPE_SEL, (void *) &RegisterType);    
    }
    cui_inline_get_value(inline_id, MMI_EM_WIFI_ACCESS_TYPE_SEL, (void *) &RegisterAccess);

    /* To check if address is valid , ansii to hex  */
    cui_inline_get_value(inline_id, MMI_EM_WIFI_ADDRESS_EDIT, (void *) addr_buf);
    result = mmi_em_rf_hex_to_i(addr_buf, &address);

    /* mt5921's   range : 0~MMI_EM_WIFI_MCR_ADDR_MAX  */
    /* mt5931's range : 0~0xffffffff */
    if (MMI_EM_WIFI_CAPABILITY_21 == wifi_cntx->wifi_capability)
    {
        if (!result || address > MMI_EM_WIFI_MCR_ADDR_MAX)
        {
            result = MMI_FALSE;
        }       
    }
    
    if (RegisterType == EM_RF_WIFI_REGISTER_TYPE_32)
    {
        if (address % 4)    /* 4 byte alignment */
            result = MMI_FALSE;      
    }
    else
    {
        if (address % 2)    /* 2 byte alignment */
            result = MMI_FALSE;            
    }       

    if (result == MMI_TRUE)
    {
        /* To check if data is valid , ansii to hex  */
        if (RegisterAccess == EM_RF_WIFI_REGISTER_ACCESS_WRITE)              
        {
            cui_inline_get_value(inline_id, MMI_EM_WIFI_DATA_EDIT, (void *) data_buf);
            result = mmi_em_rf_hex_to_i(data_buf, &data);            
        }
    }
    
    /* If one of the parameters is invalid, then pop-up error  */
    if (result ==MMI_FALSE)
    {
         mmi_em_fail_popup();
        cui_inline_close(inline_id);
      return;
    }

    /* set the atoi result to global context */
    wifi_cntx->currRFWifiRegisterAccess = RegisterAccess;
    wifi_cntx->currRFWifiRegisterType = RegisterType;
    wifi_cntx->int_mcr_address = address;
    if (RegisterAccess == EM_RF_WIFI_REGISTER_ACCESS_WRITE)
    {
        wifi_cntx->int_mcr_data = data;    
    }    

    if (wifi_cntx->currRFWifiRegisterType == EM_RF_WIFI_REGISTER_TYPE_32)
    {
        if (wifi_cntx->currRFWifiRegisterAccess == EM_RF_WIFI_REGISTER_ACCESS_READ)
        {
            wifi_cntx->req_type = RF_TEST_WIFI_REG_MCR32_READ;
        }
        else
        {
            wifi_cntx->req_type = RF_TEST_WIFI_REG_MCR32_WRITE;
        }
    }
    else if (wifi_cntx->currRFWifiRegisterType == EM_RF_WIFI_REGISTER_TYPE_16)
    {
        if (wifi_cntx->currRFWifiRegisterAccess == EM_RF_WIFI_REGISTER_ACCESS_READ)
        {
            wifi_cntx->req_type = RF_TEST_WIFI_REG_MCR16_READ;
        }            
        else
        {
            wifi_cntx->req_type = RF_TEST_WIFI_REG_MCR16_WRITE;
        }
    }

    /* Send request to RF */
    wifi_cntx->request_processing = MMI_TRUE;
    EMRFTestWiFiSendReq();
    
    if (wifi_cntx->currRFWifiRegisterAccess == EM_RF_WIFI_REGISTER_ACCESS_WRITE)
    {
        EntryEmRFTestWiFiRegMCRAccessRsp(0);
    }        
}

/*****************************************************************************
 * FUNCTION
 *  EntryEmRFTestWiFiRegMCRAccessRsp
 * DESCRIPTION
 *  EntryEmRFTestWiFiRegMCRAccessRsp
 * PARAMETERS
 *  mcr_data       [IN]
 * RETURNS
 *  void
 *****************************************************************************/
void EntryEmRFTestWiFiRegMCRAccessRsp(U32 mcr_data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    WCHAR *text_buf;
    mmi_em_text_viewer_struct data = {0};
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    text_buf = (WCHAR*)OslMalloc(MMI_EM_WIFI_SHOW_TEXT_BUF_LEN);
        
    if (wifi_cntx->currRFWifiRegisterAccess == EM_RF_WIFI_REGISTER_ACCESS_READ)
    {
        wifi_cntx->int_mcr_data = mcr_data;
    }
    if (MMI_EM_WIFI_CAPABILITY_31  == wifi_cntx->wifi_capability)
    {
        kal_wsprintf(text_buf, "%w: %w\n%w: %x\n%w: %x\n",
             get_string(STR_ID_EM_RF_WIFI_REGISTER_ACCESS),
             get_string(g_mmi_em_rf_wifi_register_access_str[wifi_cntx->currRFWifiRegisterAccess]),
             get_string(STR_ID_EM_RF_WIFI_REGISTER_ADDRESS),
             wifi_cntx->int_mcr_address,
             get_string(STR_ID_EM_RF_WIFI_REGISTER_DATA),
             wifi_cntx->int_mcr_data);    
    }
    else
    {
        kal_wsprintf(text_buf, "%w: %w\n%w: %w\n%w: %x\n%w: %x\n",
             get_string(STR_ID_EM_RF_WIFI_REGISTER_TYPE),
             get_string(g_mmi_em_rf_wifi_register_type_str[wifi_cntx->currRFWifiRegisterType]),
             get_string(STR_ID_EM_RF_WIFI_REGISTER_ACCESS),
             get_string(g_mmi_em_rf_wifi_register_access_str[wifi_cntx->currRFWifiRegisterAccess]),
             get_string(STR_ID_EM_RF_WIFI_REGISTER_ADDRESS),
             wifi_cntx->int_mcr_address,
             get_string(STR_ID_EM_RF_WIFI_REGISTER_DATA),
             wifi_cntx->int_mcr_data);    
    }
    data.text = text_buf;
    data.title_id = STR_ID_EM_RF_WIFI_REGISTER_MCR;    

    mmi_em_show_text_viewer(&data);
    OslMfree(text_buf);
}

#define WIFI_REGISTER_EEPROM


/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_wifi_init_register_eeprom
 * DESCRIPTION
 *  mmi_em_rf_wifi_init_register_eeprom
 * PARAMETERS
 *  inline_id       [IN]
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_em_rf_wifi_init_register_eeprom(MMI_ID inline_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    WCHAR data_buf[MMI_EM_WIFI_REG_ACCESS_DATA_LEN];
    WCHAR addr_buf[MMI_EM_WIFI_REG_ACCESS_ADDR_LEN];
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    cui_inline_delete_item(inline_id, MMI_EM_WIFI_CAP_1);
    cui_inline_delete_item(inline_id, MMI_EM_WIFI_BIT_TYPE_SEL);
    
    mmi_wcs_itow(wifi_cntx->int_eeprom_data, data_buf, 16);
    mmi_wcs_itow(wifi_cntx->int_eeprom_address, addr_buf, 16);    
    cui_inline_set_value(inline_id, MMI_EM_WIFI_ACCESS_TYPE_SEL, (void *) wifi_cntx->currRFWifiRegisterAccess);
    cui_inline_set_value(inline_id, MMI_EM_WIFI_ADDRESS_EDIT, (void *) addr_buf);
    cui_inline_set_value(inline_id, MMI_EM_WIFI_DATA_EDIT, (void *) data_buf);     
    if (EM_RF_WIFI_REGISTER_ACCESS_WRITE != wifi_cntx->currRFWifiRegisterAccess)    /* not Write */
    {
        cui_inline_set_item_attributes(inline_id, 
                                   MMI_EM_WIFI_DATA_EDIT, 
                                   CUI_INLINE_SET_ATTRIBUTE, 
                                   CUI_INLINE_ITEM_DISABLE);
    }
}



/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_wifi_handle_register_eeprom
 * DESCRIPTION
 *  mmi_em_rf_wifi_handle_register_eeprom
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_em_rf_wifi_handle_register_eeprom(void)
{
#if 1//def __MTK_TARGET__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID gid;
    MMI_ID inline_id;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gid = mmi_frm_group_create_ex(mmi_em_get_root_group(),
                                GRP_ID_AUTO_GEN,
                                mmi_em_rf_test_wifi_register_eeprom_proc,
                                NULL, 
                                MMI_FRM_NODE_SMART_CLOSE_FLAG);
    inline_id = cui_inline_create(gid, &g_mmi_em_rf_wifi_register_eeprom_inline_scrn);    
    mmi_em_rf_wifi_init_register_eeprom(inline_id);

    cui_inline_run(inline_id);
#endif
}

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_register_eeprom_handle_notify
 * DESCRIPTION
 *  mmi_em_rf_test_wifi_register_eeprom_handle_notify
 * PARAMETERS
 *  evt       [IN]
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_em_rf_test_wifi_register_eeprom_handle_notify(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cui_event_inline_notify_struct* notify_evt = (cui_event_inline_notify_struct*) evt;
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    if (CUI_INLINE_NOTIFY_SELECT_FOCUS_CHANGED == notify_evt->event_type)
    {   
        if (MMI_EM_WIFI_ACCESS_TYPE_SEL== notify_evt->item_id)
        {
            cui_inline_get_value(notify_evt->sender_id, 
                                MMI_EM_WIFI_ACCESS_TYPE_SEL,
                                &wifi_cntx->currRFWifiRegisterAccess);

            if(EM_RF_WIFI_REGISTER_ACCESS_WRITE == wifi_cntx->currRFWifiRegisterAccess) 
            {
                cui_inline_set_item_attributes(notify_evt->sender_id, 
                                       MMI_EM_WIFI_DATA_EDIT, 
                                       CUI_INLINE_RESET_ATTRIBUTE, 
                                       CUI_INLINE_ITEM_DISABLE); 
        //        wifi_cntx->int_eeprom_data= 0;
            }
            else
            {
                cui_inline_set_item_attributes(notify_evt->sender_id, 
                                       MMI_EM_WIFI_DATA_EDIT, 
                                       CUI_INLINE_SET_ATTRIBUTE, 
                                       CUI_INLINE_ITEM_DISABLE);
        //        wifi_cntx->int_eeprom_data = 0;
            }
        }
    }
}

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_register_eeprom_proc
 * DESCRIPTION
 *  mmi_em_rf_test_wifi_register_eeprom_proc
 * PARAMETERS
 *  evt       [IN]
 * RETURNS
 *  MMI_RET
 *****************************************************************************/
static MMI_RET mmi_em_rf_test_wifi_register_eeprom_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cui_event_inline_common_struct* inline_evt = (cui_event_inline_common_struct*) evt;
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(evt->evt_id)
    {
    case EVT_ID_CUI_INLINE_MAIN_SCREEN_ACTIVE:
        /* check if request is processing. If yes, then stop it. */
        EmStopRFTestWiFi();
        wifi_cntx->is_not_waiting = MMI_FALSE;
        break;
        
    case EVT_ID_CUI_INLINE_SUBMIT:
    case EVT_ID_CUI_INLINE_CSK_PRESS:
        EMRFTESTWifiRegEEPROMSendReq(inline_evt);
        break;

    case EVT_ID_CUI_INLINE_ABORT:
        cui_inline_close(inline_evt->sender_id);        
        break;

    case EVT_ID_CUI_INLINE_NOTIFY:
        mmi_em_rf_test_wifi_register_eeprom_handle_notify(evt);            
        break;

    case EVT_ID_CUI_INLINE_GROUP_DEINIT:
        wifi_cntx->is_not_waiting = MMI_TRUE;
        break;

    default:
        break;
    }

    return MMI_RET_OK;
}

/*****************************************************************************
 * FUNCTION
 *  EMRFTESTWifiRegEEPROMSendReq
 * DESCRIPTION
 *  F Test Wifi Register EEPROM Send Req
 * PARAMETERS
 *  evt       [IN]
 * RETURNS
 *  void
 *****************************************************************************/
void EMRFTESTWifiRegEEPROMSendReq(cui_event_inline_common_struct* evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID inline_id;
    MMI_BOOL result = MMI_TRUE;
    U32  address=0, data=0;
    U32 RegisterAccess = 0;
    WCHAR data_buf[MMI_EM_WIFI_REG_ACCESS_DATA_LEN];
    WCHAR addr_buf[MMI_EM_WIFI_REG_ACCESS_ADDR_LEN];
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    inline_id = evt->sender_id;
    cui_inline_get_value(inline_id, MMI_EM_WIFI_ACCESS_TYPE_SEL, (void *) &RegisterAccess);
    
    {
        /* To check if address is valid */
        cui_inline_get_value(inline_id, MMI_EM_WIFI_ADDRESS_EDIT, (void *)addr_buf);
        result = mmi_em_rf_hex_to_i(addr_buf, &address);
        if (!result || address > MMI_EM_WIFI_EEPROM_ADDR_MAX)  /* address > 0x1FF or not 2 byte alignment */
        {
            result = MMI_FALSE;
        }
    }
    
    if (result == MMI_TRUE)
    {
        if (RegisterAccess == EM_RF_WIFI_REGISTER_ACCESS_WRITE)              
        {
            /* To check if data is valid */
            cui_inline_get_value(inline_id, MMI_EM_WIFI_DATA_EDIT, (void *)data_buf);
            result = mmi_em_rf_hex_to_i(data_buf, &data);
        }
    }    
   
    /* If one of the parameters is invalid, then pop-up error  */
    if (result ==MMI_FALSE)
    {
        mmi_em_fail_popup();
        cui_inline_close(inline_id);
        return;
    }

    /* set the atoi result to global context */
    wifi_cntx->currRFWifiRegisterAccess = RegisterAccess;
    wifi_cntx->int_eeprom_address = address;
    if (RegisterAccess == EM_RF_WIFI_REGISTER_ACCESS_WRITE)
    {
        wifi_cntx->int_eeprom_data = data;
    }

    /* Send request to RF */
    if (RegisterAccess == EM_RF_WIFI_REGISTER_ACCESS_READ)
        wifi_cntx->req_type = RF_TEST_WIFI_REG_EEPROM_READ;
    else if (RegisterAccess == EM_RF_WIFI_REGISTER_ACCESS_WRITE)              
        wifi_cntx->req_type = RF_TEST_WIFI_REG_EEPROM_WRITE;
    else
        ASSERT(0);

    /* Send request to RF */
    wifi_cntx->request_processing = MMI_TRUE;
    EMRFTestWiFiSendReq();
    
    if (wifi_cntx->currRFWifiRegisterAccess == EM_RF_WIFI_REGISTER_ACCESS_WRITE)    
        EntryEmRFTestWiFiRegEEPROMAccessRsp(0);    
}


/*****************************************************************************
 * FUNCTION
 *  EntryEmRFTestWiFiRegEEPROMAccessRsp
 * DESCRIPTION
 *  EntryEmRFTestWiFiRegEEPROMAccessRsp
 * PARAMETERS
 *  eeprom_data       [IN]
 * RETURNS
 *  void
 *****************************************************************************/
void EntryEmRFTestWiFiRegEEPROMAccessRsp(U32 eeprom_data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    WCHAR *text_buf;
    mmi_em_text_viewer_struct data = {0};
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    text_buf = (WCHAR*)OslMalloc(MMI_EM_WIFI_SHOW_TEXT_BUF_LEN);

/*    
    if (wifi_cntx->currRFWifiRegisterAccess == EM_RF_WIFI_REGISTER_ACCESS_READ)
    {
        wifi_cntx->int_eeprom_data = eeprom_data;
    }   
*/

    if (MMI_EM_WIFI_CAPABILITY_31 == wifi_cntx->wifi_capability)
    {
        kal_wsprintf(text_buf, "%w:%w\n%w:%w\n%w:%x\n%w:%x\n",
             get_string(STR_ID_EM_RF_WIFI_REGISTER_TYPE),
             get_string(g_mmi_em_rf_wifi_register_type_str[wifi_cntx->currRFWifiRegisterType]),
             get_string(STR_ID_EM_RF_WIFI_REGISTER_ACCESS),
             get_string(g_mmi_em_rf_wifi_register_access_str[wifi_cntx->currRFWifiRegisterAccess]),
             get_string(STR_ID_EM_RF_WIFI_REGISTER_ADDRESS),
             wifi_cntx->int_eeprom_address,
             get_string(STR_ID_EM_RF_WIFI_REGISTER_DATA),
             wifi_cntx->int_eeprom_data);
    }
    else
    {
        kal_wsprintf(text_buf, "%w:%w\n%w:%x\n%w:%x\n",
             get_string(STR_ID_EM_RF_WIFI_REGISTER_ACCESS),
             get_string(g_mmi_em_rf_wifi_register_access_str[wifi_cntx->currRFWifiRegisterAccess]),
             get_string(STR_ID_EM_RF_WIFI_REGISTER_ADDRESS),
             wifi_cntx->int_eeprom_address,
             get_string(STR_ID_EM_RF_WIFI_REGISTER_DATA),
             wifi_cntx->int_eeprom_data);
    }    
    data.text = text_buf;
    data.title_id = STR_ID_EM_RF_WIFI_REGISTER_EEPROM;
    mmi_em_show_text_viewer(&data);
    
    OslMfree(text_buf);
}


#define WIFI_REGISTER_EFUSE

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_wifi_handle_register_efuse
 * DESCRIPTION
 *  mmi_em_rf_wifi_handle_register_efuse
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_em_rf_wifi_handle_register_efuse(void)
{
#if 1 //def __MTK_TARGET__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID gid;
    MMI_ID inline_id;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gid = mmi_frm_group_create_ex(mmi_em_get_root_group(),
                                GRP_ID_AUTO_GEN,
                                mmi_em_rf_test_wifi_register_efuse_proc,
                                NULL, 
                                MMI_FRM_NODE_SMART_CLOSE_FLAG);
    
    inline_id = cui_inline_create(gid, &g_mmi_em_rf_wifi_register_efuse_inline_scrn);	
	mmi_em_rf_wifi_init_register_efuse(inline_id);
    cui_inline_run(inline_id);
#endif
}

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_test_wifi_register_efuse_proc
 * DESCRIPTION
 *  mmi_em_rf_test_wifi_register_efuse_proc
 * PARAMETERS
 *  evt       [IN]
 * RETURNS
 *  MMI_RET
 *****************************************************************************/
static MMI_RET mmi_em_rf_test_wifi_register_efuse_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cui_event_inline_common_struct* inline_evt = (cui_event_inline_common_struct*) evt;
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(evt->evt_id)
    {
    case EVT_ID_CUI_INLINE_MAIN_SCREEN_ACTIVE:
        /* check if request is processing. If yes, then stop it. */
        EmStopRFTestWiFi();
        wifi_cntx->is_not_waiting = MMI_FALSE;
        break;
        
    case EVT_ID_CUI_INLINE_SUBMIT:
	case EVT_ID_CUI_INLINE_CSK_PRESS:
        mmi_em_rf_wifi_register_efuse_submit_hdlr(inline_evt->sender_id);
        break;

    case EVT_ID_CUI_INLINE_ABORT:
		cui_inline_close(inline_evt->sender_id);        
		break;

    case EVT_ID_CUI_INLINE_GROUP_DEINIT:
        wifi_cntx->is_not_waiting = MMI_TRUE;
        break;

    default:
        break;
    }

    return MMI_RET_OK;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_wifi_init_register_efuse
 * DESCRIPTION
 *  mmi_em_rf_wifi_init_register_efuse
 * PARAMETERS
 *  inline_id       [IN]
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_em_rf_wifi_init_register_efuse(MMI_ID inline_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 i;
    WCHAR addr_buf[MMI_EM_WIFI_REG_ACCESS_ADDR_LEN];
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    mmi_wcs_itow(wifi_cntx->int_efuse_address, addr_buf, 16);
    cui_inline_set_value(inline_id, MMI_EM_WIFI_ADDRESS_EDIT, (void *) addr_buf);
    for (i = 0; i < sizeof(g_mmi_em_rf_wifi_register_inline)/sizeof(cui_inline_set_item_struct) / 2 ; i++)
    {
        if (g_mmi_em_rf_wifi_register_inline[2 * i +1].item_id != MMI_EM_WIFI_ADDRESS_EDIT)
        {
            cui_inline_delete_item(inline_id, g_mmi_em_rf_wifi_register_inline[2 * i].item_id);
            cui_inline_delete_item(inline_id, g_mmi_em_rf_wifi_register_inline[2 * i + 1].item_id);
        }
    }
    cui_inline_set_text_len(inline_id, MMI_EM_WIFI_ADDRESS_EDIT, MMI_EM_WIFI_EFUSE_ADDR_LEN);
}

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_wifi_register_efuse_submit_hdlr
 * DESCRIPTION
 *  mmi_em_rf_wifi_register_efuse_submit_hdlr
 * PARAMETERS
 *  inline_id       [IN]
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_em_rf_wifi_register_efuse_submit_hdlr(MMI_ID inline_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_BOOL result;
    U32 address;
    WCHAR addr_buf[MMI_EM_WIFI_REG_ACCESS_ADDR_LEN];
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    cui_inline_get_value(inline_id, MMI_EM_WIFI_ADDRESS_EDIT, (void *)addr_buf);
    result = mmi_em_rf_hex_to_i(addr_buf, &address);
    if (!result || address > MMI_EM_WIFI_EFUSE_ADDR_MAX)
    {
        mmi_em_fail_popup();
        cui_inline_close(inline_id);
    }
    else
    {
        /* Send request to RF */
        wifi_cntx->request_processing = MMI_TRUE;
        wifi_cntx->req_type = RF_TEST_WIFI_REG_EFUSE_READ;
        wifi_cntx->int_efuse_address = address;
        EMRFTestWiFiSendReq();
    }
}

/*****************************************************************************
 * FUNCTION
 *  mmi_em_rf_wifi_register_efuse_rsp
 * DESCRIPTION
 *  mmi_em_rf_wifi_register_efuse_rsp
 * PARAMETERS
 *  eeprom_data       [IN]
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_em_rf_wifi_register_efuse_rsp(U32 eeprom_data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    WCHAR *text_buf;
    mmi_em_text_viewer_struct data = {0};
    em_rf_test_wifi_struct *wifi_cntx = &g_rf_test_wifi_cntx;
     
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    text_buf = (WCHAR*)OslMalloc(MMI_EM_WIFI_SHOW_TEXT_BUF_LEN); 
    
    kal_wsprintf(text_buf, "%w: %x\n%w: %x\n", 
             get_string(STR_ID_EM_RF_WIFI_REGISTER_ADDRESS),
             wifi_cntx->int_efuse_address,
             get_string(STR_ID_EM_RF_WIFI_REGISTER_DATA),
             eeprom_data);
    
    data.text = text_buf;
    data.title_id = STR_ID_EM_RF_WIFI_REGISTER_EFUSE;
    mmi_em_show_text_viewer(&data);
    OslMfree(text_buf);
}

#endif /* #if defined(#if defined(__MMI_EM_RF_WIFI__))  */

#if defined(__MMI_EM_RF_GSM__) || defined(__MMI_EM_RF_WIFI__)
void mmi_em_rf_test_menu_event_hdlr(cui_menu_event_struct *event)
{
    switch(event->highlighted_menu_id)
    {
    case MENU_ID_EM_RF_TEST_TOOL:
        EmRFTestDisableSleepMode();
        break;

#ifdef __MMI_EM_RF_GSM__
    case MENU_ID_EM_RF_TEST_TOOL_GSM:
        mmi_em_rf_test_gsm_enter_confirm_hdlr();
        break;
#endif /* __MMI_EM_RF_GSM__ */

#ifdef __MMI_EM_RF_WIFI__
    case MENU_ID_EM_RF_TEST_TOOL_WIFI:
        mmi_em_rf_test_wifi_enter_confirm_hdlr();
        break;
#endif /* __MMI_EM_RF_WIFI__ */

    default:
        break;
    }
}



void mmi_em_rf_test_tool_menu_list_exit_hdlr(cui_menu_event_struct *event)
{
    switch(event->parent_menu_id)
    {
    case MENU_ID_EM_RF_TEST_TOOL:
        EmRFTestEnableSleepMode();
        break;
    default:
        break;
    }
}
#endif /*defined(__MMI_EM_RF_GSM__) || defined(__MMI_EM_RF_WIFI__)*/

#endif /* __MMI_ENGINEER_MODE__ */

