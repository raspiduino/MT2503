/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE. 
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/
/*****************************************************************************
*
* Filename:
* ---------
*  CameraMenu.c
*
* Project:
* --------
*  MAUI
*
* Description:
* ------------
*  Header of Camera Menus
*
* Author:
* -------
 * -------
*                      
*============================================================================
*             HISTORY
* Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
*------------------------------------------------------------------------------
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
 * removed!
 * removed!
 * removed!
*
*------------------------------------------------------------------------------
* Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
*============================================================================
****************************************************************************/
#include "MMI_include.h"
#if defined(__MMI_CAMERA__) && !defined(__MMI_CAMCORDER__)

#include "nvram_data_items.h"   /* ID to store file path */
#include "lcd_if.h"     /* LCD layer enable flag */
#include "lcd_sw_rnd.h" /* for LCD size */
#include "MMI_features_camera.h"        /* camera features */
#include "SettingDefs.h"        /* ST_NOTIFYDURATION define */
#include "SettingProfile.h"     /* SUCCESS_TONE define */
#include "GpioSrvGprot.h"    /* LED */
#include "SettingProfile.h"
#include "CommonScreens.h"      /* DisplayPopup() */
#include "MainMenuDef.h"        /* Multi-media icon */
#include "UCMGProt.h"
#include "SettingDefs.h"        /* ST_NOTIFYDURATION define */
#include "SettingProfile.h"     /* SUCCESS_TONE define */
#include "SettingProfile.h"
//#include "SubLCDHistoryGprot.h"
#include "mdi_datatype.h"
#include "med_api.h"    /* media task */
#include "mdi_camera.h" /* camera module */

#include "wgui_categories_util.h"
#include "mmi_frm_input_gprot.h"
#include "CustMenuRes.h"
#include "mmi_frm_events_gprot.h"

#ifdef __MMI_TVOUT__
#include "mdi_tv.h"
#endif 

#include "FileMgrSrvGProt.h"
#include "FileManagerGProt.h"   /* file path / file error */
#include "FileManagerDef.h"     /* for ImageViewer's Screen ID - SCR_FMGR_EXPLORER */
#include "FileMgr.h"    /* get user define file path */
#include "filemgrcuigprot.h"
#include "ImageViewerGprot.h"
#include "nvram_data_items.h"   /* ID to store file path */
#include "mmi_rp_app_imageviewer_def.h"
#include "MenuCuiGprot.h"
#include "inlinecuigprot.h"
#include "CommonScreensResDef.h"

#include "resource_camera_skins.h"      /* UI custom config */
#include "CameraApp.h"  /* camera app data */
#include "CameraMenu.h" /* function declare */
#include "CameraResDef.h"      /* resource ID def */

#if defined(__CAMERA_OSD_HORIZONTAL__)
#include "ScreenRotationGprot.h"
#endif 

#ifdef __MMI_AUDIO_REVERB_EFFECT__
#include "SoundEffect.h"
#endif

#include "CameraCuiGprot.h"
#include "mmi_rp_app_camera_def.h"

#define MOD_API     extern

/***************************************************************************** 
* Define
*****************************************************************************/
#if !defined(ISP_SUPPORT)
#define TV_NO 1
#define AV_NO 1
#endif /* ISP_SUPPORT */ 

/****************************************************************************
* Enum                                                                 
*****************************************************************************/
typedef enum
{
    CUSTOM_FX_BRIGHTNESS,
        CUSTOM_FX_SATURATION,
        CUSTOM_FX_CONTRAST,
        CUSTOM_FX_HUE
} custom_fx_edit_enum;

/****************************************************************************
* Struct                                                                 
*****************************************************************************/
typedef struct
{
    S32 ori_cont_shot;
} camera_camera_setting_inline_data_struct;

typedef struct
{
    /* inline selection */
    camera_camera_setting_inline_data_struct camera_setting_inline;
    //camera_image_setting_inline_data_struct image_setting_inline;
    
    camera_add_frame_kind cur_select_add_frame_idx;
    S32 cur_select_flash_idx;
    S32 cur_select_add_frame_idx_normal;
    S32 cur_select_add_frame_idx_tileshot;
    S32 cur_select_add_frame_idx_color_idx;
    S32 cur_select_storage_idx;
} camera_menu_contex_struct;

typedef struct
{
    horizontal_slide slide_bar;
    S32 offset_x;
    S32 offset_y;
    S32 width;
    S32 height;
    U16 value;
} custom_fx_slider_struct;

typedef struct
{
    custom_fx_slider_struct brightness_slider;
    custom_fx_slider_struct saturation_slider;
    custom_fx_slider_struct contrast_slider;
    custom_fx_slider_struct hue_slider;
    
    S32 text_box_offset_x;
    S32 text_box_offset_y;
    S32 text_box_width;
    S32 text_box_height;
    S32 spacing;
    S32 num_width;
    S32 num_height;
    gdi_handle preview_wnd_layer;
    gdi_handle base_layer;
    BOOL is_left_arrow_press;
    BOOL is_right_arrow_press;
    U16 select_idx;
    U16 fx_idx;
} custom_fx_edit_struct;

/****************************************************************************
* Local Variable                                                                 
*****************************************************************************/
camera_menu_contex_struct g_camera_menu_cntx;
custom_fx_edit_struct g_camera_custom_fx_cntx;

/****************************************************************************
* Global Variable                                                                 
*****************************************************************************/

extern const U8 camera_ev_command_map[];
extern const U8 camera_zoom_command_map[];
extern const U8 camera_effect_command_map[];
extern const U8 camera_preview_size_command_map[];
extern const U8 camera_jpg_size_command_map[];
extern const U8 camera_image_qty_command_map[];
extern const U8 camera_banding_command_map[];
extern const U8 camera_flash_command_map[];
extern const U8 camera_ae_meter_command_map[];
extern const U8 camera_iso_command_map[];
extern const U8 camera_wb_command_map[];
extern const U8 camera_dsc_mode_command_map[];
extern const U8 camera_autofocus_command_map[];
extern const U8 camera_autofocus_mode_command_map[];

/****************************************************************************
* Golbal Function
*****************************************************************************/
extern U16 GetCurKeypadTone(void);

/****************************************************************************
* Local function        
*****************************************************************************/

#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
static void mmi_camera_custom_fx_edit_right_arrow_press(void);
static void mmi_camera_custom_fx_edit_left_arrow_press(void);

static void mmi_camera_custom_fx_edit_draw_value(U16 idx);

static void mmi_camera_custom_fx_edit_draw_title(void);

#ifdef __MMI_SUBLCD__
static void mmi_camera_entry_custom_fx_edit_sublcd_screen(void);
static void mmi_camera_exit_custom_fx_edit_sublcd_screen(void);
#endif /* __MMI_SUBLCD__ */ 
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 

#ifdef __MMI_CLAMSHELL__
static U8 mmi_camera_custom_fx_clam_close_hdlr(mmi_frm_int_event_type interrupt_event);
#endif 

#define DISPLAY_POPUP_DONE()

/*****************************************************************************
* FUNCTION
*  mmi_camera_custom_fx_clam_close_hdlr
* DESCRIPTION
*  clam close handler
* PARAMETERS
*  ptr     [IN]        Pointer to message
* RETURNS
*  U8
*****************************************************************************/
#if defined(__MMI_CLAMSHELL__) 

mmi_ret mmi_camera_custom_fx_clam_close_hdlr(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_frm_pre_post_protocol_event_struct *pevt = (mmi_frm_pre_post_protocol_event_struct *)evt;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(pevt->message->msg_id == MSG_ID_MMI_EQ_GPIO_DETECT_IND)
    {
        mmi_eq_gpio_detect_ind_struct *ind = (mmi_eq_gpio_detect_ind_struct *)pevt->message->local_para_ptr;
        if(ind->gpio_device == EXT_DEV_CLAM_CLOSE){
            mmi_frm_scrn_close_active_id();
        }
    }

    return MMI_RET_OK;

}

#endif /*__MMI_CLAMSHELL__*/

#ifdef __MMI_AP_DCM_CAMIMGV__
#pragma arm section code = "DYNAMIC_CODE_CAMIMGV_ROCODE", rodata = "DYNAMIC_CODE_CAMIMGV_RODATA"
#endif

/*****************************************************************************
*
* Camera Option Menu     
*
*****************************************************************************/


/*****************************************************************************
* FUNCTION
*  mmi_camera_entry_option_menu_screen
* DESCRIPTION
*  option menu
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
MOD_API void mmi_camera_entry_option_menu_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#if defined(__CAMERA_AUTOFOCUS__) || defined(__CAMERA_FEATURE_ISO_SUPPORT__)
    BOOL is_hide = TRUE;
#endif
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	gdi_layer_set_active(g_camera_cntx.base_layer_handle);
	

#if defined(__CAMERA_FEATURE_SELF_CAPTURE__)/*current not support so hide the menu*/
    mmi_frm_hide_menu_item(MENU_ID_CAMERA_SELF_CAPTURE);
#endif

    g_camera_cntx.setting_menu_gid = cui_menu_create(
                                                g_camera_cntx.cur_gid, 
                                                CUI_MENU_SRC_TYPE_RESOURCE, 
                                                CUI_MENU_TYPE_FROM_RESOURCE, 
                                                MENU_ID_CAMERA_OPTION, 
                                                MMI_TRUE, 
                                                NULL);
    
#if defined(__CAMERA_OSD_HORIZONTAL__) && defined(__MMI_SCREEN_ROTATE__)
    if (g_camera_cntx.osd_data.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
        cui_menu_set_rotate_screen(g_camera_cntx.setting_menu_gid, MMI_FRM_SCREEN_ROTATE_270);
    }
#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 
        
    if (g_camera_cntx.external_request_mode == MMI_CAMERA_EXTERNAL_MODE_OFF)
    {
        cui_menu_set_item_hidden(g_camera_cntx.setting_menu_gid, MENU_ID_CAMERA_TO_IMGVIEW, MMI_FALSE);
#ifdef __MMI_CAMERA_RECORDER_ONE_KEY_TOGGLE__
        cui_menu_set_item_hidden(g_camera_cntx.setting_menu_gid, MENU_ID_CAMERA_TO_VDOREC_APP, MMI_FALSE);
#endif
    }
    else
    {
        cui_menu_set_item_hidden(g_camera_cntx.setting_menu_gid, MENU_ID_CAMERA_TO_IMGVIEW, MMI_TRUE);
#ifdef __MMI_CAMERA_RECORDER_ONE_KEY_TOGGLE__
        cui_menu_set_item_hidden(g_camera_cntx.setting_menu_gid, MENU_ID_CAMERA_TO_VDOREC_APP, MMI_TRUE);
#endif
    }
    
#ifdef __CAMERA_AUTOFOCUS__


    cui_menu_set_item_hidden(g_camera_cntx.setting_menu_gid, MENU_ID_CAMERA_AUTOFOCUS_MODE, is_hide);   
    /* check dsc mode, if it is not ADVANCE mode, disable focus mode menu */
   /* if (is_hide)
    {
        cui_menu_set_item_hidden(g_camera_cntx.setting_menu_gid, MENU_ID_CAMERA_AUTOFOCUS_MODE, MMI_TRUE);
    }
    else
    {
        cui_menu_set_item_hidden(g_camera_cntx.setting_menu_gid, MENU_ID_CAMERA_AUTOFOCUS_MODE, MMI_FALSE);
    }*/
    
    /* if only support one focus metering, disable the option menu */
#ifdef __CAMERA_AUTOFOCUS_METERING__
    if (CAMERA_SETTING_AUTOFOCUS_COUNT < 2)
    {
        cui_menu_set_item_hidden(g_camera_cntx.setting_menu_gid, MENU_ID_CAMERA_AUTOFOCUS_METERING, MMI_TRUE);
    }
#endif /* __CAMERA_AUTOFOCUS_METERING__ */ 
#endif /* __CAMERA_AUTOFOCUS__ */ 
    
#ifdef __CAMERA_FEATURE_ISO_SUPPORT__    
    is_hide = TRUE;
    
#if defined(__CAMERA_DSC_MODE_NIGHT__)
    if(g_camera_cntx.setting.dsc_mode != CAMERA_SETTING_DSC_MODE_NIGHT)
        is_hide = FALSE;
#endif

	cui_menu_set_item_hidden(g_camera_cntx.setting_menu_gid, MENU_ID_CAMERA_ISO, is_hide); 

    /*if (is_hide == TRUE)
    {
        cui_menu_set_item_hidden(g_camera_cntx.setting_menu_gid, MENU_ID_CAMERA_ISO, MMI_TRUE);
    }
    else
    {
        cui_menu_set_item_hidden(g_camera_cntx.setting_menu_gid, MENU_ID_CAMERA_ISO, MMI_FALSE);
    }*/
    
#endif //__CAMERA_FEATURE_ISO_SUPPORT__  
#ifdef __CAMERA_FEATURE_STORAGE__
    if (SRV_FMGR_PUBLIC_DRV == SRV_FMGR_CARD_DRV || SRV_FMGR_PUBLIC_DRV == FS_DRIVE_NOT_FOUND)
    {
        /* only memory card but plugout, need hide storage*/
        cui_menu_set_item_hidden(g_camera_cntx.setting_menu_gid, MENU_ID_CAMERA_STORAGE, MMI_TRUE);
    }
#endif
    cui_menu_set_default_title_by_id(g_camera_cntx.setting_menu_gid, STR_GLOBAL_OPTIONS, GetRootTitleIcon(MENU_ID_CAMERA_APP));
    cui_menu_set_default_left_softkey_by_id(g_camera_cntx.setting_menu_gid, STR_GLOBAL_OK);
    cui_menu_set_default_right_softkey_by_id(g_camera_cntx.setting_menu_gid, STR_GLOBAL_BACK);
    cui_menu_run(g_camera_cntx.setting_menu_gid);
}

/*****************************************************************************
*
* Camera Storage Menu     
*
*****************************************************************************/


#if defined(__CAMERA_FEATURE_STORAGE__)

static mmi_ret mmi_camera_mc_removed_use_phone_confirmCb(mmi_alert_result_evt_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (evt->evt_id == EVT_ID_ALERT_QUIT)
    {
        switch (evt->result)
        {
        case MMI_ALERT_CNFM_OK:
            // handle softkey event here
            break;
        case MMI_ALERT_CNFM_YES:
            mmi_camera_set_storage_to((U16)SRV_FMGR_PUBLIC_DRV);
            break;
        case MMI_ALERT_CNFM_NO:
            mmi_frm_group_close(g_camera_cntx.cur_gid);
            break;
        }
    }
    return MMI_RET_OK;
}

/*****************************************************************************
* FUNCTION
*  mmi_camera_entry_storage_screen
* DESCRIPTION
*  entry storage screen
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
MOD_API void mmi_camera_entry_storage_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_confirm_property_struct arg;
    mmi_id g_id;
    U16 storage;
    MMI_BOOL is_mc_mount = MMI_TRUE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    
    storage = mmi_imgview_get_storage();
   /* only memory card but plugout, need show popup*/
    if (FS_NO_ERROR == FS_GetDevStatus(SRV_FMGR_CARD_DRV ,FS_MOUNT_STATE_ENUM))
    {
        is_mc_mount = MMI_TRUE;
    }
    else
    {
        is_mc_mount = MMI_FALSE;
    }
    
    if (storage == SRV_FMGR_CARD_DRV && is_mc_mount == MMI_FALSE)
    {
        mmi_confirm_property_init(&arg, CNFM_TYPE_YESNO);
        arg.callback = (mmi_proc_func)mmi_camera_mc_removed_use_phone_confirmCb;
        arg.parent_id = g_camera_cntx.cur_gid;
#if defined(__CAMERA_OSD_HORIZONTAL__)
        arg.rotation = (mmi_frm_screen_rotate_enum)g_camera_cntx.osd_data.osd_rotate;
#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 
        mmi_confirm_display_ext(STR_GLOBAL_MC_REMOVED_USE_PHONE, MMI_EVENT_QUERY, &arg);
    }
    else
    {
        g_id = cui_storage_selector_create(g_camera_cntx.cur_gid, (U8)mmi_imgview_get_storage(), 0);
		cui_storage_selector_set_title(g_id, NULL, GetRootTitleIcon(MENU_ID_CAMERA_APP));
        cui_storage_selector_set_ui_style(g_id, CUI_FMGR_UI_STYLE_BANNER_LIST);    /* NEED TEST */
        cui_storage_selector_run(g_id);
    }
}

#endif  /* __CAMERA_FEATURE_STORAGE__*/
/***************************************************************************** 
*
* Custom FX
*
*****************************************************************************/


/*****************************************************************************
* FUNCTION
*  mmi_camera_custom_fx_edit_draw_hilight_item
* DESCRIPTION
*  redraw hilight item
* PARAMETERS
*  cur_idx             [IN]        Current selected index
*  prev_idx            [IN]        
*  previ_idx(?)        [IN]        Previous selected index
* RETURNS
*  void
*****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM__

#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
void mmi_camera_custom_fx_edit_draw_hilight_item(U16 cur_idx, U16 prev_idx)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    custom_fx_slider_struct *slider_p = NULL;
    S32 x1, y1, x2, y2;
    S32 spacing;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* de hilight previous */
    switch (prev_idx)
    {
    case CUSTOM_FX_BRIGHTNESS:
        slider_p = &g_camera_custom_fx_cntx.brightness_slider;
        break;
        
    case CUSTOM_FX_SATURATION:
        slider_p = &g_camera_custom_fx_cntx.saturation_slider;
        break;
        
    case CUSTOM_FX_CONTRAST:
        slider_p = &g_camera_custom_fx_cntx.contrast_slider;
        break;
        
    case CUSTOM_FX_HUE:
        slider_p = &g_camera_custom_fx_cntx.hue_slider;
        break;
    }
    
    spacing = (g_camera_custom_fx_cntx.spacing >> 1);
    
    x1 = spacing;
    x2 = UI_device_width - spacing - 1;
    y1 = slider_p->offset_y - spacing;
    y2 = slider_p->offset_y + spacing + slider_p->height - 1;
    
    gdi_draw_rect(x1, y1, x2, y2, GDI_COLOR_WHITE);
    
    /* highlight */
    switch (cur_idx)
    {
    case CUSTOM_FX_BRIGHTNESS:
        slider_p = &g_camera_custom_fx_cntx.brightness_slider;
        break;
        
    case CUSTOM_FX_SATURATION:
        slider_p = &g_camera_custom_fx_cntx.saturation_slider;
        break;
        
    case CUSTOM_FX_CONTRAST:
        slider_p = &g_camera_custom_fx_cntx.contrast_slider;
        break;
        
    case CUSTOM_FX_HUE:
        slider_p = &g_camera_custom_fx_cntx.hue_slider;
        break;
    }
    
    spacing = (g_camera_custom_fx_cntx.spacing >> 1);
    
    x1 = spacing;
    x2 = UI_device_width - spacing - 1;
    y1 = slider_p->offset_y - spacing;
    y2 = slider_p->offset_y + spacing + slider_p->height - 1;
    
    gdi_draw_rect(x1, y1, x2, y2, GDI_COLOR_BLACK);
    
}


/*****************************************************************************
* FUNCTION
*  mmi_camera_custom_fx_edit_key_press_cyclic
* DESCRIPTION
*  custom fx left or right arrow key long press cyclic handler
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
void mmi_camera_custom_fx_edit_key_press_cyclic(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_camera_custom_fx_cntx.is_right_arrow_press)
    {
        mmi_camera_custom_fx_edit_right_arrow_press();
        gui_start_timer(100, mmi_camera_custom_fx_edit_key_press_cyclic);
    }
    
    if (g_camera_custom_fx_cntx.is_left_arrow_press)
    {
        mmi_camera_custom_fx_edit_left_arrow_press();
        gui_start_timer(100, mmi_camera_custom_fx_edit_key_press_cyclic);
    }
}


/*****************************************************************************
* FUNCTION
*  mmi_camera_custom_fx_edit_right_arrow_release
* DESCRIPTION
*  custom fx left arrow key release
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
void mmi_camera_custom_fx_edit_right_arrow_release(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_custom_fx_cntx.is_right_arrow_press = FALSE;
    gui_cancel_timer(mmi_camera_custom_fx_edit_key_press_cyclic);
}


/*****************************************************************************
* FUNCTION
*  mmi_camera_custom_fx_edit_right_arrow_press
* DESCRIPTION
*  custom fx right arrow key release
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
void mmi_camera_custom_fx_edit_right_arrow_press(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_custom_fx_cntx.is_right_arrow_press = TRUE;
    
    gui_lock_double_buffer();
    
    switch (g_camera_custom_fx_cntx.select_idx)
    {
    case CUSTOM_FX_BRIGHTNESS:
        
        if (g_camera_custom_fx_cntx.brightness_slider.value + 5 <= 100)
        {
            g_camera_custom_fx_cntx.brightness_slider.value += 5;
        }
        else
        {
            gui_unlock_double_buffer();
            return;
        }
        
        gui_set_horizontal_slide_value(
            &g_camera_custom_fx_cntx.brightness_slider.slide_bar,
            g_camera_custom_fx_cntx.brightness_slider.value);
        gui_show_horizontal_slide(&g_camera_custom_fx_cntx.brightness_slider.slide_bar);
        mdi_camera_update_para_sharpness((U16) (g_camera_custom_fx_cntx.brightness_slider.value * 255 / 100));
        
        break;
        
    case CUSTOM_FX_SATURATION:
        
        if (g_camera_custom_fx_cntx.saturation_slider.value + 5 <= 100)
        {
            g_camera_custom_fx_cntx.saturation_slider.value += 5;
        }
        else
        {
            gui_unlock_double_buffer();
            return;
        }
        
        gui_set_horizontal_slide_value(
            &g_camera_custom_fx_cntx.saturation_slider.slide_bar,
            g_camera_custom_fx_cntx.saturation_slider.value);
        gui_show_horizontal_slide(&g_camera_custom_fx_cntx.saturation_slider.slide_bar);
        mdi_camera_update_para_saturation((U16) (g_camera_custom_fx_cntx.saturation_slider.value * 255 / 100));
        
        break;
        
    case CUSTOM_FX_CONTRAST:
        
        if (g_camera_custom_fx_cntx.contrast_slider.value + 5 <= 100)
        {
            g_camera_custom_fx_cntx.contrast_slider.value += 5;
        }
        else
        {
            gui_unlock_double_buffer();
            return;
        }
        
        gui_set_horizontal_slide_value(
            &g_camera_custom_fx_cntx.contrast_slider.slide_bar,
            g_camera_custom_fx_cntx.contrast_slider.value);
        gui_show_horizontal_slide(&g_camera_custom_fx_cntx.contrast_slider.slide_bar);
        mdi_camera_update_para_contrast((U16) (g_camera_custom_fx_cntx.contrast_slider.value * 255 / 100));
        
        break;
        
    case CUSTOM_FX_HUE:
        
        if (g_camera_custom_fx_cntx.hue_slider.value + 10 <= 360)
        {
            g_camera_custom_fx_cntx.hue_slider.value += 10;
        }
        else
        {
            g_camera_custom_fx_cntx.hue_slider.value = 0;
        }
        
        gui_set_horizontal_slide_value(
            &g_camera_custom_fx_cntx.hue_slider.slide_bar,
            g_camera_custom_fx_cntx.hue_slider.value);
        gui_show_horizontal_slide(&g_camera_custom_fx_cntx.hue_slider.slide_bar);
        mdi_camera_update_para_hue(g_camera_custom_fx_cntx.hue_slider.value);
        
        break;
    }
    
    mmi_camera_custom_fx_edit_draw_value(g_camera_custom_fx_cntx.select_idx);
    
    gui_unlock_double_buffer();
    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
    
    gui_start_timer(100, mmi_camera_custom_fx_edit_key_press_cyclic);
    
}


/*****************************************************************************
* FUNCTION
*  mmi_camera_custom_fx_edit_left_arrow_release
* DESCRIPTION
*  custom fx left arrow key release
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
void mmi_camera_custom_fx_edit_left_arrow_release(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_custom_fx_cntx.is_left_arrow_press = FALSE;
    gui_cancel_timer(mmi_camera_custom_fx_edit_key_press_cyclic);
}


/*****************************************************************************
* FUNCTION
*  mmi_camera_custom_fx_edit_left_arrow_press
* DESCRIPTION
*  custom fx left arrow key press
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
void mmi_camera_custom_fx_edit_left_arrow_press(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_custom_fx_cntx.is_left_arrow_press = TRUE;
    
    gui_lock_double_buffer();
    
    switch (g_camera_custom_fx_cntx.select_idx)
    {
    case CUSTOM_FX_BRIGHTNESS:
        
        if (g_camera_custom_fx_cntx.brightness_slider.value - 5 >= 0)
        {
            g_camera_custom_fx_cntx.brightness_slider.value -= 5;
        }
        else
        {
            gui_unlock_double_buffer();
            return;
        }
        
        gui_set_horizontal_slide_value(
            &g_camera_custom_fx_cntx.brightness_slider.slide_bar,
            g_camera_custom_fx_cntx.brightness_slider.value);
        gui_show_horizontal_slide(&g_camera_custom_fx_cntx.brightness_slider.slide_bar);
        mdi_camera_update_para_sharpness((U16) (g_camera_custom_fx_cntx.brightness_slider.value * 255 / 100));
        
        break;
        
    case CUSTOM_FX_SATURATION:
        
        if (g_camera_custom_fx_cntx.saturation_slider.value - 5 >= 0)
        {
            g_camera_custom_fx_cntx.saturation_slider.value -= 5;
        }
        else
        {
            gui_unlock_double_buffer();
            return;
        }
        
        gui_set_horizontal_slide_value(
            &g_camera_custom_fx_cntx.saturation_slider.slide_bar,
            g_camera_custom_fx_cntx.saturation_slider.value);
        gui_show_horizontal_slide(&g_camera_custom_fx_cntx.saturation_slider.slide_bar);
        mdi_camera_update_para_saturation((U16) (g_camera_custom_fx_cntx.saturation_slider.value * 255 / 100));
        
        break;
        
    case CUSTOM_FX_CONTRAST:
        
        if (g_camera_custom_fx_cntx.contrast_slider.value - 5 >= 0)
        {
            g_camera_custom_fx_cntx.contrast_slider.value -= 5;
        }
        else
        {
            gui_unlock_double_buffer();
            return;
        }
        
        gui_set_horizontal_slide_value(
            &g_camera_custom_fx_cntx.contrast_slider.slide_bar,
            g_camera_custom_fx_cntx.contrast_slider.value);
        gui_show_horizontal_slide(&g_camera_custom_fx_cntx.contrast_slider.slide_bar);
        mdi_camera_update_para_contrast((U16) (g_camera_custom_fx_cntx.contrast_slider.value * 255 / 100));
        
        break;
        
    case CUSTOM_FX_HUE:
        
        if (g_camera_custom_fx_cntx.hue_slider.value - 10 >= 0)
        {
            g_camera_custom_fx_cntx.hue_slider.value -= 10;
        }
        else
        {
            g_camera_custom_fx_cntx.hue_slider.value = 360;
        }
        
        gui_set_horizontal_slide_value(
            &g_camera_custom_fx_cntx.hue_slider.slide_bar,
            g_camera_custom_fx_cntx.hue_slider.value);
        gui_show_horizontal_slide(&g_camera_custom_fx_cntx.hue_slider.slide_bar);
        mdi_camera_update_para_hue(g_camera_custom_fx_cntx.hue_slider.value);
        
        break;
    }
    
    mmi_camera_custom_fx_edit_draw_value(g_camera_custom_fx_cntx.select_idx);
    gui_unlock_double_buffer();
    
    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
    
    gui_start_timer(100, mmi_camera_custom_fx_edit_key_press_cyclic);
}


/*****************************************************************************
* FUNCTION
*  mmi_camera_custom_fx_edit_up_arrow_press
* DESCRIPTION
*  custom fx up arrow key press
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
void mmi_camera_custom_fx_edit_up_arrow_press(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 prev_idx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    prev_idx = g_camera_custom_fx_cntx.select_idx;
    
    if (g_camera_custom_fx_cntx.select_idx > CUSTOM_FX_BRIGHTNESS)
    {
        g_camera_custom_fx_cntx.select_idx--;
    }
    else
    {
        g_camera_custom_fx_cntx.select_idx = CUSTOM_FX_HUE;
    }
    
    gdi_layer_lock_frame_buffer();
    
    mmi_camera_custom_fx_edit_draw_title();
    mmi_camera_custom_fx_edit_draw_hilight_item(g_camera_custom_fx_cntx.select_idx, prev_idx);
    mmi_camera_custom_fx_edit_draw_value(g_camera_custom_fx_cntx.select_idx);
    
    gdi_layer_unlock_frame_buffer();
    
    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
}


/*****************************************************************************
* FUNCTION
*  mmi_camera_custom_fx_edit_down_arrow_press
* DESCRIPTION
*  custom fx down arrow key press
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
void mmi_camera_custom_fx_edit_down_arrow_press(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 prev_idx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    prev_idx = g_camera_custom_fx_cntx.select_idx;
    
    if (g_camera_custom_fx_cntx.select_idx < CUSTOM_FX_HUE)
    {
        g_camera_custom_fx_cntx.select_idx++;
    }
    else
    {
        g_camera_custom_fx_cntx.select_idx = CUSTOM_FX_BRIGHTNESS;
    }
    
    gdi_layer_lock_frame_buffer();
    
    mmi_camera_custom_fx_edit_draw_title();
    mmi_camera_custom_fx_edit_draw_hilight_item(g_camera_custom_fx_cntx.select_idx, prev_idx);
    mmi_camera_custom_fx_edit_draw_value(g_camera_custom_fx_cntx.select_idx);
    
    gdi_layer_unlock_frame_buffer();
    
    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
}


/*****************************************************************************
* FUNCTION
*  mmi_camera_custom_fx_edit_draw_value
* DESCRIPTION
*  draw item's current value
* PARAMETERS
*  idx     [IN]        Index to be draw
* RETURNS
*  void
*****************************************************************************/
void mmi_camera_custom_fx_edit_draw_value(U16 idx)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    custom_fx_slider_struct *slider_p = NULL;
    S32 offset_x;
    S32 offset_y;
    S32 width;
    S32 height;
    S8 buf[10];
    S8 buf_UCS2[20];
    S32 str_width;
    S32 str_height;
    U16 value = 0;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (idx)
    {
    case CUSTOM_FX_BRIGHTNESS:
        slider_p = &g_camera_custom_fx_cntx.brightness_slider;
        value = g_camera_custom_fx_cntx.brightness_slider.value;
        break;
        
    case CUSTOM_FX_SATURATION:
        slider_p = &g_camera_custom_fx_cntx.saturation_slider;
        value = g_camera_custom_fx_cntx.saturation_slider.value;
        break;
        
    case CUSTOM_FX_CONTRAST:
        slider_p = &g_camera_custom_fx_cntx.contrast_slider;
        value = g_camera_custom_fx_cntx.contrast_slider.value;
        break;
        
    case CUSTOM_FX_HUE:
        slider_p = &g_camera_custom_fx_cntx.hue_slider;
        value = g_camera_custom_fx_cntx.hue_slider.value;
        break;
    }
    
    gui_reset_text_clip();
    gdi_layer_reset_clip();
    
    sprintf(buf, "%d", value);
    mmi_asc_to_ucs2(buf_UCS2, buf);
    gui_measure_string((UI_string_type) buf_UCS2, &str_width, &str_height);
    
    offset_x = slider_p->offset_x + slider_p->width + (g_camera_custom_fx_cntx.spacing >> 1);
    offset_y = slider_p->offset_y;
    width = g_camera_custom_fx_cntx.num_width;
    height = g_camera_custom_fx_cntx.num_height;
    
    gdi_draw_solid_rect(offset_x, offset_y, offset_x + width - 1, offset_y + height - 1, GDI_COLOR_WHITE);
    
    if (mmi_fe_get_r2l_state())
    {
        offset_x += gui_get_string_width((UI_string_type) buf_UCS2);
    }
    
    offset_x += width - str_width;
    offset_y += ((height - str_height) >> 1);
    
    gui_move_text_cursor(offset_x, offset_y);
    gui_set_font(&MMI_medium_font);
    gui_set_text_color(gui_color(0, 0, 0));
    gui_print_text((UI_string_type) buf_UCS2);
    
}


/*****************************************************************************
* FUNCTION
*  mmi_camera_entry_custom_fx_edit_save
* DESCRIPTION
*  save edited value
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
void mmi_camera_entry_custom_fx_edit_save(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* rescale brightness contrast hue from 0-100 back to 0-255 */
    g_camera_cntx.setting.fx_brightness[g_camera_custom_fx_cntx.fx_idx] =
        g_camera_custom_fx_cntx.brightness_slider.value * 255 / 100;
    
    g_camera_cntx.setting.fx_saturation[g_camera_custom_fx_cntx.fx_idx] =
        g_camera_custom_fx_cntx.saturation_slider.value * 255 / 100;
    
    g_camera_cntx.setting.fx_contrast[g_camera_custom_fx_cntx.fx_idx] =
        g_camera_custom_fx_cntx.contrast_slider.value * 255 / 100;
    
    g_camera_cntx.setting.fx_hue[g_camera_custom_fx_cntx.fx_idx] = g_camera_custom_fx_cntx.hue_slider.value;
    
    DISPLAY_POPUP_DONE();
    mmi_frm_scrn_close(g_camera_cntx.cur_gid, SCR_ID_CAMERA_EFFECT_SETTING);    

    mmi_camera_store_setting();
}

/*****************************************************************************
* FUNCTION
*  mmi_camera_exit_custom_fx_edit_sublcd_screen
* DESCRIPTION
*  exit sublcd screen
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
#ifdef __MMI_SUBLCD__
void mmi_camera_exit_custom_fx_edit_sublcd_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SubLCDHistoryNode SubLCDHistory;
    
    /* someone may exit/draw sublcd first then exit mainlcd, this may cause driver assert */
    mdi_camera_preview_stop();
    
    SubLCDHistory.entryFuncPtr = mmi_camera_entry_custom_fx_edit_sublcd_screen;
    AddSubLCDHistory(&SubLCDHistory);
}


/*****************************************************************************
* FUNCTION
*  mmi_camera_entry_custom_fx_edit_sublcd_screen
* DESCRIPTION
*  entry sublcd screen
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
void mmi_camera_entry_custom_fx_edit_sublcd_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ExecSubLCDCurrExitHandler();
    ShowCategory331Screen();
    mmi_camera_sublcd_draw_icon();
    SetSubLCDExitHandler(mmi_camera_exit_custom_fx_edit_sublcd_screen);
}
#endif /* __MMI_SUBLCD__ */ 


/*****************************************************************************
* FUNCTION
*  mmi_camera_custom_fx_edit_draw_title
* DESCRIPTION
*  draw custom fx's title, will draw current selected item's name
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
void mmi_camera_custom_fx_edit_draw_title(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (g_camera_custom_fx_cntx.select_idx)
    {
    case CUSTOM_FX_BRIGHTNESS:
        ChangeTitle(0, (PU8) GetString(STR_ID_CAMERA_EFFECT_CUSTOM_FX_BRIGHTNESS));
        break;
        
    case CUSTOM_FX_SATURATION:
        ChangeTitle(0, (PU8) GetString(STR_ID_CAMERA_EFFECT_CUSTOM_FX_SATURATION));
        break;
        
    case CUSTOM_FX_CONTRAST:
        ChangeTitle(0, (PU8) GetString(STR_ID_CAMERA_EFFECT_CUSTOM_FX_CONTRAST));
        break;
        
    case CUSTOM_FX_HUE:
        ChangeTitle(0, (PU8) GetString(STR_ID_CAMERA_EFFECT_CUSTOM_FX_HUE));
        break;
    }
    
    draw_title();
    
}


/*****************************************************************************
* FUNCTION
*  mmi_camera_exit_custom_fx_edit_screen
* DESCRIPTION
*  exit edit screen
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
void mmi_camera_exit_custom_fx_edit_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* stop preview and power off */
    mdi_camera_preview_stop();
    mdi_camera_power_off();
    
    /* merge layers */
    gdi_layer_flatten_previous_to_base();
    
    /* free layers */
    gdi_layer_free(g_camera_custom_fx_cntx.preview_wnd_layer);
    gdi_layer_multi_layer_disable();
    
    gui_cancel_timer(mmi_camera_custom_fx_edit_key_press_cyclic);
    
    /* re-enable keypad tone */
    mmi_frm_kbd_set_tone_state(MMI_KEY_TONE_ENABLED);
    
    /* un-hook clam close msg */
    /*mmi_frm_clear_interrupt_event_handler(MMI_FRM_INT_CLAM_CLOSE);*/
    mmi_frm_cb_dereg_event(EVT_ID_PRE_PROTOCOL, mmi_camera_custom_fx_clam_close_hdlr, NULL);
#ifdef __MMI_SUBLCD__
    /* leave sublcd screen */
    GoBackSubLCDHistory();
#endif /* __MMI_SUBLCD__ */ 
}


/*****************************************************************************
* FUNCTION
*  mmi_camera_entry_custom_fx_edit_screen
* DESCRIPTION
*  entry custom fx screen
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
void mmi_camera_entry_custom_fx_edit_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;
    S32 str_width;
    S32 str_height;
    S32 preview_wnd_height;
    S32 preview_wnd_width;
    S32 preview_wnd_offset_x;
    S32 preview_wnd_offset_y;
    S32 num_width;
    S32 num_height;
    S32 spacing;
    S32 image_width;
    S32 image_height;
    S32 image_spacing;
    S32 image_offset_x;
    S32 image_offset_y;
    S32 remain;
    mdi_camera_setting_struct camera_setting_data;
    mdi_camera_preview_struct camera_preview_data;
    custom_fx_slider_struct *slider_p;
    MMI_BOOL entry_ret;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    entry_ret = mmi_frm_scrn_enter (
        g_camera_cntx.cur_gid, 
        STR_ID_CAMERA_EFFECT_CUSTOM_FX_EDIT_EFFECT, 
        mmi_camera_exit_custom_fx_edit_screen, 
        mmi_camera_entry_custom_fx_edit_screen, MMI_FRM_UNKNOW_SCRN);
    if (!entry_ret)
    {
        return;
    }
    
#if defined(__CAMERA_OSD_HORIZONTAL__) && defined(__MMI_SCREEN_ROTATE__)
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }
#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 
    
    /* entry sublcd - avoid sulcd update */
#ifdef __MMI_SUBLCD__
    ForceSubLCDScreen(mmi_camera_entry_custom_fx_edit_sublcd_screen);
#endif 
    
    guiBuffer = mmi_frm_scrn_get_gui_buf(g_camera_cntx.cur_gid,  STR_ID_CAMERA_EFFECT_CUSTOM_FX_EDIT_EFFECT);
    
    /* force all playing keypad tone off */
    srv_profiles_stop_tone((srv_prof_tone_enum)GetCurKeypadTone());
    
    /* disable key pad tone */
    mmi_frm_kbd_set_tone_state(MMI_KEY_TONE_DISABLED);
    
    g_camera_custom_fx_cntx.is_left_arrow_press = FALSE;
    g_camera_custom_fx_cntx.is_right_arrow_press = FALSE;
    
    /* if first time enter */
    if (!guiBuffer)
    {
        g_camera_custom_fx_cntx.select_idx = CUSTOM_FX_BRIGHTNESS;
        
        /* rescale brightness contrast stauration from 0-255 to 0-100 */
        g_camera_custom_fx_cntx.brightness_slider.value =
            g_camera_cntx.setting.fx_brightness[g_camera_custom_fx_cntx.fx_idx] * 100 / 255;
        g_camera_custom_fx_cntx.saturation_slider.value =
            g_camera_cntx.setting.fx_saturation[g_camera_custom_fx_cntx.fx_idx] * 100 / 255;
        g_camera_custom_fx_cntx.contrast_slider.value =
            g_camera_cntx.setting.fx_contrast[g_camera_custom_fx_cntx.fx_idx] * 100 / 255;
        g_camera_custom_fx_cntx.hue_slider.value = g_camera_cntx.setting.fx_hue[g_camera_custom_fx_cntx.fx_idx];
        
        /* sometime rounding will get a value like 4, or 1, and we use 5 as out minium step */
        /* rounding them */
        
        /* brightness rounding */
        remain = g_camera_custom_fx_cntx.brightness_slider.value % 5;
        
        if (remain != 0)
        {
            if (remain < 3)
            {
                g_camera_custom_fx_cntx.brightness_slider.value -= remain;
            }
            else
            {
                g_camera_custom_fx_cntx.brightness_slider.value += (5 - remain);
            }
        }
        
        /* saturation rounding */
        remain = g_camera_custom_fx_cntx.saturation_slider.value % 5;
        
        if (remain != 0)
        {
            if (remain < 3)
            {
                g_camera_custom_fx_cntx.saturation_slider.value -= remain;
            }
            else
            {
                g_camera_custom_fx_cntx.saturation_slider.value += (5 - remain);
            }
        }
        
        /* contrast rounding */
        remain = g_camera_custom_fx_cntx.contrast_slider.value % 5;
        
        if (remain != 0)
        {
            if (remain < 3)
            {
                g_camera_custom_fx_cntx.contrast_slider.value -= remain;
            }
            else
            {
                g_camera_custom_fx_cntx.contrast_slider.value += (5 - remain);
            }
        }
        
        /* hue rounding */
        remain = g_camera_custom_fx_cntx.hue_slider.value % 10;
        
        if (remain != 0)
        {
            if (remain < 5)
            {
                g_camera_custom_fx_cntx.hue_slider.value -= remain;
            }
            else
            {
                g_camera_custom_fx_cntx.hue_slider.value += (10 - remain);
            }
        }
        
    }
    
    /* avoid draw empty category first */
    gdi_layer_lock_frame_buffer();
    
    /* draw a emptry category */
    ShowCategory221Screen(
        STR_GLOBAL_OK,  /* just give it a string, for category221 to draw status and title bar */
        GetRootTitleIcon(MENU_ID_CAMERA_APP),
        STR_GLOBAL_SAVE,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        GDI_COLOR_WHITE,
        NULL);
    
    gdi_layer_unlock_frame_buffer();
    
    mmi_camera_custom_fx_edit_draw_title();
    
    SetKeyDownHandler(mmi_camera_custom_fx_edit_down_arrow_press, KEY_DOWN_ARROW);
    SetKeyDownHandler(mmi_camera_custom_fx_edit_up_arrow_press, KEY_UP_ARROW);
    SetKeyDownHandler(mmi_camera_custom_fx_edit_left_arrow_press, KEY_LEFT_ARROW);
    SetKeyDownHandler(mmi_camera_custom_fx_edit_right_arrow_press, KEY_RIGHT_ARROW);
    SetKeyUpHandler(mmi_camera_custom_fx_edit_left_arrow_release, KEY_LEFT_ARROW);
    SetKeyUpHandler(mmi_camera_custom_fx_edit_right_arrow_release, KEY_RIGHT_ARROW);
    
    SetLeftSoftkeyFunction(mmi_camera_entry_custom_fx_edit_save, KEY_EVENT_UP);
    SetRightSoftkeyFunction((mmi_void_funcptr_type)mmi_frm_scrn_close_active_id, KEY_EVENT_UP);
    
    gdi_layer_lock_frame_buffer();
    
    gui_set_font(&MMI_medium_font);
    gui_measure_string((UI_string_type) GetString(STR_ID_CAMERA_EFFECT_CUSTOM_FX_BRIGHTNESS), &str_width, &str_height);
    gui_measure_string((UI_string_type) L"255", &num_width, &num_height);
    
    spacing = str_height >> 1;
    g_camera_custom_fx_cntx.spacing = spacing;
    g_camera_custom_fx_cntx.num_width = num_width;
    g_camera_custom_fx_cntx.num_height = num_height;
    
    preview_wnd_height = MMI_content_height - (str_height * 4 + spacing * 6);
    preview_wnd_width = UI_device_width - spacing * 2;
    preview_wnd_offset_x = spacing;
    preview_wnd_offset_y = MMI_title_height + MMI_title_y + spacing;
    
    gdi_layer_create(
        preview_wnd_offset_x,
        preview_wnd_offset_y,
        preview_wnd_width,
        preview_wnd_height,
        &g_camera_custom_fx_cntx.preview_wnd_layer);
    
    gdi_layer_push_and_set_active(g_camera_custom_fx_cntx.preview_wnd_layer);
    gdi_layer_clear_background(GDI_COLOR_BLACK);
    gdi_layer_pop_and_restore_active();
    
    gdi_layer_get_base_handle(&g_camera_custom_fx_cntx.base_layer);
    
    gdi_layer_set_blt_layer(g_camera_custom_fx_cntx.base_layer, g_camera_custom_fx_cntx.preview_wnd_layer, 0, 0);
    
    /* brightness */
    slider_p = &g_camera_custom_fx_cntx.brightness_slider;
    
    slider_p->width = UI_device_width - spacing * 4 - num_width * 2;
    slider_p->height = str_height;
    
    slider_p->offset_x = spacing * 2 + num_width;
    slider_p->offset_y = MMI_title_height + MMI_title_y + preview_wnd_height + spacing * 2;
    
    gui_create_horizontal_slide(
        &slider_p->slide_bar,
        slider_p->offset_x,
        slider_p->offset_y,
        slider_p->width,
        slider_p->height);
    gui_set_horizontal_slide_range(&slider_p->slide_bar, 100);
    gui_set_horizontal_slide_scale(&slider_p->slide_bar, 1);
    gui_set_horizontal_slide_value(&slider_p->slide_bar, slider_p->value);
    gui_show_horizontal_slide(&slider_p->slide_bar);
    
    gdi_image_get_dimension_id(IMG_ID_CAMERA_CUSTOM_FX_BIRIGHTNESS, &image_width, &image_height);
    
    image_spacing = (slider_p->height - image_height) >> 1;
    image_offset_x = spacing + image_spacing + ((num_width - image_width) >> 1);
    image_offset_y = slider_p->offset_y + image_spacing;
    
    gdi_image_draw_id(image_offset_x, image_offset_y, IMG_ID_CAMERA_CUSTOM_FX_BIRIGHTNESS);
    
    mmi_camera_custom_fx_edit_draw_value(CUSTOM_FX_BRIGHTNESS);
    
    /* saturation */
    slider_p = &g_camera_custom_fx_cntx.saturation_slider;
    
    slider_p->width = UI_device_width - spacing * 4 - num_width * 2;
    slider_p->height = str_height;
    
    slider_p->offset_x = spacing * 2 + num_width;
    slider_p->offset_y = MMI_title_height + MMI_title_y + preview_wnd_height + str_height + spacing * 3;
    
    gui_create_horizontal_slide(
        &slider_p->slide_bar,
        slider_p->offset_x,
        slider_p->offset_y,
        slider_p->width,
        slider_p->height);
    gui_set_horizontal_slide_range(&slider_p->slide_bar, 100);
    gui_set_horizontal_slide_scale(&slider_p->slide_bar, 1);
    gui_set_horizontal_slide_value(&slider_p->slide_bar, slider_p->value);
    gui_show_horizontal_slide(&slider_p->slide_bar);
    
    gdi_image_get_dimension_id(IMG_ID_CAMERA_CUSTOM_FX_SATURATION, &image_width, &image_height);
    
    image_spacing = (slider_p->height - image_height) >> 1;
    image_offset_x = spacing + image_spacing + ((num_width - image_width) >> 1);
    image_offset_y = slider_p->offset_y + image_spacing;
    
    gdi_image_draw_id(image_offset_x, image_offset_y, IMG_ID_CAMERA_CUSTOM_FX_SATURATION);
    
    mmi_camera_custom_fx_edit_draw_value(CUSTOM_FX_SATURATION);
    
    /* contrast */
    slider_p = &g_camera_custom_fx_cntx.contrast_slider;
    
    slider_p->width = UI_device_width - spacing * 4 - num_width * 2;
    slider_p->height = str_height;
    
    slider_p->offset_x = spacing * 2 + num_width;
    slider_p->offset_y = MMI_title_height + MMI_title_y + preview_wnd_height + str_height * 2 + spacing * 4;
    
    gui_create_horizontal_slide(
        &slider_p->slide_bar,
        slider_p->offset_x,
        slider_p->offset_y,
        slider_p->width,
        slider_p->height);
    gui_set_horizontal_slide_range(&slider_p->slide_bar, 100);
    gui_set_horizontal_slide_scale(&slider_p->slide_bar, 1);
    gui_set_horizontal_slide_value(&slider_p->slide_bar, slider_p->value);
    gui_show_horizontal_slide(&slider_p->slide_bar);
    
    gdi_image_get_dimension_id(IMG_ID_CAMERA_CUSTOM_FX_CONTRAST, &image_width, &image_height);
    
    image_spacing = (slider_p->height - image_height) >> 1;
    image_offset_x = spacing + image_spacing + ((num_width - image_width) >> 1);
    image_offset_y = slider_p->offset_y + image_spacing;
    
    gdi_image_draw_id(image_offset_x, image_offset_y, IMG_ID_CAMERA_CUSTOM_FX_CONTRAST);
    
    mmi_camera_custom_fx_edit_draw_value(CUSTOM_FX_CONTRAST);
    
    /* Hue */
    slider_p = &g_camera_custom_fx_cntx.hue_slider;
    
    slider_p->width = UI_device_width - spacing * 4 - num_width * 2;
    slider_p->height = str_height;
    
    slider_p->offset_x = spacing * 2 + num_width;
    slider_p->offset_y = MMI_title_height + MMI_title_y + preview_wnd_height + str_height * 3 + spacing * 5;
    
    gui_create_horizontal_slide(
        &slider_p->slide_bar,
        slider_p->offset_x,
        slider_p->offset_y,
        slider_p->width,
        slider_p->height);
    gui_set_horizontal_slide_range(&slider_p->slide_bar, 360);
    gui_set_horizontal_slide_scale(&slider_p->slide_bar, 1);
    gui_set_horizontal_slide_value(&slider_p->slide_bar, slider_p->value);
    gui_show_horizontal_slide(&slider_p->slide_bar);
    
    gdi_image_get_dimension_id(IMG_ID_CAMERA_CUSTOM_FX_HUE, &image_width, &image_height);
    
    image_spacing = (slider_p->height - image_height) >> 1;
    image_offset_x = spacing + image_spacing + ((num_width - image_width) >> 1);
    image_offset_y = slider_p->offset_y + image_spacing;
    
    gdi_image_draw_id(image_offset_x, image_offset_y, IMG_ID_CAMERA_CUSTOM_FX_HUE);
    mmi_camera_custom_fx_edit_draw_value(CUSTOM_FX_HUE);
    
    mmi_camera_custom_fx_edit_draw_hilight_item(g_camera_custom_fx_cntx.select_idx, g_camera_custom_fx_cntx.select_idx);
    
    gdi_layer_unlock_frame_buffer();
    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
    
    /*********** start preview ************/
    
    /* stop MMI sleep */
    srv_backlight_turn_on(0);
    
#if defined(__MMI_CLAMSHELL__)
    /* register event hdlr */
    mmi_frm_cb_reg_event(EVT_ID_PRE_PROTOCOL, mmi_camera_custom_fx_clam_close_hdlr, NULL);
#endif /* defined(__MMI_CLAMSHELL__) */ 
    
    /* stop LCD patten */
    srv_gpio_play_pattern((srv_gpio_pattern_id_enum)srv_led_pattern_get_bg_pattern(), SRV_GPIO_PATN_PLAY_STOP);
    
    /* power on and init hardware module */
    mdi_camera_power_on(0);
    
    camera_setting_data.xenon_flash_status_callback = NULL;
    camera_setting_data.zoom = 10;
    camera_setting_data.wb = camera_wb_command_map[g_camera_cntx.setting.wb];
//    camera_setting_data.manual_wb = FALSE;
    
    camera_setting_data.ev = camera_ev_command_map[g_camera_cntx.setting.ev];
    camera_setting_data.banding = camera_banding_command_map[g_camera_cntx.setting.banding];
    
//    camera_setting_data.night = g_camera_cntx.setting.night;
    camera_setting_data.flash = camera_flash_command_map[g_camera_cntx.setting.flash];
    camera_setting_data.ae_meter = camera_ae_meter_command_map[g_camera_cntx.setting.ae_meter];
    camera_setting_data.iso = camera_iso_command_map[g_camera_cntx.setting.iso];
    
    camera_setting_data.scene_mode = camera_dsc_mode_command_map[g_camera_cntx.setting.dsc_mode];
    
    camera_setting_data.effect = camera_effect_command_map[CAMERA_SETTING_EFFECT_NORMAL];
    camera_setting_data.sharpness = g_camera_custom_fx_cntx.brightness_slider.value * 255 / 100;
    camera_setting_data.saturation = g_camera_custom_fx_cntx.saturation_slider.value * 255 / 100;
    camera_setting_data.contrast = g_camera_custom_fx_cntx.contrast_slider.value * 255 / 100;
    camera_setting_data.hue = g_camera_custom_fx_cntx.hue_slider.value;
    
    camera_setting_data.preview_width = preview_wnd_width;
    camera_setting_data.preview_height = preview_wnd_height;
    
    /* capture parameters */
    camera_setting_data.image_qty = camera_image_qty_command_map[g_camera_cntx.setting.image_qty];
    camera_setting_data.image_width = g_camera_cntx.image_width;
    camera_setting_data.image_height = g_camera_cntx.image_height;
    
    camera_setting_data.lcm = MDI_CAMERA_PREVIEW_LCM_MAINLCD;
//    camera_setting_data.preview_rotate = CAMERA_PREVIEW_MAINLCD_ROTATE;
//    camera_setting_data.lcm_rotate = CAMERA_LCM_MAINLCD_ROTATE;
    
    camera_preview_data.preview_layer_handle = g_camera_custom_fx_cntx.preview_wnd_layer;
//    camera_preview_data.preview_wnd_offset_x = 0;
//    camera_preview_data.preview_wnd_offset_y = 0;
//    camera_preview_data.preview_wnd_width = preview_wnd_width;
//    camera_preview_data.preview_wnd_height = preview_wnd_height;
    camera_preview_data.blt_layer_flag = GDI_LAYER_ENABLE_LAYER_0 | GDI_LAYER_ENABLE_LAYER_1;
    camera_preview_data.src_key_color = 0;
    camera_preview_data.preview_layer_flag = GDI_LAYER_ENABLE_LAYER_1;
    camera_preview_data.is_lcd_update = TRUE;
    camera_preview_data.is_tvout = TRUE;
    
    /* start preview */
    mdi_camera_preview_start(
        &camera_preview_data,
        &camera_setting_data,
        NULL);
}


/*****************************************************************************
* FUNCTION
*  mmi_camera_entry_custom_fx_set
* DESCRIPTION
*  entry custom fx screen
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
void mmi_camera_entry_custom_fx_set(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DISPLAY_POPUP_DONE();
    DeleteUptoScrID(SCR_ID_CAMERA_OPTION);
    
    g_camera_cntx.setting.effect = g_camera_cntx.selected_effect;
    
    mmi_camera_store_setting();
}


/*****************************************************************************
* FUNCTION
*  mmi_camera_highlight_custom_fx_set
* DESCRIPTION
*  entry custom fx screen
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
void mmi_camera_highlight_custom_fx_set(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_camera_entry_custom_fx_set, KEY_EVENT_UP);
    SetRightSoftkeyFunction((mmi_void_funcptr_type)mmi_frm_scrn_close_active_id, KEY_EVENT_UP);
    SetKeyDownHandler((mmi_void_funcptr_type)mmi_frm_scrn_close_active_id, KEY_LEFT_ARROW);
}


/*****************************************************************************
* FUNCTION
*  mmi_camera_highlight_custom_fx_edit
* DESCRIPTION
*  highlight hdlr of edit menu item
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
void mmi_camera_highlight_custom_fx_edit(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_camera_entry_custom_fx_edit_screen, KEY_EVENT_UP);
    SetRightSoftkeyFunction((mmi_void_funcptr_type)mmi_frm_scrn_close_active_id, KEY_EVENT_UP);
    SetKeyDownHandler((mmi_void_funcptr_type)mmi_frm_scrn_close_active_id, KEY_LEFT_ARROW);
}

/*****************************************************************************
* FUNCTION
*  mmi_camera_entry_custom_fx_option_screen
* DESCRIPTION
*  custom fx option screen
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
void mmi_camera_entry_custom_fx_option_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 ItemList[16];
    U16 ItemIcons[16];
    U16 nItems;
    U8 *guiBuffer, i;
    MMI_BOOL entry_ret;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    entry_ret = mmi_frm_scrn_enter (
        g_camera_cntx.cur_gid, 
        SCR_ID_CAMERA_EFFECT_SET_OPTION, 
        NULL, 
        mmi_camera_entry_custom_fx_option_screen, MMI_FRM_UNKNOW_SCRN);
    if (!entry_ret)
    {
        return;
    }
    
#if defined(__CAMERA_OSD_HORIZONTAL__) && defined(__MMI_SCREEN_ROTATE__)
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }
#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 
    
    guiBuffer = mmi_frm_scrn_get_gui_buf(g_camera_cntx.cur_gid,  SCR_ID_CAMERA_EFFECT_SET_OPTION);
    nItems = GetNumOfChild(MENU_ID_CAMERA_EFFECT_CUSTOM_FX_SET_OPTION);
    GetSequenceStringIds(MENU_ID_CAMERA_EFFECT_CUSTOM_FX_SET_OPTION, ItemList);
    SetParentHandler(MENU_ID_CAMERA_EFFECT_CUSTOM_FX_SET_OPTION);
    
    for (i = 0; i < nItems; i++)
    {
        ItemIcons[i] = IMG_GLOBAL_L1 + i;
    }
    RegisterHighlightHandler(ExecuteCurrHiliteHandler);
    
    ShowCategory11Screen(
        STR_ID_CAMERA_EFFECT_SETTING,
        GetRootTitleIcon(MENU_ID_CAMERA_APP),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nItems,
        ItemList,
        0,
        guiBuffer);
    
}
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 

#endif // __CAMERA_FEATURE_EFFECT_CUSTOM__


/***************************************************************************** 
*
* Camera Setting
*
*****************************************************************************/
typedef struct {
    U16         cap_str_id;
    U16         *val_addr;
    const U16   *p_select_data;
    U8          select_count;
}camera_setting_inline_item_struct;

typedef struct {
    U16 title_str_id;
    const camera_setting_inline_item_struct *pitems;
}camera_setting_inline_data_struct;

static void mmi_camera_entry_setting_inline(const camera_setting_inline_data_struct *pdata)
{
    cui_inline_struct setting;
    mmi_id g_id;
    const camera_setting_inline_item_struct *pitems = pdata->pitems;
    cui_inline_set_item_struct inline_item;
    U16 item_id = CUI_INLINE_ITEM_ID_BASE;
    cui_inline_item_caption_struct inline_cap;
    cui_inline_item_select_struct  inline_select;

#if defined(__CAMERA_OSD_HORIZONTAL__) && defined(__MMI_SCREEN_ROTATE__)
    if (g_camera_cntx.osd_data.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }  
#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 

    memset(&setting, 0, sizeof(setting));
    setting.title = pdata->title_str_id;
    setting.title_icon = GetRootTitleIcon(MENU_ID_CAMERA_APP);
    setting.screen_flag = CUI_INLINE_SCREEN_DISABLE_DONE | CUI_INLINE_SCREEN_DEFAULT_TEXT;

    g_id = cui_inline_create(g_camera_cntx.cur_gid, &setting);
    
    while(pitems->val_addr != NULL){
        inline_cap.string_id = pitems->cap_str_id;
        inline_item.item_id = item_id++;
        inline_item.item_flag = CUI_INLINE_ITEM_TYPE_CAPTION | CUI_INLINE_ITEM_LEFT_JUSTIFY;
        inline_item.item_data = (void*)(&inline_cap);
        inline_item.image_id = 0;

        cui_inline_insert_item(g_id, CUI_INLINE_INSERT_TAIL, &inline_item);

        inline_select.n_items = pitems->select_count;
        inline_select.highlighted_item = (U8)(*(pitems->val_addr));
        inline_select.list_of_item_id = pitems->p_select_data;
        
        inline_item.item_id = item_id++;
        inline_item.item_flag = CUI_INLINE_ITEM_TYPE_SELECT | CUI_INLINE_ITEM_CENTER_JUSTIFY;
        inline_item.item_data = (void*)(&inline_select);
        inline_item.image_id = 0;
        cui_inline_insert_item(g_id, CUI_INLINE_INSERT_TAIL, &inline_item);
        
        pitems++;
    }

    cui_inline_set_parent_data(g_id, (U32)(pdata));
    cui_inline_set_highlight_item(g_id, CUI_INLINE_ITEM_ID_BASE);
    cui_inline_run(g_id);
    
}

#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#ifdef __CAMERA_FEATURE_CONT_SHOT_BURST__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* __CAMERA_FEATURE_CONT_SHOT_BURST__ */ 
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#if defined(__CAMERA_FEATURE_CONT_SHOT_BURST__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* defined(__CAMERA_FEATURE_CONT_SHOT_BURST__) */ 
/* under construction !*/
/* under construction !*/
#endif

void mmi_camera_setting_inline_on_commit(mmi_id g_id)
{
    const camera_setting_inline_data_struct *pdata = 
        (const camera_setting_inline_data_struct *)cui_inline_get_parent_data(g_id);
    const camera_setting_inline_item_struct *pitems = pdata->pitems;
    U8 val;
    U16 item_id = CUI_INLINE_ITEM_ID_BASE+1;
    U16 org_imgsize = g_camera_cntx.setting.image_size;
#ifdef __CAMERA_FEATURE_CONT_SHOT_BURST__
    U16 org_cont_shot = g_camera_cntx.setting.cont_shot;
#endif
    

    while(pitems->val_addr != NULL){
        cui_inline_get_value(g_id, item_id, (void*)&val);
        *(pitems->val_addr) = val;
        pitems++;
        item_id += 2;
    }

#ifdef __CAMERA_FEATURE_CONT_SHOT_BURST__
        /* set image size to other will auto close continue shot burst */
        if (g_camera_cntx.setting.cont_shot == CAMERA_SETTING_CONT_SHOT_BURST && org_imgsize != g_camera_cntx.setting.image_size)
        {
            if (g_camera_cntx.setting.image_size != CAMERA_FEATURE_CONT_SHOT_BURST_IMAGE_IDX)
            {
                g_camera_cntx.setting.cont_shot = CAMERA_SETTING_CONT_SHOT_OFF;
            }
        }
        /* while switching to burstshot mode, the menu should be changed from vertical to horizontal */
        if (g_camera_cntx.setting.cont_shot == CAMERA_SETTING_CONT_SHOT_BURST)
        {
            if (g_camera_cntx.setting.image_size != CAMERA_FEATURE_CONT_SHOT_BURST_IMAGE_IDX)
            {
                g_camera_cntx.image_size_before_burst = g_camera_cntx.setting.image_size;
                g_camera_cntx.setting.image_size = CAMERA_FEATURE_CONT_SHOT_BURST_IMAGE_IDX;
                
            }
        }
        else if(old_cont_shot == CAMERA_SETTING_CONT_SHOT_BURST)
        {
            
            if (g_camera_cntx.image_size_before_burst != CAMERA_FEATURE_CONT_SHOT_BURST_IMAGE_IDX)
            {
                /* restore preview */
                g_camera_cntx.setting.image_size = g_camera_cntx.image_size_before_burst;
            }        
        }
#endif /* defined(__CAMERA_FEATURE_CONT_SHOT_BURST__) */ 

    if(org_imgsize != g_camera_cntx.setting.image_size)
    {
        /* reset zoom to default since image size might changed */
        g_camera_cntx.setting.zoom_idx = CAMERA_DEFAULT_SETTING_ZOOM_IDX;
    }
    mmi_camera_preview_update_capture_size();

    mmi_camera_store_setting();
    DISPLAY_POPUP_DONE();
}


/**************************************************************
 *  data of image setting screen
 *************************************************************/
static const U16 g_camera_il_image_qty_select_str[] =
    {
#ifdef __CAMERA_FEATURE_IMAGE_QTY_LOW__
        STR_ID_CAMERA_IMAGE_QTY_LOW,
#endif
#ifdef __CAMERA_FEATURE_IMAGE_QTY_NORMAL__
        STR_ID_CAMERA_IMAGE_QTY_NORMAL,
#endif
#ifdef __CAMERA_FEATURE_IMAGE_QTY_HIGH__
        STR_ID_CAMERA_IMAGE_QTY_HIGH,
#endif
#ifdef __CAMERA_FEATURE_IMAGE_QTY_FINE__
        STR_ID_CAMERA_IMAGE_QTY_FINE,
#endif
};

static const U16 g_camera_il_image_size_select_str[] =
{

#ifdef __CAMERA_FEATURE_IMAGE_SIZE_SS__
		CAMERA_COMPOSE_STRID(SS_SUFFIX),
#endif

#ifdef __CAMERA_FEATURE_IMAGE_SIZE_S__
        CAMERA_COMPOSE_STRID(S_SUFFIX),
#endif

#ifdef __CAMERA_FEATURE_IMAGE_SIZE_M__
        CAMERA_COMPOSE_STRID(M_SUFFIX),
#endif

#ifdef __CAMERA_FEATURE_IMAGE_SIZE_L__
        CAMERA_COMPOSE_STRID(L_SUFFIX),
#endif

#ifdef __CAMERA_FEATURE_IMAGE_SIZE_LL__
        CAMERA_COMPOSE_STRID(LL_SUFFIX),
#endif
};


static const camera_setting_inline_item_struct g_camera_il_image_items[] = 
{
    {
        STR_ID_CAMERA_IMAGE_SIZE,
        &g_camera_cntx.setting.image_size,
        g_camera_il_image_size_select_str,
        sizeof(g_camera_il_image_size_select_str)/sizeof(U16)
        
    },

    {
        STR_ID_CAMERA_IMAGE_QTY,
        &g_camera_cntx.setting.image_qty,
        g_camera_il_image_qty_select_str,
        sizeof(g_camera_il_image_qty_select_str)/sizeof(U16)
    },
    {0, NULL, NULL, 0}
};

static const camera_setting_inline_data_struct g_camera_img_setting = 
{
    STR_ID_CAMERA_IMAGE_SETTING,
    g_camera_il_image_items
};


void mmi_camera_entry_image_setting_screen(void)
{
    mmi_camera_entry_setting_inline(&g_camera_img_setting);
}




/**************************************************************
 *  data of camera setting screen
 *************************************************************/
#ifdef __CAMERA_FEATURE_FLASH__
    static const U16 g_camera_il_flash_select_str[] =
    {
#ifdef __CAMERA_FEATURE_FLASH_AUTO__
        STR_ID_CAMERA_FLASH_AUTO,
#endif
#ifdef __CAMERA_FEATURE_FLASH_REDEYE__
        STR_ID_CAMERA_FLASH_REDEYE,
#endif
    };
#endif
    
    
#ifdef __CAMERA_FEATURE_LED_HIGHLIGHT__
static const U16 g_camera_il_led_hightlight_select_str[] =
{
#if defined(__CAMERA_FEATURE_LED_HIGHLIGHT_7_COLOR__) || defined(__CAMERA_FEATURE_LED_HIGHLIGHT_ON_OFF__)
    STR_ID_CAMERA_LED_HIGHLIGHT_OFF,
#endif
#ifdef __CAMERA_FEATURE_LED_HIGHLIGHT_ON_OFF__
    STR_ID_CAMERA_LED_HIGHLIGHT_ON,
#endif
#ifdef __CAMERA_FEATURE_LED_HIGHLIGHT_7_COLOR__
    STR_ID_CAMERA_LED_HIGHLIGHT_WHITE,
    STR_ID_CAMERA_LED_HIGHLIGHT_RED,
    STR_ID_CAMERA_LED_HIGHLIGHT_GREEN,
    STR_ID_CAMERA_LED_HIGHLIGHT_BLUE,
    STR_ID_CAMERA_LED_HIGHLIGHT_YELLOW,
    STR_ID_CAMERA_LED_HIGHLIGHT_PURPLE,
    STR_ID_CAMERA_LED_HIGHLIGHT_CYAN,
#endif
};

#endif
    
    
#ifdef __CAMERA_FEATURE_SHUTTER_SOUND__
static const U16 g_camera_il_shutter_sound_select_str[] =
{
#ifdef __CAMERA_FEATURE_SHUTTER_SOUND_OFF__
    STR_ID_CAMERA_SHUTTER_SOUND_OFF,
#endif
#ifdef __CAMERA_FEATURE_SHUTTER_SOUND_1__
    STR_ID_CAMERA_SHUTTER_SOUND_1,
#endif
#ifdef __CAMERA_FEATURE_SHUTTER_SOUND_2__
    STR_ID_CAMERA_SHUTTER_SOUND_2,
#endif
#ifdef __CAMERA_FEATURE_SHUTTER_SOUND_3__
    STR_ID_CAMERA_SHUTTER_SOUND_3,
#endif
};

#endif
    
#ifdef __CAMERA_FEATURE_EV__
static const U16 g_camera_il_ev_select_str[] =
{
#ifdef __CAMERA_FEATURE_EV_4__
        STR_ID_CAMERA_EV_N4,
#endif
#ifdef __CAMERA_FEATURE_EV_3__
        STR_ID_CAMERA_EV_N3,
#endif
#ifdef __CAMERA_FEATURE_EV_2__
        STR_ID_CAMERA_EV_N2,
#endif
        STR_ID_CAMERA_EV_N1,
        STR_ID_CAMERA_EV_0,
        STR_ID_CAMERA_EV_P1,
#ifdef __CAMERA_FEATURE_EV_2__
        STR_ID_CAMERA_EV_P2,
#endif
#ifdef __CAMERA_FEATURE_EV_3__
        STR_ID_CAMERA_EV_P3,
#endif
#ifdef __CAMERA_FEATURE_EV_4__
        STR_ID_CAMERA_EV_P4,
#endif
};
#endif /* __CAMERA_FEATURE_EV__ */ 
                    
#ifdef __CAMERA_FEATURE_NIGHT__
static const U16 g_camera_il_night_select_str[] =
{
#ifdef __CAMERA_FEATURE_NIGHT__
    STR_ID_CAMERA_NIGHT_OFF,
    STR_ID_CAMERA_NIGHT_ON,
#endif        
};
#endif /* __CAMERA_FEATURE_NIGHT__ */ 
                    
#ifdef __CAMERA_FEATURE_AE_METER__
static const U16 g_camera_il_ae_meter_select_str[] =
    {
#ifdef __CAMERA_FEATURE_AE_METER_AUTO__
        STR_ID_CAMERA_AE_METER_AUTO,
#endif
#ifdef __CAMERA_FEATURE_AE_METER_SPOT__
        STR_ID_CAMERA_AE_METER_SPOT,
#endif
#ifdef __CAMERA_FEATURE_AE_METER_CENTER__
        STR_ID_CAMERA_AE_METER_CENTER,
#endif
#ifdef __CAMERA_FEATURE_AE_METER_AVERAGE__
        STR_ID_CAMERA_AE_METER_AVERAGE,
#endif
    };
#endif /* __CAMERA_FEATURE_AE_METER__ */ 
                    
#ifdef __CAMERA_FEATURE_CONTRAST__
static const U16 g_camera_il_contrast_select_str[] =
{
    STR_ID_CAMERA_CONTRAST_HIGH,
    STR_ID_CAMERA_CONTRAST_MEDIUM,
    STR_ID_CAMERA_CONTRAST_LOW,
};
#endif /* __CAMERA_FEATURES_CONTRAST__ */
                    
#ifdef __CAMERA_FEATURE_BANDING__
static const U16 g_camera_il_banding_select_str[] =
{
#ifdef __CAMERA_FEATURE_BANDING__
    STR_ID_CAMERA_BANDING_50HZ,
    STR_ID_CAMERA_BANDING_60HZ,
#endif
};
#endif /* __CAMERA_FEATURE_BANDING__ */ 
                    
#ifdef __CAMERA_DSC_MODE__
static const U16 g_camera_il_dsc_mode_select_str[] =
{
	#ifdef __CAMERA_DSC_MODE_AUTO__
	  STR_ID_CAMERA_DSC_MODE_AUTO,
	#endif
	#ifdef __CAMERA_DSC_MODE_SHUTTER_PRI__
        STR_ID_CAMERA_DSC_MODE_SHUTTER_PRI,
    #endif
    #ifdef __CAMERA_DSC_MODE_APERTURE_PRI__
        STR_ID_CAMERA_DSC_MODE_APERTURE_PRI,
    #endif
    #ifdef __CAMERA_DSC_MODE_PORTRAIT__
       STR_ID_CAMERA_DSC_MODE_PORTRAIT,
    #endif
    #ifdef __CAMERA_DSC_MODE_LANDSCAPE__
       STR_ID_CAMERA_DSC_MODE_LANDSCAPE,
    #endif
    #ifdef __CAMERA_DSC_MODE_SPORT__
        STR_ID_CAMERA_DSC_MODE_SPORT,
    #endif
    #ifdef __CAMERA_DSC_MODE_FLOWER__
        STR_ID_CAMERA_DSC_MODE_FLOWER,
    #endif
    #ifdef __CAMERA_DSC_MODE_NIGHT__
       STR_ID_CAMERA_DSC_MODE_NIGHT,
    #endif
	#ifdef __CAMERA_FEATURE_ISO_SUPPORT__
        STR_ID_CAMERA_ISO,
    #endif
	};
#endif

#ifdef __CAMERA_FEATURE_WB__
static const U16 g_camera_il_wb_select_str[] =
{
	#ifdef __CAMERA_FEATURE_WB_AUTO__
        STR_ID_CAMERA_WB_AUTO,
    #endif
    #ifdef __CAMERA_FEATURE_WB_DAYLIGHT__
        STR_ID_CAMERA_WB_DAYLIGHT,
    #endif
    #ifdef __CAMERA_FEATURE_WB_TUNGSTEN__
        STR_ID_CAMERA_WB_TUNGSTEN,
    #endif
    #ifdef __CAMERA_FEATURE_WB_FLUORESCENT__
        STR_ID_CAMERA_WB_FLUORESCENT,
    #endif
    #ifdef __CAMERA_FEATURE_WB_CLOUD__
        STR_ID_CAMERA_WB_CLOUD,
    #endif
    #ifdef __CAMERA_FEATURE_WB_INCANDESCENCE__
        STR_ID_CAMERA_WB_INCANDESCENCE,
    #endif
    #ifdef __CAMERA_FEATURE_WB_MANUAL__
        STR_ID_CAMERA_WB_MANUAL,
    #endif
};
#endif


#ifdef __CAMERA_FEATURE_DELAY_TIMER__
static const U16 g_camera_il_delay_timer_select_str[] =
{
    STR_ID_CAMERA_DELAY_TIMER_OFF,
    STR_ID_CAMERA_DELAY_TIMER_1,
#ifdef __CAMERA_FEATURE_DELAY_TIMER_2__
    STR_ID_CAMERA_DELAY_TIMER_2,
#endif
#ifdef __CAMERA_FEATURE_DELAY_TIMER_3__
    STR_ID_CAMERA_DELAY_TIMER_3,
#endif
};
#endif /* __CAMERA_FEATURE_DELAY_TIMER__ */ 
                    
#ifdef __CAMERA_FEATURE_CONT_SHOT__
static const U16 g_camera_il_cont_shot_select_str[] =
{
    STR_ID_CAMERA_CONT_SHOT_OFF,
    STR_ID_CAMERA_CONT_SHOT_1,
#ifdef __CAMERA_FEATURE_CONT_SHOT_2__
    STR_ID_CAMERA_CONT_SHOT_2,
#endif
#ifdef __CAMERA_FEATURE_CONT_SHOT_3__
    STR_ID_CAMERA_CONT_SHOT_3,
#endif
#ifdef __CAMERA_FEATURE_CONT_SHOT_BURST__
    STR_ID_CAMERA_CONT_SHOT_BURST,
#endif
#ifdef __CAMERA_FEATURE_CONT_SHOT_TILE__
    STR_ID_CAMERA_CONT_SHOT_TILE,
#endif
};
#endif /* __CAMERA_FEATURE_CONT_SHOT__ */ 

static const camera_setting_inline_item_struct g_camera_il_camera_items[] = 
{
#ifdef __CAMERA_FEATURE_FLASH__
    {
        STR_ID_CAMERA_FLASH,
        &g_camera_cntx.setting.flash,
        g_camera_il_flash_select_str,
        sizeof(g_camera_il_flash_select_str)/sizeof(U16)
        
    },
#endif

#ifdef __CAMERA_FEATURE_LED_HIGHLIGHT__
    {
        STR_ID_CAMERA_LED_HIGHLIGHT,
        &g_camera_cntx.setting.led_highlight,
        g_camera_il_led_hightlight_select_str,
        sizeof(g_camera_il_led_hightlight_select_str)/sizeof(U16)
        
    },
#endif

#ifdef __CAMERA_FEATURE_SHUTTER_SOUND__
    {
        STR_ID_CAMERA_SHUTTER_SOUND,
        &g_camera_cntx.setting.shutter_sound,
        g_camera_il_shutter_sound_select_str,
        sizeof(g_camera_il_shutter_sound_select_str)/sizeof(U16)
        
    },
#endif

#ifdef __CAMERA_FEATURE_EV__
    {
        STR_ID_CAMERA_EV,
        &g_camera_cntx.setting.ev,
        g_camera_il_ev_select_str,
        sizeof(g_camera_il_ev_select_str)/sizeof(U16)
        
    },
#endif /* __CAMERA_FEATURE_EV__ */ 

#ifdef __CAMERA_FEATURE_NIGHT__
    {
        STR_ID_CAMERA_NIGHT,
        &g_camera_cntx.setting.night,
        g_camera_il_night_select_str,
        sizeof(g_camera_il_night_select_str)/sizeof(U16)
        
    },
#endif /* __CAMERA_FEATURE_NIGHT__ */ 

#ifdef __CAMERA_FEATURE_AE_METER__
    {
        STR_ID_CAMERA_AE_METER,
        &g_camera_cntx.setting.ae_meter,
        g_camera_il_ae_meter_select_str,
        sizeof(g_camera_il_ae_meter_select_str)/sizeof(U16)
        
    },
#endif /* __CAMERA_FEATURE_AE_METER__ */ 

#ifdef __CAMERA_FEATURE_CONTRAST__
    {
        STR_ID_CAMERA_CONTRAST,
        &g_camera_cntx.setting.contrast,
        g_camera_il_contrast_select_str,
        sizeof(g_camera_il_contrast_select_str)/sizeof(U16)
        
    },
#endif /* __CAMERA_FEATURES_CONTRAST__ */

#ifdef __CAMERA_FEATURE_BANDING__
    {
        STR_ID_CAMERA_BANDING,
        &g_camera_cntx.setting.banding,
        g_camera_il_banding_select_str,
        sizeof(g_camera_il_banding_select_str)/sizeof(U16)
        
    },
#endif /* __CAMERA_FEATURE_BANDING__ */ 

#ifdef __CAMERA_DSC_MODE__
{
	   STR_ID_CAMERA_DSC_MODE,
	   &g_camera_cntx.setting.dsc_mode,
	   g_camera_il_dsc_mode_select_str,
	   sizeof(g_camera_il_dsc_mode_select_str)/sizeof(U16)
	   
   },
#endif

#ifdef __CAMERA_FEATURE_WB__
	    {
        STR_ID_CAMERA_WB,
        &g_camera_cntx.setting.wb,
        g_camera_il_wb_select_str,
        sizeof(g_camera_il_wb_select_str)/sizeof(U16)
        
    },
#endif


#ifdef __CAMERA_FEATURE_DELAY_TIMER__
    {
        STR_ID_CAMERA_DELAY_TIMER,
        &g_camera_cntx.setting.delay_timer,
        g_camera_il_delay_timer_select_str,
        sizeof(g_camera_il_delay_timer_select_str)/sizeof(U16)
        
    },
#endif /* __CAMERA_FEATURE_DELAY_TIMER__ */ 

#ifdef __CAMERA_FEATURE_CONT_SHOT__
    {
        STR_ID_CAMERA_CONT_SHOT,
        &g_camera_cntx.setting.cont_shot,
        g_camera_il_cont_shot_select_str,
        sizeof(g_camera_il_cont_shot_select_str)/sizeof(U16)
        
    },
#endif /* __CAMERA_FEATURE_CONT_SHOT__ */ 
    {0, NULL, NULL, 0}
};

static const camera_setting_inline_data_struct g_camera_camera_setting = 
{
    STR_ID_CAMERA_CAMERA_SETTING,
    g_camera_il_camera_items
};

void mmi_camera_entry_camera_setting_screen(void)
{
    mmi_camera_entry_setting_inline(&g_camera_camera_setting);
}

#ifndef __MMI_CASCADED_OPTION_MENU__ 

void mmi_camera_entry_forward_screen(void)
{
	MMI_ID menu_gid;
	menu_gid = cui_menu_create(g_camera_cntx.cur_gid, 
							    CUI_MENU_SRC_TYPE_RESOURCE, 
								CUI_MENU_TYPE_FROM_RESOURCE, 
								MENU_ID_CAMERA_FORWARD_OPTION, 
								MMI_TRUE, 
								NULL);
	cui_menu_set_default_title_by_id(menu_gid, STR_GLOBAL_OPTIONS, GetRootTitleIcon(MENU_ID_CAMERA_APP));
	cui_menu_set_default_left_softkey_by_id(menu_gid, STR_GLOBAL_OK);
	cui_menu_set_default_right_softkey_by_id(menu_gid, STR_GLOBAL_BACK);
	cui_menu_run(menu_gid);

}
#endif


#ifdef __CAMERA_FEATURE_RESTORE_DEFAULT__

/*****************************************************************************
*
* Restore Default
*
*****************************************************************************/


/*****************************************************************************
* FUNCTION
*  mmi_camera_entry_restore_default_confirm_yes
* DESCRIPTION
*  restore defualt confirm yes
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
static void mmi_camera_entry_restore_default_confirm_yes(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* restore default values */
    DISPLAY_POPUP_DONE();
    mmi_camera_restore_factory();
    mmi_frm_scrn_close(g_camera_cntx.cur_gid, SCR_ID_CAMERA_OPTION);
}
#endif

#ifdef __CAMERA_FEATURE_RESTORE_DEFAULT__

static mmi_ret mmi_camera_restore_confirmCb(mmi_alert_result_evt_struct *evt)
{
    if (evt->evt_id == EVT_ID_ALERT_QUIT)
    {
        switch (evt->result)
        {
        case MMI_ALERT_CNFM_OK:
            // handle softkey event here
            break;
        case MMI_ALERT_CNFM_YES:
            mmi_camera_entry_restore_default_confirm_yes();
            break;
        case MMI_ALERT_CNFM_NO:
            // handle softkey event here
            mmi_frm_scrn_close_active_id();
            break;
        }
    }
    return MMI_RET_OK;
}
#endif


#ifdef __CAMERA_FEATURE_RESTORE_DEFAULT__

/*****************************************************************************
* FUNCTION
*  mmi_camera_entry_restore_default_confirm_screen
* DESCRIPTION
*  entry restore default confirm screen
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
MOD_API void mmi_camera_entry_restore_default_confirm_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_confirm_property_struct arg;
    mmi_confirm_property_init(&arg, CNFM_TYPE_YESNO);
    arg.callback = (mmi_proc_func)mmi_camera_restore_confirmCb;
    arg.parent_id = g_camera_cntx.cur_gid;
#if defined(__CAMERA_OSD_HORIZONTAL__)
    arg.rotation = (mmi_frm_screen_rotate_enum)g_camera_cntx.osd_data.osd_rotate;
#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 
    mmi_confirm_display_ext(STR_ID_CAMERA_NOTIFY_RESTORE_DEFAULT_CONFIRM, MMI_EVENT_QUERY, &arg);
}

#endif


/*****************************************************************************
*
* Self Capture
*
*****************************************************************************/

#ifdef __CAMERA_FEATURE_SELF_CAPTURE__
/*****************************************************************************
* FUNCTION
*  mmi_camera_set_self_capture
* DESCRIPTION
*  Set self capture
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
MOD_API void mmi_camera_set_self_capture(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_cntx.is_force_self_capture = TRUE;
    mmi_frm_scrn_close_active_id();
}
#endif


/***************************************************************
 *          setting cat11 begin
 ***************************************************************/
typedef struct{
    MMI_ID  scrn_id;
    U16     item_id;
    U16     title_str_id;
    U16     *val_addr;
    U16     *selected_addr;
    S32     (*pre_set_val)(void);   /* return: 0 -- continue set val, else return */
}Category11_data_struct;

static const Category11_data_struct *g_pAct_Cat11_data;
static U16 g_cat11_selected_item;

static void mmi_camera_entry_Category11_screen(void);
static void mmi_camera_cat11_highlight_hdlr(S32 idx);
static void mmi_camera_cat11_set_val(void);

#if 0
#ifdef __CAMERA_FEATURE_WB__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif
/* under construction !*/
#ifdef __CAMERA_DSC_MODE__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#ifdef __CAMERA_AUTOFOCUS_MODE__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* __CAMERA_AUTOFOCUS_MODE__ */ 
/* under construction !*/
#ifdef __CAMERA_DSC_MODE_NIGHT__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif 
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif
#endif

#ifdef __CAMERA_AUTOFOCUS__
static const Category11_data_struct Category11_data_autofocus = {
    SCR_ID_CAMERA_AUTOFOCUS_METERING,
    MENU_ID_CAMERA_AUTOFOCUS_METERING,
    STR_ID_CAMERA_AUTOFOCUS_METERING,
    &g_camera_cntx.setting.af_meter,
    &g_cat11_selected_item,
    NULL
};

void mmi_camera_entry_autofocus_screen(void)
{
    g_pAct_Cat11_data = &Category11_data_autofocus;
    mmi_camera_entry_Category11_screen();
}

#endif

#ifdef __CAMERA_AUTOFOCUS_MODE__
static const Category11_data_struct Category11_data_afmode = {
    SCR_ID_CAMERA_AUTOFOCUS_MODE,
    MENU_ID_CAMERA_AUTOFOCUS_MODE,
    STR_ID_CAMERA_AUTOFOCUS_MODE,
    &g_camera_cntx.setting.af_mode,
    &g_cat11_selected_item,
    NULL
};

void mmi_camera_entry_autofocus_mode_screen(void)
{
    g_pAct_Cat11_data = &Category11_data_afmode;
    mmi_camera_entry_Category11_screen();
}
#endif

#ifdef __CAMERA_FEATURE_EFFECT__
/*****************************************************************************
* FUNCTION
*  mmi_camera_set_effect_setting_value
* DESCRIPTION
*  set effect
* PARAMETERS
*  void
* RETURNS
*  void
*****************************************************************************/
static S32 mmi_camera_set_effect_setting_value(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
    if (g_camera_cntx.selected_effect == CAMERA_SETTING_EFFECT_CUSTOM_FX_1)
    {
        g_camera_custom_fx_cntx.fx_idx = 0;
        mmi_camera_entry_custom_fx_option_screen();
        return 1;
    }
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 
    
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_2__
    if (g_camera_cntx.selected_effect == CAMERA_SETTING_EFFECT_CUSTOM_FX_2)
    {
        g_camera_custom_fx_cntx.fx_idx = 1;
        mmi_camera_entry_custom_fx_option_screen();
        return 1;
    }
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_2__ */ 
    
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_3__
    if (g_camera_cntx.selected_effect == CAMERA_SETTING_EFFECT_CUSTOM_FX_3)
    {
        g_camera_custom_fx_cntx.fx_idx = 2;
        mmi_camera_entry_custom_fx_option_screen();
        return 1;
    }
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_3__ */ 
    
    return 0;
}


static const Category11_data_struct Category11_data_effect = {
    SCR_ID_CAMERA_EFFECT_SETTING,
    MENU_ID_CAMERA_EFFECT_SETTING,
    STR_ID_CAMERA_EFFECT_SETTING,
    &g_camera_cntx.setting.effect,
    &g_camera_cntx.selected_effect,
    mmi_camera_set_effect_setting_value
};

void mmi_camera_entry_effect_setting_screen(void)
{
    g_pAct_Cat11_data = &Category11_data_effect;
    mmi_camera_entry_Category11_screen();
}

#endif

#ifdef __CAMERA_FEATURE_ISO_SUPPORT__
static const Category11_data_struct Category11_data_iso = {
    SCR_ID_CAMERA_ISO,
    MENU_ID_CAMERA_ISO,
    STR_ID_CAMERA_ISO,
    &g_camera_cntx.setting.iso,
    &g_camera_cntx.selected_iso,
    NULL
};

void mmi_camera_entry_iso_screen(void)
{
    g_pAct_Cat11_data = &Category11_data_iso;
    mmi_camera_entry_Category11_screen();
}

#endif

static void mmi_camera_cat11_set_val(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(g_pAct_Cat11_data->pre_set_val){
        if(g_pAct_Cat11_data->pre_set_val()){
            return;
        }
    }
    
    *(g_pAct_Cat11_data->val_addr) = *(g_pAct_Cat11_data->selected_addr);
    mmi_camera_store_setting();
    
    DISPLAY_POPUP_DONE();
    mmi_frm_scrn_close(g_camera_cntx.cur_gid, g_pAct_Cat11_data->scrn_id);
}

static void mmi_camera_cat11_highlight_hdlr(S32 idx)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* set selected effect */
    *(g_pAct_Cat11_data->selected_addr) = idx;
}

static void mmi_camera_entry_Category11_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 ItemList[32];
    U16 nItems;
    U8 *guiBuffer;
    MMI_BOOL entry_ret;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    entry_ret = mmi_frm_scrn_enter (g_camera_cntx.cur_gid, g_pAct_Cat11_data->scrn_id, NULL, mmi_camera_entry_Category11_screen, MMI_FRM_UNKNOW_SCRN);
    if (!entry_ret)
    {
        return;
    }

#if defined(__CAMERA_OSD_HORIZONTAL__) && defined(__MMI_SCREEN_ROTATE__)
    if (g_camera_cntx.osd_data.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }
#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 
    
    guiBuffer = mmi_frm_scrn_get_gui_buf(g_camera_cntx.cur_gid,  g_pAct_Cat11_data->scrn_id);
    
    nItems = GetNumOfChild(g_pAct_Cat11_data->item_id);
    GetSequenceStringIds(g_pAct_Cat11_data->item_id, ItemList);
    SetParentHandler(g_pAct_Cat11_data->item_id);
    
    RegisterHighlightHandler(mmi_camera_cat11_highlight_hdlr);
    
    ShowCategory11Screen(
        g_pAct_Cat11_data->title_str_id,
        GetRootTitleIcon(MENU_ID_CAMERA_APP),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nItems,
        ItemList,
        *(g_pAct_Cat11_data->val_addr),   /* current index */
        guiBuffer);
    
    SetLeftSoftkeyFunction(mmi_camera_cat11_set_val, KEY_EVENT_UP);
    #ifndef __MMI_WGUI_DISABLE_CSK__
    ChangeCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
	#endif
    SetCenterSoftkeyFunction(mmi_camera_cat11_set_val, KEY_EVENT_UP);
    SetRightSoftkeyFunction((mmi_void_funcptr_type)mmi_frm_scrn_close_active_id, KEY_EVENT_UP);
}

#ifdef __MMI_AP_DCM_CAMIMGV__
#pragma arm section code,rodata
#endif

#endif /* defined(__MMI_CAMERA__) && !defined(__MMI_CAMCORDER__) */ 

