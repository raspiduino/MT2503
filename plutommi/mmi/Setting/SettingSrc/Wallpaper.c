/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE. 
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/

/*****************************************************************************
 *
 * Filename:
 * ---------
 * Wallpaper.c
 *
 * Project:
 * --------
 *   MAUI
 *
 * Description:
 * ------------
 *   This file is intends for wallpaper
 *
 * Author:
 * -------
 * -------
 *
 *============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *============================================================================
 ****************************************************************************/

/***************************************************************************** 
* Include
*****************************************************************************/
#include "MMI_features.h"
/*  Include: MMI header file */
#include "FileMgrSrvGProt.h"
#include "SettingProt.h"
#include "WPSSProtos.h"
#include "drm_def.h"
#include "drm_gprot.h"
#include "Mdi_include.h"

#include "PhoneSetup.h"
#include "PhoneSetupGprots.h"
#include "FileMgrGProt.h"
#include "Menucuigprot.h"
#ifdef __MMI_FILE_MANAGER__
#include "Filemgrcuigprot.h"
#endif 

#include "mmi_rp_app_viewsetting_def.h"

#include "Conversions.h"
#include "IdleAppDef.h"

#ifdef __MMI_USB_SUPPORT__
#include "USBDeviceGprot.h"
#include "USBSrvGProt.h"
#endif
#if 0
#if defined(__MMI_OP11_HOMESCREEN_0301__) || defined(__MMI_OP11_HOMESCREEN_0302__)
/* under construction !*/
#endif
#endif
#ifdef __MMI_VUI_HOMESCREEN_WALLPAPER__
#include "vapp_wallpaper_cfg.h"
#include "vapp_wallpaper_content_provider.h"
#endif

#if defined(SYNCML_DM_SUPPORT) && defined(__DM_LAWMO_SUPPORT__)
#include "dmuigprot.h" /* For DM lock check */
#endif /* defined(SYNCML_DM_SUPPORT) && defined(__DM_LAWMO_SUPPORT__) */
#include "SimCtrlSrvGprot.h"
#include "BootupSrvGprot.h"

/* auto add by kw_check begin */
#include "wgui_categories_list.h"
#include "MMIDataType.h"
#include "kal_general_types.h"
#include "mmi_phnset_dispchar.h"
#include "mmi_rp_file_type_def.h"
#include "gui_config.h"
#include "gdi_const.h"
#include "gdi_datatype.h"
#include "mmi_frm_scenario_gprot.h"
#include "mmi_rp_srv_wallpaper_def.h"
#include "CustDataRes.h"
#include "PhoneSetupResList.h"
#include "mmi_rp_app_phonesetting_new_def.h"
#include "kal_public_api.h"
#include "DebugInitDef_Int.h"
#include "GlobalResDef.h"
#include "mmi_frm_events_gprot.h"
#include "AlertScreen.h"
#include "wgui_categories_util.h"
#include "GlobalConstants.h"
#include "wgui_categories_clock.h"
#include "wgui_categories_idlescreen.h"
#include "wgui_include.h"
#include "wgui_categories_multimedia.h"
#include "mmi_frm_input_gprot.h"
#include "Mmi_frm_scenario_gprot.h"
#include "gui_typedef.h"
#include "MMI_common_app_trc.h"
#include "mmi_common_app_trc.h"
#include "kal_trace.h"
#include "nvram_common_defs.h"
#include "mmi_frm_nvram_gprot.h"
#include "mmi_frm_mem_gprot.h"
#include "Unicodexdcl.h"
#include "FileMgrType.h"
#include "mmi_frm_history_gprot.h"
#include "string.h"
#include "gdi_include.h"
#include "fs_func.h"
#include "fs_type.h"
#include "fs_errcode.h"
#include "mmi_rp_srv_phnset_onoff_def.h"
#include "TimerEvents.h"
#include "mmi_frm_timer_gprot.h"
#include "mmi_rp_srv_screensaver_def.h"
#include "gui_data_types.h"
#include "FileMgrResDef.h"
#include "wgui_categories_popup.h"
#include "custom_events_notify.h"
#include "wgui.h"
#include "UcmSrvGprot.h"
#include "stdio.h"
#include "mmi_rp_app_mainmenu_def.h"
#include "stack_config.h"
#include "CustMenuRes.h"
#include "mmi_rp_app_usbsrv_def.h"
/* auto add by kw_check end */
#include "PhnsetProt.h"
#include "USBSrvGprot.h"

#ifdef __MMI_SUB_WALLPAPER__
#include "Wgui_categories_sublcd.h"
#endif
#include "App_str.h"
#include "IdleGprot.h"
#include "ViewSettingCommonProt.h"
#include "phonesetup.h"
#include "mmi_rp_srv_datetime_def.h"
#ifdef __MMI_PHNSET_APPICON_SUPPORT__
#include "mmi_rp_app_setting_appicon_def.h"
#endif
#ifndef __MMI_MAINLCD_96X64__

/***************************************************************************** 
* External Function
*****************************************************************************/

/***************************************************************************** 
* Local Variable
*****************************************************************************/
/* Store END key handler function pointer */
/* When previewing the user define wallpaper & Screen saver */
/* Press END key shall to release file path buffer and execute stored END key handler */
static CHAR* error_str_ptr;
static U8 wp_item_amount;
static U8 wp_sub_menu_type;
#ifdef __MMI_FILE_MANAGER__
static MMI_BOOL save_cache_flag = MMI_FALSE;
#endif

/***************************************************************************** 
* Global Variable
*****************************************************************************/
MMI_ID_TYPE idle_screen_wallpaper_ID;
MMI_ID_TYPE idle_screen_cache_id;  
#ifdef __MMI_VUI_HOMESCREEN_LIVE_WALLPAPER__
#ifndef __MMI_SETTING_HS_LIVEWP_EXT__
   #define  __MMI_SETTING_HS_LIVEWP_EXT__
#endif 
   static VAPP_WALLPAPER_PROVIDER_HANDLE g_provider_handle = NULL;
   #ifdef __MMI_SETTING_HS_LIVEWP_EXT__
   U8 *g_vui_provider_buffer=NULL;
   MMI_ID g_parent_gid=0;
   #endif
   #endif

#if defined (__MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__)
#define INTERACTIVE_VIDEO_WALLPAPER_NUM  50
#define INTERACTIVE_VIDEO_WALLPAPER_HEADER_LEN  50
#define INTERACTIVE_VIDEO_WALLPAPER_FOLDER "@wallpaper_mwp"
#define INTERACTIVE_VIDEO_WALLPAPER_EXT    "mwp"
#define INTERACTIVE_VIDEO_WALLPAPER_EXT_LWP    "lwp"
//#define INTERACTIVE_VIDEO_WALLPAPER_PATH   'E'

typedef enum
{
    INTERACTIVE_WALLPAPER_LWP,
    INTERACTIVE_WALLPAPER_MWP,
    INTERACTIVE_WALLPAPER_INVALID
}phnset_ivlw_type;

typedef struct
{
    WCHAR path_name[FS_MAX_FILE_NAME_LENGTH];
    phnset_ivlw_type mType;
}phnset_ivlw_struct;

static phnset_ivlw_struct *g_ivlw_cntx = NULL; //[INTERACTIVE_VIDEO_WALLPAPER_NUM];
static S32 ivlw_wallpaper_count = 0;
static PU8 g_ivlw_frame_buffer = NULL;
static S32 partition_frame_num = 0;
static S32 partition_frame_index;
static S32 mem_ref_cont = 0;
static pBOOL is_play_ivlw;
S32 is_ivlw_file;
#endif

#if defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__)

S32 is_vlw_file;

#endif


#ifdef __MMI_FILE_MANAGER__
#define MMI_WALLPAPER_DEFAULT_CACHE_DRVIER (SRV_FMGR_PUBLIC_DRV)
#define FMGR_DEFAULT_FOLDER_SETTINGS   "Settings"

static const U16 PHNSET_PREDEFINED_WP_PATH_JPG[] = L"Z:\\@WPCACHE\\UserWP.JPG\0";
static const U16 PHNSET_PREDEFINED_WP_PATH_PBM[] = L"Z:\\@WPCACHE\\UserWP.PBM\0";
static const WCHAR PHNSET_PREDEFINED_WP_PATH[] = L"Z:\\@WPCACHE\\";

#if (!defined(__MMI_VIEW_SETTING_DISABLE_CACHE__) && !defined(__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__)) && !defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__)
static const WCHAR MMI_PHNSET_WALLPAPER_CACHE_FILE_NAME[] = L"\\UserWP_";
#endif

#endif /* __MMI_FILE_MANAGER__ */


/***************************************************************************** 
* Global Function
*****************************************************************************/
#if 0
#ifdef __MMI_WALLPAPER_ON_BOTTOM__
/* under construction !*/
#endif 
#endif
/***************************************************************************** 
* Extern Function
*****************************************************************************/
extern GDI_RESULT gdi_anim_stop_all_by_layer(gdi_handle layer);
/***************************************************************************** 
* Local Function
*****************************************************************************/
#if 0
#if !defined(__MMI_PHNSET_AT_DISABLE__) || !defined(__MMI_PHNSET_WP_SLIM__)||defined(__DAILY_WALLPAPER__)
/* under construction !*/
#endif
#else
#if !defined(__MMI_PHNSET_AT_DISABLE__) || !defined(__MMI_PHNSET_WP_SLIM__)
static U8 PhnsetConstSysWallpaperList(U8 **pSysWallpaperStrList, U16 *pSysWallpaperImgIDList, U16 *HighliteItem);
#endif
#endif //0
static void DispIdleScrWPBadFilePopup(void);
#ifndef __MMI_PHNSET_SLIM__
void mmi_phnset_save_wallpaper_to_speedup(void);
#endif
#if 0
#if defined(__MMI_OP11_HOMESCREEN_0301__) || defined(__MMI_OP11_HOMESCREEN_0302__) || defined(__MMI_OP11_HOMESCREEN__)
/* under construction !*/
/* under construction !*/
#endif
#endif
static mmi_ret mmi_phnset_wallpaper_sub_menu_entry_handler(cui_menu_event_struct *param, MMI_ID parent_gid);
static mmi_ret mmi_phnset_wallpaper_sub_menu_highlight_handler(cui_menu_event_struct *param, MMI_ID parent_gid);
static mmi_ret mmi_phnset_wallpaper_sub_menu_select_handler(cui_menu_event_struct *param, MMI_ID parent_gid);
static void mmi_phnset_init_wallpaper_menu(void);
static void mmi_phnset_wallpaper_entry_main(mmi_id parent_gid);
static mmi_ret mmi_phnset_wallpaper_main_menu_proc(mmi_event_struct *evt);
#ifndef __MMI_PHNSET_WP_SLIM__
static void mmi_phnset_entry_wallpaper_sys_int(mmi_scrn_essential_struct *scrn_data);
#endif
#if 0
#ifdef __DAILY_WALLPAPER__
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif
#endif
#ifdef __MMI_VUI_HOMESCREEN_LIVE_WALLPAPER__
static mmi_ret mmi_phnset_wallpaper_live_wallpaper_proc(mmi_event_struct *evt);
static void mmi_phnset_wallpaper_init_live_wallpaper(void); 
static MMI_BOOL mmi_phnset_wallpaper_set_vui_live_wallpaper_setting(U8 wallpaper_id, VAPP_WALLPAPER_ID_HANDLE id_handle);

#endif 
static void mmi_phnset_wallpaper_init(void);
static void mmi_phnset_wallpaper_update_display(void);
static void mmi_phnset_wallpaper_enter_mass_storage_mode(void);
static void mmi_phnset_wallpaper_exit_mass_storage_mode(void);
static void mmi_phnset_lock_wallpaper_enter_mass_storage_mode(void);
static void mmi_phnset_lock_wallpaper_exit_mass_storage_mode(void);
static void mmi_phnset_wallpaper_reset_to_default(MMI_BOOL update_nvram);
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
static void mmi_phnset_wallpaper_screen_lock_set_static_id(U16 id);
#endif
#ifdef __MMI_SUB_WALLPAPER__
static void mmi_phnset_sub_wallpaper_init(void);
static U16 g_mmi_sub_wallpaper_id;
static void mmi_phnset_sub_wallpaper_reset_to_default(MMI_BOOL update_nvram);
static void mmi_phnset_sub_wallpaper_enter_mass_storage_mode(void);
static void mmi_phnset_sub_wallpaper_exit_mass_storage_mode(void);
static void mmi_phnset_sub_wallpaper_set_static_id(U16 id);
#endif
static U16 g_mmi_wallpaper_id;
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
static U16 g_mmi_wallpaper_sl_id;
#endif /* __MMI_VUI_SCREEN_LOCK_KEY__ */
#ifdef __MMI_FILE_MANAGER__
static mmi_setting_display_cache_file_nvram_struct g_mmi_wallpaper_user_file;
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
static mmi_setting_display_cache_file_nvram_struct g_mmi_wallpaper_sl_user_file;
#endif /* __MMI_VUI_SCREEN_LOCK_KEY__ */
static WCHAR g_mmi_wallpaper_cache_file_name[MMI_SETTING_DISPLAY_CACHE_USER_FILE_NAME_LEN];
#if (!defined(__MMI_VIEW_SETTING_DISABLE_CACHE__) && !defined(__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__)) && !defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__)
CHAR *idle_screen_wallpaper_name = (CHAR*)g_mmi_wallpaper_cache_file_name;
CHAR *idle_screen_cache_name = (CHAR*)g_mmi_wallpaper_cache_file_name;
CHAR *idle_screen_wallpaper_name_original = (CHAR*)g_mmi_wallpaper_cache_file_name;
#else /*(!defined(__MMI_VIEW_SETTING_DISABLE_CACHE__) && !defined(__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__))*/
CHAR *idle_screen_wallpaper_name = (CHAR*)g_mmi_wallpaper_user_file.file_name;
CHAR *idle_screen_cache_name = (CHAR*)g_mmi_wallpaper_user_file.file_name;
CHAR *idle_screen_wallpaper_name_original = (CHAR*)g_mmi_wallpaper_user_file.file_name;
#endif /*(!defined(__MMI_VIEW_SETTING_DISABLE_CACHE__) && !defined(__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__))*/
#ifdef __MMI_SUB_WALLPAPER__
static mmi_setting_display_cache_file_nvram_struct g_mmi_sub_wallpaper_user_file;
static mmi_phnset_wp_ss_pwrdisp_common_filename_struct g_phnset_wallpaper_sub_filename;
CHAR *idle_screen_wallpaper_sub_name = (CHAR *) g_phnset_wallpaper_sub_filename.filename;
#endif
#endif
static void mmi_phnset_wallpapaer_send_changed_notify(mmi_evt_phnset_wallpaper_change_num evt_id);
static void mmi_phnset_wallpaper_entry_sel_type_wallpaper(MMI_ID parent_id);
/*vui main screen*/
#ifdef __MMI_VUI_HOMESCREEN_LIVE_WALLPAPER__
static void mmi_phnset_wallpaper_vuiwallpaper_free_ext(MMI_BOOL is_buffer);
#ifdef __MMI_SETTING_HS_LIVEWP_EXT__
static void mmi_phnset_wallpaper_entry_system_mainscrn(MMI_ID parent_id);//add ligen
void mmi_phnset_wallpaper_vuiwallpaper_exit_by_asm(void);
static void mmi_phnset_wallpaper_vuiwallpaper_asm_alloc_entry(void);
static void mmi_phnset_wallpaper_vuiwallpaper_asm_alloc_entry_2(void);
#endif
#endif
/*****************************************************************************
 * FUNCTION
 *  HintPhnsetWallpaper
 * DESCRIPTION
 *  This function is hint handling function
 *  for Phonesetup -> Display Character -> Wallpaper
 *  Functionality:
 * PARAMETERS
 *  index       [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HintPhnsetWallpaper(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    CHAR* p;
	MMI_ID menu_id;
#ifdef __MMI_VUI_HOMESCREEN_LIVE_WALLPAPER__
	VAPP_WALLPAPER_ID_HANDLE live_wallpaper_id_handle = NULL;
	WCHAR wallpaper_name[VAPP_WALLPAPER_MAX_NAME_LEN + 1] = {0};
#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
	menu_id = MENU_SETTING_WALLPAPER_HOMESCREEN + g_phnset_cntx_p->wpss_type;
#else
	menu_id = MENU_SETTING_WALLPAPER;
#endif

#ifdef __MMI_VUI_HOMESCREEN_LIVE_WALLPAPER__
    live_wallpaper_id_handle = vapp_wallpaper_provider_get_current_live_wallpaper_id_handle((VappWallpaperSrcEnum)(g_phnset_cntx_p->wpss_type));
    vapp_wallpaper_provider_get_live_wallpaper_name_from_wallpaper_id_handle(
                                                                live_wallpaper_id_handle, 
                                                                wallpaper_name, 
                                                                VAPP_WALLPAPER_MAX_NAME_LEN + 1);
    vapp_wallpaper_id_handle_close(live_wallpaper_id_handle);
    live_wallpaper_id_handle = NULL;
    if(NULL != wallpaper_name[0])
	{
        cui_menu_set_item_hint(
            mmi_frm_group_get_active_id(),
            menu_id,
            wallpaper_name);    	
        return;
	}
#endif
    p = PhnsetGetCurWallpaperName();
    if (p)
    {
        cui_menu_set_item_hint(
            mmi_frm_group_get_active_id(),
            menu_id,
            (WCHAR*)p);
    }
}


#ifdef __MMI_SUB_WALLPAPER__
/*****************************************************************************
 * FUNCTION
 *  HintPhnsetSubWallpaper
 * DESCRIPTION
 *  This function is hint handling function
 *  for Phonesetup -> Display -> Wallpaper
 *  Functionality:
 * PARAMETERS
 *  index       [IN]                      
 * RETURNS
 *  void
 *****************************************************************************/
void HintPhnsetSubWallpaper(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    CHAR* name;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    name = PhnsetGetCurSubWallpaperName();
    if (name)
    {
        
        cui_menu_set_item_hint(
            mmi_frm_group_get_active_id(),
            MENU_SETTING_WALLPAPER_SUB,
            (WCHAR*)name);
    }
}


#endif /* __MMI_SUB_WALLPAPER__ */ 

#if 0
#ifdef __DAILY_WALLPAPER__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #ifdef __MMI_SUB_WALLPAPER__
/* under construction !*/
    #endif 
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#else /* __DAILY_WALLPAPER__ */ 
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* __DAILY_WALLPAPER__ */ 
#else

/*****************************************************************************
 * FUNCTION
 *  PhnsetGetCurWallPaperIdx
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
U16 PhnsetGetCurWallPaperIdx(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return mmi_phnset_wallpaper_get_static_id();
}


#endif //0

#if defined (__MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__)
/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetWallpaperSys_ivlw
 * DESCRIPTION
 *  This function is to entry function for Setting->Phonesetup->IdleScreenDisplay->Wallpaper (->Fix) ->System
 *  Functionality: Display ivlw system wallpaper list
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnsetWallpaperSys_ivlw(MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!parent_gid)
	{
	    parent_gid = GRP_ID_ROOT;
	}
    mmi_frm_group_create_ex(
        parent_gid,
        GRP_ID_WALLPAPER_SYSTEM_SUB,
        NULL,
        NULL,
        MMI_FRM_NODE_SMART_CLOSE_FLAG);

    mmi_frm_scrn_first_enter(
        GRP_ID_WALLPAPER_SYSTEM_SUB,
        SCR_WALLPAPER_SYSTEM_LIST,
        (FuncPtr)mmi_phnset_entry_wallpaper_sys_int,
        NULL);
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetWallpaperGetTypeFromFileName
 * DESCRIPTION
 *  Functionality: Get IVLW type
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
int PhnsetWallpaperGetTypeFromFileName(WCHAR* fileName)
{
    WCHAR *ext = (WCHAR*)srv_fmgr_path_get_extension_ptr((WCHAR*)fileName);
    if(0 == mmi_ucs2nicmp((CHAR*)ext, (CHAR*)L"mwp", 3))
    {
        return 1;
    }
    else if(0 == mmi_ucs2nicmp((CHAR*)ext, (CHAR*)L"lwp", 3))
    {
        return 0;
    }
    else
    {
        return -1;
    }
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetWallpaperGetIVLW_num
 * DESCRIPTION
 *  Functionality: Get IVLW list num
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
pBOOL PhnsetWallpaperSupportLWP()
{
    return KAL_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetWallpaperGetnum
 * DESCRIPTION
 *  Functionality: get ivlw files num
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
pBOOL PhnsetWallpaperHasIVLW()
{
    fs_list_param_struct param = {0};
    FS_HANDLE list = NULL;
    FS_Pattern_Struct patterns[2] = {0};
    FS_DOSDirEntry e = {0};
    S32 patternLen, result;
    WCHAR path_buffer[400];
    WCHAR fileName[FS_MAX_FILE_NAME_LENGTH] = {0};
    pBOOL has_vlw = KAL_FALSE;
    S32 batchSize = 1;

    patternLen = sizeof(patterns[0].Pattern) / sizeof(patterns[0].Pattern[0]);

    if(PhnsetWallpaperSupportLWP())
    {
        mmi_wcsncpy(patterns[0].Pattern, (WCHAR*)L"*.mwp", patternLen);
        mmi_wcsncpy(patterns[1].Pattern, (WCHAR*)L"*.lwp", patternLen);
        param.name_pattern_count = 2;
        param.name_pattern = patterns;

        kal_wsprintf(
                path_buffer,
                "%c:\\%s\\%s.%s",
                SRV_FMGR_CARD_DRV,
                INTERACTIVE_VIDEO_WALLPAPER_FOLDER,
                (WCHAR*)L"*",
                (WCHAR*)L"*");
    }
    else
    {
        mmi_wcsncpy(patterns[0].Pattern, (WCHAR*)L"*.mwp", patternLen);
        param.name_pattern_count = 1;
        param.name_pattern = patterns;
        kal_wsprintf(
                path_buffer,
                "%c:\\%s\\%s.%s",
                SRV_FMGR_CARD_DRV,
                INTERACTIVE_VIDEO_WALLPAPER_FOLDER,
                (WCHAR*)L"*",
                INTERACTIVE_VIDEO_WALLPAPER_EXT);
    }

    param.index = 0;
    param.buff_size = FS_LIST_SIZE(batchSize);
    param.path = (kal_wchar *)path_buffer;

    param.buff = OslMalloc(param.buff_size);

    if(param.buff == NULL)
    {
        ASSERT(0);
    }

    result = FS_ListOpen(&param, &list); 
    if(result >= 0 && list > 0)
    {
        #ifdef __MTK_TARGET__
        result = FS_ListNext(list, &e, param.path, (WCHAR*)fileName, FS_MAX_FILE_NAME_LENGTH, 0);
        #else  //__MTK_TARGET__
        result = FS_ListNext(list, &e, NULL, (WCHAR*)fileName, FS_MAX_FILE_NAME_LENGTH, 0);
        #endif  //__MTK_TARGET__
        if(result >= FS_NO_ERROR)
        {
            has_vlw = KAL_TRUE;            
        }
        else
        {
            has_vlw = KAL_FALSE;
        }
    }
    

    FS_ListClose(list);
    list = NULL;
    OslMfree(param.buff);
    return has_vlw;
    
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetWallpaperGetIVLW_num
 * DESCRIPTION
 *  Functionality: Get IVLW list num
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetWallpaperGetIVLW_num()
{
    fs_list_param_struct param = {0};
    FS_HANDLE list = NULL;
    FS_Pattern_Struct patterns[2] = {0};
    FS_DOSDirEntry e = {0};
    S32 patternLen, result, i;
    S32 batchSize = 5;
    WCHAR path_buffer[400];
    WCHAR fileName[FS_MAX_FILE_NAME_LENGTH] = {0};
    WCHAR *ext;

    patternLen = sizeof(patterns[0].Pattern) / sizeof(patterns[0].Pattern[0]);

    if(PhnsetWallpaperSupportLWP())
    {
        mmi_wcsncpy(patterns[0].Pattern, (WCHAR*)L"*.mwp", patternLen);
        mmi_wcsncpy(patterns[1].Pattern, (WCHAR*)L"*.lwp", patternLen);
        param.name_pattern_count = 2;
        param.name_pattern = patterns;

        kal_wsprintf(
                path_buffer,
                "%c:\\%s\\%s.%s",
                SRV_FMGR_CARD_DRV,
                INTERACTIVE_VIDEO_WALLPAPER_FOLDER,
                (WCHAR*)L"*",
                (WCHAR*)L"*");
    }
    else
    {
        mmi_wcsncpy(patterns[0].Pattern, (WCHAR*)L"*.mwp", patternLen);
        param.name_pattern_count = 1;
        param.name_pattern = patterns;
        kal_wsprintf(
                path_buffer,
                "%c:\\%s\\%s.%s",
                SRV_FMGR_CARD_DRV,
                INTERACTIVE_VIDEO_WALLPAPER_FOLDER,
                (WCHAR*)L"*",
                INTERACTIVE_VIDEO_WALLPAPER_EXT);
    }

    param.index = 0;
    param.buff_size = FS_LIST_SIZE(batchSize);
    param.path = (kal_wchar *)path_buffer;

    param.buff = OslMalloc(param.buff_size);

    if(param.buff == NULL)
    {
        ASSERT(0);
    }

    ivlw_wallpaper_count = 0;

    if(g_ivlw_cntx == NULL)
    {
        g_ivlw_cntx = mmi_frm_asm_alloc_r(mmi_frm_group_get_active_id(),sizeof(phnset_ivlw_struct)*INTERACTIVE_VIDEO_WALLPAPER_NUM);
    }
    
    if(g_ivlw_cntx == NULL)
    {
        ASSERT(0);
    }

    mem_ref_cont++;
    ivlw_wallpaper_count = 0;
    memset(g_ivlw_cntx,0,sizeof(phnset_ivlw_struct)*INTERACTIVE_VIDEO_WALLPAPER_NUM);
    
    for(result = FS_ListOpen(&param, &list); 
        result >= 0 && list > 0 && ivlw_wallpaper_count < INTERACTIVE_VIDEO_WALLPAPER_NUM;
        #ifdef __MTK_TARGET__
        FS_ListReload(&param, &list)
        #endif
        )
    {
        for(i = 0; i < batchSize; i++)
        {
            #ifdef __MTK_TARGET__
            result = FS_ListNext(list, &e, param.path, (WCHAR*)fileName, FS_MAX_FILE_NAME_LENGTH, i);
            #else  //__MTK_TARGET__
            result = FS_ListNext(list, &e, NULL, (WCHAR*)fileName, FS_MAX_FILE_NAME_LENGTH, i);
            #endif  //__MTK_TARGET__
            if(result >= FS_NO_ERROR)
            {
                if(PhnsetWallpaperGetTypeFromFileName((WCHAR*)fileName) == 1)
                {
                    g_ivlw_cntx[ivlw_wallpaper_count].mType = INTERACTIVE_WALLPAPER_MWP;
                }
                else if(PhnsetWallpaperGetTypeFromFileName((WCHAR*)fileName) == 0)
                {
                    g_ivlw_cntx[ivlw_wallpaper_count].mType = INTERACTIVE_WALLPAPER_LWP;
                }
                else
                {
                    ASSERT(0);
                }

                /*Get display name*/
                ext = (WCHAR*)srv_fmgr_path_get_extension_ptr((WCHAR*)fileName);
                if(ext && ext > fileName)
                {
                    --ext;
                    *ext = NULL;
                }
                
                mmi_ucs2cpy((CHAR *)g_ivlw_cntx[ivlw_wallpaper_count].path_name, (CHAR *)srv_fmgr_path_get_filename_ptr(fileName));
                
                ivlw_wallpaper_count++;            
            }
            else
            {
                break;
            }
        }

        #ifndef __MTK_TARGET__
        // MoDIS can only search once.
        break;
        #endif
    }

    FS_ListClose(list);
    list = NULL;
    OslMfree(param.buff);
    
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetWallpaperRedraw
 * DESCRIPTION
 *  Functionality: redraw callback
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetWallpaperRedraw()
{
    S32 header_len;
    WCHAR path_buffer[400];
    gdi_handle h1;
    partition_frame_index++;

    if(partition_frame_index >= partition_frame_num)
    {
        partition_frame_index = 0;
    }

    if(g_ivlw_cntx[g_phnset_cntx_p->curHightlightItem].mType == INTERACTIVE_WALLPAPER_LWP)
    {
        kal_wsprintf(
                    path_buffer,
                    "%c:\\%s\\",
                    SRV_FMGR_CARD_DRV,
                    INTERACTIVE_VIDEO_WALLPAPER_FOLDER);
        mmi_ucs2cat((CHAR *)path_buffer, (CHAR *)g_ivlw_cntx[g_phnset_cntx_p->curHightlightItem].path_name);
        mmi_ucs2cat((CHAR *)path_buffer, (CHAR *)L".lwp\0");
    }
    else
    {
        kal_wsprintf(
                    path_buffer,
                    "%c:\\%s\\",
                    SRV_FMGR_CARD_DRV,
                    INTERACTIVE_VIDEO_WALLPAPER_FOLDER);
        mmi_ucs2cat((CHAR *)path_buffer, (CHAR *)g_ivlw_cntx[g_phnset_cntx_p->curHightlightItem].path_name);
        mmi_ucs2cat((CHAR *)path_buffer, (CHAR *)L".mwp\0");    
    }

		if(is_play_ivlw == KAL_TRUE)
		{
        header_len = mmi_applist_interactive_video_wallpaper_query_frame_buffer(partition_frame_index, g_ivlw_frame_buffer);

        if(header_len != -1)
        {
            //draw ivlw file to base layer
            gdi_layer_get_blt_layer(&h1, NULL, NULL, NULL);
            gdi_layer_push_and_set_active(h1);
            dm_change_image(g_ivlw_frame_buffer + header_len,NULL,0);
            gdi_layer_pop_and_restore_active();
            RedrawCategoryFunction();
            gui_start_timer(40,PhnsetWallpaperRedraw);
        }
        else
        {
            gui_cancel_timer(PhnsetWallpaperRedraw);
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetWallpaperRedraw
 * DESCRIPTION
 *  Functionality: redraw callback
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
S32 PhnsetWallpaperCompWPname(S32 highlight_index)
{
    CHAR path_buffer[400];
    if(g_ivlw_cntx[highlight_index].mType == INTERACTIVE_WALLPAPER_LWP)
    {
        kal_wsprintf(
                (WCHAR *)path_buffer,
                "%c:\\%s\\",
                SRV_FMGR_CARD_DRV,
                INTERACTIVE_VIDEO_WALLPAPER_FOLDER);
        mmi_ucs2cat((CHAR *)path_buffer, (CHAR *)g_ivlw_cntx[highlight_index].path_name);
        mmi_ucs2cat((CHAR *)path_buffer, (CHAR *)L".lwp\0");
    }
    else
    {
        kal_wsprintf(
                (WCHAR *)path_buffer,
                "%c:\\%s\\",
                SRV_FMGR_CARD_DRV,
                INTERACTIVE_VIDEO_WALLPAPER_FOLDER);
        mmi_ucs2cat((CHAR *)path_buffer, (CHAR *)g_ivlw_cntx[highlight_index].path_name);
        mmi_ucs2cat((CHAR *)path_buffer, (CHAR *)L".mwp\0");    
        }
    return mmi_wcscmp((WCHAR *)path_buffer, (WCHAR *)idle_screen_wallpaper_name);
}

#endif


/*****************************************************************************
 * FUNCTION
 *  PhnsetConstSysWallpaperList
 * DESCRIPTION
 *  This function is to construct wallpaper system folder list,
 *  for Setting->Phonesetup->IdleScreenDisplay->Wallpaper (->Fix) ->System
 * PARAMETERS
 *  pSysWallpaperStrList        [IN]            
 *  pSysWallpaperImgIDList      [?]             
 *  HighliteItem                [?]             
 *  a(?)                        [IN/OUT]        Void
 *  b(?)                        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
#if 0
#if !defined(__MMI_PHNSET_AT_DISABLE__) || !defined(__MMI_PHNSET_WP_SLIM__)||defined(__DAILY_WALLPAPER__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#ifdef __MMI_SWFLASH__
/* under construction !*/
#endif
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
		#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
/* under construction !*/
		#endif
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#ifdef __MMI_THEMES_V2_SUPPORT__
/* under construction !*/
#endif
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
        #if defined(__MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
        #endif
/* under construction !*/
		#if defined( __MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__) || defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__)
/* under construction !*/
/* under construction !*/
#ifndef __MMI_MAINLCD_96X64__		
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif            
/* under construction !*/
/* under construction !*/
		#endif /* __MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__ */
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
            #if !defined(__MMI_UI_TECHNO_IDLESCREEN_BAR__)
/* under construction !*/
            #ifdef __MMI_ANALOG_CLOCK__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
            #endif /* __MMI_ANALOG_CLOCK__ */ 
/* under construction !*/
            #ifdef __MMI_DIGITAL_CLOCK__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
            #endif /* __MMI_DIGITAL_CLOCK__ */ 
/* under construction !*/
            #endif /* !__MMI_UI_TECHNO_IDLESCREEN_BAR__ */ 
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#ifdef __MMI_SWFLASH__        
/* under construction !*/
#endif
/* under construction !*/
/* under construction !*/
#ifdef __MMI_SUB_WALLPAPER__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* __MMI_SUB_WALLPAPER__ */ 
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif
/* under construction !*/
#else  //0
#if !defined(__MMI_PHNSET_AT_DISABLE__) || !defined(__MMI_PHNSET_WP_SLIM__)
static U8 PhnsetConstSysWallpaperList(U8 **pSysWallpaperStrList, U16 *pSysWallpaperImgIDList, U16 *HighliteItem)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 i, wp_max = 0;
    U16 strID = 0, imgID = 0;
    U8 index_other = 0;
#ifdef __MMI_SWFLASH__
    U8 index_swflash = 0;
#endif
    U8 index_img = 0;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    /*
     * SYSTEM WALLPAPER
     */
    if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_WP
		#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
		|| g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_SL_WP
		#endif
		)
    {
        U8 max_wp_img = MAX_WALLPAPER_IMG - MAX_OTHER_WALLPAPER - MAX_DISPCHAR_SWFLASH;
        U8 max_wp_other = MAX_OTHER_WALLPAPER;
        U8 max_wp_swflash = MAX_DISPCHAR_SWFLASH;

		/* video wallpaper feature */
		U8 max_wp_video = MAX_VIDEO_WALLPAPER;
		
#ifdef __MMI_THEMES_V2_SUPPORT__
        max_wp_other --;                /* when theme screen saver valid delete screen saver image id */         
#endif
        /* Layout
         * 
         *
         * -- Normal Images --
         * -- Normal Images -- SVG
         * -- Normal Images -- M3D
         * -- Analog clock  --
         * -- Digital clock --
         * -- Theme         --
         * -- SWFLASH        --
         * 
         */
         
        /* 
         * Build-in images
         */
        #if defined(__MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__)
        if(wp_sub_menu_type == PHNSET_WALLPAPER_IVLW_SYSTEM)
        {
            PhnsetWallpaperGetIVLW_num();
            for(i = 0; i < ivlw_wallpaper_count;i++)
            {
                if (pSysWallpaperStrList)
                {
	                pSysWallpaperStrList[i] = (PU8) g_ivlw_cntx[i].path_name;
	            }

	            if (pSysWallpaperImgIDList)
	            {
	                pSysWallpaperImgIDList[i] = IMG_ID_PHNSET_MAX;
	            }
	            
	            if (HighliteItem && (PhnsetWallpaperCompWPname(i) == 0))
	            {
	                *HighliteItem = i;
	                g_phnset_cntx_p->curHightlightItem = i;
	            }	
            }
            wp_max = ivlw_wallpaper_count;
        }
        else
        #endif
        
		#if defined( __MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__) || defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__)
		if(wp_sub_menu_type == PHNSET_WALLPAPER_VIDEO_SYSTEM)
		{
#ifndef __MMI_MAINLCD_96X64__		
			for(i = 0; i < max_wp_video; i++)
        {
				imgID = IMG_ID_VIDEO_WP_START + i;
				strID = STR_ID_PHNSET_DISPCHAR_VDOID_START + i;
				if (pSysWallpaperImgIDList)
	            {
	                pSysWallpaperImgIDList[i] = imgID;
	            }

	            if (pSysWallpaperStrList)
        {
	                pSysWallpaperStrList[i] = (PU8) GetString(strID);
	            }

	            if (HighliteItem && mmi_phnset_wallpaper_get_static_id() == imgID)
	            {
	                *HighliteItem = i;
	                g_phnset_cntx_p->curHightlightItem = i;
	            }
				else
        {
					*HighliteItem = 0;
				}	
			}
			wp_max = i;
#endif            
			}
			else
		#endif /* __MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__ */
		if(wp_sub_menu_type == PHNSET_WALLPAPER_STATIC_SYSTEM)
            {
	        for (i = 0; i < (max_wp_img + max_wp_other + max_wp_swflash); i++)
            {
				/* video wallpaper feature */
				if (i < max_wp_img)
            {
	                imgID = IMG_ID_PHNSET_WP_START + i;
            }
            else if (max_wp_other &&
	                     i >= max_wp_img && 
	                     i < (max_wp_img + max_wp_other))
            {
	                imgID = IMG_ID_DISPCHAR_OTHER_START + (i - max_wp_img) + 1;
            }
            else if(max_wp_swflash)
            {
	                imgID = IMG_ID_DISPCHAR_SWFLASH_START + (i - (max_wp_img + max_wp_other));
            }

            /* normal/SVG/M3D  images*/
            if (imgID >= IMG_ID_PHNSET_WP_START && imgID <= IMG_ID_PHNSET_WP_MAX)
            {
                strID = STR_ID_PHNSET_DISPCHAR_IMGID_START + index_img;
                ++index_img;
            }
            else if ( imgID > IMG_ID_DISPCHAR_OTHER_START && imgID < IMG_ID_DISPCHAR_OTHER_MAX)
            {

            #if !defined(__MMI_UI_TECHNO_IDLESCREEN_BAR__)
            
            #ifdef __MMI_ANALOG_CLOCK__
                /* Analog clock */
                if (imgID == IMG_ID_DISPCHAR_ANALOG_CLK)
                {
                    strID = STR_ID_PHNSET_DISPCHAR_ANALOG;
                }
            #endif /* __MMI_ANALOG_CLOCK__ */ 
            
            #ifdef __MMI_DIGITAL_CLOCK__
                /* Digital clock */
                if (imgID == IMG_ID_DISPCHAR_DIGITAL_CLK)
                {
                    strID = STR_ID_PHNSET_DISPCHAR_DIGITAL;
                }
            #endif /* __MMI_DIGITAL_CLOCK__ */ 
            
            #endif /* !__MMI_UI_TECHNO_IDLESCREEN_BAR__ */ 
            
                if (imgID == IMG_ID_DISPCHAR_THEME_WALLPAPER)
                {
                    strID = STR_ID_DISPCHAR_THEME_WALLPAPER;
                }

                ++index_other;
            }

            if (pSysWallpaperImgIDList)
            {
                pSysWallpaperImgIDList[i] = imgID;
            }

            if (pSysWallpaperStrList)
            {
                pSysWallpaperStrList[i] = (PU8) GetString(strID);
            }

            if (HighliteItem && mmi_phnset_wallpaper_get_static_id() == pSysWallpaperImgIDList[i])
            {
                *HighliteItem = i;
                g_phnset_cntx_p->curHightlightItem = i;
            }
        }
        wp_max = i;

        MMI_ASSERT(index_other == max_wp_other);
#ifdef __MMI_SWFLASH__        
        MMI_ASSERT(index_swflash == max_wp_swflash);
#endif
		}
    }/* Main Wallpaper */
#ifdef __MMI_SUB_WALLPAPER__
    else if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_SUB_WP)
    {
        for (i = 0; i < MAX_SUB_WALLPAPER_IMG; i++)
        {
            strID = STR_ID_PHNSET_DISPCHAR_IMGID_START + i;

            if (pSysWallpaperImgIDList)
            {
                pSysWallpaperImgIDList[i] = IMG_ID_PHNSET_SUB_WP_START + i;
            }

            if (pSysWallpaperStrList)
            {
                pSysWallpaperStrList[i] = (PU8) GetString(strID);
            }

            if (HighliteItem)
                if (g_mmi_sub_wallpaper_id == pSysWallpaperImgIDList[i])
                {
                    *HighliteItem = i;
                    g_phnset_cntx_p->curHightlightItem = i;
                }

        }
        wp_max = i;
    }
#endif /* __MMI_SUB_WALLPAPER__ */ 
    else
    {
        MMI_ASSERT(0);
    }

    return (wp_max);

}
#endif

#endif   //0

/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetWallpaperSys
 * DESCRIPTION
 *  This function is to entry function for Setting->Phonesetup->IdleScreenDisplay->Wallpaper (->Fix) ->System
 *  Functionality: Display system wallpaper list
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnsetWallpaperSys(MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    if (!parent_gid)
	{
	    parent_gid = GRP_ID_ROOT;
	}

	mmi_frm_group_create_ex(
        parent_gid,
        GRP_ID_WALLPAPER_SYSTEM_SUB,
        mmi_phnset_wallpaper_main_menu_proc,
        NULL,
        MMI_FRM_NODE_SMART_CLOSE_FLAG);
#ifndef __MMI_PHNSET_WP_SLIM__
    mmi_frm_scrn_first_enter(
        GRP_ID_WALLPAPER_SYSTEM_SUB,
        SCR_WALLPAPER_SYSTEM_LIST,
        (FuncPtr)mmi_phnset_entry_wallpaper_sys_int,
        NULL);
#else
      #ifdef __MMI_SUB_WALLPAPER__   
            if(g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_SUB_WP)
             {
                g_phnset_cntx_p->SysWPSSList[0] = IMG_ID_PHNSET_SUB_WP_START;
             }
            else
         #endif       
             { 
			    wp_sub_menu_type = PHNSET_WALLPAPER_STATIC_SYSTEM;
                g_phnset_cntx_p->SysWPSSList[0] = IMG_ID_PHNSET_WP_START;
             }
      g_phnset_cntx_p->curHightlightItem = 0;
      EntryPhnsetWallpaperSysView();
#endif
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_entry_wallpaper_sys_int
 * DESCRIPTION
 *  Internal entry function for wall paper system menu 
 * PARAMETERS
 *  
 * RETURNS
 *  static void
 *****************************************************************************/
#ifndef __MMI_PHNSET_WP_SLIM__

void mmi_phnset_exit_wallpaper_sys_init(void)
{
#if defined (__MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__)
    mem_ref_cont--;
    if(mem_ref_cont == 0)
    {
        if(g_ivlw_cntx != NULL)
        {
            mmi_frm_asm_free_r(mmi_frm_group_get_active_id(),g_ivlw_cntx);
            g_ivlw_cntx = NULL;
        }
    }
#endif
}


static void mmi_phnset_entry_wallpaper_sys_int(mmi_scrn_essential_struct *scrn_data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;
#ifdef __MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__
    U8 is_interactive_video_wallpaper = 0;
    //S16 error;
#endif
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_scrn_enter(
            scrn_data->group_id,
            scrn_data->scrn_id,
            mmi_phnset_exit_wallpaper_sys_init,
            (FuncPtr)mmi_phnset_entry_wallpaper_sys_int,
            MMI_FRM_FULL_SCRN))
    {
        guiBuffer = mmi_frm_scrn_get_gui_buf(scrn_data->group_id, scrn_data->scrn_id);

        RegisterHighlightHandler(PhnsetWallpaperSysHiliteHandler);
        
		g_phnset_cntx_p->curHightlightItem = 0;
        wp_item_amount = PhnsetConstSysWallpaperList(
                            subMenuDataPtrs,
                            g_phnset_cntx_p->SysWPSSList,
                            (U16*) & (g_phnset_cntx_p->curHightlightItem));

#ifdef __MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__
        //ReadValue(NVRAM_PHNSET_IVLW_WALLPAPER, &is_interactive_video_wallpaper, DS_BYTE, &error);
		ReadValueSlim(NVRAM_PHNSET_IVLW_WALLPAPER, &is_interactive_video_wallpaper, DS_BYTE);
        if(wp_item_amount == 0)
        {
            mmi_frm_scrn_close_active_id();
            return ;  
        }
#endif
        if (mmi_phnset_wallpaper_get_static_id() == 0)
        {
#ifdef __MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__
            if(is_interactive_video_wallpaper == 1)
            {
                //Do nothing
            }
            else
#endif
            {
                g_phnset_cntx_p->curHightlightItem = 0;
            }
        }

        EnableCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
        
        ShowCategory36Screen(
            STR_GLOBAL_SELECT,
            IMG_SCR_SETTING_CAPTION,
            STR_GLOBAL_VIEW,
            0,
            STR_GLOBAL_BACK,
            IMG_GLOBAL_BACK,
            wp_item_amount,
            subMenuDataPtrs,
            (U16) g_phnset_cntx_p->curHightlightItem,
            guiBuffer);

        SetLeftSoftkeyFunction(EntryPhnsetWallpaperSysView, KEY_EVENT_UP);
        SetCenterSoftkeyFunction(EntryPhnsetWallpaperSysView, KEY_EVENT_UP);

        //SetRightSoftkeyFunction(mmi_frm_scrn_close_active_id, KEY_EVENT_UP);
    }    
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetWallpaperSysHiliteHandler
 * DESCRIPTION
 *  This function is Highlight hanlder when scrolling at wallpaper list screen
 *  for Setting->Phonesetup->IdleScreenDisplay->Wallpaper (->Fix) ->System
 * PARAMETERS
 *  nIndex      [IN]            
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetWallpaperSysHiliteHandler(S32 nIndex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#if defined (__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__) || defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__) || defined (__MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__)
	U16 wallpaperId = g_phnset_cntx_p->SysWPSSList[nIndex];
#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (nIndex > wp_item_amount - MAX_DISPCHAR_SWFLASH - 1
#if defined (__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__) || defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__)
		|| (wallpaperId >= IMG_ID_VIDEO_WP_START && wallpaperId <= IMG_ID_VIDEO_WP_MAX)
#endif /* __MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__ */
#if defined (__MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__)
        || (wallpaperId == IMG_ID_PHNSET_MAX)
#endif /* __MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__ */
		)
        ChangeLeftSoftkey(STR_GLOBAL_PLAY, 0);
    else
        ChangeLeftSoftkey(STR_GLOBAL_VIEW, 0);

    g_phnset_cntx_p->curHightlightItem = (U16) nIndex;
}
#endif


/*****************************************************************************
 * FUNCTION
 *  PhnsetWallpaperViewBack
 * DESCRIPTION
 *  This function is back function to exit wallpaper preview
 *  for Setting->Phonesetup->IdleScreenDisplay->Wallpaper (->Fix) ->System/Download -> View ->Back
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
 void PhnsetWallpaperViewBack()
 {
#if defined (__MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__)
    gui_cancel_timer(PhnsetWallpaperRedraw);
#endif    
    mmi_frm_scrn_close_active_id();
 }


/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetWallpaperSysView
 * DESCRIPTION
 *  This function is Entry function to preview wallpaper
 *  for Setting->Phonesetup->IdleScreenDisplay->Wallpaper (->Fix) ->System/Download -> View
 *  Follow functions: PhnsetWallpaperSysViewPre
 *  PhnsetWallpaperSysViewNext
 *  PhnsetWallpaperSet
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnsetWallpaperSysView(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    PU8 wallpaperName;
    U8 *guiBuffer;
    U16 wallpaperId = g_phnset_cntx_p->SysWPSSList[g_phnset_cntx_p->curHightlightItem];

#if defined (__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__) || defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__)
	U16 strID;
#endif
#if defined (__MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__)
    WCHAR path_buffer[400];
    S32 header_len;
    pBOOL need_to_play = KAL_FALSE;
    is_play_ivlw = KAL_FALSE;   
#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    g_phnset_cntx_p->isCorrectSet = 0;
#if defined (__MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__)
    mem_ref_cont++;
#endif

    mmi_phnset_enter_switch_screen();

    guiBuffer = mmi_frm_scrn_get_gui_buf(GRP_ID_WALLPAPER_SYSTEM, mmi_frm_scrn_get_active_id());
        
    wallpaperName = (PU8) PhnsetGetWallpaperNameById(wallpaperId);
#ifndef __MMI_PHNSET_WP_SLIM__
    wgui_set_touch_title_bar_buttons(); /* enable the display of title bar buttons */

#if defined(__MMI_TOUCH_SCREEN__)
    register_touch_button_handlers(NULL, PhnsetWallpaperSysViewPre, NULL, PhnsetWallpaperSysViewNext);
#endif 
#endif 

#if defined (__MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__)
    if(wallpaperId == IMG_ID_PHNSET_MAX)
    {
        if(g_ivlw_cntx == NULL)
        {
            GoBackHistory();
            mem_ref_cont++;
            return ;
        }
        
        if(g_ivlw_frame_buffer == NULL)
        {
            g_ivlw_frame_buffer = mmi_frm_asm_alloc_r(mmi_frm_group_get_active_id(),LCD_WIDTH * LCD_HEIGHT * 2 + INTERACTIVE_VIDEO_WALLPAPER_HEADER_LEN);
        }
        
        if(g_ivlw_frame_buffer == NULL)
        {
            ASSERT(0);
        }

        partition_frame_index = 0;

        if(g_ivlw_cntx[g_phnset_cntx_p->curHightlightItem].mType == INTERACTIVE_WALLPAPER_LWP)
        {
            kal_wsprintf(
                    path_buffer,
                    "%c:\\%s\\",
                    SRV_FMGR_CARD_DRV,
                    INTERACTIVE_VIDEO_WALLPAPER_FOLDER);
            mmi_ucs2cat((CHAR *)path_buffer, (CHAR *)g_ivlw_cntx[g_phnset_cntx_p->curHightlightItem].path_name);
            mmi_ucs2cat((CHAR *)path_buffer, (CHAR *)L".lwp\0");
        }
        else
        {
            kal_wsprintf(
                    path_buffer,
                    "%c:\\%s\\",
                    SRV_FMGR_CARD_DRV,
                    INTERACTIVE_VIDEO_WALLPAPER_FOLDER);
            mmi_ucs2cat((CHAR *)path_buffer, (CHAR *)g_ivlw_cntx[g_phnset_cntx_p->curHightlightItem].path_name);
            mmi_ucs2cat((CHAR *)path_buffer, (CHAR *)L".mwp\0");    
        }

        is_play_ivlw = KAL_TRUE;
        
        partition_frame_num = mmi_applist_interactive_video_wallpaper_open_query_partition_num((PU8)path_buffer);

        if(partition_frame_num != 0)
        {
            wallpaperName = (PU8)g_ivlw_cntx[g_phnset_cntx_p->curHightlightItem].path_name;
        
            header_len = mmi_applist_interactive_video_wallpaper_query_frame_buffer(partition_frame_index, g_ivlw_frame_buffer);

            if(header_len < 0)
            {
                need_to_play = KAL_FALSE;
            }
            else
            {
                need_to_play = KAL_TRUE;
            }
        }
        else
        {
            need_to_play = KAL_FALSE;
        }

        EnableCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
        //wgui_softkey_disable_text_translucence();  
        
        if(need_to_play == KAL_FALSE)
        {
            ShowCategory129ScreenInternal(
                (UI_string_type)wallpaperName,
                0,
                STR_GLOBAL_OK,
                STR_GLOBAL_BACK,
                0,
                guiBuffer,
                NULL,
                0);
            //Exit category screen, display popup
            mmi_popup_display_simple_ext(STR_GLOBAL_UNSUPPORTED_FORMAT,MMI_EVENT_FAILURE, GRP_ID_ROOT, NULL);
            //GoBackHistory();

            if (mmi_frm_scrn_is_present(GRP_ID_VIEW_SETTING_FILE_COMMON_PREVIEW, SCR_ID_VIEW_SETTING_COMMON_FILE_PREVIEW, MMI_FRM_NODE_ALL_FLAG))
            {
                mmi_frm_scrn_close(GRP_ID_VIEW_SETTING_FILE_COMMON_PREVIEW, SCR_ID_VIEW_SETTING_COMMON_FILE_PREVIEW);
            } 

                    /* Close wallpaper system view screen */
            #ifndef __MMI_MAINLCD_96X64__        
            if (mmi_frm_scrn_is_present(GRP_ID_WALLPAPER_SYSTEM_SUB, SCR_WALLPAPER_VIEW, MMI_FRM_NODE_ALL_FLAG))
    	    {
                mmi_frm_scrn_close(GRP_ID_WALLPAPER_SYSTEM_SUB, SCR_WALLPAPER_VIEW);
    	    }            
            if (mmi_frm_scrn_is_present(GRP_ID_WALLPAPER_SYSTEM_SUB, SCR_WALLPAPER_VIEW_2, MMI_FRM_NODE_ALL_FLAG))
    	    {
                mmi_frm_scrn_close(GRP_ID_WALLPAPER_SYSTEM_SUB, SCR_WALLPAPER_VIEW_2);
    	    }                        
            #endif        
            /* Close screen saver system view screen */
            #ifdef __MMI_SCREEN_SAVER__        
            if (mmi_frm_scrn_is_present(GRP_ID_SCREENSAVER_SYSTEM, SCR_SCREENSAVER_VIEW, MMI_FRM_NODE_ALL_FLAG))
    	    {
                mmi_frm_scrn_close(GRP_ID_SCREENSAVER_SYSTEM, SCR_SCREENSAVER_VIEW);
    	    }            
            if (mmi_frm_scrn_is_present(GRP_ID_SCREENSAVER_SYSTEM, SCR_SCREENSAVER_VIEW_2, MMI_FRM_NODE_ALL_FLAG))
    	    {
                mmi_frm_scrn_close(GRP_ID_SCREENSAVER_SYSTEM, SCR_SCREENSAVER_VIEW_2);
    	    }              
            #endif        

            #ifdef __MMI_POWER_ON_OFF_DISPLAY__
            if (mmi_frm_scrn_is_present(GRP_ID_POWER_ON_OFF_SYSTEM, SCR_ID_PHNSET_POWER_OFF_SYSTEM_VIEW, MMI_FRM_NODE_ALL_FLAG))
    	    {
                mmi_frm_scrn_close(GRP_ID_POWER_ON_OFF_SYSTEM, SCR_ID_PHNSET_POWER_OFF_SYSTEM_VIEW);
    	    }            
            if (mmi_frm_scrn_is_present(GRP_ID_POWER_ON_OFF_SYSTEM, SCR_ID_PHNSET_POWER_OFF_SYSTEM_VIEW_2, MMI_FRM_NODE_ALL_FLAG))
    	    {
                mmi_frm_scrn_close(GRP_ID_POWER_ON_OFF_SYSTEM, SCR_ID_PHNSET_POWER_OFF_SYSTEM_VIEW_2);
    	    }   
            if (mmi_frm_scrn_is_present(GRP_ID_POWER_ON_OFF_SYSTEM, SCR_ID_PHNSET_POWER_ON_SYSTEM_VIEW, MMI_FRM_NODE_ALL_FLAG))
    	    {
                mmi_frm_scrn_close(GRP_ID_POWER_ON_OFF_SYSTEM, SCR_ID_PHNSET_POWER_ON_SYSTEM_VIEW);
    	    }            
            if (mmi_frm_scrn_is_present(GRP_ID_POWER_ON_OFF_SYSTEM, SCR_ID_PHNSET_POWER_ON_SYSTEM_VIEW_2, MMI_FRM_NODE_ALL_FLAG))
    	    {
                mmi_frm_scrn_close(GRP_ID_POWER_ON_OFF_SYSTEM, SCR_ID_PHNSET_POWER_ON_SYSTEM_VIEW_2);
    	    }               
            #endif  
            DisableLeftSoftkey(STR_GLOBAL_OK, NULL);
            DisableRightSoftkey(STR_GLOBAL_BACK, NULL);
        
            return ;
        }
        else
        {
            ShowCategory129ScreenInternal(
                (UI_string_type)wallpaperName,
                0,
                STR_GLOBAL_OK,
                STR_GLOBAL_BACK,
                0,
                guiBuffer,
                g_ivlw_frame_buffer + header_len,
                1);
            gui_start_timer(40,PhnsetWallpaperRedraw);
        }
    }
    else
#endif 
#if !defined(__MMI_UI_TECHNO_IDLESCREEN_BAR__)
#ifdef __MMI_ANALOG_CLOCK__
    /* Category 86 if to View the Analog Clock */
    if ((wallpaperId == IMG_ID_DISPCHAR_ANALOG_CLK))
    {
        EnableCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
        ShowCategory86Screen(
            STR_ID_PHNSET_DISPCHAR_ANALOG,
            0,
            STR_GLOBAL_OK,
            IMG_GLOBAL_OK,
            STR_GLOBAL_BACK,
            IMG_GLOBAL_BACK,
            IMG_ID_DISPCHAR_ANALOG_CLK,
            guiBuffer);
    }
    else
#endif /* __MMI_ANALOG_CLOCK__ */ 

#ifdef __MMI_DIGITAL_CLOCK__
        /* Category 128 to view Digital Clock */
    if (wallpaperId == IMG_ID_DISPCHAR_DIGITAL_CLK)
    {
        EnableCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
        ShowCategory128Screen(
            STR_ID_PHNSET_DISPCHAR_DIGITAL,
            0,
            STR_GLOBAL_OK,
            IMG_GLOBAL_OK,
            STR_GLOBAL_BACK,
            IMG_GLOBAL_BACK,
            IMG_ID_DISPCHAR_DIGITAL_CLK,
            guiBuffer);
    }
    else
#endif /* __MMI_DIGITAL_CLOCK__ */ 
#endif /* !__MMI_UI_TECHNO_IDLESCREEN_BAR__ */

    if (wallpaperId == IMG_ID_DISPCHAR_THEME_WALLPAPER)
    {
        EnableCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
        ShowCategory130Screen(
            wallpaperName,
            0,
            STR_GLOBAL_OK,
            IMG_GLOBAL_OK,
            STR_GLOBAL_BACK,
            IMG_GLOBAL_BACK,
            guiBuffer);
    }
#if defined (__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__) || defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__)/* video wallpaper feature */
	else if(wallpaperId >= IMG_ID_VIDEO_WP_START && wallpaperId <= IMG_ID_VIDEO_WP_MAX)
	{
		mmi_frm_start_scenario(MMI_SCENARIO_ID_HIGH_SCRN);
		strID = STR_ID_PHNSET_DISPCHAR_VDOID_START + wallpaperId - IMG_ID_VIDEO_WP_START;
		EnableCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
        //wgui_softkey_disable_text_translucence();
		wgui_cat225_set_preview_vlw_scenario();/* notify vdo current wallpaper file is preview */
		ShowCategory225Screen(
            strID,                /* title_str */
            0,                          /* title_icon */
            STR_GLOBAL_OK,              /* lsk_str */
            IMG_GLOBAL_OK,              /* lsk_icon */
            STR_GLOBAL_BACK,            /* rsk_str */
            IMG_GLOBAL_BACK,            /* rsk_icon */
            wallpaperId,                /* video_id */
            NULL,                       /* video_filename */
            0,                          /* repeat_count */
            TRUE,                       /* is_visual_update */
            MMI_FALSE,   				/* is_play_audio */
            TRUE,                       /* is_lcd_no_sleep */
            GDI_COLOR_BLACK,            /* bg_color */
            mmi_phnset_view_setting_common_video_play_callback, /* callback */
            guiBuffer);                 /* gui_buffer */

	}
#endif/* __MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__  */
    else
     /* For Normal Viewing */
    {
        EnableCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
        //wgui_softkey_disable_text_translucence();
        ShowCategory129Screen(
            wallpaperName,
            0,
            STR_GLOBAL_OK,
            IMG_GLOBAL_OK,
            STR_GLOBAL_BACK,
            IMG_GLOBAL_BACK,
            wallpaperId,
            guiBuffer);
    }

    SetLeftSoftkeyFunction(PhnsetWallpaperSet, KEY_EVENT_UP);
    SetCenterSoftkeyFunction(PhnsetWallpaperSet, KEY_EVENT_UP);
    SetRightSoftkeyFunction(PhnsetWallpaperViewBack, KEY_EVENT_UP);
    //SetRightSoftkeyFunction(mmi_frm_scrn_close_active_id, KEY_EVENT_UP);

    /* change the key handler for KEY UP event to KEY DOWN event. */
#ifndef __MMI_PHNSET_WP_SLIM__ 
    mmi_frm_send_incomplete_key_event_to_new_screen(MMI_TRUE); /* for handle long press LNK and RNK */    
    SetKeyHandler(PhnsetWallpaperSysViewPre, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(PhnsetWallpaperSysViewPre, KEY_LEFT_ARROW, KEY_REPEAT);    
    SetKeyHandler(PhnsetWallpaperSysViewPre, KEY_LEFT_ARROW, KEY_LONG_PRESS);        
    SetKeyHandler(PhnsetWallpaperSysViewNext, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(PhnsetWallpaperSysViewNext, KEY_RIGHT_ARROW, KEY_REPEAT);    
    SetKeyHandler(PhnsetWallpaperSysViewNext, KEY_RIGHT_ARROW, KEY_LONG_PRESS);        
#endif    
}


/*****************************************************************************
 * FUNCTION
 *  ExitPhnsetWallpaperSysView
 * DESCRIPTION
 *  This function is Exit function for preview wallpaper
 *  for Setting->Phonesetup->IdleScreenDisplay->Wallpaper (->Fix) ->System/Download -> View
 *  Functionality: Add to history
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void ExitPhnsetWallpaperSysView(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#if defined (__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__) || defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__)
	U16 wallpaperId;
#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined (__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__) || defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__)
     wallpaperId = g_phnset_cntx_p->SysWPSSList[g_phnset_cntx_p->curHightlightItem];

	if(wallpaperId >= IMG_ID_VIDEO_WP_START && wallpaperId <= IMG_ID_VIDEO_WP_MAX)
	{		
		mmi_frm_end_scenario(MMI_SCENARIO_ID_HIGH_SCRN);
	}
#endif

#if defined (__MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__)
    mem_ref_cont--;
    if(mem_ref_cont == 0)
    {
        if(is_play_ivlw == KAL_TRUE)
        {
            gui_cancel_timer(PhnsetWallpaperRedraw);
            mmi_applist_interactive_video_wallpaper_query_close();
        }
        if(g_ivlw_frame_buffer != NULL)
        {
            mmi_frm_asm_free_r(mmi_frm_group_get_active_id(), g_ivlw_frame_buffer);
            g_ivlw_frame_buffer = NULL;
        }

        if(g_ivlw_cntx != NULL)
        {
            mmi_frm_asm_free_r(mmi_frm_group_get_active_id(),g_ivlw_cntx);
            g_ivlw_cntx = NULL;
        }
    }
    is_play_ivlw = KAL_FALSE;
#endif

    if (g_phnset_cntx_p->isCorrectSet)
    {
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
        mmi_frm_group_close(GRP_ID_WALLPAPER_SYSTEM_SUB);
		mmi_frm_group_close(GRP_ID_WALLPAPER_HOME_WALLPAPER + g_phnset_cntx_p->wpss_type);
#else
		mmi_frm_group_close(GRP_ID_WALLPAPER_MAIN);
#endif
    }
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetWallpaperSysViewPre
 * DESCRIPTION
 *  This function is to view previous wallpaper
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
#ifndef __MMI_PHNSET_WP_SLIM__
void PhnsetWallpaperSysViewPre(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined (__MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__)
    if(is_play_ivlw == KAL_TRUE)
    {
        gui_cancel_timer(PhnsetWallpaperRedraw);
        mmi_applist_interactive_video_wallpaper_query_close();
    }
#endif
    ExitCategoryFunction();
    if (g_phnset_cntx_p->curHightlightItem <= 0)
    {
        if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_WP
		#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
			|| g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_SL_WP
		#endif
			)
        {
            g_phnset_cntx_p->curHightlightItem = wp_item_amount;
        }
    #ifdef __MMI_SUB_WALLPAPER__
        else if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_SUB_WP)
        {
            g_phnset_cntx_p->curHightlightItem = MAX_SUB_WALLPAPER_IMG;
        }
    #endif /* __MMI_SUB_WALLPAPER__ */ 
        else
        {
            MMI_ASSERT(MMI_FALSE);
        }
    }

    g_phnset_cntx_p->curHightlightItem--;
    EntryPhnsetWallpaperSysView();
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetWallpaperSysViewNext
 * DESCRIPTION
 *  This function is to view next wallpaper
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetWallpaperSysViewNext(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined (__MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__)
    if(is_play_ivlw == KAL_TRUE)
    {
        gui_cancel_timer(PhnsetWallpaperRedraw);
        mmi_applist_interactive_video_wallpaper_query_close();
    }
#endif
    ExitCategoryFunction();
    if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_WP
	#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
		|| g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_SL_WP
	#endif
		)
    {
        if (wp_item_amount && (g_phnset_cntx_p->curHightlightItem >= wp_item_amount - 1))
        {
            g_phnset_cntx_p->curHightlightItem = -1;
        }
    }
#ifdef __MMI_SUB_WALLPAPER__
    else if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_SUB_WP)
    {
        if (g_phnset_cntx_p->curHightlightItem >= MAX_SUB_WALLPAPER_IMG - 1)
        {
            g_phnset_cntx_p->curHightlightItem = -1;
        }
    }
#endif /* __MMI_SUB_WALLPAPER__ */ 
    else
    {
        MMI_ASSERT(0);
    }

    g_phnset_cntx_p->curHightlightItem++;
    EntryPhnsetWallpaperSysView();
}
#endif

/*****************************************************************************
 * FUNCTION
 *  PhnsetWallpaperSet
 * DESCRIPTION
 *  This function is Left softkey handler for set/preview wallpaper
 *  Functionality: Save to nvram, change globol variable gCurrentWallpaper
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetWallpaperSet(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined (__MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__)
    gui_cancel_timer(PhnsetWallpaperRedraw);
    //mmi_applist_interactive_video_wallpaper_query_close();
#endif
    PhnsetSetWallpaperByImgID(g_phnset_cntx_p->SysWPSSList[g_phnset_cntx_p->curHightlightItem]);

#ifdef __MMI_SUB_WALLPAPER__
    if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_SUB_WP)
    {
        SUBLCD_RedrawCategoryFunction();

        MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_SET_SUB_WP_ID, g_mmi_sub_wallpaper_id);
    }
#endif /* __MMI_SUB_WALLPAPER__ */ 

    g_phnset_cntx_p->isCorrectSet = 1;

    mmi_popup_display_simple_ext(STR_GLOBAL_DONE, MMI_EVENT_SUCCESS, GRP_ID_ROOT, NULL);
#if 0
#if defined(__MMI_OP11_HOMESCREEN_0301__) || defined(__MMI_OP11_HOMESCREEN_0302__)
/* under construction !*/
#endif
#endif
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
	mmi_frm_group_close(GRP_ID_WALLPAPER_SYSTEM_SUB);
	mmi_frm_group_close(GRP_ID_WALLPAPER_HOME_WALLPAPER + g_phnset_cntx_p->wpss_type);
#else
	mmi_frm_group_close(GRP_ID_WALLPAPER_MAIN);
#endif

}


/*****************************************************************************
 * FUNCTION
 *  ThemeManagerSetWallpaper
 * DESCRIPTION
 *  ...
 *  * PARAMETERS
 *  a  IN/OUT      void
 *  b  IN       void
 * RETURNS
 *  void
 *****************************************************************************/
void ThemeManagerSetWallpaper(U16 nId)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	
	wp_sub_menu_type = PHNSET_WALLPAPER_STATIC_SYSTEM;
    mmi_phnset_wallpaper_set_static_id(nId);

#ifdef __MMI_FILE_MANAGER__
    if (nId == 0)
    {
        mmi_phnset_wallpaper_update_display();
    }
#endif /* __MMI_FILE_MANAGER__ */

    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_SET_THEME_WP_ID, mmi_phnset_wallpaper_get_static_id());
}



/*****************************************************************************
 * FUNCTION
 *  DispIdleScrWPBadFilePopup
 * DESCRIPTION
 *  This function is call back function for showcategories33screen,
 *  If display user defined image got problem in idle screen, this function will be executed
 *  Follow functions:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
static void DispIdleScrWPBadFilePopup(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (error_str_ptr)
    {
		mmi_popup_display_simple((WCHAR*) error_str_ptr, MMI_EVENT_FAILURE, GRP_ID_ROOT, NULL);
    }
    else
    {
		mmi_popup_display_simple_ext(STR_WP_IDLE_WP_DECODE_ERR, MMI_EVENT_FAILURE, GRP_ID_ROOT, NULL);
    }
    error_str_ptr = NULL;

}


/*****************************************************************************
 * FUNCTION
 *  PhnsetWallpaperBadFileCallBack
 * DESCRIPTION
 *  This function is call back function for showcategories33screen,
 *  If display user defined image got problem in idle screen, this function will be executed
 *  Follow functions:
 * PARAMETERS
 *  imgID       [IN]            
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetWallpaperBadFileCallBack(U16 strID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (strID)
        error_str_ptr = (CHAR*)GetString(strID);
    else
        error_str_ptr = NULL;
    
    StartTimer(IDLE_SHOW_BADFILE_WARNING_TIMER, 100, PhnsetRstWallpaperDefault);

    /* g_phnset_cntx_p->wpss_type = MMI_PHNSET_TYPE_WP; */
}


#ifdef __MMI_SUB_WALLPAPER__
/*****************************************************************************
 * FUNCTION
 *  PhnsetWallpaperSubBadFileCallBack
 * DESCRIPTION
 *  
 * PARAMETERS
 *  imgID       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetWallpaperSubBadFileCallBack(U16 imgID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    error_str_ptr = NULL;
    StartTimer(IDLE_SHOW_SUB_BADFILE_WARNING_TIMER, 1000, PhnsetRstSubWallpaperDefault);

    /* g_phnset_cntx_p->wpss_type = MMI_PHNSET_TYPE_SUB_WP; */

}

#endif /* __MMI_SUB_WALLPAPER__ */ 

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_lock_wallpaper_bad_file_callback
 * DESCRIPTION
 *  This function is call back function for showcategories33screen,
 *  If display user defined image got problem in lock screen, this function will be executed
 *  Follow functions:
 * PARAMETERS
 *  imgID       [IN]            
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            Void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_phnset_lock_wallpaper_bad_file_callback(U16 strID)
{
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (strID)
        error_str_ptr = (CHAR*)GetString(strID);
    else
        error_str_ptr = NULL;
    
	if (!srv_bootup_is_booting() 
#if defined(SYNCML_DM_SUPPORT) && defined(__DM_LAWMO_SUPPORT__)        
		&& !mmi_dmui_is_phone_lock()
#endif
		)
	{
	
		StartTimer(IDLE_SHOW_BADFILE_WARNING_TIMER, 100, DispIdleScrWPBadFilePopup);
		
	}
	g_mmi_wallpaper_sl_id = RstGetWallpaperImgIdDefault();

	wp_sub_menu_type = 0;
	mmi_phnset_wallpaper_screen_lock_set_static_id(g_mmi_wallpaper_sl_id);

#endif /* __MMI_VUI_SCREEN_LOCK_KEY__ */ 
    /* g_phnset_cntx_p->wpss_type = MMI_PHNSET_TYPE_WP; */
}

/*****************************************************************************
 * FUNCTION
 *  PhnsetGetDisplayType
 * DESCRIPTION
 *  
 * PARAMETERS
 *  id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
PHNSET_TYPE_DISP PhnsetGetDisplayType(U16 id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if ((id >= IMG_ID_PHNSET_WP_START && id <= IMG_ID_PHNSET_WP_MAX)
#ifdef __MMI_SUB_WALLPAPER__
        || (id >= IMG_ID_PHNSET_SUB_WP_START && id <= IMG_ID_PHNSET_SUB_WP_MAX)
#endif 
        || (id >= IMG_ID_PHNSET_SS_START && id <= IMG_ID_PHNSET_SS_MAX)
#if !defined(__MMI_UI_TECHNO_IDLESCREEN_BAR__)
#ifdef __MMI_ANALOG_CLOCK__
        || (id == IMG_ID_DISPCHAR_ANALOG_CLK)
#endif 
#ifdef __MMI_DIGITAL_CLOCK__
        || (id == IMG_ID_DISPCHAR_DIGITAL_CLK)
#endif 
#endif /* !__MMI_UI_TECHNO_IDLESCREEN_BAR__ */
        || (id == IMG_ID_DISPCHAR_THEME_WALLPAPER)
#ifdef __MMI_THEMES_V2_SUPPORT__
        || (id == IMG_ID_DISPCHAR_THEME_SCREENSAVER)
#endif 
#ifdef __MMI_POWER_ON_OFF_DISPLAY__
        || (id >= IMG_ID_PHNSET_ON_START && id <= IMG_ID_PHNSET_ON_MAX)
        || (id >= IMG_ID_PHNSET_OFF_START && id <= IMG_ID_PHNSET_OFF_MAX)
#else /* __MMI_POWER_ON_OFF_DISPLAY__ */ 
        || (id == IMG_ID_PHNSET_ON_ANIMATION_DEFAULT) || (id == IMG_ID_PHNSET_OFF_ANIMATION_DEFAULT)
#endif /* __MMI_POWER_ON_OFF_DISPLAY__ */ 
#ifdef __MMI_DOWNLOADABLE_APP_ICON_FW_SUPPORT__
        || (id == IMG_ID_APP_LIST_THEME_WALLPAPER_0)
#endif
        )
    {
        return PHNSET_TYPE_DISP_IMAGE;
    }
#ifdef __MMI_SWFLASH__
    else if (id >= IMG_ID_DISPCHAR_SWFLASH_START && id <= IMG_ID_DISPCHAR_SWFLASH_MAX)
    {
        return PHNSET_TYPE_DISP_SWFLASH;
    }
#endif
#if defined(__MMI_VIDEO_PLAY_SUPPORT__) && defined(__MTK_TARGET__)
    else if ((id >= IMG_ID_PHNSET_SS_VDO_START && id <= IMG_ID_PHNSET_SS_VDO_MAX)
#ifdef __MMI_POWER_ON_OFF_DISPLAY__
             || (id >= IMG_ID_PHNSET_ON_VDO_START && id <= IMG_ID_PHNSET_ON_VDO_MAX)
             || (id >= IMG_ID_PHNSET_OFF_VDO_START && id <= IMG_ID_PHNSET_OFF_VDO_MAX)
#endif /* __MMI_POWER_ON_OFF_DISPLAY__ */ 
#if defined (__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__) || defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__)
             || (id >= IMG_ID_VIDEO_WP_START && id <= IMG_ID_VIDEO_WP_MAX)
#endif /* __MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__ */
        )
        return PHNSET_TYPE_DISP_VIDEO;
#endif /* defined(__MMI_VIDEO_PLAY_SUPPORT__) && defined(__MTK_TARGET__) */ 
    else if (id == 0x00)
    {
        return PHNSET_TYPE_DISP_USER;
    }
    else
    {
        return PHNSET_TYPE_DISP_INVALID;
    }
}

/* 
 * Externel Interfaces
 */


/*****************************************************************************
 * FUNCTION
 *  PhnsetRstWallpaperDefault
 * DESCRIPTION
 *  This function is to set wallpaper to default one
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            ImageId
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetRstWallpaperDefault(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!srv_bootup_is_booting() 
#if defined(SYNCML_DM_SUPPORT) && defined(__DM_LAWMO_SUPPORT__)        
        && !mmi_dmui_is_phone_lock()
#endif
        )
    {
        DispIdleScrWPBadFilePopup();
    }

    mmi_phnset_wallpaper_reset_to_default(MMI_TRUE);

    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_RST_WP_DEFAULT, 0);
}

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpapaer_send_changed_notify
 * DESCRIPTION
 *  update wallpaper display to notify idle
 * PARAMETERS
 *  
 * RETURNS
 *  U16
 *****************************************************************************/
static void mmi_phnset_wallpapaer_send_changed_notify(mmi_evt_phnset_wallpaper_change_num evt_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 	mmi_event_struct evt;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_FRM_INIT_EVENT(&evt, evt_id);
    MMI_FRM_CB_EMIT_EVENT((mmi_event_struct *)&evt);
}

#ifdef __MMI_SUB_WALLPAPER__

/*****************************************************************************
 * FUNCTION
 *  PhnsetRstSubWallpaperDefault
 * DESCRIPTION
 *  This function is to set sub wallpaper to default one
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void
 *  b(?)        [IN]            ImageId
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetRstSubWallpaperDefault(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_phnset_sub_wallpaper_reset_to_default(MMI_TRUE);
    if (!srv_bootup_is_booting())
    {
        DispIdleScrWPBadFilePopup();
        mmi_phnset_wallpapaer_send_changed_notify(EVT_ID_PHNSET_SUBWALLPAPER_CHANGED_NOTIFY);
    }
    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_RST_SUBWP_DEFAULT,
                         g_mmi_sub_wallpaper_id);
}
#endif /* __MMI_SUB_WALLPAPER__ */ 


/*****************************************************************************
 * FUNCTION
 *  PhnsetReadWallpaper
 * DESCRIPTION
 *  This function is to Read wallpaper from Nvram, and set as current wallpaper
 *  Functionality: Referenced at InitNvramData when bootup
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void *
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetReadWallpaper(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_phnset_wallpaper_init();
    
#ifdef __MMI_SUB_WALLPAPER__
    mmi_phnset_sub_wallpaper_init();
#endif /* __MMI_SUB_WALLPAPER__ */ 
}

/*****************************************************************************
 * FUNCTION
 *  PhnsetGetCurWallpaperName
 * DESCRIPTION
 *  This function is to get current name string pointer of wallpaper
 *  Functionality: ex: Referenced by hint windows
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void *
 *  b(?)        [IN]            
 * RETURNS
 *  PS8 wallpaper name string pointer
 *****************************************************************************/
CHAR* PhnsetGetCurWallpaperName(void)
{
#ifdef __MMI_FILE_MANAGER__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined(__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__) || defined(__MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__)
    if(mmi_factory_get_favorite_type(mmi_idle_get_cfg_table()) == MMI_IDLE_TYPE_CLASSIC)
    {
        #ifdef __MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__
        if(is_vlw_file == 1)
        {
            return PhnsetGetWallpaperNameById(IMG_ID_PHNSET_WP_START);
        }
        #endif

        #ifdef __MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__
        if(is_ivlw_file == 1)
        {
            return PhnsetGetWallpaperNameById(IMG_ID_PHNSET_WP_START);
        }
        #endif
    }
#endif

    if (mmi_phnset_wallpaper_get_static_id() == 0)
    {
        MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_GET_CUR_WP_NAME, 0);
        return (CHAR*)mmi_phnset_view_setting_util_get_file_name_ptr(mmi_phnset_wallpaper_get_user_file());
    }
    else
#endif /* __MMI_FILE_MANAGER__ */ 
        return PhnsetGetWallpaperNameById(mmi_phnset_wallpaper_get_static_id());
}

#ifdef __MMI_SUB_WALLPAPER__


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetCurSubWallpaperName
 * DESCRIPTION
 *  This function is to get current name string pointer of sublcd wallpaper
 *  Functionality: ex: Referenced by hint windows
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void *
 *  b(?)        [IN]            
 * RETURNS
 *  PS8 wallpaper name string pointer
 *****************************************************************************/
CHAR* PhnsetGetCurSubWallpaperName(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_mmi_sub_wallpaper_id == 0)
    {
        MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_GET_CUR_SUBWP_NAME, g_phnset_wallpaper_sub_filename.filename);

        return (CHAR*)mmi_phnset_view_setting_util_get_file_name_ptr(g_phnset_wallpaper_sub_filename.filename);
    }
    else
    {
        return PhnsetGetWallpaperNameById(g_mmi_sub_wallpaper_id);
    }
}
#endif /* __MMI_SUB_WALLPAPER__ */ 


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetWallpaperNameById
 * DESCRIPTION
 *  This function is to translate image ID to name string pointer
 *  Functionality: ex: Referenced by hint windows
 * PARAMETERS
 *  Id          [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            U16 image ID
 * RETURNS
 *  Wallpaper Name as PS8 passed as U16 as its ID
 *****************************************************************************/
CHAR* PhnsetGetWallpaperNameById(U16 Id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    CHAR* pstr = NULL;
    U32 strID;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (Id >= IMG_ID_PHNSET_WP_START && Id <= IMG_ID_PHNSET_WP_MAX)
    {
        /* System Wallpaper Range */
        strID = STR_ID_PHNSET_DISPCHAR_IMGID_START + (Id - IMG_ID_PHNSET_WP_START);
        pstr = GetString((U16) strID);
    }
#ifdef __MMI_SUB_WALLPAPER__
    else if (Id >= IMG_ID_PHNSET_SUB_WP_START && Id <= IMG_ID_PHNSET_SUB_WP_MAX)
    {
        strID = STR_ID_PHNSET_DISPCHAR_IMGID_START + (Id - IMG_ID_PHNSET_SUB_WP_START);
        pstr = GetString((U16) strID);
    }
#endif /* __MMI_SUB_WALLPAPER__ */ 
#ifndef __MMI_UI_TECHNO_IDLESCREEN_BAR__    
#ifdef __MMI_ANALOG_CLOCK__
    else if (Id == IMG_ID_DISPCHAR_ANALOG_CLK)
    {
        /* Analog Clock Wallpaper */
        strID = STR_ID_PHNSET_DISPCHAR_ANALOG;
        pstr = GetString((U16) strID);
    }
#endif /* __MMI_ANALOG_CLOCK__ */ 

#ifdef __MMI_DIGITAL_CLOCK__
    else if (Id == IMG_ID_DISPCHAR_DIGITAL_CLK)
    {
        /* Digital Clock Wallpaper */
        strID = STR_ID_PHNSET_DISPCHAR_DIGITAL;
        pstr = GetString((U16) strID);
    }
#endif /* __MMI_DIGITAL_CLOCK__ */ 
#endif /* !__MMI_UI_TECHNO_IDLESCREEN_BAR__ */

    else if (Id == IMG_ID_DISPCHAR_THEME_WALLPAPER)
    {
        /* Theme Wallpaper */
        strID = STR_ID_DISPCHAR_THEME_WALLPAPER;
        pstr = GetString((U16) strID);
    }
#if defined (__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__) || defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__)/* video wallpaper feature */
	else if (Id >= IMG_ID_VIDEO_WP_START && Id <= IMG_ID_VIDEO_WP_MAX)
	{
		strID = STR_ID_PHNSET_DISPCHAR_VDOID_START + (Id - IMG_ID_VIDEO_WP_START);
		pstr = GetString((U16) strID);
	}
#endif /*__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__ */
    return pstr;

}


/*****************************************************************************
 * FUNCTION
 *  PhnsetSetWallpaperByImgID
 * DESCRIPTION
 *  This function is to set current wallpaper using index by AT command
 * PARAMETERS
 *  imgID       [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            U16 image ID
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetSetWallpaperByImgID(U16 imgID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_WP)
    {
        mmi_phnset_wallpaper_set_static_id(imgID);
    }
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
	else if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_SL_WP)
	{
		mmi_phnset_wallpaper_screen_lock_set_static_id(imgID);
	}
#endif
#ifdef __MMI_SUB_WALLPAPER__
    else if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_SUB_WP)
    {
        mmi_phnset_sub_wallpaper_set_static_id(imgID);
    }
#endif /* __MMI_SUB_WALLPAPER__ */ 
    else
    {
        MMI_ASSERT(0);
    }

    g_phnset_cntx_p->isCorrectSet = 1;

}

#if 0
/* under construction !*/
#endif

#if  !defined(__MMI_PHNSET_AT_DISABLE__)
/*****************************************************************************
 * FUNCTION
 *  PhnsetSetDisplayFromAT
 * DESCRIPTION
 *  This function is to set current wallpaper using index by AT command
 * PARAMETERS
 *  idx         [IN]            
 *  type        [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            U16 image ID
 * RETURNS
 *  void
 *****************************************************************************/
BOOL PhnsetSetDisplayFromAT(U8 idx, U8 type)
{
#ifndef __SLIM_AT__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 SysWpIDList[MAX_WALLPAPER_IMG];
    U8 max_idx = 0;
    U16 wallpaper_id;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if !defined(__MMI_DUAL_SIM_MASTER__)
    if (srv_sim_ctrl_is_available(MMI_SIM1))
#else   /* __MMI_DUAL_SIM_MASTER__ */
/* under construction !*/
#endif  /* __MMI_DUAL_SIM_MASTER__ */
    {
		mmi_popup_display_simple_ext(STR_GLOBAL_DONE, MMI_EVENT_SUCCESS, GRP_ID_ROOT, NULL);
    
        switch (type)
        {
            case MMI_PHNSET_TYPE_WP:
        #ifdef __MMI_SUB_WALLPAPER__
            case MMI_PHNSET_TYPE_SUB_WP:
        #endif 
            {
                phnset_wpss_type_enum tmp_type = g_phnset_cntx_p->wpss_type;

                g_phnset_cntx_p->wpss_type = (phnset_wpss_type_enum) type;

                max_idx = PhnsetConstSysWallpaperList(NULL, SysWpIDList, NULL);

                g_phnset_cntx_p->wpss_type = tmp_type;


                if (idx < max_idx)  /* unsigned comparison with 0 is always true: '>=' */
                {
				    wallpaper_id = SysWpIDList[idx];
				    g_phnset_cntx_p->curtWpID = SysWpIDList[idx];
					
					wp_sub_menu_type = PHNSET_WALLPAPER_STATIC_SYSTEM;
                    mmi_phnset_wallpaper_set_static_id(wallpaper_id);
                    mmi_dispchar_set_img_id(RESTORE_DEFAULT_FUNANDGAMES_SETWALLPAPER, &wallpaper_id);

                }
                else
                {
                    return MMI_FALSE;
                }
            }
                break;
#ifdef __MMI_SCREEN_SAVER__                
            case MMI_PHNSET_TYPE_SS:
            {
                max_idx = PhnsetConstSysScrSvrList(NULL, SysWpIDList, NULL);
                if (idx < max_idx)  /* unsigned comparison with 0 is always true: '>=' */
                {

                    g_phnset_cntx_p->curSsID = SysWpIDList[idx];
                    mmi_dispchar_set_img_id(NVRAM_CURRENT_SCREENSVER_ID, &(g_phnset_cntx_p->curSsID));
                    mmi_dispchar_set_img_id(RESTORE_DEFAULT_CURRENT_SCREENSVER_ID, &(g_phnset_cntx_p->curSsID));
                }
                else
                {
                    return MMI_FALSE;
                }
                break;
            }
#endif                
        #ifdef __MMI_POWER_ON_OFF_DISPLAY__
            case MMI_PHNSET_TYPE_PWRON:
            case MMI_PHNSET_TYPE_PWROFF:
            {
                phnset_wpss_type_enum tmp_type = g_phnset_cntx_p->wpss_type;

                g_phnset_cntx_p->wpss_type = (phnset_wpss_type_enum) type;

                max_idx = PhnsetConstSysPwrOnOffList(NULL, SysWpIDList, NULL);

                g_phnset_cntx_p->wpss_type = tmp_type;

                if (idx < max_idx)  /* unsigned comparison with 0 is always true: '>=' */
                {
                    if (type == MMI_PHNSET_TYPE_PWRON)
                    {
                        g_phnset_cntx_p->curtPwrOnID = SysWpIDList[idx];
                        mmi_dispchar_set_img_id(NVRAM_CURRENT_POWER_ON_DISPLAY, &(g_phnset_cntx_p->curtPwrOnID));
                        mmi_dispchar_set_img_id(NVRAM_RESTORE_POWER_ON_DISPLAY, &(g_phnset_cntx_p->curtPwrOnID));
                    }
                    else
                    {
                        g_phnset_cntx_p->curtPwrOffID = SysWpIDList[idx];
                        mmi_dispchar_set_img_id(NVRAM_CURRENT_POWER_OFF_DISPLAY, &(g_phnset_cntx_p->curtPwrOffID));
                        mmi_dispchar_set_img_id(NVRAM_RESTORE_POWER_OFF_DISPLAY, &(g_phnset_cntx_p->curtPwrOffID));
                    }

                }
                else
                {
                    return MMI_FALSE;
                }

            }
                break;
        #endif /* __MMI_POWER_ON_OFF_DISPLAY__ */ 
        }
    }
#endif /* __SLIM_AT__ */
    return MMI_TRUE;

}
#endif

/*****************************************************************************
 * FUNCTION
 *  PhnsetGetATDisplayBound
 * DESCRIPTION
 *  This function is to get index boundary by AT command
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            U16 image ID
 * RETURNS
 *  U8 boundary
 *****************************************************************************/
U8 PhnsetGetATDisplayBound(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Please refer to ATSetProfileHandler */
    return (0 /* Wallpaper -- 0 */
        + 1   /* Reserved  -- 1 */
        + 1   /* Home city -- 2 */
        + 1   /* Theme     -- 3 */
        + 1   /* Shortcut  -- 4 */
        + 1   /* Screen saver -- 5 */
#ifdef __MMI_POWER_ON_OFF_DISPLAY__
        + 2   /* Power on/off display -- 6 7 */
#endif
        );
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetIsWPCurrentTheme
 * DESCRIPTION
 *  To check if the wallpaper is the current theme.
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
BOOL PhnsetIsWPCurrentTheme(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_phnset_wallpaper_get_static_id() == IMG_ID_DISPCHAR_THEME_WALLPAPER)
    {
        return TRUE;
    }
    else
    {
        return FALSE;
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_check_themeid_wallpaper
 * DESCRIPTION
 *  Check img ID is theme or not
 * PARAMETERS
 *  void
 * RETURNS
 *  BOOL
 *****************************************************************************/
MMI_BOOL mmi_phnset_check_themeid_wallpaper(U16 imgID)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (imgID == IMG_ID_DISPCHAR_THEME_WALLPAPER)
        return MMI_TRUE;

    return MMI_FALSE;
}

#if 0
#if defined(__MMI_OP11_HOMESCREEN_0301__) || defined(__MMI_OP11_HOMESCREEN_0302__) || defined(__MMI_OP11_HOMESCREEN__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#if 0
#if (defined (__DAILY_WALLPAPER__) )
/* under construction !*/
/* under construction !*/
/* under construction !*/
#elif (defined(__MMI_FILE_MANAGER__) && defined(__MMI_FILE_USEAS_SUPPORT__))
/* under construction !*/
/* under construction !*/
#else 
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif 
#else
#if (defined(__MMI_FILE_MANAGER__) && defined(__MMI_FILE_USEAS_SUPPORT__))
/* under construction !*/
/* under construction !*/
/* under construction !*/
#else 
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif 
#endif 
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* defined( __MMI_OP11_HOMESCREEN_0301__) || defined(__MMI_OP11_HOMESCREEN_0302__) || defined(__MMI_OP11_HOMESCREEN__) */
#endif
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_speedup
 * DESCRIPTION
 *  Check img ID is theme or not
 * PARAMETERS
 *  void
 * RETURNS
 *  BOOL
 *****************************************************************************/
#ifndef __MMI_PHNSET_SLIM__
void mmi_phnset_save_wallpaper_to_speedup(void)
{
#ifdef __MMI_FILE_MANAGER__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_BOOL ret;
    GDI_HANDLE wplayer;
    U16 cache_imgtype;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_WP_SPEEDUP_FUNCTION);

    if (save_cache_flag)
        return;

    ret = mmi_cat33_get_cache_wallpaper_info(idle_screen_wallpaper_ID, 	idle_screen_wallpaper_name, &wplayer, &cache_imgtype);

    if (wplayer == GDI_ERROR_HANDLE)
        return;

    {
        FS_HANDLE dir_ret;

        dir_ret = FS_Open(PHNSET_PREDEFINED_WP_PATH, FS_OPEN_DIR | FS_READ_ONLY);
        if (dir_ret < 0)
        {
            dir_ret = FS_CreateDir(PHNSET_PREDEFINED_WP_PATH);
            if (dir_ret < 0)
            {
                return;
            }
            else
            {
                dir_ret = 0;
            }
        }
        else
        {
            FS_Close(dir_ret);
            dir_ret = 0;
        }
    }

    if (ret == MMI_TRUE)
    {
        GDI_RESULT save_result;
        
        if (cache_imgtype == GDI_IMAGE_TYPE_DEVICE_BMP_FILE)
        {
            save_result = gdi_layer_save_pbm_file(wplayer, (CHAR*)PHNSET_PREDEFINED_WP_PATH_PBM);

            if (0 <= save_result)
            {
                idle_screen_wallpaper_name = (CHAR*) PHNSET_PREDEFINED_WP_PATH_PBM;
                gdi_anim_stop_all_by_layer(wplayer);
            }
            else
            {
                mmi_phnset_view_setting_cache_util_del_file((WCHAR *)PHNSET_PREDEFINED_WP_PATH_PBM);
            }
        }
        else if (cache_imgtype == GDI_IMAGE_TYPE_JPG_FILE)   
        {
            save_result = gdi_layer_save_jpeg_file(wplayer, (CHAR*) PHNSET_PREDEFINED_WP_PATH_JPG);

            if (0 <= save_result)
            {
                idle_screen_wallpaper_name = (CHAR*) PHNSET_PREDEFINED_WP_PATH_JPG;
                gdi_anim_stop_all_by_layer(wplayer);
            }
            else
            {
                mmi_phnset_view_setting_cache_util_del_file((WCHAR *)PHNSET_PREDEFINED_WP_PATH_JPG);
            }
        }
    }

    save_cache_flag = MMI_TRUE;
#endif /* __MMI_FILE_MANAGER__ */

}
#endif

#ifdef __MMI_FILE_MANAGER__



/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_copy_wpss_check_device
 * DESCRIPTION
 *  check device status and storage before copy image or video file to root
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_phnset_copy_wpss_check_device(void)
{
    mmi_phnset_view_setting_confirm_to_set();
}



#endif /* __MMI_FILE_MANAGER__ */


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_menu_proc
 * DESCRIPTION
 *  Proc function for wallpaper menu CUI 
 * PARAMETERS
 *  param   [IN]
 * RETURNS
 *  mmi_ret
 *****************************************************************************/
mmi_ret mmi_phnset_wallpaper_sub_menu_handler(cui_menu_event_struct *param, MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (param->evt_id)
    {
    case EVT_ID_CUI_MENU_LIST_ENTRY:
        return mmi_phnset_wallpaper_sub_menu_entry_handler(param, parent_gid);

    case EVT_ID_CUI_MENU_ITEM_HILITE:
        return mmi_phnset_wallpaper_sub_menu_highlight_handler(param, parent_gid);

    case EVT_ID_CUI_MENU_ITEM_SELECT:
    case EVT_ID_CUI_MENU_ITEM_TAP:
        return mmi_phnset_wallpaper_sub_menu_select_handler(param, parent_gid);
       
    default:
        break;            
    }		

    return MMI_RET_DONT_CARE;
}



/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_sub_menu_entry_handler
 * DESCRIPTION
 *  Entry proc function for wallpaper menu cui 
 * PARAMETERS
 *  param   [IN]
 * RETURNS
 *  mmi_ret
 *****************************************************************************/
static mmi_ret mmi_phnset_wallpaper_sub_menu_entry_handler(cui_menu_event_struct *param, MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    #ifdef __MMI_VUI_HOMESCREEN_LIVE_WALLPAPER__
	U32 numOfWlw;
	#endif
    mmi_ret ret = MMI_RET_DONT_CARE;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    switch (param->parent_menu_id)
    {
    case MENU_SETTING_WALLPAPER:
#if 0
#if defined(__DAILY_WALLPAPER__) && defined(__MMI_FILE_MANAGER__)
/* under construction !*/
#endif  
#endif        
#ifdef __MMI_SUB_WALLPAPER__
    case MENU_SETTING_WALLPAPER_SUB:
#endif        
    	mmi_phnset_init_wallpaper_menu();
        ret = MMI_RET_OK;
        break;
#ifndef __MMI_PHNSET_WP_SLIM__   
    case MENU_SETTING_WALLPAPER_SYSTEM:
        #ifndef __MMI_PHNSET_SLIM__
        cui_menu_set_currlist_flags(param->sender_id, CUI_MENU_NORMAL_LIST_WITH_NUMBERED_ICONS);    
        #endif
        cui_menu_set_currlist_title_by_id(param->sender_id, STR_WALLPAPER_SYSTEM, IMG_SCR_SETTING_CAPTION);   
    #ifdef __MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__
        if(mmi_factory_get_favorite_type(mmi_idle_get_cfg_table()) == MMI_IDLE_TYPE_CLASSIC)
        {
            cui_menu_set_item_hidden(param->sender_id, MENU_SETTING_VIDEO_WALLPAPER, MMI_TRUE);
        }
    #endif
    
    #ifdef __MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__
        if(PhnsetWallpaperHasIVLW() == KAL_FALSE || mmi_factory_get_favorite_type(mmi_idle_get_cfg_table()) == MMI_IDLE_TYPE_CLASSIC)
        {
            cui_menu_set_item_hidden(param->sender_id, MENU_SETTING_LIVE_WALLPAPER, MMI_TRUE);
        }
    #else

#ifdef __MMI_VUI_HOMESCREEN_LIVE_WALLPAPER__
     #ifndef __MMI_SETTING_HS_LIVEWP_EXT__
        mmi_phnset_wallpaper_vuiwallpaper_free_ext(1);
        vapp_wallpaper_provider_create(&g_provider_handle);
	#else
		applib_mem_ap_register(APPLIB_MEM_SETTING_VUI_WALLPAPER, STR_GLOBAL_WALLPAPER, IMG_SCR_SETTING_CAPTION, mmi_phnset_wallpaper_vuiwallpaper_exit_by_asm);
		mmi_phnset_wallpaper_vuiwallpaper_free_ext(0);
		mmi_phnset_wallpaper_vuiwallpaper_free_ext(1);
		if(!g_vui_provider_buffer)
 		{
		   if((g_vui_provider_buffer=applib_mem_ap_alloc(APPLIB_MEM_SETTING_VUI_WALLPAPER, VAPP_WALLPAPER_PROVIDER_WORKING_MEMORY_SIZE))==NULL)
		   {
 		     g_parent_gid=parent_gid;		   
			 mmi_frm_appmem_prompt_to_release_mem(APPLIB_MEM_SETTING_VUI_WALLPAPER,IMG_SCR_SETTING_CAPTION,VAPP_WALLPAPER_PROVIDER_WORKING_MEMORY_SIZE,mmi_phnset_wallpaper_vuiwallpaper_asm_alloc_entry);
			 return MMI_RET_ERR;
		   }
		}	
		vapp_wallpaper_provider_create_ex(&g_provider_handle,g_vui_provider_buffer,VAPP_WALLPAPER_PROVIDER_WORKING_MEMORY_SIZE);
	#endif
		numOfWlw = vapp_wallpaper_provider_get_live_wallpaper_total_num(g_provider_handle);	
        mmi_phnset_wallpaper_vuiwallpaper_free_ext(1);
		mmi_phnset_wallpaper_vuiwallpaper_free_ext(0);
		if (0 == numOfWlw)
		{
			cui_menu_set_item_hidden(param->sender_id, MENU_SETTING_LIVE_WALLPAPER, MMI_TRUE);
		}
	#endif
#endif
        ret = MMI_RET_OK;
        break;
#endif   
	case MENU_SETTING_WALLPAPER_HOMESCREEN:
        #ifndef __MMI_PHNSET_SLIM__        
        cui_menu_set_currlist_flags(param->sender_id, CUI_MENU_NORMAL_LIST_WITH_NUMBERED_ICONS);        
        #endif
	#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
        cui_menu_set_currlist_title_by_id(param->sender_id, STR_ID_HOMESCREEN_WALLPAPER, IMG_SCR_SETTING_CAPTION);
	#else
		cui_menu_set_currlist_title_by_id(param->sender_id, STR_GLOBAL_WALLPAPER, IMG_SCR_SETTING_CAPTION);
	#endif
		g_phnset_cntx_p->wpss_type = MMI_PHNSET_TYPE_WP;
		return MMI_RET_OK;
		
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
	case MENU_SETTING_WALLPAPER_LOCKSCREEN:
        #ifndef __MMI_PHNSET_SLIM__
        cui_menu_set_currlist_flags(param->sender_id, CUI_MENU_NORMAL_LIST_WITH_NUMBERED_ICONS);        
        #endif
        cui_menu_set_currlist_title_by_id(param->sender_id, STR_ID_LOCKSCREEN_WALLPAPER, IMG_SCR_SETTING_CAPTION);
		g_phnset_cntx_p->wpss_type = MMI_PHNSET_TYPE_SL_WP;
        ret = MMI_RET_OK;
        break;
#endif
    default:
    	break;
    }
  #ifdef __MMI_PHNSET_SLIM__
    if(ret)
      {
      cui_menu_set_currlist_flags(param->sender_id, CUI_MENU_NORMAL_LIST_WITH_NUMBERED_ICONS);
       }
  #endif
   return ret;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_sub_menu_highlight_handler
 * DESCRIPTION
 *  Highlight proc function for wallpaper menu cui
 * PARAMETERS
 *  param   [IN]
 * RETURNS
 *  mmi_ret
 *****************************************************************************/
static mmi_ret mmi_phnset_wallpaper_sub_menu_highlight_handler(cui_menu_event_struct *param, MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (param->highlighted_menu_id)
    {
    case MENU_SETTING_WALLPAPER_HOMESCREEN:
		g_phnset_cntx_p->wpss_type = MMI_PHNSET_TYPE_WP;
		//HintPhnsetWallpaper();
		break;
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
	case MENU_SETTING_WALLPAPER_LOCKSCREEN:
		g_phnset_cntx_p->wpss_type = MMI_PHNSET_TYPE_SL_WP;		
		//HintPhnsetWallpaper();
		break;
#endif		
    default:
        break;
    }
    HintPhnsetWallpaper();

    return MMI_RET_DONT_CARE;    
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_sub_menu_select_handler
 * DESCRIPTION
 *  select proc function for wallpaper menu cui
 * PARAMETERS
 *  param   [IN]
 * RETURNS
 *  mmi_ret
 *****************************************************************************/
static mmi_ret mmi_phnset_wallpaper_sub_menu_select_handler(cui_menu_event_struct *param, MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (param->highlighted_menu_id)
    {
/* Main menu of wallpaper setting */        
    case MENU_SETTING_WALLPAPER:
        g_phnset_cntx_p->wpss_type = MMI_PHNSET_TYPE_WP;
#if 0
#if !defined(__MMI_FILE_MANAGER__) && !defined(__DAILY_WALLPAPER__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
#else
/* under construction !*/
#endif
#endif
#if !defined(__MMI_FILE_MANAGER__) 
	wp_sub_menu_type = PHNSET_WALLPAPER_STATIC_SYSTEM;
	EntryPhnsetWallpaperSys(parent_gid);
#else
        mmi_phnset_wallpaper_entry_main(parent_gid);
#endif
        return MMI_RET_OK;
        
#ifdef __MMI_SUB_WALLPAPER__
    case MENU_SETTING_WALLPAPER_SUB:
        g_phnset_cntx_p->wpss_type = MMI_PHNSET_TYPE_SUB_WP;
#if 0
#if !defined(__MMI_FILE_MANAGER__) && !defined(__DAILY_WALLPAPER__)
/* under construction !*/
/* under construction !*/
#else
/* under construction !*/
#endif
#endif
#if !defined(__MMI_FILE_MANAGER__) 
	   EntryPhnsetWallpaperSys(parent_gid);
#else
        mmi_phnset_wallpaper_entry_main(parent_gid);
#endif
        return MMI_RET_OK;
#ifndef __MMI_PHNSET_WP_SLIM__		
		case MENU_SETTING_WALLPAPER_SYSTEM:
			if(g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_SUB_WP)
			{
				EntryPhnsetWallpaperSys(parent_gid);
			}
			return MMI_RET_OK;		
#endif            
#endif
#ifdef __MMI_PHNSET_WP_SLIM__
        case MENU_SETTING_WALLPAPER_SYSTEM:
		    EntryPhnsetWallpaperSys(parent_gid);
			return MMI_RET_OK;
#endif        

/* Sub menu of wallpaper setting */        
#ifdef __MMI_FILE_MANAGER__
    case MENU_SETTING_WALLPAPER_DOWNLOAD:
        mmi_phnset_view_setting_common_entry_fmgr(parent_gid, g_phnset_cntx_p->wpss_type);
        return MMI_RET_OK;        
#endif /* __MMI_FILE_MANAGER__ */
#ifndef __MMI_PHNSET_WP_SLIM__ 
#if defined (__MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__)
	case MENU_SETTING_LIVE_WALLPAPER:	
	    wp_sub_menu_type = PHNSET_WALLPAPER_IVLW_SYSTEM;
		EntryPhnsetWallpaperSys(parent_gid);
		return MMI_RET_OK;
#else
#ifdef __MMI_VUI_HOMESCREEN_LIVE_WALLPAPER__
    case MENU_SETTING_LIVE_WALLPAPER:
        mmi_phnset_wallpaper_entry_vui_live_wallpaper(parent_gid);
        return MMI_RET_OK;
  #ifdef __MMI_SETTING_HS_LIVEWP_EXT__
	case MENU_SETTING_WALLPAPER_SYSTEM:
		mmi_phnset_wallpaper_entry_system_mainscrn(parent_gid);
		return MMI_RET_OK;;
  #endif/*__MMI_SETTING_HS_LIVEWP_EXT__*/		
#endif
#endif
	case MENU_SETTING_STATIC_WALLPAPER:
		wp_sub_menu_type = PHNSET_WALLPAPER_STATIC_SYSTEM;
		EntryPhnsetWallpaperSys(parent_gid);
		return MMI_RET_OK;
#if defined (__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__) || defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__)
	case MENU_SETTING_VIDEO_WALLPAPER:	
		wp_sub_menu_type = PHNSET_WALLPAPER_VIDEO_SYSTEM;
		EntryPhnsetWallpaperSys(parent_gid);
		return MMI_RET_OK;
#endif
/* Old feature, may phase out */
#if 0
#ifdef __DAILY_WALLPAPER__        
#if !defined(__MMI_FILE_MANAGER__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* !defined(__MMI_FILE_MANAGER__) */
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* __DAILY_WALLPAPER__ */ 
#endif
#endif /* __MMI_PHNSET_WP_SLIM__ */   
	case MENU_SETTING_WALLPAPER_HOMESCREEN:
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
	case MENU_SETTING_WALLPAPER_LOCKSCREEN:
#endif
		mmi_phnset_wallpaper_entry_sel_type_wallpaper(parent_gid);
		break;
    default:
        break;
    }
    return MMI_RET_DONT_CARE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_init_wallpaper_menu
 * DESCRIPTION
 *  Initialize the wallpaper menu 
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_init_wallpaper_menu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID wallpaper_menu_cui_id = mmi_frm_group_get_active_id();
    U16 title_str_id = 0;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* set menu list flags to numbered icon menu list at the first time enter*/
    #ifndef __MMI_PHNSET_SLIM__
    cui_menu_set_currlist_flags(wallpaper_menu_cui_id, CUI_MENU_NORMAL_LIST_WITH_NUMBERED_ICONS);
    #endif    
    /* set title */
    if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_WP
		#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
			 || g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_SL_WP
		#endif
		)
	{
#if 0
#ifdef __DAILY_WALLPAPER__
/* under construction !*/
#else
/* under construction !*/
#endif
#else
	    title_str_id = STR_GLOBAL_WALLPAPER;
#endif
	}
#ifdef __MMI_SUB_WALLPAPER__
    else if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_SUB_WP)
	{
	    title_str_id = STR_SETTING_WALLPAPER_SUB;
	}
#endif
    cui_menu_set_currlist_title_by_id(wallpaper_menu_cui_id, title_str_id, IMG_SCR_SETTING_CAPTION);
    cui_menu_set_currlist_left_softkey_by_id(wallpaper_menu_cui_id, STR_GLOBAL_OK);
    cui_menu_set_currlist_right_softkey_by_id(wallpaper_menu_cui_id, STR_GLOBAL_BACK); 
}

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_entry_main
 * DESCRIPTION
 *  Main menu of wallpaer 
 * PARAMETERS
 *  
 * RETURNS
 *  static void
 *****************************************************************************/
static void mmi_phnset_wallpaper_entry_main(mmi_id parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 	mmi_id menu_id;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(mmi_phnset_entry_group_check_ex(parent_gid,GRP_ID_WALLPAPER_MAIN))
        return;

    mmi_frm_group_create_ex(
        parent_gid,
        GRP_ID_WALLPAPER_MAIN,
        mmi_phnset_wallpaper_main_menu_proc,
        NULL, 
        MMI_FRM_NODE_SMART_CLOSE_FLAG);
#ifdef __MMI_SUB_WALLPAPER__
	if(g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_SUB_WP)
	{
		menu_id = MENU_SETTING_WALLPAPER_SUB;
	}
	else
#endif
	{
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
	menu_id = MENU_SETTING_WALLPAPER;
#else
	menu_id = MENU_SETTING_WALLPAPER_HOMESCREEN;
#endif
	}
    cui_menu_create_and_run(
        GRP_ID_WALLPAPER_MAIN,
        CUI_MENU_SRC_TYPE_RESOURCE,
        CUI_MENU_TYPE_APPMAIN,
        menu_id,
        MMI_FALSE,
        NULL);    
}

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_main_menu_proc
 * DESCRIPTION
 *  Proc function of wallpaper setting main menu 
 * PARAMETERS
 *  
 * RETURNS
 *  static mmi_ret
 *****************************************************************************/
static mmi_ret mmi_phnset_wallpaper_main_menu_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (evt->evt_id == EVT_ID_CUI_MENU_CLOSE_REQUEST)
	{
	    cui_menu_close(((cui_menu_event_struct*)evt)->sender_id);
        return MMI_RET_OK;
	}
    else if (cui_menu_is_menu_event(evt->evt_id))
    {        
        return mmi_phnset_wallpaper_sub_menu_handler((cui_menu_event_struct*)evt,GRP_ID_WALLPAPER_MAIN);
    }    
    return MMI_RET_OK;
}
 

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_entry_system
 * DESCRIPTION
 *  Entry system resource list screen of wallpaper, for external used. 
 * PARAMETERS
 *  parent_gid  :   [IN]    Group ID of parent
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_phnset_wallpaper_entry_system(MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_phnset_cntx_p->wpss_type = MMI_PHNSET_TYPE_WP;
	wp_sub_menu_type = PHNSET_WALLPAPER_STATIC_SYSTEM;
    EntryPhnsetWallpaperSys(parent_gid);
}

#ifdef __MMI_VUI_HOMESCREEN_LIVE_WALLPAPER__

static S32 _mmi_phnset_wallpaper_name_cb(U8 idx, WCHAR *name_buf, S32 buf_len)
{
    ASSERT(g_provider_handle);
    return vapp_wallpaper_provider_get_live_wallpaper_name_from_item_idx(g_provider_handle, idx, name_buf, buf_len);
}

/*
 *  Live wallpaper
 */ 
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_entry_vui_live_wallpaper
 * DESCRIPTION
 *  Entry live wallpaper setting menu 
 * PARAMETERS
 *  
 * RETURNS
 *  static void
 *****************************************************************************/
void mmi_phnset_wallpaper_entry_vui_live_wallpaper(mmi_id parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	g_parent_gid=parent_gid;
	mmi_phnset_appcreate_menucui_create(parent_gid, GRP_ID_WALLPAPER_LIVE_WALLPAPER, MENU_SETTING_LIVE_WALLPAPER, mmi_phnset_wallpaper_live_wallpaper_proc);
}

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_live_wallpaper_proc
 * DESCRIPTION
 *  Proc function for live wallpapaer setting 
 * PARAMETERS
 *  
 * RETURNS
 *  static mmi_ret
 *****************************************************************************/
static mmi_ret mmi_phnset_wallpaper_live_wallpaper_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cui_menu_event_struct *menucui_evt = (cui_menu_event_struct*)evt;
    U8 wallpaper_id = 0;
    VAPP_WALLPAPER_ID_HANDLE wallpaper_id_handle = NULL;
    S32 nNumofItem = 0;
    MMI_ID grp_id;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (menucui_evt->evt_id)
	{
	case EVT_ID_CUI_MENU_LIST_ENTRY:
    #ifndef __MMI_SETTING_HS_LIVEWP_EXT__
        mmi_phnset_wallpaper_vuiwallpaper_free_ext(1)
        vapp_wallpaper_provider_create(&g_provider_handle);
	#else		
        mmi_phnset_wallpaper_vuiwallpaper_free_ext(1);
		mmi_phnset_wallpaper_vuiwallpaper_free_ext(0);
		if(!g_vui_provider_buffer)
 		{
 		   applib_mem_ap_register(APPLIB_MEM_SETTING_VUI_WALLPAPER, STR_GLOBAL_WALLPAPER, IMG_SCR_SETTING_CAPTION, mmi_phnset_wallpaper_vuiwallpaper_exit_by_asm);
			if((g_vui_provider_buffer=applib_mem_ap_alloc(APPLIB_MEM_SETTING_VUI_WALLPAPER, VAPP_WALLPAPER_PROVIDER_WORKING_MEMORY_SIZE))==NULL)
		   {
			  mmi_frm_appmem_prompt_to_release_mem(APPLIB_MEM_SETTING_VUI_WALLPAPER,IMG_SCR_SETTING_CAPTION,VAPP_WALLPAPER_PROVIDER_WORKING_MEMORY_SIZE,mmi_phnset_wallpaper_vuiwallpaper_asm_alloc_entry_2);
			  return MMI_RET_ERR;
		   }
		}
        if(!vapp_wallpaper_provider_create_ex(&g_provider_handle,g_vui_provider_buffer,VAPP_WALLPAPER_PROVIDER_WORKING_MEMORY_SIZE))
        {
        	MMI_ASSERT(0);
        }
	#endif
		mmi_phnset_wallpaper_init_live_wallpaper();
		break;
        
    case EVT_ID_CUI_MENU_ITEM_SELECT:
		
		nNumofItem = vapp_wallpaper_provider_get_live_wallpaper_total_num(g_provider_handle);
		if(nNumofItem == 0)
		{
			wallpaper_id = 0;
            wallpaper_id_handle = NULL;
		}
		else
		{
        	wallpaper_id = 0;
            wallpaper_id_handle = vapp_wallpaper_provider_get_live_wallpaper_id_handle(g_provider_handle, menucui_evt->highlighted_menu_id);
		}
		if (mmi_phnset_wallpaper_set_vui_live_wallpaper_setting(wallpaper_id, wallpaper_id_handle))
    	{
    	    mmi_popup_display_simple((WCHAR*)GetString(STR_GLOBAL_DONE), MMI_EVENT_SUCCESS, GRP_ID_ROOT, NULL);
		#ifdef __MMI_SETTING_HS_LIVEWP_EXT__
			mmi_phnset_wallpaper_vuiwallpaper_free_ext(0);
		#endif	
			cui_menu_close(menucui_evt->sender_id);
            mmi_phnset_wallpaper_vuiwallpaper_free_ext(1);
			#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
			grp_id = GRP_ID_WALLPAPER_HOME_WALLPAPER + g_phnset_cntx_p->wpss_type;
			#else
			grp_id = GRP_ID_WALLPAPER_MAIN;
			#endif
            mmi_frm_group_close(GRP_ID_WALLPAPER_LIVE_WALLPAPER);
            mmi_frm_group_close(grp_id);
    	}
        else
        {
    	    mmi_popup_display_simple_ext(STR_GLOBAL_UNFINISHED, MMI_EVENT_FAILURE, GRP_ID_ROOT, NULL);
        }
        if(wallpaper_id_handle)
        {
            vapp_wallpaper_id_handle_close(wallpaper_id_handle);
            wallpaper_id_handle = NULL;
        }
        break;
        
    case EVT_ID_CUI_MENU_CLOSE_REQUEST:
        cui_menu_close(menucui_evt->sender_id);
	#ifdef __MMI_SETTING_HS_LIVEWP_EXT__
		mmi_phnset_wallpaper_vuiwallpaper_free_ext(0);
	#endif	
		mmi_phnset_wallpaper_vuiwallpaper_free_ext(1);
        break;
        
	default:
		break;
	}
    return MMI_RET_OK;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_init_live_wallpaper
 * DESCRIPTION
 *  Init function for live wallpaper setting menu 
 * PARAMETERS
 *  
 * RETURNS
 *  static void
 *****************************************************************************/
static void mmi_phnset_wallpaper_init_live_wallpaper(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    phnset_radio_button_menu_data_struct radio_button_menu;
    S32 nNumofItem = 0;
    S32 highlight_item_idx = 0;
	U16 lwp_str = STR_GLOBAL_NONE;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    nNumofItem = vapp_wallpaper_provider_get_live_wallpaper_total_num(g_provider_handle);
	
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
	if(g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_SL_WP)
	{
    	highlight_item_idx = vapp_wallpaper_provider_get_current_live_wallpaper_item_idx(g_provider_handle, VAPP_WALLPAPER_SRC_LOCK);
	}
	else if(g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_WP)
#endif
	{		
        highlight_item_idx = vapp_wallpaper_provider_get_current_live_wallpaper_item_idx(g_provider_handle, VAPP_WALLPAPER_SRC_HOMESCREEN);
	}
    if(-1 == highlight_item_idx)
	{
        highlight_item_idx = 0;
	}
    // make sure it is correct when convert to U8
    ASSERT(highlight_item_idx < 0xFF);

    /* Retrieve no of child of menu item to be displayed */
    radio_button_menu.group_id = GRP_ID_WALLPAPER_LIVE_WALLPAPER;
    radio_button_menu.menu_title_str_id = STR_ID_WALLPAPER_LIVE_WALLPAPER;
    radio_button_menu.menu_icon_id = MAIN_MENU_TITLE_SETTINGS_ICON;
	if(nNumofItem == 0)
    {
		nNumofItem ++;
		radio_button_menu.menu_item_str_id_list = &lwp_str;
    }
    else
    {
		radio_button_menu.menu_item_str_id_list = NULL;
    }
	radio_button_menu.menu_item_str_list = NULL;
    radio_button_menu.menu_item_num = nNumofItem < MAX_SUB_MENUS ? nNumofItem: MAX_SUB_MENUS; //MINOF(nNumofItem, MAX_SUB_MENUS);
    radio_button_menu.menu_item_str_cb = &_mmi_phnset_wallpaper_name_cb;
    radio_button_menu.highlighted_item_idx = (U8)highlight_item_idx; 
    mmi_phnset_init_radio_button_menu(&radio_button_menu);
}

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_set_vui_live_wallpaper_setting
 * DESCRIPTION
 *  Save Live wallpaper setting to NVRAM. Wallpaper Class ID (enum) are stored.
 * PARAMETERS
 *  
 * RETURNS
 *  static void
 *****************************************************************************/
static MMI_BOOL mmi_phnset_wallpaper_set_vui_live_wallpaper_setting(U8 wallpaper_id, VAPP_WALLPAPER_ID_HANDLE id_handle)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;
    S32 result_nvram = 0;
    MMI_BOOL result_wallpaper = MMI_TRUE;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_PRINT(MOD_MMI_COMMON_APP, MMI_COMMON_TRC_G7_SETTING, "[Wallpaper.c] Set VUI Live wallpaper (%d)", wallpaper_id);
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
	if(g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_SL_WP)
	{
		result_wallpaper = vapp_wallpaper_setting_save_wallpaper_id_handle(VAPP_WALLPAPER_SRC_LOCK, id_handle);
    	result_nvram = WriteValue(SCREEN_LOCK_WALLPAPER_LIVE_ID, &wallpaper_id, DS_BYTE, &error);
}
	else if(g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_WP)
#endif /* __MMI_VUI_SCREEN_LOCK_KEY__ */
	    {
		result_wallpaper = vapp_wallpaper_setting_save_wallpaper_id_handle(VAPP_WALLPAPER_SRC_HOMESCREEN, id_handle);
		result_nvram = WriteValue(NVRAM_PHNSET_LIVE_WALLPAPER, &wallpaper_id, DS_BYTE, &error);
	    }
    if (result_nvram == -1 || result_wallpaper == MMI_FALSE)
	    {
	    return MMI_FALSE;
	}
    return MMI_TRUE;
}
/***********************************************************
*FUNCTION:
*mmi_phnset_wallpaper_vuiwallpaper_free_ext
*PARAMETERS:
*is_buffer: 0 is buffer, 1 is provider handler
*RETURNS:
*void
************************************************************/
static void mmi_phnset_wallpaper_vuiwallpaper_free_ext(MMI_BOOL is_buffer)
{
#ifdef __MMI_SETTING_HS_LIVEWP_EXT__
    if(is_buffer)
    {
      if(g_vui_provider_buffer)
		{
			applib_mem_ap_free(g_vui_provider_buffer);
			g_vui_provider_buffer=NULL;
		}
    } 
	else 
#endif	
	{
    
      if(g_provider_handle)
        {
            vapp_wallpaper_provider_close(g_provider_handle);
            g_provider_handle = NULL;
        }
    }
}

#ifdef __MMI_SETTING_HS_LIVEWP_EXT__
/*==========================================*/
//entry wallpaper ->XXX->system
/*==========================================*/
static void mmi_phnset_wallpaper_entry_system_mainscrn(MMI_ID parent_id)
{
    MMI_ID grp_id;
	if (!parent_id)
	   {
		   parent_id = GRP_ID_ROOT;
	   }
    grp_id=mmi_frm_group_create_ex(
        parent_id,
        GRP_ID_AUTO_GEN,
        mmi_phnset_wallpaper_main_menu_proc,
        NULL,
        MMI_FRM_NODE_SMART_CLOSE_FLAG);
	cui_menu_create_and_run(grp_id,
					CUI_MENU_SRC_TYPE_RESOURCE,
					CUI_MENU_TYPE_FROM_RESOURCE,
					MENU_SETTING_WALLPAPER_SYSTEM,
					MMI_FALSE,
        			NULL);
  
}
void mmi_phnset_wallpaper_vuiwallpaper_exit_by_asm(void)
{
      mmi_phnset_wallpaper_vuiwallpaper_free_ext(1);
	  mmi_phnset_wallpaper_vuiwallpaper_free_ext(0);
     applib_mem_ap_notify_stop_finished(APPLIB_MEM_SETTING_VUI_WALLPAPER, KAL_TRUE);
}
static void mmi_phnset_wallpaper_vuiwallpaper_asm_alloc_entry(void)
{
	 mmi_phnset_wallpaper_entry_system_mainscrn(g_parent_gid);
}
static void mmi_phnset_wallpaper_vuiwallpaper_asm_alloc_entry_2(void)
{
     mmi_phnset_wallpaper_entry_vui_live_wallpaper(g_parent_gid);
}
#endif/*__MMI_SETTING_HS_LIVEWP_EXT__*/

#endif /* __MMI_VUI_HOMESCREEN_LIVE_WALLPAPER__ */

#ifdef __MMI_FILE_MANAGER__
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_entry_fmgr
 * DESCRIPTION
 *  Entry file resource selection screen of wallpaper, for external used. 
 * PARAMETERS
 *  parent_gid  :   [IN]    Group ID of parent
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_phnset_wallpaper_entry_fmgr(MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_phnset_cntx_p->wpss_type = MMI_PHNSET_TYPE_WP;
    mmi_phnset_view_setting_common_entry_fmgr(parent_gid, g_phnset_cntx_p->wpss_type);
}
#endif /* __MMI_FILE_MANAGER__ */

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_enter_switch_screen
 * DESCRIPTION
 *  Create a new screen and delete old one to handle screen switch 
 * PARAMETERS
 *  
 * RETURNS
 *  
 *****************************************************************************/
MMI_BOOL mmi_phnset_enter_switch_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID new_scrn_id = 0;
    MMI_ID group_id = 0;
    MMI_ID curr_scrn_id = mmi_frm_scrn_get_active_id();
    FuncPtr enter_func = NULL;
    FuncPtr exit_func = NULL;
    MMI_BOOL close_scrn_flag = MMI_FALSE;
    MMI_BOOL ret;

      if (curr_scrn_id == SCR_WALLPAPER_VIEW || curr_scrn_id == SCR_WALLPAPER_VIEW_2)
    	{
            close_scrn_flag = MMI_TRUE;
            new_scrn_id = (curr_scrn_id == SCR_WALLPAPER_VIEW) ? SCR_WALLPAPER_VIEW_2 : SCR_WALLPAPER_VIEW;
    	}
        /* First enter this screen */
        else
        {
            new_scrn_id = SCR_WALLPAPER_VIEW;
        }    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(g_phnset_cntx_p->wpss_type)
    {
    case MMI_PHNSET_TYPE_WP:
#ifdef __MMI_SUB_WALLPAPER__
    case MMI_PHNSET_TYPE_SUB_WP:
#endif
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
	case MMI_PHNSET_TYPE_SL_WP:
#endif
        group_id = GRP_ID_WALLPAPER_SYSTEM_SUB;
#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif        
        enter_func = EntryPhnsetWallpaperSysView;
        exit_func = ExitPhnsetWallpaperSysView;
        break;
#ifdef __MMI_SCREEN_SAVER__
    case MMI_PHNSET_TYPE_SS:
        group_id = GRP_ID_SCREENSAVER_SYSTEM;
#if 0        
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif        
        enter_func = EntryPhnsetScrSvrSysView;
        exit_func = mmi_phnset_exit_scrsvr_sys_view;
        break;   
#endif
#ifdef __MMI_POWER_ON_OFF_DISPLAY__
    case MMI_PHNSET_TYPE_PWRON:
        group_id = GRP_ID_POWER_ON_OFF_SYSTEM;
#if 0        
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif        
        enter_func = EntryPhnsetPwrOnOffSysView;
        exit_func = ExitPhnsetPwrOnOffSysView;
        break;           

        
    case MMI_PHNSET_TYPE_PWROFF:
        group_id = GRP_ID_POWER_ON_OFF_SYSTEM;
#if 0        
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif        
        enter_func = EntryPhnsetPwrOnOffSysView;
        exit_func = ExitPhnsetPwrOnOffSysView;
        break;         
#endif /* __MMI_POWER_ON_OFF_DISPLAY__ */
#ifdef __MMI_PHNSET_APPICON_SUPPORT__
    case MMI_PHNSET_TYPE_APPICON:
        group_id = GRP_ID_APPICON_MAIN;
#if 0        
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif        
        enter_func = mmi_phnset_appicon_setting_view_lsk;
        exit_func = mmi_phnset_appicon_setting_exit_preview;
        break;
#endif        
    default:
        ASSERT(0);
    }
    /* If it is back from other screen, create new and close old will behave incorrectly */
    if (mmi_frm_is_in_backward_scenario())
	{
	    ret = mmi_frm_scrn_enter(group_id, curr_scrn_id, exit_func, enter_func, MMI_FRM_UNKNOW_SCRN);
	}
    else
    {
        ret = mmi_frm_scrn_enter(group_id, new_scrn_id, exit_func, enter_func, MMI_FRM_UNKNOW_SCRN);
        if (close_scrn_flag)
    	{
    	    mmi_frm_scrn_close(group_id, curr_scrn_id);
    	}
    }
    return ret;
}


#ifdef __MMI_FILE_MANAGER__
void mmi_fmgr_to_wallpaper_hdlr(mmi_menu_id item_id, const WCHAR* filepath, const srv_fmgr_fileinfo_struct* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	phnset_wpss_type_enum view_type = MMI_PHNSET_TYPE_WP;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
	view_type += item_id - MENU_ID_FMGR_FWD_HOME_WALLPAPER;
#endif
    mmi_phnset_view_setting_common_forward_from_fmgr(view_type, filepath, (filetypes_file_type_enum)fileinfo->type);
}

#ifdef __MMI_SUB_WALLPAPER__		
void mmi_fmgr_to_sub_wallpaper_hdlr(mmi_menu_id item_id, const WCHAR* filepath, const srv_fmgr_fileinfo_struct* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_phnset_view_setting_common_forward_from_fmgr(MMI_PHNSET_TYPE_SUB_WP, filepath, (filetypes_file_type_enum)fileinfo->type);
}
#endif


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_display_use_as_enabler
 * DESCRIPTION
 *  Enabler for file manager use as wallpaper, screen saver, power on/off display menu 
 * PARAMETERS
 *  
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_phnset_display_use_as_enabler(mmi_menu_id item_id, const WCHAR* filepath, const srv_fmgr_fileinfo_struct* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    phnset_wpss_type_enum check_type = (phnset_wpss_type_enum)0;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (item_id)
	{
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
	case MENU_ID_FMGR_FWD_HOME_WALLPAPER:
	case MENU_ID_FMGR_FWD_LOCK_WALLPAPER:
#else
	case MENU_ID_FMGR_FWD_WALLPAPER:
#endif
        check_type = MMI_PHNSET_TYPE_WP;
        break;
#ifdef __MMI_SUB_WALLPAPER__        
	case MENU_ID_FMGR_FWD_SUB_WALLPAPER:
        check_type = MMI_PHNSET_TYPE_SUB_WP;
        break;
#endif        
#ifdef __MMI_SCREEN_SAVER__
    case MENU_ID_FMGR_FWD_SCREENSAVER:
        check_type = MMI_PHNSET_TYPE_SS;
        break;
#endif        
#ifdef __MMI_POWER_ON_OFF_DISPLAY__        
    case MENU_ID_FMGR_FWD_POWER_ON:
        check_type = MMI_PHNSET_TYPE_PWRON;
        break;
        
    case MENU_ID_FMGR_FWD_POWER_OFF:
        check_type = MMI_PHNSET_TYPE_PWROFF;
		break;
#endif        
	default:
	    mmi_frm_hide_menu_item(item_id);
        return;
	}
    if (!mmi_phnset_view_setting_util_check_file_type(fileinfo->type, check_type))
	{
	    mmi_frm_hide_menu_item(item_id);
	}    
}
#endif /* __MMI_FILE_MANAGER__ */


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wp_ss_pwr_disp_ms_hdlr
 * DESCRIPTION
 *  Handler for wallpaper, screen saver and power on off display when entering
 *  or exitting USB mass storage mode 
 * PARAMETERS
 *  
 * RETURNS
 *  mmi_ret
 *****************************************************************************/
mmi_ret mmi_phnset_wp_ss_pwr_disp_ms_hdlr(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_USB_SUPPORT__
#ifdef __USB_IN_NORMAL_MODE__    
    switch (evt->evt_id)
	{
        /* Entering Mass Storage mode */
	case EVT_ID_USB_ENTER_MS_MODE:
        mmi_phnset_wallpaper_enter_mass_storage_mode();               /* suspend wallpaper */
#ifdef __MMI_SUB_WALLPAPER__
        mmi_phnset_sub_wallpaper_enter_mass_storage_mode();
#endif
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
		mmi_phnset_lock_wallpaper_enter_mass_storage_mode();
#endif
#ifdef __MMI_SCREEN_SAVER__
        mmi_phnset_screensaver_enter_mass_storage_mode();               /* suspend screensaver */
#endif
#ifdef __MMI_POWER_ON_OFF_DISPLAY__
        mmi_phnset_pwr_on_off_enter_mass_storage_mode();         /* suspend power on/off disp. */
#endif 		
		break;
        /* Exiting Mass Storage mode */
    case EVT_ID_USB_EXIT_MS_MODE:
        mmi_phnset_wallpaper_exit_mass_storage_mode();              /* resume wallpaper from secondary flash */
#ifdef __MMI_SUB_WALLPAPER__
        mmi_phnset_sub_wallpaper_exit_mass_storage_mode();
#endif        
#ifdef __MMI_SCREEN_SAVER__
        mmi_phnset_screensaver_exit_mass_storage_mode();    /* resume screensaver from secondary flash */
#endif
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
		mmi_phnset_lock_wallpaper_exit_mass_storage_mode();
#endif

#ifdef __MMI_POWER_ON_OFF_DISPLAY__
        mmi_phnset_pwr_on_off_exit_mass_storage_mode();           /* resume power on/off disp. from secondary flash */
#endif         
        break;
	default:
		break;
	}
#endif    
#endif /* __MMI_USB_SUPPORT__ */
    return MMI_RET_OK;
}

#ifdef __MMI_FILE_MANAGER__
/***************************************************************************** 
 * Setting method
 *****************************************************************************/
#if (!defined(__MMI_VIEW_SETTING_DISABLE_CACHE__) && !defined(__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__) && !defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__))
CHAR mmi_phnset_wallpaper_get_default_driver(void *obj)
{
    return MMI_WALLPAPER_DEFAULT_CACHE_DRVIER;
}


void mmi_phnset_wallpaper_get_default_folder(void *obj, WCHAR *buffer, U8 buffer_len)
{
    mmi_phnset_view_setting_cache_util_get_default_folder(buffer, buffer_len, MMI_WALLPAPER_DEFAULT_CACHE_DRVIER, FMGR_DEFAULT_FOLDER_SETTINGS);
}

void mmi_phnset_wallpaper_get_default_file_prefix(void *obj, WCHAR *buffer, U8 buffer_len)
{
    mmi_setting_display_cache_setting_object_struct *cache_obj = (mmi_setting_display_cache_setting_object_struct*)obj;
    cache_obj->get_default_folder((void*)obj, buffer, buffer_len);
    if (mmi_wcslen(buffer) + mmi_wcslen(MMI_PHNSET_WALLPAPER_CACHE_FILE_NAME) > buffer_len)
	{
	    ASSERT(0);
	}
    mmi_wcscat(buffer, MMI_PHNSET_WALLPAPER_CACHE_FILE_NAME);
}
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallppaer_set_cache_file
 * DESCRIPTION
 *  Set cache file 
 * PARAMETERS
 *  
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_phnset_wallpaper_set_file(void* obj, const WCHAR* user_file_name, const WCHAR* cache_file_name)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    //S16 error;
    U16 wallpaper_id = 0;
#ifdef __MMI_VUI_HOMESCREEN_WALLPAPER__
		VAPP_WALLPAPER_ID_HANDLE wallpaper_file_handle = NULL;
#endif 
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(!cache_file_name && !user_file_name)
    {
        return;
    }
    
    if (cache_file_name)
	{
        mmi_wcscpy(g_mmi_wallpaper_cache_file_name, cache_file_name);
        mmi_ucs2_to_asc(g_mmi_wallpaper_user_file.cache_file_name, (CHAR*)g_mmi_wallpaper_cache_file_name);
        g_mmi_wallpaper_id = 0;
        mmi_dispchar_set_img_id(NVRAM_FUNANDGAMES_SETWALLPAPER, &wallpaper_id);

        idle_screen_wallpaper_name = (CHAR*)g_mmi_wallpaper_cache_file_name;
        idle_screen_cache_name = (CHAR*)g_mmi_wallpaper_cache_file_name;
        idle_screen_wallpaper_name_original = (CHAR*)g_mmi_wallpaper_cache_file_name;
#ifdef __MMI_VUI_HOMESCREEN_WALLPAPER__ /* Set wallpaper to venus UI*/
#if defined (__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__) || defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__)
		if (srv_fmgr_types_find_group_by_filename_str(g_mmi_wallpaper_cache_file_name) == FMGR_GROUP_VIDEO)
	    {
		   wallpaper_file_handle = vapp_wallpaper_provider_get_user_video_wallpaper_id_handle(g_mmi_wallpaper_cache_file_name);
    	}
	    else
#endif
	    {
		   wallpaper_file_handle = vapp_wallpaper_provider_get_user_image_wallpaper_id_handle(g_mmi_wallpaper_cache_file_name);
	    }
	    vapp_wallpaper_setting_save_wallpaper_id_handle(VAPP_WALLPAPER_SRC_HOMESCREEN, wallpaper_file_handle);
	    vapp_wallpaper_id_handle_close(wallpaper_file_handle);
	    wallpaper_file_handle = NULL;
#endif/* __MMI_VUI_HOMESCREEN_WALLPAPER__*/
        mmi_phnset_wallpaper_update_display();
	}
    if (user_file_name)
	{
        mmi_wcscpy(g_mmi_wallpaper_user_file.file_name, user_file_name);
	}      
   
    //WriteRecord(NVRAM_EF_WALLPAPER_FILENAME_LID, 1, &g_mmi_wallpaper_user_file, sizeof(mmi_setting_display_cache_file_nvram_struct), &error);        
	WriteRecordSlim(NVRAM_EF_WALLPAPER_FILENAME_LID, 1, &g_mmi_wallpaper_user_file, sizeof(mmi_setting_display_cache_file_nvram_struct));

    mmi_popup_display_simple_ext(STR_GLOBAL_DONE, MMI_EVENT_SUCCESS, GRP_ID_ROOT, NULL);
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
	mmi_frm_group_close(GRP_ID_WALLPAPER_HOME_WALLPAPER);
#else
	mmi_frm_group_close(GRP_ID_WALLPAPER_MAIN);
#endif
}

#else /* ( (!defined(__MMI_VIEW_SETTING_DISABLE_CACHE__) && !defined(__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__))) */

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_direct_set_file
 * DESCRIPTION
 *  Set cache file 
 * PARAMETERS
 *  
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_phnset_wallpaper_direct_set_file(void* obj, const WCHAR* file_name)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;
#ifdef __MMI_VUI_HOMESCREEN_WALLPAPER__
	VAPP_WALLPAPER_ID_HANDLE wallpaper_file_handle = NULL;
#endif 
    //VAPP_WALLPAPER_ID_HANDLE wallpaper_file_handle = NULL;
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(!file_name)
    {
        return;
    }
    
    
    mmi_wcscpy(g_mmi_wallpaper_user_file.file_name, file_name);
    g_mmi_wallpaper_id = 0;
    mmi_dispchar_set_img_id(NVRAM_FUNANDGAMES_SETWALLPAPER, &g_mmi_wallpaper_id);

    idle_screen_wallpaper_name = (CHAR*)g_mmi_wallpaper_user_file.file_name;
    idle_screen_wallpaper_name_original = (CHAR*)g_mmi_wallpaper_user_file.file_name;
    idle_screen_wallpaper_name_original = (CHAR*)g_mmi_wallpaper_user_file.file_name;
    
    SetIdleScreenWallpaperName((UI_string_type)g_mmi_wallpaper_user_file.file_name);

#ifdef __MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__
    if(srv_fmgr_types_find_group_by_filename_str((WCHAR *)idle_screen_wallpaper_name) == FMGR_GROUP_VIDEO)
    {
        is_vlw_file = 1;
        WriteValue(NVRAM_PHNSET_VLW_WALLPAPER, &is_vlw_file, DS_BYTE, &error);
    }
    else
    {
        is_vlw_file = 0;
        WriteValue(NVRAM_PHNSET_VLW_WALLPAPER, &is_vlw_file, DS_BYTE, &error);
    }
#endif

#ifdef __MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__
    {
        is_ivlw_file = 0;
        WriteValue(NVRAM_PHNSET_IVLW_WALLPAPER, &is_ivlw_file, DS_BYTE, &error);
    }
#endif

    if (mmi_idle_is_active())
    {
        mmi_idle_display();
    }	

#ifdef __MMI_VUI_HOMESCREEN_WALLPAPER__ /* Set wallpaper to venus UI*/
#ifdef __MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__
			if (srv_fmgr_types_find_group_by_filename_str(g_mmi_wallpaper_user_file.file_name) == FMGR_GROUP_VIDEO)
		{
			wallpaper_file_handle = vapp_wallpaper_provider_get_user_video_wallpaper_id_handle(g_mmi_wallpaper_user_file.file_name);
		}
		else
#endif
		{
			wallpaper_file_handle = vapp_wallpaper_provider_get_user_image_wallpaper_id_handle(g_mmi_wallpaper_user_file.file_name);
		}
			vapp_wallpaper_setting_save_wallpaper_id_handle(VAPP_WALLPAPER_SRC_HOMESCREEN, wallpaper_file_handle);
		vapp_wallpaper_id_handle_close(wallpaper_file_handle);
		wallpaper_file_handle = NULL;
#endif/* __MMI_VUI_HOMESCREEN_WALLPAPER__*/


   
    //WriteRecord(NVRAM_EF_WALLPAPER_FILENAME_LID, 1, &g_mmi_wallpaper_user_file, sizeof(mmi_setting_display_cache_file_nvram_struct), &error);        
	WriteRecordSlim(NVRAM_EF_WALLPAPER_FILENAME_LID, 1, &g_mmi_wallpaper_user_file, sizeof(mmi_setting_display_cache_file_nvram_struct));

    mmi_popup_display_simple_ext(STR_GLOBAL_DONE, MMI_EVENT_SUCCESS, GRP_ID_ROOT, NULL);
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
	mmi_frm_group_close(GRP_ID_WALLPAPER_HOME_WALLPAPER);
#else
	mmi_frm_group_close(GRP_ID_WALLPAPER_MAIN);
#endif

    mmi_phnset_view_setting_notify_result(MMI_TRUE, PHNSET_WP_SS_SET_NO_ERROR);
}
#endif /* ( (!defined(__MMI_VIEW_SETTING_DISABLE_CACHE__) && !defined(__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__))) */
/***************************************************************************** 
 * Query API
 *****************************************************************************/
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_get_cache_file
 * DESCRIPTION
 *  Get cache file name 
 * PARAMETERS
 *  
 * RETURNS
 *  WCHAR*
 *****************************************************************************/
WCHAR* mmi_phnset_wallpaper_get_cache_file(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_phnset_wallpaper_init();
    return g_mmi_wallpaper_cache_file_name;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_get_user_file
 * DESCRIPTION
 *  Get file name 
 * PARAMETERS
 *  
 * RETURNS
 *  WCHAR*
 *****************************************************************************/
WCHAR* mmi_phnset_wallpaper_get_user_file(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_phnset_wallpaper_init();
	
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
	if(g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_SL_WP)
	{		
		return g_mmi_wallpaper_sl_user_file.file_name;
	}
	else 
#endif
	{
    return g_mmi_wallpaper_user_file.file_name;
}
}
#endif /* __MMI_FILE_MANAGER__ */


#ifdef __MMI_USB_SUPPORT__
#ifdef __USB_IN_NORMAL_MODE__
static void mmi_phnset_wallpaper_enter_mass_storage_mode(void)
{
#ifdef __MMI_FILE_MANAGER__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    PHNSET_TYPE_DISP type;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    type = PhnsetGetDisplayType(mmi_phnset_wallpaper_get_static_id());
    if (type == PHNSET_TYPE_DISP_USER
        && (srv_usb_check_path_exported((WCHAR*)mmi_phnset_wallpaper_get_cache_file()))
    #ifdef __MMI_VUI_HOMESCREEN_LIVE_WALLPAPER__
        && (MMI_TRUE == vapp_wallpaper_provider_is_current_wallpaper_file_based(VAPP_WALLPAPER_SRC_HOMESCREEN))
    #endif
		)
    {
    
	#ifdef __MMI_VUI_HOMESCREEN_WALLPAPER__	
		vapp_wallpaper_provider_set_usb_mass_storage_mode(MMI_TRUE);
	#endif
        mmi_phnset_wallpaper_reset_to_default(MMI_FALSE);
    #if defined (__MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__)
        is_ivlw_file = 0;
    #endif
    #if defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__)
        is_vlw_file = 0;
    #endif
        mmi_phnset_wallpaper_update_display();
    }
#endif /* __MMI_FILE_MANAGER__ */
}

static void mmi_phnset_wallpaper_exit_mass_storage_mode(void)
{
    //S16 error;
#ifdef __MMI_VUI_HOMESCREEN_WALLPAPER__	
	vapp_wallpaper_provider_set_usb_mass_storage_mode(MMI_FALSE);
#endif
    mmi_dispchar_get_img_id(NVRAM_FUNANDGAMES_SETWALLPAPER, &g_mmi_wallpaper_id);
    
#if defined (__MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__)
    //ReadValue(NVRAM_PHNSET_IVLW_WALLPAPER, &is_ivlw_file, DS_BYTE, &error);
    ReadValueSlim(NVRAM_PHNSET_IVLW_WALLPAPER, &is_ivlw_file, DS_BYTE);
#endif
    
#if defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__)
    //ReadValue(NVRAM_PHNSET_VLW_WALLPAPER, &is_vlw_file, DS_BYTE, &error);
    ReadValueSlim(NVRAM_PHNSET_VLW_WALLPAPER, &is_vlw_file, DS_BYTE);
#endif

    mmi_phnset_wallpaper_update_display();
}

#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_lock_wallpaper_enter_mass_storage_mode
 * DESCRIPTION
 *  lock wallpaper enter mass storage mode. Notify idle.
 * PARAMETERS
 *  
 * RETURNS
 *  U16
 *****************************************************************************/
static void mmi_phnset_lock_wallpaper_enter_mass_storage_mode(void)
{
#ifdef __MMI_FILE_MANAGER__

    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (MMI_TRUE == vapp_wallpaper_provider_is_current_wallpaper_file_based(VAPP_WALLPAPER_SRC_LOCK))
    { 
		vapp_wallpaper_provider_set_usb_mass_storage_mode(MMI_TRUE);
		g_mmi_wallpaper_sl_id = RstGetWallpaperImgIdDefault();
    }
#endif
}

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_lock_wallpaper_exit_mass_storage_mode
 * DESCRIPTION
 *  lock wallpaper exit mass storage mode. Notify wallpaper
 * PARAMETERS
 *  
 * RETURNS
 *  U16
 *****************************************************************************/
static void mmi_phnset_lock_wallpaper_exit_mass_storage_mode(void)
{
	
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	vapp_wallpaper_provider_set_usb_mass_storage_mode(MMI_FALSE);
    mmi_dispchar_get_img_id(SCREEN_LOCK_WALLPAPER_STATIC_ID, &g_mmi_wallpaper_sl_id);
}

#endif

#endif /* __USB_IN_NORMAL_MODE__ */
#endif /* __MMI_USB_SUPPORT__ */
static void mmi_phnset_wallpaper_reset_to_default(MMI_BOOL update_nvram)
{
    g_mmi_wallpaper_id = RstGetWallpaperImgIdDefault();
    if (update_nvram)
	{
		wp_sub_menu_type = PHNSET_WALLPAPER_STATIC_SYSTEM;
	    mmi_phnset_wallpaper_set_static_id(g_mmi_wallpaper_id);
	}
}

static void mmi_phnset_wallpaper_update_display(void)
{
	mmi_id dummy_gid = 0; 
#ifdef __MMI_FILE_MANAGER__    
    if (g_mmi_wallpaper_id == 0)
	{
        SetIdleScreenWallpaperName((UI_string_type)idle_screen_wallpaper_name);
	}
    else
#endif        
    {
        SetIdleScreenWallpaperID(g_mmi_wallpaper_id, MMI_FALSE);
   #if 0
        #ifdef __MMI_WALLPAPER_ON_BOTTOM__
/* under construction !*/
        #endif 
        #endif     
    }
    if (mmi_idle_is_active())
    {
        dummy_gid = mmi_frm_group_create_ex(GRP_ID_ROOT, GRP_ID_AUTO_GEN, NULL, NULL, MMI_FRM_NODE_SMART_CLOSE_FLAG);
        mmi_frm_display_dummy_screen();
        mmi_frm_group_close(dummy_gid);
        //mmi_idle_display();

    }
}

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_get_static_id
 * DESCRIPTION
 *  Get cache file name 
 * PARAMETERS
 *  
 * RETURNS
 *  U16
 *****************************************************************************/
U16 mmi_phnset_wallpaper_get_static_id(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 	U16 ret = 0;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	if(g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_WP)
	{
	    ret = g_mmi_wallpaper_id;
	}
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
	else if(g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_SL_WP)
	{
		ret = g_mmi_wallpaper_sl_id;
	}
#endif
	return ret;	
}

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_set_static_id
 * DESCRIPTION
 *  Get cache file name 
 * PARAMETERS
 *  
 * RETURNS
 *  U16
 *****************************************************************************/
void mmi_phnset_wallpaper_set_static_id(U16 id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifdef __MMI_VUI_HOMESCREEN_WALLPAPER__	
    VAPP_WALLPAPER_ID_HANDLE wallpaper_static_handle = NULL;
#endif
 
    //S16 error;
    
#ifdef __MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__
    U8 is_video_wallpaper = 0;
#endif

#ifdef __MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__
        WCHAR path_buffer[400];
        U8 is_interactive_video_wallpaper = 0;
#endif
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_dispchar_set_img_id(NVRAM_FUNANDGAMES_SETWALLPAPER, &id);
    g_mmi_wallpaper_id = id;
#ifdef __MMI_VUI_HOMESCREEN_WALLPAPER__	
#ifdef __MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__
	if(wp_sub_menu_type == PHNSET_WALLPAPER_VIDEO_SYSTEM)
	{
		wallpaper_static_handle = vapp_wallpaper_provider_get_res_video_wallpaper_id_handle(g_mmi_wallpaper_id);
	}
	else
#endif
	{
		wallpaper_static_handle = vapp_wallpaper_provider_get_res_image_wallpaper_id_handle(g_mmi_wallpaper_id);
	}
	vapp_wallpaper_setting_save_wallpaper_id_handle(VAPP_WALLPAPER_SRC_HOMESCREEN, wallpaper_static_handle);
    vapp_wallpaper_id_handle_close(wallpaper_static_handle);
    wallpaper_static_handle = NULL;
#endif /* VENUS MMI */
#ifdef __MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__
    if(wp_sub_menu_type == PHNSET_WALLPAPER_VIDEO_SYSTEM)
    {
        is_video_wallpaper = 1;
        is_vlw_file = 1;
        //WriteValue(NVRAM_PHNSET_VLW_WALLPAPER, &is_video_wallpaper, DS_BYTE, &error);
		WriteValueSlim(NVRAM_PHNSET_VLW_WALLPAPER, &is_video_wallpaper, DS_BYTE);
    }
    else
    {
        is_vlw_file = 0;
        //WriteValue(NVRAM_PHNSET_VLW_WALLPAPER, &is_video_wallpaper, DS_BYTE, &error);
		WriteValueSlim(NVRAM_PHNSET_VLW_WALLPAPER, &is_video_wallpaper, DS_BYTE);
    }
#endif

#ifdef __MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__
    if(wp_sub_menu_type == PHNSET_WALLPAPER_IVLW_SYSTEM)
    {
        if(g_ivlw_cntx[g_phnset_cntx_p->curHightlightItem].mType == INTERACTIVE_WALLPAPER_LWP)
        {
            kal_wsprintf(
                    path_buffer,
                    "%c:\\%s\\",
                    SRV_FMGR_CARD_DRV,
                    INTERACTIVE_VIDEO_WALLPAPER_FOLDER);
            mmi_ucs2cat((CHAR *)path_buffer, (CHAR *)g_ivlw_cntx[g_phnset_cntx_p->curHightlightItem].path_name);
            mmi_ucs2cat((CHAR *)path_buffer, (CHAR *)L".lwp\0");
        }
        else
        {
            kal_wsprintf(
                    path_buffer,
                    "%c:\\%s\\",
                    SRV_FMGR_CARD_DRV,
                    INTERACTIVE_VIDEO_WALLPAPER_FOLDER);
            mmi_ucs2cat((CHAR *)path_buffer, (CHAR *)g_ivlw_cntx[g_phnset_cntx_p->curHightlightItem].path_name);
            mmi_ucs2cat((CHAR *)path_buffer, (CHAR *)L".mwp\0");    
        }
        mmi_wcscpy((WCHAR *)g_mmi_wallpaper_user_file.file_name, (WCHAR *)path_buffer);

        g_mmi_wallpaper_id = 0;
        mmi_dispchar_set_img_id(NVRAM_FUNANDGAMES_SETWALLPAPER, &g_mmi_wallpaper_id);
        idle_screen_wallpaper_name = (CHAR*)g_mmi_wallpaper_user_file.file_name;
        idle_screen_wallpaper_name_original = (CHAR*)g_mmi_wallpaper_user_file.file_name;

        is_interactive_video_wallpaper = 1;
        is_ivlw_file = 1;
        //WriteValue(NVRAM_PHNSET_IVLW_WALLPAPER, &is_interactive_video_wallpaper, DS_BYTE, &error);
		WriteValueSlim(NVRAM_PHNSET_IVLW_WALLPAPER, &is_interactive_video_wallpaper, DS_BYTE);
       // WriteRecord(NVRAM_EF_WALLPAPER_FILENAME_LID, 1, &g_mmi_wallpaper_user_file, sizeof(mmi_setting_display_cache_file_nvram_struct), &error);
		WriteRecordSlim(NVRAM_EF_WALLPAPER_FILENAME_LID, 1, &g_mmi_wallpaper_user_file, sizeof(mmi_setting_display_cache_file_nvram_struct));
    }
    else
    {
        is_ivlw_file = 0;
        //WriteValue(NVRAM_PHNSET_IVLW_WALLPAPER, &is_interactive_video_wallpaper, DS_BYTE, &error);
		WriteValueSlim(NVRAM_PHNSET_IVLW_WALLPAPER, &is_interactive_video_wallpaper, DS_BYTE);
    }
#endif /* VENUS MMI */	

	if (id == 0)
	{
	   return;
	}
    	
    mmi_phnset_wallpaper_update_display();

#ifdef __MMI_FILE_MANAGER__
    mmi_phnset_view_setting_cache_util_del_file(mmi_phnset_wallpaper_get_cache_file());
#endif
}


#ifdef __MMI_DOWNLOADABLE_APP_ICON_FW_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  mmi_phset_wallpaper_change_cb
 * DESCRIPTION
 *  Wallpaper Change callback for download app icon switch 
 * PARAMETERS
 *  
 * RETURNS
 *  U16
 *****************************************************************************/
MMI_RET mmi_phset_wallpaper_change_cb(mmi_event_struct *param)
{
    U16 id;
    S16 error;

#ifdef __MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__
    U8 is_video_wallpaper = 0;
#endif

#ifdef __MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__
    U8 is_interactive_video_wallpaper = 0;
#endif

    id = IMG_ID_APP_LIST_THEME_WALLPAPER_0;

    /*Set theme id as wallpaper when switch app icon*/
    g_mmi_wallpaper_id = id;
    idle_screen_wallpaper_ID = id;
    mmi_dispchar_set_img_id(NVRAM_FUNANDGAMES_SETWALLPAPER, &id);

    /*Reset video nvram value*/
#ifdef __MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__
    is_vlw_file = 0;
    WriteValue(NVRAM_PHNSET_VLW_WALLPAPER, &is_video_wallpaper, DS_BYTE, &error);
#endif

#ifdef __MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__
    is_ivlw_file = 0;
    WriteValue(NVRAM_PHNSET_IVLW_WALLPAPER, &is_interactive_video_wallpaper, DS_BYTE, &error);
#endif

    return MMI_RET_OK;
}
#endif


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_init
 * DESCRIPTION
 *  Wallpaper init function
 * PARAMETERS
 *  
 * RETURNS
 *  void
 *****************************************************************************/

static void mmi_phnset_wallpaper_init(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    static MMI_BOOL is_init = MMI_FALSE;
	//S16 error;
    PHNSET_TYPE_DISP type;
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
	PHNSET_TYPE_DISP sl_wp_type;
#endif

    if (is_init)
    {
        return;
    }
	is_init = MMI_TRUE;
	
/* Screen lock wallpaper setting init*/	
#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
	mmi_dispchar_get_img_id(SCREEN_LOCK_WALLPAPER_STATIC_ID, &g_mmi_wallpaper_sl_id);
	sl_wp_type = PhnsetGetDisplayType(g_mmi_wallpaper_sl_id);
#ifdef __MMI_FILE_MANAGER__
	if(sl_wp_type == PHNSET_TYPE_DISP_USER)
	{		
        //ReadRecord(NVRAM_EF_WALLPAPER_FILENAME_LID, g_phnset_cntx_p->wpss_type + 1, &g_mmi_wallpaper_sl_user_file, sizeof(mmi_setting_display_cache_file_nvram_struct), &error);   
		ReadRecordSlim(NVRAM_EF_WALLPAPER_FILENAME_LID, g_phnset_cntx_p->wpss_type + 1, &g_mmi_wallpaper_sl_user_file, sizeof(mmi_setting_display_cache_file_nvram_struct));
	}
	else if (sl_wp_type == PHNSET_TYPE_DISP_INVALID)
    {
		g_mmi_wallpaper_sl_id = RstGetWallpaperImgIdDefault();
		mmi_dispchar_set_img_id(SCREEN_LOCK_WALLPAPER_STATIC_ID, &g_mmi_wallpaper_sl_id);
    }
#endif /* __MMI_FILE_MANAGER__ */
#endif /* __MMI_VUI_SCREEN_LOCK_KEY__ */
#if 0
#if !defined(__OP01_FWPBW__)
/* under construction !*/
#else
/* under construction !*/
/* under construction !*/
#endif
#else
	mmi_dispchar_get_img_id(NVRAM_FUNANDGAMES_SETWALLPAPER, &g_mmi_wallpaper_id);
#endif

/*Read VLW & IVLW NVRAM Setting*/
#if defined (__MMI_LAUNCHER_APP_LIST_INTERACTIVE_VIDEO_WALLPAPER__)
    //ReadValue(NVRAM_PHNSET_IVLW_WALLPAPER, &is_ivlw_file, DS_BYTE, &error);
    ReadValueSlim(NVRAM_PHNSET_IVLW_WALLPAPER, &is_ivlw_file, DS_BYTE);
#endif

#if defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__)
    //ReadValue(NVRAM_PHNSET_VLW_WALLPAPER, &is_vlw_file, DS_BYTE, &error);
	ReadValueSlim(NVRAM_PHNSET_VLW_WALLPAPER, &is_vlw_file, DS_BYTE);
#endif

    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_READ_WP_ID, g_mmi_wallpaper_id);

    if ((type = PhnsetGetDisplayType(g_mmi_wallpaper_id)) == PHNSET_TYPE_DISP_INVALID)
    {
        PhnsetRstWallpaperDefault();
    }
#ifdef __MMI_FILE_MANAGER__
    else if (type == PHNSET_TYPE_DISP_USER)
    {
		//ReadRecord(NVRAM_EF_WALLPAPER_FILENAME_LID, 1, &g_mmi_wallpaper_user_file, sizeof(mmi_setting_display_cache_file_nvram_struct), &error);        
		ReadRecordSlim(NVRAM_EF_WALLPAPER_FILENAME_LID, 1, &g_mmi_wallpaper_user_file, sizeof(mmi_setting_display_cache_file_nvram_struct));
		#if (!defined(__MMI_VIEW_SETTING_DISABLE_CACHE__) && !defined(__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__) && !defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__))
        mmi_asc_to_wcs(g_mmi_wallpaper_cache_file_name, g_mmi_wallpaper_user_file.cache_file_name);
        #endif /* (!defined(__MMI_VIEW_SETTING_DISABLE_CACHE__) && !defined(__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__)) */
        if (  //error == NVRAM_READ_SUCCESS ||
			#if (!defined(__MMI_VIEW_SETTING_DISABLE_CACHE__) && !defined(__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__) && !defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__))
            mmi_fmgr_util_file_limit_check(FMGR_LIMIT_WALLPAPER, (CHAR*) mmi_phnset_wallpaper_get_cache_file(), &error_str_ptr)
            #else /*(!defined(__MMI_VIEW_SETTING_DISABLE_CACHE__) && !defined(__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__))*/
            mmi_fmgr_util_file_limit_check(FMGR_LIMIT_WALLPAPER, (CHAR*) mmi_phnset_wallpaper_get_user_file(), &error_str_ptr)
            #endif /*(!defined(__MMI_VIEW_SETTING_DISABLE_CACHE__) && !defined(__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__))*/
            )
        {
            SetIdleScreenWallpaperName((UI_string_type) idle_screen_wallpaper_name);
            if (mmi_idle_is_active())
            {
                mmi_idle_display();
            }
        }
        else
        {
            memset(&g_mmi_wallpaper_user_file, 0, sizeof(g_mmi_wallpaper_user_file));
            memset(g_mmi_wallpaper_cache_file_name, 0, sizeof(WCHAR) * MMI_SETTING_DISPLAY_CACHE_USER_FILE_NAME_LEN);

            PhnsetRstWallpaperDefault();
        }
    }
#endif /* __MMI_FILE_MANAGER__ */    
	else
	{
        mmi_phnset_wallpaper_update_display();
	}
} 

#ifdef __MMI_SUB_WALLPAPER__
static void mmi_phnset_sub_wallpaper_set_static_id(U16 id)
{
    g_mmi_sub_wallpaper_id = id;
    mmi_dispchar_set_img_id(NVRAM_SETWALLPAPER_SUB, &id);
    
	if (id == 0)
	{
	   return;
	}
    
    SUBLCD_SetIdleScreenWallpaperID(g_mmi_sub_wallpaper_id);
}

static void mmi_phnset_sub_wallpaper_reset_to_default(MMI_BOOL update_nvram)
{
    //g_mmi_sub_wallpaper_id = RstGetWallpaperSubImgIdDefault();
    mmi_dispchar_get_img_id(RESTORE_DEFAULT_SETWALLPAPER_SUB, &g_mmi_sub_wallpaper_id);
    if (update_nvram)
	{
	    mmi_phnset_sub_wallpaper_set_static_id(g_mmi_sub_wallpaper_id);
	}
}


static void mmi_phnset_sub_wallpaper_enter_mass_storage_mode(void)
{
#ifdef __MMI_FILE_MANAGER__
    PHNSET_TYPE_DISP type;

    type = PhnsetGetDisplayType(g_mmi_sub_wallpaper_id);
    if (type == PHNSET_TYPE_DISP_USER
        && (srv_usb_check_path_exported((WCHAR*) g_phnset_wallpaper_sub_filename.filename)))
    {
        //g_mmi_sub_wallpaper_id = RstGetWallpaperSubImgIdDefault();
		mmi_dispchar_get_img_id(RESTORE_DEFAULT_SETWALLPAPER_SUB, &g_mmi_sub_wallpaper_id);
        SUBLCD_SetIdleScreenWallpaperID(g_mmi_sub_wallpaper_id);
        MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_SUBWP_USE_DEFAULT, g_mmi_sub_wallpaper_id);
    }
#endif
}

static void mmi_phnset_sub_wallpaper_exit_mass_storage_mode(void)
{
    mmi_phnset_sub_wallpaper_init();
}

static void mmi_phnset_sub_wallpaper_init(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifdef __MMI_FILE_MANAGER__
    S16 error;
#endif
    PHNSET_TYPE_DISP type;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_dispchar_get_img_id(NVRAM_SETWALLPAPER_SUB, &g_mmi_sub_wallpaper_id);

    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_READ_SUBWP_ID, g_mmi_sub_wallpaper_id);

    if ((type = PhnsetGetDisplayType(g_mmi_sub_wallpaper_id)) == PHNSET_TYPE_DISP_INVALID)
    {
        PhnsetRstSubWallpaperDefault();
    }
#ifdef __MMI_FILE_MANAGER__
    else if (type == PHNSET_TYPE_DISP_USER)
    {
        //ReadRecord(NVRAM_EF_WALLPAPER_FILENAME_LID, g_phnset_cntx_p->wpss_type + 1, &g_mmi_sub_wallpaper_user_file, sizeof(mmi_setting_display_cache_file_nvram_struct), &error);        
		ReadRecordSlim(NVRAM_EF_WALLPAPER_FILENAME_LID, g_phnset_cntx_p->wpss_type + 1, &g_mmi_sub_wallpaper_user_file, sizeof(mmi_setting_display_cache_file_nvram_struct));
        //if (error == NVRAM_READ_SUCCESS)
        //{
            SUBLCD_SetIdleScreenWallpaperName((UI_string_type) g_mmi_sub_wallpaper_user_file.file_name);
        //}
       /*
        else
        {
            memset(&g_mmi_sub_wallpaper_user_file, 0, sizeof(g_mmi_sub_wallpaper_user_file));

            PhnsetRstSubWallpaperDefault();

        #ifdef __USB_IN_NORMAL_MODE__            
            if (srv_usb_is_leaving_ms_mode())
                SUBLCD_UpdateWallpaper();
        #endif
        }
        */
    }
#endif /* __MMI_FILE_MANAGER__ */    
	else
	{
        SUBLCD_SetIdleScreenWallpaperID(g_mmi_sub_wallpaper_id);
	}
}

#ifdef __MMI_FILE_MANAGER__
void mmi_phnset_sub_wallpaper_set_file(void* obj, const WCHAR* file_name)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    //S16 error;
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(!file_name)
    {
        return;
    }
    
    mmi_wcscpy(g_mmi_sub_wallpaper_user_file.file_name, file_name);

	g_mmi_sub_wallpaper_id = 0;
    mmi_dispchar_set_img_id(NVRAM_SETWALLPAPER_SUB, &g_mmi_sub_wallpaper_id);

    SUBLCD_SetIdleScreenWallpaperName((UI_string_type) g_mmi_sub_wallpaper_user_file.file_name);

    #ifdef __USB_IN_NORMAL_MODE__            
        if (srv_usb_is_leaving_ms_mode())
            SUBLCD_RedrawCategoryFunction();
    #endif
   
    //WriteRecord(NVRAM_EF_WALLPAPER_FILENAME_LID, g_phnset_cntx_p->wpss_type + 1, &g_mmi_sub_wallpaper_user_file, sizeof(mmi_setting_display_cache_file_nvram_struct), &error);        
	WriteRecordSlim(NVRAM_EF_WALLPAPER_FILENAME_LID, g_phnset_cntx_p->wpss_type + 1, &g_mmi_sub_wallpaper_user_file, sizeof(mmi_setting_display_cache_file_nvram_struct));

    mmi_popup_display_simple_ext(STR_GLOBAL_DONE, MMI_EVENT_SUCCESS, GRP_ID_ROOT, NULL);
    mmi_frm_group_close(GRP_ID_WALLPAPER_MAIN);

    mmi_phnset_view_setting_notify_result(MMI_TRUE, PHNSET_WP_SS_SET_NO_ERROR);
}
#endif /* __MMI_FILE_MANAGER__ */
#endif /* __MMI_SUB_WALLPAPER__ */ 

#ifdef __MMI_VUI_SCREEN_LOCK_KEY__
#ifdef __MMI_FILE_MANAGER__
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_screen_lock_direct_set_file
 * DESCRIPTION
 *  Set cache file 
 * PARAMETERS
 *  
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_phnset_wallpaper_screen_lock_direct_set_file(void* obj, const WCHAR* file_name)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
   // S16 error;
	VAPP_WALLPAPER_ID_HANDLE wallpaper_file_handle =NULL;
	
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(!file_name)
    {
        return;
    }
    
    mmi_wcscpy(g_mmi_wallpaper_sl_user_file.file_name, file_name);
	g_mmi_wallpaper_sl_id = 0;
    mmi_dispchar_set_img_id(SCREEN_LOCK_WALLPAPER_STATIC_ID, &g_mmi_wallpaper_sl_id);
	
#if defined (__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__) || defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__)
    if (srv_fmgr_types_find_group_by_filename_str(file_name) == FMGR_GROUP_VIDEO)
	{
		wallpaper_file_handle = vapp_wallpaper_provider_get_user_video_wallpaper_id_handle(g_mmi_wallpaper_sl_user_file.file_name);
	}
	else
#endif
	{
		wallpaper_file_handle = vapp_wallpaper_provider_get_user_image_wallpaper_id_handle(g_mmi_wallpaper_sl_user_file.file_name);
	}
	vapp_wallpaper_setting_save_wallpaper_id_handle(VAPP_WALLPAPER_SRC_LOCK, wallpaper_file_handle);
    vapp_wallpaper_id_handle_close(wallpaper_file_handle);
    wallpaper_file_handle = NULL;



    //WriteRecord(NVRAM_EF_WALLPAPER_FILENAME_LID, g_phnset_cntx_p->wpss_type + 1, &g_mmi_wallpaper_sl_user_file, sizeof(mmi_setting_display_cache_file_nvram_struct), &error);        
	WriteRecordSlim(NVRAM_EF_WALLPAPER_FILENAME_LID, g_phnset_cntx_p->wpss_type + 1, &g_mmi_wallpaper_sl_user_file, sizeof(mmi_setting_display_cache_file_nvram_struct));
    mmi_popup_display_simple_ext(STR_GLOBAL_DONE, MMI_EVENT_SUCCESS, GRP_ID_ROOT, NULL);
	mmi_frm_group_close(GRP_ID_WALLPAPER_LOCK_WALLPAPER);
    mmi_phnset_view_setting_notify_result(MMI_TRUE, PHNSET_WP_SS_SET_NO_ERROR);
}

#endif /* __MMI_FILE_MANAGER__ */

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_screen_lock_set_static_id
 * DESCRIPTION
 *  Set cache file 
 * PARAMETERS
 *  
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_wallpaper_screen_lock_set_static_id(U16 id)
{

	/*----------------------------------------------------------------*/
	/* Local Variables												  */
	/*----------------------------------------------------------------*/
    VAPP_WALLPAPER_ID_HANDLE wallpaper_static_handle = NULL;
	
	/*----------------------------------------------------------------*/
	/* Code Body													  */
	/*----------------------------------------------------------------*/
	mmi_dispchar_set_img_id(SCREEN_LOCK_WALLPAPER_STATIC_ID, &id);
	g_mmi_wallpaper_sl_id = id;
#if defined (__MMI_VUI_HOMESCREEN_VIDEO_WALLPAPER__) || defined (__MMI_LAUNCHER_APP_LIST_VIDEO_WALLPAPER__)
	if(wp_sub_menu_type == PHNSET_WALLPAPER_VIDEO_SYSTEM)
	{
		wallpaper_static_handle = vapp_wallpaper_provider_get_res_video_wallpaper_id_handle(g_mmi_wallpaper_sl_id);
	}
	else
#endif
	{
		wallpaper_static_handle = vapp_wallpaper_provider_get_res_image_wallpaper_id_handle(g_mmi_wallpaper_sl_id);
	}
	vapp_wallpaper_setting_save_wallpaper_id_handle(VAPP_WALLPAPER_SRC_LOCK, wallpaper_static_handle);
    vapp_wallpaper_id_handle_close(wallpaper_static_handle);
    wallpaper_static_handle = NULL;
		

}

#endif /* __MMI_VUI_SCREEN_LOCK_KEY__ */

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_entry_sel_type_wallpaper
 * DESCRIPTION
 *  Entry function for home wallpaper or lock wallpaper. 
 * PARAMETERS
 *  
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_wallpaper_entry_sel_type_wallpaper(MMI_ID parent_id)
{
	
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	MMI_ID grp_id;
	MMI_ID menu_id;
	
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	grp_id = GRP_ID_WALLPAPER_HOME_WALLPAPER + g_phnset_cntx_p->wpss_type;
	menu_id = MENU_SETTING_WALLPAPER_HOMESCREEN + g_phnset_cntx_p->wpss_type;
    if(mmi_phnset_entry_group_check_ex(parent_id,grp_id))
        return;
	
    mmi_frm_group_create_ex(
        parent_id,
        grp_id,
        mmi_phnset_wallpaper_main_menu_proc,
        NULL,
        MMI_FRM_NODE_SMART_CLOSE_FLAG);

	cui_menu_create_and_run(grp_id,
					CUI_MENU_SRC_TYPE_RESOURCE,
					CUI_MENU_TYPE_FROM_RESOURCE,
					menu_id,
					MMI_FALSE,
        			NULL);

}
#else
MMI_ID_TYPE idle_screen_wallpaper_ID;
MMI_ID_TYPE idle_screen_cache_id;
CHAR *idle_screen_wallpaper_name = NULL;
CHAR *idle_screen_cache_name = NULL;
CHAR *idle_screen_wallpaper_name_original = NULL;
void PhnsetWallpaperBadFileCallBack(U16 strID)
{
}
#ifndef __MMI_PHNSET_SLIM__
void mmi_phnset_save_wallpaper_to_speedup(void)
{

}
#endif
U8 PhnsetGetATDisplayBound(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Please refer to ATSetProfileHandler */
    return (0 /* Wallpaper -- 0 */
        + 1   /* Reserved  -- 1 */
        + 1   /* Home city -- 2 */
        + 1   /* Theme     -- 3 */
        + 1   /* Shortcut  -- 4 */
        + 1   /* Screen saver -- 5 */
#ifdef __MMI_POWER_ON_OFF_DISPLAY__
        + 2   /* Power on/off display -- 6 7 */
#endif
        );
}
void mmi_phnset_wallpaper_direct_set_file(void* obj, const WCHAR* file_name)
{
}
void PhnsetReadWallpaper(void)
{
}
void mmi_phnset_display_use_as_enabler(mmi_menu_id item_id, const WCHAR* filepath, const srv_fmgr_fileinfo_struct* fileinfo)
{
  
}
void mmi_fmgr_to_wallpaper_hdlr(mmi_menu_id item_id, const WCHAR* filepath, const srv_fmgr_fileinfo_struct* fileinfo)
{
}
mmi_ret mmi_phnset_wp_ss_pwr_disp_ms_hdlr(mmi_event_struct *evt)
{
    return MMI_RET_OK;
}
MMI_BOOL mmi_phnset_check_themeid_wallpaper(U16 imgID)
{
    return MMI_FALSE;
}
/*****************************************************************************
 * FUNCTION
 *  PhnsetGetDisplayType
 * DESCRIPTION
 *  
 * PARAMETERS
 *  id      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
PHNSET_TYPE_DISP PhnsetGetDisplayType(U16 id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (
#ifdef __MMI_POWER_ON_OFF_DISPLAY__
        (id >= IMG_ID_PHNSET_ON_START && id <= IMG_ID_PHNSET_ON_MAX)
        || (id >= IMG_ID_PHNSET_OFF_START && id <= IMG_ID_PHNSET_OFF_MAX)
#else /* __MMI_POWER_ON_OFF_DISPLAY__ */ 
        (id == IMG_ID_PHNSET_ON_ANIMATION_DEFAULT) || (id == IMG_ID_PHNSET_OFF_ANIMATION_DEFAULT)
#endif /* __MMI_POWER_ON_OFF_DISPLAY__ */ 
        )
    {
        return PHNSET_TYPE_DISP_IMAGE;
    }
#ifdef __MMI_SWFLASH__
    else if (id >= IMG_ID_DISPCHAR_SWFLASH_START && id <= IMG_ID_DISPCHAR_SWFLASH_MAX)
    {
        return PHNSET_TYPE_DISP_SWFLASH;
    }
#endif
#if defined(__MMI_VIDEO_PLAY_SUPPORT__) && defined(__MTK_TARGET__)
    else if (
#ifdef __MMI_POWER_ON_OFF_DISPLAY__
             (id >= IMG_ID_PHNSET_ON_VDO_START && id <= IMG_ID_PHNSET_ON_VDO_MAX)
             || (id >= IMG_ID_PHNSET_OFF_VDO_START && id <= IMG_ID_PHNSET_OFF_VDO_MAX)
#endif /* __MMI_POWER_ON_OFF_DISPLAY__ */ 
        )
        return PHNSET_TYPE_DISP_VIDEO;
#endif /* defined(__MMI_VIDEO_PLAY_SUPPORT__) && defined(__MTK_TARGET__) */ 
    else if (id == 0x00)
    {
        return PHNSET_TYPE_DISP_USER;
    }
    else
    {
        return PHNSET_TYPE_DISP_INVALID;
    }
}
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_enter_switch_screen
 * DESCRIPTION
 *  Create a new screen and delete old one to handle screen switch 
 * PARAMETERS
 *  
 * RETURNS
 *  
 *****************************************************************************/
MMI_BOOL mmi_phnset_enter_switch_screen(void)
{
    return MMI_FALSE;
}

#endif
