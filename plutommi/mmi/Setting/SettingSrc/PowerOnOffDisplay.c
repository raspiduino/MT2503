/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE. 
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/

/*****************************************************************************
 *
 * Filename:
 * ---------
 * PowerOnOffDisplay.c
 *
 * Project:
 * --------
 *   MAUI
 *
 * Description:
 * ------------
 *   This file is intends for Resource IDs for the Power ON/Off Display
 *
 * Author:
 * -------
 * -------
 *
 *============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *============================================================================
 ****************************************************************************/

/***************************************************************************** 
* Include
*****************************************************************************/
#include "MMI_features.h"
#include "MMIDataType.h"
#include "FileMgrSrvGProt.h"
#ifdef __MMI_POWER_ON_OFF_DISPLAY__

#include "WPSSProtos.h"
#include "WallpaperDefs.h"
#include "ProfilesSrvGprot.h"
#include "PhoneSetup.h"
#include "IdleAppDef.h"
#include "drm_def.h"
#include "drm_gprot.h"
#include "UCMGProt.h"
#include "Menucuigprot.h"
/* For user defined file image */


#include "Conversions.h"


/* auto add by kw_check begin */
#include "wgui_categories_list.h"
#include "mmi_frm_scenario_gprot.h"
#include "mmi_phnset_dispchar.h"
#include "mmi_rp_srv_phnset_onoff_def.h"
#include "MMI_common_app_trc.h"
#include "mmi_common_app_trc.h"
#include "DebugInitDef_Int.h"
#include "kal_trace.h"
#include "nvram_common_defs.h"
#include "mmi_frm_nvram_gprot.h"
#include "CustDataRes.h"
#include "mmi_rp_app_phonesetting_new_def.h"
#include "PhoneSetupResList.h"
#include "kal_general_types.h"
#include "GlobalResDef.h"
#include "mmi_frm_events_gprot.h"
#include "kal_public_api.h"
#include "wgui_categories_util.h"
#include "GlobalConstants.h"
#include "mmi_frm_history_gprot.h"
#include "wgui_categories_multimedia.h"
#include "UcmSrvGprot.h"
#include "wgui_include.h"
#include "gdi_include.h"
#include "custom_mmi_default_value.h"
#include "Unicodexdcl.h"
#include "mmi_frm_input_gprot.h"
#include "mmi_frm_mem_gprot.h"
#include "gui_typedef.h"
#include "gui.h"
#include "AlertScreen.h"
#include "mmi_rp_srv_wallpaper_def.h"
#include "mmi_rp_file_type_def.h"
#include "fs_type.h"
#include "fs_errcode.h"
#include "FileMgrType.h"
#include "FileMgrGProt.h"
#include "string.h"
#include "mmi_rp_app_mainmenu_def.h"
#include "gui_data_types.h"
/* auto add by kw_check end */
#include "IdleGprot.h"
#ifdef __MMI_USB_SUPPORT__
 #include "USBSrvGProt.h"
#endif
#include "PhoneSetupGprots.h"
#include "ViewSettingCommonProt.h"
#include "MMI_ap_dcm_config.h"
/***************************************************************************** 
* External Function
*****************************************************************************/
/***************************************************************************** 
* Typedef
*****************************************************************************/
typedef struct
{
    U16 cache_id;
    U16 default_cache_id;
    U16 nvram_lid;
    U16 nvram_nid;
} mmi_phnset_pwr_on_off_nvram_id_struct;

/***************************************************************************** 
* Local Variable
*****************************************************************************/
#define MMI_PWR_ON_OFF_DISP_TYPE_NUM (2)

static U8 item_amount;

static U16 g_mmi_phnset_pwr_on_off_id[MMI_PWR_ON_OFF_DISP_TYPE_NUM];
static mmi_setting_display_cache_file_nvram_struct g_phnset_pwr_on_off_filename[MMI_PWR_ON_OFF_DISP_TYPE_NUM];

const static mmi_phnset_pwr_on_off_nvram_id_struct g_mmi_phnset_pwr_on_off_nvram_id[MMI_PWR_ON_OFF_DISP_TYPE_NUM] =
{
    {NVRAM_CURRENT_POWER_ON_DISPLAY, NVRAM_RESTORE_POWER_ON_DISPLAY, NVRAM_EF_POWER_ON_OFF_DISP_FILENAME_LID, 1},
    {NVRAM_CURRENT_POWER_OFF_DISPLAY, NVRAM_RESTORE_POWER_OFF_DISPLAY, NVRAM_EF_POWER_ON_OFF_DISP_FILENAME_LID, 2}
};

/***************************************************************************** 
* Local Function
*****************************************************************************/
static mmi_ret mmi_phnset_pwr_on_off_sub_menu_entry_handler(cui_menu_event_struct *param, MMI_ID parent_gid);
static mmi_ret mmi_phnset_pwr_on_off_sub_menu_select_handler(cui_menu_event_struct *param, MMI_ID parent_gid);
static void mmi_phnset_init_pwr_on_off_menu(void);
static void mmi_phnset_entry_pwr_on_off_sys_int(mmi_scrn_essential_struct *scrn_data);
static void mmi_phnset_entry_pwr_on_off_main(mmi_id parent_gid);
static mmi_ret mmi_phnset_pwr_on_off_main_proc(mmi_event_struct *evt);
static void mmi_phnset_pwr_on_off_init(void);
static void mmi_phnset_pwr_on_off_reset_to_default(U32 type, MMI_BOOL update_nvram);
static void mmi_phnset_pwr_on_off_init_int(U32 type);
/*****************************************************************************
 * FUNCTION
 *  PhnsetReadPwrOnOffDisp
 * DESCRIPTION
 *  This function is to read power on/off display from NVRAM at initialization
 *  , and set as current
 *  Functionality: Referenced at InitNvramData when bootup
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        Void *
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetReadPwrOnOffDisp(void)
{
    mmi_phnset_pwr_on_off_init();
}
#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata = "DYNAMIC_CODE_SETTINGS_RODATA" , code = "DYNAMIC_CODE_SETTINGS_ROCODE"
#endif
static WCHAR* mmi_phnset_pwr_on_off_display_get_hint(U32 type)
{
    WCHAR* ret_string = NULL;

#ifdef __MMI_FILE_MANAGER__    
    if (mmi_phnset_pwr_on_off_get_static_id(type) == 0)
    {
            ret_string = mmi_phnset_view_setting_util_get_file_name_ptr(mmi_phnset_pwr_on_off_get_user_file(type));
    }
    else
#endif /* __MMI_FILE_MANAGER__ */        
    {
    #if defined(__MMI_POWER_ON_OFF_DISPLAY_VIDEO__) && defined(__MTK_TARGET__)
#ifndef __MMI_MAINLCD_96X64__    
        if (PhnsetGetDisplayType(mmi_phnset_pwr_on_off_get_static_id(type)) == PHNSET_TYPE_DISP_VIDEO)
        {
			U16 video_start_idx = (type == MMI_PHNSET_TYPE_PWRON ? IMG_ID_PHNSET_ON_VDO_START : IMG_ID_PHNSET_OFF_VDO_START);
            ret_string = (WCHAR*)GetString((U16)
                          (STR_ID_PHNSET_DISPCHAR_VDOID_START +
                           (mmi_phnset_pwr_on_off_get_static_id(type) - video_start_idx)));
        }
        else
#endif            
    #endif /* defined(__MMI_POWER_ON_OFF_DISPLAY_VIDEO__) && defined(__MTK_TARGET__) */ 
        {
			U16 image_start_idx = (type == MMI_PHNSET_TYPE_PWRON ? IMG_ID_PHNSET_ON_START : IMG_ID_PHNSET_OFF_START);
            ret_string = (WCHAR*)GetString((U16)
                          (STR_ID_PHNSET_DISPCHAR_ANMID_START +
                           (mmi_phnset_pwr_on_off_get_static_id(type) - image_start_idx)));
        }
    }
    return ret_string;
}

/*****************************************************************************
 * FUNCTION
 *  HintPhnsetPwrOnDisplay
 * DESCRIPTION
 *  hint handler when move to power on display
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void HintPhnsetPwrOnDisplay(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    WCHAR *p = mmi_phnset_pwr_on_off_display_get_hint(MMI_PHNSET_TYPE_PWRON);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (p)
    {
        cui_menu_set_item_hint(
            mmi_frm_group_get_active_id(),
            MENU_SETTING_POWER_ON_DISPLAY,
            p);
    }

}


/*****************************************************************************
 * FUNCTION
 *  HintPhnsetPwrOffDisplay
 * DESCRIPTION
 *  hint handler when move to power off display
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void HintPhnsetPwrOffDisplay(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    WCHAR *p = mmi_phnset_pwr_on_off_display_get_hint(MMI_PHNSET_TYPE_PWROFF);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (p)
    {
        cui_menu_set_item_hint(
            mmi_frm_group_get_active_id(),
            MENU_SETTING_POWER_OFF_DISPLAY,
            p);
    }
}


/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetPowerOnOffSys
 * DESCRIPTION
 *  To view build-in image/video list
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnsetPowerOnOffSys(MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!parent_gid)
	{
	    parent_gid = GRP_ID_ROOT;
	}
    if (mmi_frm_group_is_present(GRP_ID_POWER_ON_OFF_SYSTEM))
	{
	    mmi_frm_group_close(GRP_ID_POWER_ON_OFF_SYSTEM);
	}
    
    mmi_frm_group_create_ex(parent_gid, GRP_ID_POWER_ON_OFF_SYSTEM, NULL, NULL, MMI_FRM_NODE_SMART_CLOSE_FLAG);   
    if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_PWRON)
	{
        mmi_frm_scrn_first_enter(
            GRP_ID_POWER_ON_OFF_SYSTEM,
            SCR_ID_PHNSET_POWER_ON_SYSTEM_LIST,
            (FuncPtr)mmi_phnset_entry_pwr_on_off_sys_int,
            NULL);
	}
    else
    {
        mmi_frm_scrn_first_enter(
            GRP_ID_POWER_ON_OFF_SYSTEM,
            SCR_ID_PHNSET_POWER_OFF_SYSTEM_LIST,
            (FuncPtr)mmi_phnset_entry_pwr_on_off_sys_int,
            NULL);        
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_entry_pwr_on_off_sys_int
 * DESCRIPTION
 *  Internal entry function for power on off screen system resource setting menu 
 * PARAMETERS
 *  scrn_data   [IN]
 * RETURNS
 *  static void
 *****************************************************************************/
static void mmi_phnset_entry_pwr_on_off_sys_int(mmi_scrn_essential_struct *scrn_data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
     U8 *guiBuffer = NULL;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_scrn_enter(
        scrn_data->group_id,
        scrn_data->scrn_id,
        NULL,
        (FuncPtr)mmi_phnset_entry_pwr_on_off_sys_int,
        MMI_FRM_UNKNOW_SCRN);
    guiBuffer = mmi_frm_scrn_get_gui_buf(scrn_data->group_id, scrn_data->scrn_id);
    
    if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_PWRON)
    {
        MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_PWR_ENTRY_SYS_POWERON);
    }
    else if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_PWROFF)
    {
        MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_PWR_ENTRY_SYS_POWEROFF);
    }
    else
    {
        ASSERT(0);
    }

    RegisterHighlightHandler(PhnsetPowerOnOffSysHiliteHandler);

    g_phnset_cntx_p->curHightlightItem = 0;
    item_amount = PhnsetConstSysPwrOnOffList(
                    subMenuDataPtrs,
                    g_phnset_cntx_p->SysWPSSList,
                    (S16*) & (g_phnset_cntx_p->curHightlightItem));

    if ((g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_PWRON && !mmi_phnset_pwr_on_off_get_static_id(MMI_PHNSET_TYPE_PWRON)) ||
        (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_PWROFF && !mmi_phnset_pwr_on_off_get_static_id(MMI_PHNSET_TYPE_PWROFF)))
        g_phnset_cntx_p->curHightlightItem = 0;

    EnableCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);

    ShowCategory36Screen(
        STR_GLOBAL_SELECT,
        IMG_SCR_SETTING_CAPTION,
        STR_GLOBAL_VIEW,
        0,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        item_amount,
        subMenuDataPtrs,
        (U16) (g_phnset_cntx_p->curHightlightItem),
        guiBuffer);

    SetLeftSoftkeyFunction(EntryPhnsetPwrOnOffSysView, KEY_EVENT_UP);
    SetCenterSoftkeyFunction(EntryPhnsetPwrOnOffSysView, KEY_EVENT_UP);
    //SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);

}    


/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetPwrOnOffSysView
 * DESCRIPTION
 *  To preview build-in image/video
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnsetPwrOnOffSysView(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 strID;
    U16 resID;
    U8 *guiBuffer = NULL;
	#if defined(__MMI_POWER_ON_OFF_DISPLAY_VIDEO__) && defined(__MTK_TARGET__)
    MMI_BOOL vol_is_on = MMI_FALSE;
	#endif /* defined(__MMI_POWER_ON_OFF_DISPLAY_VIDEO__) && defined(__MTK_TARGET__) */
	#ifndef __MMI_POWER_ON_OFF_MUTE__
	srv_prof_audio_id audio_id;   
	#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_phnset_cntx_p->isCorrectSet = 0;

    mmi_phnset_enter_switch_screen();
    guiBuffer = mmi_frm_scrn_get_gui_buf(GRP_ID_POWER_ON_OFF_SYSTEM, mmi_frm_scrn_get_active_id());
#ifndef __MMI_PHNSET_WP_SLIM__
    wgui_set_touch_title_bar_buttons(); /* enable the display of title bar buttons */

#if defined(__MMI_TOUCH_SCREEN__)
    /* register the handlers for pen down event. */
    register_touch_button_handlers(NULL, PhnsetPwrOnOffSysViewPre, NULL, PhnsetPwrOnOffSysViewNext);
#endif /* defined(__MMI_TOUCH_SCREEN__) */ 
#endif

    resID = g_phnset_cntx_p->SysWPSSList[g_phnset_cntx_p->curHightlightItem];

#if defined(__MMI_POWER_ON_OFF_DISPLAY_VIDEO__) && defined(__MTK_TARGET__)
#ifndef __MMI_MAINLCD_96X64__
    if ((g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_PWRON) && (g_phnset_cntx_p->curHightlightItem < MAX_POWER_ON_VDO)
        || (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_PWROFF) &&
        (g_phnset_cntx_p->curHightlightItem < MAX_POWER_OFF_VDO))
    {
        /* This bucket handle build-in videos */
        strID = STR_ID_PHNSET_DISPCHAR_VDOID_START + g_phnset_cntx_p->curHightlightItem;

		mmi_frm_start_scenario(MMI_SCENARIO_ID_HIGH_SCRN);
		
        MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_PWR_ENTRY_SYS_VIDEO_VIEW, strID, resID);
    #ifdef __DRM_SUPPORT__
        wgui_catvdo_set_drm_flag(WGUI_CATVDO_DRM_DISABLE_CONSUME_ALL);
    #endif /* __DRM_SUPPORT__ */
	#ifndef __MMI_POWER_ON_OFF_MUTE__
		if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_PWRON)
		{
			srv_prof_get_current_profile_value(SRV_PROF_SETTINGS_POWER_ON_TONE,&audio_id);
		}
		else if(g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_PWROFF)
		{
			srv_prof_get_current_profile_value(SRV_PROF_SETTINGS_POWER_OFF_TONE,&audio_id);
		}
	#endif
        if (srv_prof_is_profile_activated(SRV_PROF_SILENT_MODE) != SRV_PROF_RET_PROFILE_ACTIVATED
		#ifndef __MMI_POWER_ON_OFF_MUTE__
			&& audio_id != SRV_PROF_TONE_NONE
		#endif
			)
    	{
    	    vol_is_on = MMI_TRUE;
    	}
#ifdef __MMI_BACKGROUND_CALL__
        if (srv_ucm_is_background_call() && vol_is_on)
        {
			mmi_ucm_app_entry_error_message();
			mmi_frm_group_close(GRP_ID_POWER_ON_OFF_SYSTEM);
            return;
        }
#endif /* __MMI_BACKGROUND_CALL__ */

        EnableCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
        wgui_softkey_disable_text_translucence();
        ShowCategory225Screen(
            strID,                      /* title_str */
            0,                          /* title_icon */
            STR_GLOBAL_OK,              /* lsk_str */
            IMG_GLOBAL_OK,              /* lsk_icon */
            STR_GLOBAL_BACK,            /* rsk_str */
            IMG_GLOBAL_BACK,            /* rsk_icon */
            resID,                      /* video_id */
            NULL,                       /* video_filename */
            0,                       		/* repeat_count */
            TRUE,                       /* is_visual_update */
            vol_is_on,   /* is_play_audio */
            TRUE,                       /* is_lcd_no_sleep */
            GDI_COLOR_BLACK,            /* bg_color */
            mmi_phnset_view_setting_common_video_play_callback, /* callback */
            guiBuffer);                 /* gui_buffer */

        SetLeftSoftkeyFunction(PhnsetSetPwrOnOffDisplay, KEY_EVENT_UP);
        SetCenterSoftkeyFunction(PhnsetSetPwrOnOffDisplay, KEY_EVENT_UP);        
#ifdef __MMI_FILE_MANAGER__
        SetRightSoftkeyFunction(mmi_frm_scrn_close_active_id, KEY_EVENT_UP);
#else
        SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
#endif
    }
    else
#endif        
#endif /* defined(__MMI_POWER_ON_OFF_DISPLAY_VIDEO__) && defined(__MTK_TARGET__) */ 
    {
        /* This bucket handle build-in images */
        U8 imgName[MAX_IMAGE_NAME_WIDTH];
        if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_PWRON)
        {
            strID = STR_ID_PHNSET_DISPCHAR_ANMID_START + (resID - IMG_ID_PHNSET_ON_START);
        }
        else
        {
            strID = STR_ID_PHNSET_DISPCHAR_ANMID_START + (resID - IMG_ID_PHNSET_OFF_START);
        }

        MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_PWR_ENTRY_SYS_IMAGE_VIEW, strID, resID);

        mmi_ucs2cpy((CHAR*) imgName, GetString(strID));

        {   
            EnableCenterSoftkey(0, IMG_GLOBAL_COMMON_CSK);
            wgui_softkey_disable_text_translucence();    
            ShowCategory129Screen(
                imgName,
                0,
                STR_GLOBAL_OK,
                IMG_GLOBAL_OK,
                STR_GLOBAL_BACK,
                IMG_GLOBAL_BACK,
                resID,
                guiBuffer);
        }
        SetLeftSoftkeyFunction(PhnsetSetPwrOnOffDisplay, KEY_EVENT_UP);
        SetCenterSoftkeyFunction(PhnsetSetPwrOnOffDisplay, KEY_EVENT_UP);
        //SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    }
#ifndef __MMI_PHNSET_WP_SLIM__
    /* for handle long press LNK and RNK */
    mmi_frm_send_incomplete_key_event_to_new_screen(MMI_TRUE);     
    SetKeyHandler(PhnsetPwrOnOffSysViewPre, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(PhnsetPwrOnOffSysViewPre, KEY_LEFT_ARROW, KEY_REPEAT);    
    SetKeyHandler(PhnsetPwrOnOffSysViewPre, KEY_LEFT_ARROW, KEY_LONG_PRESS);        
    SetKeyHandler(PhnsetPwrOnOffSysViewNext, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(PhnsetPwrOnOffSysViewNext, KEY_RIGHT_ARROW, KEY_REPEAT);    
    SetKeyHandler(PhnsetPwrOnOffSysViewNext, KEY_RIGHT_ARROW, KEY_LONG_PRESS);           
#endif
}

#ifndef __MMI_PHNSET_WP_SLIM__
/*****************************************************************************
 * FUNCTION
 *  PhnsetPwrOnOffSysViewPre
 * DESCRIPTION
 *  To preview previous build-in image/video
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetPwrOnOffSysViewPre(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ExitCategoryFunction();
    if (g_phnset_cntx_p->curHightlightItem <= 0)
    {
        g_phnset_cntx_p->curHightlightItem = item_amount;
    }

    g_phnset_cntx_p->curHightlightItem--;
    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_PWR_ENTRY_SYS_VIEW_PRE, g_phnset_cntx_p->curHightlightItem);
    EntryPhnsetPwrOnOffSysView();
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetPwrOnOffSysViewNext
 * DESCRIPTION
 *  To preview next build-in image/video
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetPwrOnOffSysViewNext(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ExitCategoryFunction(); 
    if (g_phnset_cntx_p->curHightlightItem >= item_amount - 1)
    {
        g_phnset_cntx_p->curHightlightItem = -1;
    }

    g_phnset_cntx_p->curHightlightItem++;
    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_PWR_ENTRY_SYS_VIEW_NEXT, g_phnset_cntx_p->curHightlightItem);

    EntryPhnsetPwrOnOffSysView();
}
#endif

/*****************************************************************************
 * FUNCTION
 *  PhnsetPowerOnOffSysHiliteHandler
 * DESCRIPTION
 *  Callback of highlight moving
 * PARAMETERS
 *  nIndex      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetPowerOnOffSysHiliteHandler(S32 nIndex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined(__MMI_POWER_ON_OFF_DISPLAY_VIDEO__) && defined(__MTK_TARGET__)
    U8 max_video = 0;

    if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_PWRON)
    {
        max_video = MAX_POWER_ON_VDO;
    }
    else if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_PWROFF)
    {
        max_video = MAX_POWER_OFF_VDO;
    }

    if (nIndex < max_video)
    {
        ChangeLeftSoftkey(STR_GLOBAL_PLAY, 0);
    }
    else
#endif /* defined(__MMI_POWER_ON_OFF_DISPLAY_VIDEO__) && defined(__MTK_TARGET__) */
    if (nIndex > item_amount - MAX_DISPCHAR_SWFLASH - 1)
        ChangeLeftSoftkey(STR_GLOBAL_PLAY, 0);
    else
        ChangeLeftSoftkey(STR_GLOBAL_VIEW, 0);

    g_phnset_cntx_p->curHightlightItem = (U16) nIndex;

}
#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata , code
#endif
/*****************************************************************************
 * FUNCTION
 *  PhnsetConstSysPwrOnOffList
 * DESCRIPTION
 *  To construct build-in power on/off disp. image/video list
 * PARAMETERS
 *  pSysPwrOnOffStrList         [IN]        
 *  pSysPwrOnOffImgIDList       [?]         
 *  HighliteItem                [?]         
 * RETURNS
 *  void
 *****************************************************************************/
U8 PhnsetConstSysPwrOnOffList(U8 **pSysPwrOnOffStrList, U16 *pSysPwrOnOffImgIDList, S16 *HighliteItem)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 i;
    U16 currentID = 0;
    U16 max_animation = 0, max_video = 0;
    U16 vdoStart = 0, imgStart = 0;
    U16 strID = 0, imgID = 0;

#ifdef __MMI_SWFLASH__
        U8 index_swflash = 0;
#endif
        U8 index_img = 0; /* count of image */
        U8 index_vdo = 0; /* count of video */

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    /* Layout
     *
     * -- Video         --
     *
     * -- Normal Images --
     * -- Normal Images -- SVG
     * -- Normal Images -- M3D
     * -- SWFLASH        --
     * 
     */

    max_animation = MAX_POWER_ON_IMG; /* same as MAX_POWER_OFF_IMG */
    max_video = MAX_POWER_ON_VDO; /* same as MAX_POWER_OFF_VDO */

    if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_PWRON)
    {
        if (max_video)
        {
            vdoStart = IMG_ID_PHNSET_ON_VDO_START;
        }
        imgStart = IMG_ID_PHNSET_ON_START;
        currentID = mmi_phnset_pwr_on_off_get_static_id(MMI_PHNSET_TYPE_PWRON);
    }
    else if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_PWROFF)
    {
        if (max_video)
        {
            vdoStart = IMG_ID_PHNSET_OFF_VDO_START;
        }
        imgStart = IMG_ID_PHNSET_OFF_START;
        currentID = mmi_phnset_pwr_on_off_get_static_id(MMI_PHNSET_TYPE_PWROFF);
    }


    for (i = 0; i < (max_animation + max_video); i++)
    {
        if (i < max_video)
        {
           imgID = vdoStart + i;
        }
        else if (i >= max_video && 
                 i < (max_video + max_animation - MAX_DISPCHAR_SWFLASH))
        {
           imgID = imgStart + (i - max_video);
        }
        else
        {
            imgID = IMG_ID_DISPCHAR_SWFLASH_START + (i - (max_video + max_animation - MAX_DISPCHAR_SWFLASH));
        }
        
        
#ifndef __MMI_MAINLCD_96X64__ 
        if (imgID >= vdoStart && imgID < (vdoStart + max_video))
        {
            strID = STR_ID_PHNSET_DISPCHAR_VDOID_START + index_vdo;
            ++index_vdo;
        }
        else if ((imgID >= IMG_ID_PHNSET_ON_START && imgID <= IMG_ID_PHNSET_ON_MAX) ||
           (imgID >= IMG_ID_PHNSET_OFF_START && imgID <= IMG_ID_PHNSET_OFF_MAX))
#else
        if ((imgID >= IMG_ID_PHNSET_ON_START && imgID <= IMG_ID_PHNSET_ON_MAX) ||
                 (imgID >= IMG_ID_PHNSET_OFF_START && imgID <= IMG_ID_PHNSET_OFF_MAX))
#endif                 
        {
            strID = STR_ID_PHNSET_DISPCHAR_ANMID_START + index_img;
            index_img++;
        }
            
        if (pSysPwrOnOffImgIDList)
        {
            pSysPwrOnOffImgIDList[i] = imgID;
        }

        if (pSysPwrOnOffStrList)
        {
            pSysPwrOnOffStrList[i] = (PU8) GetString(strID);
        }

        if (HighliteItem && currentID == pSysPwrOnOffImgIDList[i])
        {
            *HighliteItem = i;
        }
    }


    i = max_video + max_animation;

    return i;   /* amount, will be used to construct list */

}


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetPwrOnDisp
 * DESCRIPTION
 *  To get power on disp. id
 * PARAMETERS
 *  id      [?]     
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetGetPwrOnDisp(U16 *id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    *id = mmi_phnset_pwr_on_off_get_static_id(MMI_PHNSET_TYPE_PWRON);
    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_PWR_GET_PWRON_ID, *id);
	
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetPwrOnFileName
 * DESCRIPTION
 *  To get power on disp. path
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
CHAR* PhnsetGetPwrOnFileName(void)
{
    return (CHAR*)mmi_phnset_pwr_on_off_get_user_file(MMI_PHNSET_TYPE_PWRON);
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetPwrOffDisp
 * DESCRIPTION
 *  To get power off disp. id
 * PARAMETERS
 *  id      [?]     
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetGetPwrOffDisp(U16 *id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    *id = mmi_phnset_pwr_on_off_get_static_id(MMI_PHNSET_TYPE_PWROFF);
    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_PWR_GET_PWROFF_ID, *id);
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetPwrOffFileName
 * DESCRIPTION
 *  To get power off disp. path
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
CHAR* PhnsetGetPwrOffFileName(void)
{
    return (CHAR*)mmi_phnset_pwr_on_off_get_user_file(MMI_PHNSET_TYPE_PWROFF);
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetRstPwrOnDisplayDefault
 * DESCRIPTION
 *  To restore default power on build-in id
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetRstPwrOnDisplayDefault(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_phnset_pwr_on_off_reset_to_default(MMI_PHNSET_TYPE_PWRON, MMI_TRUE);

    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_PWR_RST_PWRON_DEFAULT, mmi_phnset_pwr_on_off_get_static_id(MMI_PHNSET_TYPE_PWRON));
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetRstPwrOffDisplayDefault
 * DESCRIPTION
 *  To restore default power off build-in id
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetRstPwrOffDisplayDefault(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_phnset_pwr_on_off_reset_to_default(MMI_PHNSET_TYPE_PWROFF, MMI_TRUE);
    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_PWR_RST_PWROFF_DEFAULT, mmi_phnset_pwr_on_off_get_static_id(MMI_PHNSET_TYPE_PWROFF));
}

#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata = "DYNAMIC_CODE_SETTINGS_RODATA" , code = "DYNAMIC_CODE_SETTINGS_ROCODE"
#endif
/*****************************************************************************
 * FUNCTION
 *  ExitPhnsetPwrOnOffSysView
 * DESCRIPTION
 *  Release/reset buffer/variables/history
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void ExitPhnsetPwrOnOffSysView(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#if defined(__MMI_POWER_ON_OFF_DISPLAY_VIDEO__) && defined(__MTK_TARGET__)
    U16 resID = g_phnset_cntx_p->SysWPSSList[g_phnset_cntx_p->curHightlightItem];
#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_EXIT_PWR_ONOFF_SYS_VIEW, g_phnset_cntx_p->isCorrectSet);

#if defined(__MMI_POWER_ON_OFF_DISPLAY_VIDEO__) && defined(__MTK_TARGET__)
	if (PhnsetGetDisplayType(resID) == PHNSET_TYPE_DISP_VIDEO)
	{
		mmi_frm_end_scenario(MMI_SCENARIO_ID_HIGH_SCRN);
	}	
#endif

    if (g_phnset_cntx_p->isCorrectSet)
    {
    #ifdef __MMI_FILE_MANAGER__
        if (mmi_frm_group_is_present(GRP_ID_POWER_ON_OFF_PREVIEW))
    	{
            mmi_frm_group_close(GRP_ID_POWER_ON_OFF_PREVIEW);	
    	}
#ifndef __MMI_MAINLCD_96X64__        
        if (mmi_frm_group_is_present(GRP_ID_DISPLAY_FMGR_COMMON))
    	{
            mmi_frm_group_close(GRP_ID_DISPLAY_FMGR_COMMON);
    	}
#endif        

    #endif /* __MMI_FILE_MANAGER__ */
        mmi_frm_group_close(GRP_ID_POWER_ON_OFF_MAIN);
    }

}


/*****************************************************************************
 * FUNCTION
 *  PhnsetSetPwrOnOffDisplay
 * DESCRIPTION
 *  Set Current Power on/off disp. by current highlight or selected path
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetSetPwrOnOffDisplay(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_SET_PWR_DISPLAY);
    mmi_phnset_pwr_on_off_set_static_id(
        g_phnset_cntx_p->wpss_type,
        g_phnset_cntx_p->SysWPSSList[g_phnset_cntx_p->curHightlightItem]);

    g_phnset_cntx_p->isCorrectSet = 1;
	mmi_popup_display_simple_ext(STR_GLOBAL_DONE, MMI_EVENT_SUCCESS, GRP_ID_ROOT, NULL);

    ExitPhnsetPwrOnOffSysView();
}
#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata , code
#endif
#ifdef __USB_IN_NORMAL_MODE__
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_pwr_on_off_enter_mass_storage_mode
 * DESCRIPTION
 *  Use default build-in image/video
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_phnset_pwr_on_off_enter_mass_storage_mode(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    PHNSET_TYPE_DISP res_type;
    U8 index;

    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    for (index = 0; index < MMI_PWR_ON_OFF_DISP_TYPE_NUM; index++)
	{
        U32 type = index + MMI_PHNSET_TYPE_PWRON;
        res_type = PhnsetGetDisplayType(mmi_phnset_pwr_on_off_get_static_id(type));
        if (res_type == PHNSET_TYPE_DISP_USER
            && (srv_usb_check_path_exported((WCHAR*)g_phnset_pwr_on_off_filename[index].file_name)))
        {
            /* Temporaly reset the power on off display to default because of mass storage mode */
            mmi_phnset_pwr_on_off_reset_to_default(type, MMI_FALSE);
        }
	}
    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_PWR_USE_DEFAULT, mmi_phnset_pwr_on_off_get_static_id(MMI_PHNSET_TYPE_PWRON), mmi_phnset_pwr_on_off_get_static_id(MMI_PHNSET_TYPE_PWROFF));
}

void mmi_phnset_pwr_on_off_exit_mass_storage_mode(void)
{
    mmi_phnset_pwr_on_off_init_int(MMI_PHNSET_TYPE_PWRON);
    mmi_phnset_pwr_on_off_init_int(MMI_PHNSET_TYPE_PWROFF);
}
#endif /* __USB_IN_NORMAL_MODE__ */ 

#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata = "DYNAMIC_CODE_SETTINGS_RODATA" , code = "DYNAMIC_CODE_SETTINGS_ROCODE"
#endif
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_pwr_on_of_proc
 * DESCRIPTION
 *  Proc function for power on off menu 
 * PARAMETERS
 *  param   [IN]
 * RETURNS
 *  mmi_ret
 *****************************************************************************/
mmi_ret mmi_phnset_pwr_on_off_sub_menu_handler(cui_menu_event_struct *param, MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (param->evt_id)
    {
    case EVT_ID_CUI_MENU_LIST_ENTRY:
        return mmi_phnset_pwr_on_off_sub_menu_entry_handler(param, parent_gid);


    case EVT_ID_CUI_MENU_ITEM_SELECT:
    case EVT_ID_CUI_MENU_ITEM_TAP:        
        return mmi_phnset_pwr_on_off_sub_menu_select_handler(param, parent_gid);

       
    default:
		break;
    }

    return MMI_RET_DONT_CARE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_pwr_on_off_sub_menu_entry_handler
 * DESCRIPTION
 *  Entry proc function for power on off menu 
 * PARAMETERS
 *  param   [IN]
 * RETURNS
 *  mmi_ret
 *****************************************************************************/
static mmi_ret mmi_phnset_pwr_on_off_sub_menu_entry_handler(cui_menu_event_struct *param, MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (param->parent_menu_id)
    {
    case MENU_SETTING_POWER_ON_DISPLAY:
    case MENU_SETTING_POWER_OFF_DISPLAY:
	    mmi_phnset_init_pwr_on_off_menu();
        return MMI_RET_OK;

    default:
        break;	
    }
    return MMI_RET_DONT_CARE;    
}    

    
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_pwr_on_off_sub_menu_select_handler
 * DESCRIPTION
 *  Select proc function for power on off menu 
 * PARAMETERS
 *  param   [IN]
 * RETURNS
 *  mmi_ret
 *****************************************************************************/
static mmi_ret mmi_phnset_pwr_on_off_sub_menu_select_handler(cui_menu_event_struct *param, MMI_ID parent_gid)    
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (param->highlighted_menu_id)
    {
    case MENU_SETTING_POWER_ON_DISPLAY:
        g_phnset_cntx_p->wpss_type = MMI_PHNSET_TYPE_PWRON;
        mmi_phnset_entry_pwr_on_off_main(parent_gid);
        return MMI_RET_OK;        

    case MENU_SETTING_POWER_OFF_DISPLAY:
        g_phnset_cntx_p->wpss_type = MMI_PHNSET_TYPE_PWROFF;
        mmi_phnset_entry_pwr_on_off_main(parent_gid);
        return MMI_RET_OK;        

    case MENU_SETTING_POWER_ON_SYSTEM:
    case MENU_SETTING_POWER_OFF_SYSTEM:
        EntryPhnsetPowerOnOffSys(parent_gid);
        return MMI_RET_OK;

#if defined(__MMI_FILE_USEAS_SUPPORT__)
    case MENU_SETTING_POWER_ON_DOWNLOAD:
    case MENU_SETTING_POWER_OFF_DOWNLOAD:
        mmi_phnset_view_setting_common_entry_fmgr(parent_gid, g_phnset_cntx_p->wpss_type);
        return MMI_RET_OK;

#endif

    default:
    	break;
    }
    return MMI_RET_DONT_CARE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_init_pwr_on_off_menu
 * DESCRIPTION
 *  Initialize power on off menu 
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_init_pwr_on_off_menu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID pwr_on_off_menu_cui_id = mmi_frm_group_get_active_id();
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* set menu list flags to numbered icon menu list at the first time enter*/
    cui_menu_set_currlist_flags(pwr_on_off_menu_cui_id, CUI_MENU_NORMAL_LIST_WITH_NUMBERED_ICONS);
    cui_menu_set_default_title_image_by_id(pwr_on_off_menu_cui_id, MAIN_MENU_TITLE_SETTINGS_ICON);

    cui_menu_set_currlist_left_softkey_by_id(pwr_on_off_menu_cui_id, STR_GLOBAL_OK);
    cui_menu_set_currlist_right_softkey_by_id(pwr_on_off_menu_cui_id, STR_GLOBAL_BACK);     
}

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_entry_screensaver_main
 * DESCRIPTION
 *  Entry the main menu of screen saver 
 * PARAMETERS
 *  
 * RETURNS
 *  static void
 *****************************************************************************/
static void mmi_phnset_entry_pwr_on_off_main(mmi_id parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_menu_id menu_id = 0;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_frm_group_is_present(GRP_ID_POWER_ON_OFF_MAIN))
	{
	    mmi_popup_display_simple_ext(STR_GLOBAL_NOT_AVAILABLE, MMI_EVENT_NOT_AVAILABLE, GRP_ID_ROOT, NULL);
        return;
	}
    if (!parent_gid)
	{
	    parent_gid = GRP_ID_ROOT;
	}

    mmi_frm_group_create_ex(
        parent_gid,
        GRP_ID_POWER_ON_OFF_MAIN,
        mmi_phnset_pwr_on_off_main_proc,
        NULL,
        MMI_FRM_NODE_SMART_CLOSE_FLAG);
    
    if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_PWRON)
	{
	    menu_id = MENU_SETTING_POWER_ON_DISPLAY;
	}
    else if (g_phnset_cntx_p->wpss_type == MMI_PHNSET_TYPE_PWROFF)
	{
	    menu_id = MENU_SETTING_POWER_OFF_DISPLAY;	
	}
    else
    {
        ASSERT(0);
    }
    
 	cui_menu_create_and_run(
        GRP_ID_POWER_ON_OFF_MAIN,
        CUI_MENU_SRC_TYPE_RESOURCE,
        CUI_MENU_TYPE_APPMAIN,
        menu_id,
        MMI_FALSE,
        NULL);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_screensaver_main_proc
 * DESCRIPTION
 *  Proc function of screen saver 
 * PARAMETERS
 *  
 * RETURNS
 *  static mmi_ret
 *****************************************************************************/
static mmi_ret mmi_phnset_pwr_on_off_main_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (evt->evt_id == EVT_ID_CUI_MENU_CLOSE_REQUEST)
	{
	    cui_menu_close(((cui_menu_event_struct*)evt)->sender_id);
        return MMI_RET_OK;
	}
    else if (cui_menu_is_menu_event(evt->evt_id))
    {        
        return mmi_phnset_pwr_on_off_sub_menu_handler((cui_menu_event_struct*)evt,GRP_ID_POWER_ON_OFF_MAIN);
    }    
    return MMI_RET_OK;    
}

#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata , code
#endif
#ifdef __MMI_FILE_MANAGER__
void mmi_fmgr_to_power_on_display_hdlr(mmi_menu_id item_id, const WCHAR* filepath, const srv_fmgr_fileinfo_struct* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_phnset_view_setting_common_forward_from_fmgr(MMI_PHNSET_TYPE_PWRON, filepath, (filetypes_file_type_enum)fileinfo->type);
}

void mmi_fmgr_to_power_off_display_hdlr(mmi_menu_id item_id, const WCHAR* filepath, const srv_fmgr_fileinfo_struct* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_phnset_view_setting_common_forward_from_fmgr(MMI_PHNSET_TYPE_PWROFF, filepath, (filetypes_file_type_enum)fileinfo->type);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_screensaver_set_file
 * DESCRIPTION
 *  Set cache file 
 * PARAMETERS
 *  
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_phnset_pwr_on_off_set_file(void* obj, const WCHAR* file_name)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;
    mmi_setting_display_fmgr_setting_object_struct *fmgr_obj = (mmi_setting_display_fmgr_setting_object_struct*)obj;
    U8 index = fmgr_obj->display_type - MMI_PHNSET_TYPE_PWRON;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ASSERT (index <  MMI_PWR_ON_OFF_DISP_TYPE_NUM);
    if(!file_name)
    {
        return;
    }
    mmi_phnset_pwr_on_off_set_static_id(fmgr_obj->display_type, 0);

    mmi_wcscpy(g_phnset_pwr_on_off_filename[index].file_name, file_name);   

    WriteRecord(
        g_mmi_phnset_pwr_on_off_nvram_id[index].nvram_lid, 
        g_mmi_phnset_pwr_on_off_nvram_id[index].nvram_nid, 
        &g_phnset_pwr_on_off_filename[index], 
        sizeof(mmi_setting_display_cache_file_nvram_struct), 
        &error);        

    mmi_popup_display_simple_ext(STR_GLOBAL_DONE, MMI_EVENT_SUCCESS, GRP_ID_ROOT, NULL);
    mmi_frm_group_close(GRP_ID_POWER_ON_OFF_MAIN);

    mmi_phnset_view_setting_notify_result(MMI_TRUE, PHNSET_WP_SS_SET_NO_ERROR);
}
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_screensaver_get_user_file
 * DESCRIPTION
 *  Get file name 
 * PARAMETERS
 *  
 * RETURNS
 *  WCHAR*
 *****************************************************************************/
WCHAR* mmi_phnset_pwr_on_off_get_user_file(U32 type)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 index = type - MMI_PHNSET_TYPE_PWRON;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ASSERT (index <  MMI_PWR_ON_OFF_DISP_TYPE_NUM);
    mmi_phnset_pwr_on_off_init();
    return g_phnset_pwr_on_off_filename[index].file_name;
}
#endif /* __MMI_FILE_MANAGER__ */

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_get_static_id
 * DESCRIPTION
 *  Get cache file name 
 * PARAMETERS
 *  
 * RETURNS
 *  U16
 *****************************************************************************/
U16 mmi_phnset_pwr_on_off_get_static_id(U32 type)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 index = type - MMI_PHNSET_TYPE_PWRON;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ASSERT (index <  MMI_PWR_ON_OFF_DISP_TYPE_NUM);
    mmi_phnset_pwr_on_off_init();
    return g_mmi_phnset_pwr_on_off_id[index];
}

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_wallpaper_set_static_id
 * DESCRIPTION
 *  Get cache file name 
 * PARAMETERS
 *  
 * RETURNS
 *  U16
 *****************************************************************************/
void mmi_phnset_pwr_on_off_set_static_id(U32 type, U16 id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 index = type - MMI_PHNSET_TYPE_PWRON;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ASSERT (index <  MMI_PWR_ON_OFF_DISP_TYPE_NUM);
    g_mmi_phnset_pwr_on_off_id[index] = id;
    mmi_dispchar_set_img_id(g_mmi_phnset_pwr_on_off_nvram_id[index].cache_id, &id);
    
    if (id == 0)
	{
	   return;
	}

    if (mmi_idle_is_active())
    {
        mmi_idle_display();
    }
}

static void mmi_phnset_pwr_on_off_reset_to_default(U32 type, MMI_BOOL update_nvram)
{
    U8 index = type - MMI_PHNSET_TYPE_PWRON;

    ASSERT (index <  MMI_PWR_ON_OFF_DISP_TYPE_NUM);
    mmi_dispchar_get_img_id(g_mmi_phnset_pwr_on_off_nvram_id[index].default_cache_id, &g_mmi_phnset_pwr_on_off_id[index]);

    if (update_nvram)
    {
        mmi_dispchar_set_img_id(g_mmi_phnset_pwr_on_off_nvram_id[index].cache_id, &(g_mmi_phnset_pwr_on_off_id[index]));
    }

    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_PWR_RST_PWRON_DEFAULT, g_mmi_phnset_pwr_on_off_id[index]);
}

static void mmi_phnset_pwr_on_off_init_int(U32 type)
{
    U8 index = type - MMI_PHNSET_TYPE_PWRON;
    S16 error;

    ASSERT (index <  MMI_PWR_ON_OFF_DISP_TYPE_NUM);
    mmi_dispchar_get_img_id(g_mmi_phnset_pwr_on_off_nvram_id[index].cache_id, &(g_mmi_phnset_pwr_on_off_id[index]));
    
    if ((type = PhnsetGetDisplayType(g_mmi_phnset_pwr_on_off_id[index])) == PHNSET_TYPE_DISP_INVALID)
    {
        mmi_phnset_pwr_on_off_reset_to_default(type, MMI_TRUE);
    }
    else if (type == PHNSET_TYPE_DISP_USER)
    {
        ReadRecord(
            g_mmi_phnset_pwr_on_off_nvram_id[index].nvram_lid, 
            g_mmi_phnset_pwr_on_off_nvram_id[index].nvram_nid, 
            &g_phnset_pwr_on_off_filename[index], 
            sizeof(mmi_setting_display_cache_file_nvram_struct), 
            &error);
    }
}

static void mmi_phnset_pwr_on_off_init(void)
{
    static MMI_BOOL is_init = MMI_FALSE;

    if (is_init)
    {
        return;
    }
	is_init = MMI_TRUE;

    mmi_phnset_pwr_on_off_init_int(MMI_PHNSET_TYPE_PWRON);
    mmi_phnset_pwr_on_off_init_int(MMI_PHNSET_TYPE_PWROFF);
} 
#else
void mmi_fmgr_to_power_on_display_hdlr(mmi_menu_id item_id, const WCHAR* filepath, const srv_fmgr_fileinfo_struct* fileinfo)
{
}

void mmi_fmgr_to_power_off_display_hdlr(mmi_menu_id item_id, const WCHAR* filepath, const srv_fmgr_fileinfo_struct* fileinfo)
{
}

CHAR* PhnsetGetPwrOnFileName(void)
{
    return NULL;
}

#endif /* __MMI_POWER_ON_OFF_DISPLAY__ */ 

